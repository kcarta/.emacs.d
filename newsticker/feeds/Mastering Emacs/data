;; -*- coding: utf-8 -*-
(("Mastering Emacs" "a blog about mastering the world's best text editor" "https://www.masteringemacs.org/feed" (26631 25781 331275 0) feed 0 nil nil ((title nil "Mastering Emacs") (link nil "https://www.masteringemacs.org/feed") (description nil "a blog about mastering the world's best text editor") (link ((href . "https://www.masteringemacs.org/feed") (rel . "self"))) (docs nil "http://www.rssboard.org/rss-specification") (generator nil "python-feedgen") (language nil "en-US") (lastBuildDate nil "Tue, 22 Apr 2025 09:10:53 +0000") (item nil (title nil "Combobulate: Interactive Node Editing with Tree-Sitter") (link nil "https://www.masteringemacs.org/article/combobulate-interactive-node-editing-treesitter?utm_source=newsletter&utm_medium=rss") (description nil "Editing code using a concrete syntax tree may seem straightforward, but it's a complex task fraught with challenges. For every command that modifies the code, there's ample room for ambiguity. What if there are multiple legal choices available? How do you create a user experience in Emacs that not only displays the intended changes but also caters to the needs of power users seamlessly? Here I talk about how I've solved that problem in Combobulate.") (encoded nil "
<p class=\" text-justify drop-cap\">Recently, I talked about the challenges around improving <a href=\"/article/combobulate-structured-movement-editing-treesitter\" class=\" article-link\">Combobulate</a>, my package that adds structured editing and movement to Emacs, so navigation is <a href=\"/article/combobulate-intuitive-structured-navigation-treesitter\" class=\" article-link\">intuitive and works the way a human expects</a>. Briefly, instead of relying on elaborate guesswork that breaks easily, there is now a little mini-language that captures how to pluck the right node from the concrete syntax tree provided by tree-sitter, a library that makes it a snap to parse and access said tree of any language for which there is a supported grammar.</p>
<p class=\" text-justify\">Intuitive navigation is hard because if you ask a human developer to navigate up, down, left or right in their code, they can do so effortlessly, as there’s little ambiguity around, say, what constitutes the next “line of code”. Good luck asking a computer to make the right choice when it’s got a baker’s dozen of wildly different nodes to contend with. Hence the mini-language.</p>
<p class=\" text-justify\">But I’ve talked about <a href=\"/article/combobulate-intuitive-structured-navigation-treesitter\" class=\" article-link\">that already</a>. You should read that article first, if you haven’t. So today I’d like to talk about a related issue: when you ask Combobulate to do something – say, cloning the node at point, and in effect duplicating a piece of code – and Combobulate can’t decide which node is the right one, because there’s more than one legitimate node to clone at point.</p>
<p class=\" text-justify\">The problem space is similar to intuitive navigation, but with a twist. When we navigate we have a limited number of sensible directions we can move (up, down, left, right) and the bindings to go with it – <code>C-M-n</code> to move to the next sibling, <code>C-M-u</code> to move up to a parent, etc. – and when we invoke them we’d expect Emacs to just, you know, go to the right place. You don’t <em>really</em> want annoying minibuffer prompts, banners, billboards, smoke signals, crop circles or much of anything else to petition you and impede your train of thought. You just want to scoot away and not have Emacs stop you to ask for directions.</p>
<p class=\" text-justify\">Fair enough. Combobulate goes to a lot of trouble to try and pick the right thing for you in most cases, whether you’re editing or moving. Sometimes, though, you must ask the user to make a choice.</p>
<p class=\" text-justify\">And what’s the best way to do that?</p>
<H2 id=\"decisions-decisions\">Decisions, decisions…</H2>
<figure>
<img src=\"/static/uploads/combobulate/combobulate-python-indent.gif\" alt=\"\" class=\" center-block\">
<figcaption>The indentation 'carousel' in action. Tapping <code>TAB</code> at the start of a statement and Combobulate will calculate all possible indentation levels and let you choose the one you want interactively.</figcaption>
</figure>
<p class=\" text-justify\">It’s a quagmire, really, because I’d had this issue multiple times where I really wanted some way of asking the user to make a choice. I had played around with the obvious contenders: some form of <code>completing-read</code> (Emacs’s way of doing <a href=\"/article/understanding-minibuffer-completion\" class=\" article-link\">minibuffer completion</a>) and a hook to update the buffer as you browse through the candidates. It didn’t really work all that well as it assumes you have a completion system that lets you cruise through the candidates interactively. Not everyone uses that; default Emacs has you <code>TAB</code> endlessly to scratch out a completion like some sort of neolithic farm hand. So that method wouldn’t work well for people who use that type of completion, and it also has the annoying problem of feeling like it was the wrong tool for the job. What if someone uses Helm or any number of other completion systems?</p>
<p class=\" text-justify\">I brainstormed some other methods like a <a href=\"/article/introduction-magit-emacs-mode-git\" class=\" article-link\">Magit</a> transient popup-like thing that you’d pick nodes from, but it also felt cumbersome and I couldn’t figure out how to get transient to do what I wanted it to do.</p>
<p class=\" text-justify\">So I did what I always do: I got bored and went off in search of something else to do.</p>
<p class=\" text-justify\">Right around that time I’d added a primitive version of “expand region”. It is a simple concept, really: given successive key presses, expand the region to incorporate larger and larger structural elements, starting from point. It’s a nifty way of picking things that ordinary Emacs methods struggle to do well at, though I never cared much for it pre-tree-sitter as I found it too imprecise. Lots of people love it, though, and I figured that it’d be super handy with tree-sitter, as it’s so granular, and I wanted to support a wide range of workflows. So I added a basic version in about 30 minutes, and off it went to Github.</p>
<figure>
<img src=\"/static/uploads/combobulate/combobulate-expand-region.gif\" alt=\"\" class=\" center-block\">
<figcaption>Combobulate can expand the region with <code>M-h</code>. It highlights the item ahead of the current region,  to give you an idea of where you are going. A customizable feature to let you select by number is also enabled here, and Combobulate will show you how much it has selected in the tree view as well.</figcaption>
</figure>
<p class=\" text-justify\">A few days later I got a polite and <em>totally obvious in hindsight</em> request to make possible to <em>shrink</em> the region. It’s all too easy to overshoot your mark as you’re tapping away and, having done so, you’d have no recourse but to start from scratch. Argh. Terrible UX!</p>
<p class=\" text-justify\">So I put on my thinking cap and started wondering how I could crowbar something into <code>combobulate-mark-node-dwim</code> (bound to <code>M-h</code>) so it can toggle the direction and, I… I realized I should just re-use <em>another</em> feature I’d added some months prior: a node / region-based indentation command in Python that lets you interactively browse and select the indentation level you want your node or region to have. (Believe it or not, but Emacs’s crummy Python mode can’t cycle all possible indentations of a region. It’s madness. The crux of the code to build it is <em>right there</em>, too. No TS required at all.)</p>
<p class=\" text-justify\">The python indentation command (see above) acts like a carousel: keep moving in one or the other direction and you’ll wind up back where you started. That’s great for a wide range of things, particularly when you’re not sure how many finger taps away something is: is it two or <em>three</em> indentations I want? Tap a bit and find out, as your buffer updates automatically.</p>
<p class=\" text-justify\">The indentation command was also a bit ham fisted in some ways, but it was a huge improvement over the ghastly python-mode indentation logic you had before which involved manual tedium and <code>C-x TAB</code> to indent by column.</p>
<p class=\" text-justify\">I gambled that if I could file off the rough edges, and build some tooling around it into Combobulate, it could work well for a wide range of tasks. I sat down and spent a fair bit of time hammering out a system of rules and concepts that makes for, I think, a pleasant user experience. Carousel seems like as good a name for it as anything, so that’s what I’ll call it from now on.</p>
<p class=\" text-justify\">If you’re already using Combobulate you’ll of course be familiar with the carousel concept already as it’s been in Combobulate for quite a while.</p>
<H3 id=\"reading-a-key-vs-minibuffer-prompting\">Reading a Key vs Minibuffer Prompting</H3>
<p class=\" text-justify\">Let me explain. There’s a philosophical view (and some who disagree with this) that certain user-facing actions in Emacs don’t require a full-blown <em>minibuffer prompt</em> and that <em>reading a key</em> is enough. Which one is the right choice is rarely too contentious, but in a few instances you could lean towards either method, and that’s usually where tempers flash.</p>
<p class=\" text-justify\">Reading a key is mechanically simple: you call <code>read-key</code> (or one of its close relatives) and Emacs will patiently wait for a <em>key</em>; any key or key sequence, really. There is no minibuffer history to contend with; recursive minibuffers don’t apply, so you can’t switch out of the minibuffer window, either. You can display a prompt, but the main focus is really about user anticipation: once you know how the command works, and you know it expects a key, you just type it and get on with it. It is about as zero-effort as requesting user input could ever be. It’s used in a wide range of contexts in Emacs today, and it’s perfect when all you need from a user is a key.</p>
<p class=\" text-justify\">The alternative is <em>minibuffer prompting</em> which is the all-singing, all-dancing prompt experience you know already.</p>
<p class=\" text-justify\">I want Combobulate’s carousel to read a key: the reason is that it means I can capture the key you typed and, if I decide I have no use for it, I can put the key back on the <code>unread-command-events</code>. I could in theory still do that with the minibuffer prompt, but I still have to deal with the fact that it’s a complex system designed for non-trivial user interactions.</p>
<p class=\" text-justify\">Reading a key is simpler, and that’s important because it meshes well with the idea that the carousel is there to offer a seamless transition in to, and out of it.</p>
<H3 id=\"seamless-transition\">Seamless transition</H3>
<p class=\" text-justify\">If you want to expand the region with <code>M-h</code>, you probably want to follow that up with another key. Perhaps <code>C-w</code> to kill the region you just expanded. By <em>reading the key</em> I can separate <code>TAB</code> and <code>S-TAB</code> (to cycle to the next and previous choice in the carousel) from irrelevant keys the carousel does not care about. Then, by putting the key the carousel <em>does not</em> care about back into the event loop, you can have Emacs carry out what ever it was going to do as though the carousel wasn’t there at all.</p>
<p class=\" text-justify\">End result? You can hit <code>M-h</code> and tap, tap, tap and press any other key that is not recognized by the carousel, and it’ll just execute the key as though you’d never had the carousel at all. No transition; no annoying in-your-face “are you really sure?” prompting; and no thinking required. It behaves the way an experienced Emacs user would expect it to work, and as if you never had the carousel active, even though, there it is, indicating in the echo area that it’s active and awaiting your input.</p>
<H3 id=\"maintaining-your-tempo\">Maintaining your tempo</H3>
<p class=\" text-justify\">I mentioned that <code>TAB</code> and <code>S-TAB</code> cycle nodes. But if you tap, say, <code>M-h</code> for the first time, the carousel interface appears, and you can then repeatedly type <code>M-h</code> again which is the same as pressing <code>TAB</code>. That way you don’t have to move your fingers away from the triggering key and that helps preserve tempo. It makes for a smoother and easier user experience as you don’t have to context shift: oh I hit <code>M-h</code> and now I have to <code>TAB</code> to expand.</p>
<p class=\" text-justify\">Because I look up the key in a boring, old <a href=\"/article/mastering-key-bindings-emacs\" class=\" article-link\">keymap</a> it’s easy for anyone to come along and modify it if they want the carousel to use other keys. It also means I can add additional keys that only apply to specific commands: Combobulate’s expand region functionality lets you cycle between the next and previous candidates with <code>M-h</code> and <code>M-S-h</code>, respectively.</p>
<p class=\" text-justify\">The third reason why it’s useful to have the same key is that some operations are incredibly destructive and may leave your buffer in a “broken” state: the syntax is invalid, and tree-sitter may struggle to glue it back together. Having a cohesive view of the buffer at the beginning and operating on it from a clean slate is crucial.</p>
<H3 id=\"cohesion\">Cohesion</H3>
<p class=\" text-justify\">Let’s say you’re deleting code as part of a refactoring operation you’re doing. As you go about doing it, you’re definitely going to leave your code in a broken state at some point. That’s all well and good: you’re a human, and you can fix it.</p>
<p class=\" text-justify\">Tree-sitter has error-correction built into its parser, but just because it can mend, and partially recover from, broken syntax, does not mean it leaves the resulting tree in a state where an automated tool like Combobulate can make sensible decisions.</p>
<p class=\" text-justify\">That’s particularly true of highly destructive operations like Combobulate’s <em>splicing</em> where you’re eliding text as you try to snip and glue two pieces of code back together: the code you’ve decided to keep, and the code <em>around</em> the code you’re keeping that the splice deleted. Think of HTML where you want to delete the outer tag but keep the things inside it - that’s one part of what you can do with splicing.</p>
<p class=\" text-justify\">The problem is, maybe you want to splice two times, but the first splice irrevocably breaks your code in such a way that you’d never be able to make it to the second splice. And how do you delete the “outer” something of any old random piece of code, anyway? Take a look at the figure below to see what I mean.</p>
<figure>
<img src=\"/static/uploads/combobulate/combobulate-splice-go.gif\" alt=\"\" class=\" center-block\">
<figcaption><code>M-&lt;up&gt;</code> splices up, keeping the siblings, which in this case is one line of code, and then deletes successive parents until it's at the root of the buffer. Note that along the way it leaves the tree in a broken state.</figcaption>
</figure>
<p class=\" text-justify\">Combobulate can splice nearly anything into something else. But that doesn’t mean it makes <em>syntactic sense</em> to do so. Maybe you do want it in a broken state; perhaps you want to tweak something to make it legal syntax again. Combobulate can’t read your mind so it has to calculate all possible paths.</p>
<p class=\" text-justify\">If the splice up command – as it used to do – only went up one level, you could easily break the tree in such a way that you wouldn’t be able to splice again. A broken tree often begets an even more broken tree.</p>
<p class=\" text-justify\">To work around <em>that</em>, the carousel virtualizes editing and computes everything on the fly, starting from the clean slate your buffer is (presumably!) in when you first initiate the command.</p>
<H3 id=\"virtualized-editing\">Virtualized Editing</H3>
<figure>
<img src=\"/static/uploads/combobulate/combobulate-clone-dwim.gif\" alt=\"\" class=\" center-block\">
<figcaption><code>C-c o c</code> clones a node and, if there are ambiguities, Combobulate will let you cycle through all the choices and interactively preview the change it'll make to your buffer.</figcaption>
</figure>
<p class=\" text-justify\">This was one of the harder things to build.</p>
<p class=\" text-justify\">Tree-sitter generates your tree on-the-fly as you type. Every key press compels tree-sitter to rebuild all or parts of the tree. That is its main benefit, and a lot of work was put into making it fast enough for even the fastest typist to not experience any lag or latency.</p>
<p class=\" text-justify\">Unfortunately, if you ask for a node and subsequently edit the buffer, that node is invalidated and marked outdated. If you try to do anything with it – anything at all, even asking it for its type or where it was in the buffer – it throws an error in your face.</p>
<p class=\" text-justify\">So you can’t collect the node(s) you want at the start and then modify the buffer in-situ, like the indentation example above shows. The first tap would kill the old nodes (we changed the indentation!), and render that approach useless.</p>
<p class=\" text-justify\">Combobulate constructs proxy nodes, and almost every part of Combobulate will accept these proxy nodes in lieu of the real deal. They are slimmed-down versions of the real things, but they reify the most important things we’d want to cling to: the point range in the buffer; the type; the text contained therein; etc.</p>
<p class=\" text-justify\">So when you ask Combobulate to present a carousel it actually virtualizes the nodes before any sort of change can take place. It neatly skirts most issues and lets you write code that can in theory modify the buffer without worrying about your nodes expiring when you touch the buffer. Of course, modifying the buffer means you hold on to outdated information, and Combobulate is no oracle, so if you make substantial changes, the proxy nodes might be thoroughly useless.</p>
<p class=\" text-justify\">Luckily, that’s usually not a problem because of Combobulate’s refactoring display system.</p>
<p class=\" text-justify\">Part of the challenge around the proxy node thing is that most commands do small, localized editing operations: indent some code; expand an envelope; splice some code; clone a node. You get the idea.</p>
<p class=\" text-justify\">As you tap through the carousel’s list of valid nodes, it should show you what would happen if the transformation you asked for is carried out on the currently selected node.</p>
<p class=\" text-justify\">For this to work well, the carousel works in unison with Combobulate’s refactoring system. The latter sounds fancier than it really is: all it lets you do is describe simple transformations, and visual ones to aid users, to make to a buffer. Add in the carousel’s ability to use <em>undo change groups</em> to revert buffer changes between choices and you can have visible modifications made to your buffer that is properly restored as you cycle through the choices.</p>
<p class=\" text-justify\">I think it’s important that, if you ask a command to make changes to your buffer, and if there’s more than one way to make that change, that you can preview all possible options. Combine it with the carousel interface and you’re afforded a fair amount of slop when it comes to point positioning.</p>
<p class=\" text-justify\">And if you don’t like the change? You can hit <code>C-g</code>, as with most things in Emacs, to abort the command.</p>
<p class=\" text-justify\">So that’s the carousel interface. I think it makes it much easier to visualize what’s going to happen in a non-committal way, and at the same time scroll through the valid node choices available to you.</p>
") (guid ((isPermaLink . "false")) "/article/combobulate-interactive-node-editing-treesitter") (pubDate nil "Sat, 23 Mar 2024 14:04:38 +0000")) (item nil (title nil " The Emacs 29 Edition of Mastering Emacs is out now") (link nil "https://www.masteringemacs.org/article/the-emacs-29-edition-of-mastering-emacs-out-now?utm_source=newsletter&utm_medium=rss") (description nil "The Emacs 29 edition of Mastering Emacs is now available.") (encoded nil "
<p class=\" text-justify drop-cap\">It’s taken a little bit longer than I would have liked to get the next edition out the door. I also felt the site needed a lick of paint which, if you’re a regular and astute reader, you may have noticed already.</p>
<p class=\" text-justify\">But as I explain in the book update below, the two headline features are tree-sitter support and Eglot. To say nothing of the <a href=\"/article/whats-new-in-emacs-29-1\" class=\" article-link\">million other new Emacs 29.1 features</a> that were added.</p>
<p class=\" text-justify\">A couple of years ago, I wrote about <a href=\"/article/tree-sitter-complications-of-parsing-languages\" class=\" article-link\">Tree Sitter and the Complications of Parsing Languages</a>. In it, I talk about the immense difficulties around parsing languages in a way that is both useful and consistent for a wide range of programming languages and structured texts. Tree-sitter is one of the few that have managed to cross that chasm; no small feat, in my opinion.</p>
<p class=\" text-justify\">The other major inclusion is Eglot. It’s another smart and sensible addition to Emacs core. Combined with tree-sitter, you now have access to top-notch syntax highlighting and IDE-like features right out of the box.</p>
<H2 id=\"edition-update\">2024 Edition Update</H2>
<p class=\" text-justify\"><em>This is 2024 Edition update the excerpt from the book.</em></p>
<p class=\" text-justify\">Emacs 29 continues the long-running trend of keeping up with advances in technology. That is commendable. Emacs is an old piece of software, and yet it is continuously improving.</p>
<p class=\" text-justify\">One of the hardest things to get right in a text editor is syntax highlighting (<em>font locking</em> in Emacs parlance) and writing a robust indentation engine. You see, when Emacs – and many other editors, old and new – syntax highlight your source code, they do so using <em>regular expressions</em>, a terse method for matching text using pattern matching. Regular expressions are great; they’re a succinct way of matching and extracting important information from text. They are the backbone of syntax highlighters nearly everywhere, but they also have a flaw: they can be imprecise, and can impede performance if they are poorly written.</p>
<p class=\" text-justify\">A regular expression also cannot contextualize what it is matching: just that it did (or did not) match something. For a wide range of granular tasks, it is simply not possible to rely on regular expressions. That is a problem as you want as much precision as you can get. Yet it’s often impossible to tell some things apart with a regular expression, such as whether a series of characters is a variable or a function call. The same series of characters may have one meaning in one context, and an altogether different one in another. Regular expressions are rarely powerful enough to capture that nuance. And so most text editors build their syntax highlighting and indentation engines with a medley of regular expressions and hand-tuned, imperative code to try to work around the limitations of the former.</p>
<p class=\" text-justify\">Good news, then, as Emacs 29 adds optional support for <a href=\"/article/how-to-get-started-tree-sitter\" class=\" article-link\">tree-sitter</a>, a parser library with an exacting eye for source code parsing that constructs a <em>Concrete Syntax Tree</em> from any text for which it has a valid grammar. Such a tree is the perfect medium for a computer (or willing user) to query. It makes correct syntax highlighting possible with little more than a few dozen lines of code. It also adds the tantalizing promise of <em>structured editing and movement</em>, a sprawling concept that reuses the tree-like structure tree-sitter yields to offer unparalleled editing and movement in your code base.</p>
<p class=\" text-justify\">Tree-sitter’s not the only game in town. What it <em>does</em> bring to the table, and what has eluded most other attempts (in Emacs and beyond), is that is has the largest repository of parsers for both common and uncommon languages and structured text files. Tree-sitter is thus capable <em>and</em> popular. It helps that it is quite straightforward to write your own parser using tree-sitter’s tooling. The cherry on top is a query language to quickly find and match segments of the parsed <em>tree</em> that it emits. That is perhaps its ace in the hole: being able to ask it to show you (for example) all the functions that contain one or more variables with a given name is a powerful feature indeed. Modeled on LISP’s S-expressions, the query language also feels right at home in an Emacs ecosystem.</p>
<p class=\" text-justify\">Presently, the feature is optional, as you must compile Emacs with tree-sitter support. So it is unlikely to replace, wholesale, the existing major modes and the old way of doing things. But it’s a large step forward for Emacs, as it makes writing syntax highlighting and indentation code <a href=\"/article/lets-write-a-treesitter-major-mode\" class=\" article-link\">downright easy</a>. Its adoption into Emacs core is a positive development, and a repudiation against the entrenched belief that Emacs can never fundamentally change. <em>Font locking</em> in Emacs was first introduced around 35 years ago, and now there is a new way – and often much better way – than the old regular expressions. Its successful integration into Emacs is also reflected in the wider Emacs community where it has proven to be a popular feature, despite the fact that tree-sitter is, being new to Emacs, cumbersome to set up and use.</p>
<p class=\" text-justify\">The other major inclusion is Eglot, a client that understands the language server protocol (LSP). Eglot adds IDE-like features to any buffer for which there is a language server available. It’s designed to work with nothing more than base Emacs and the requisite language server. Provided you’ve got your language server set up, all you need to type is <code>M-x eglot</code> (or select <code>Tools -&gt; Language Server Support</code>) to get started. Eglot’s been around for a long time on <a href=\"http://elpa.gnu.org/\" class=\" article-link\">ELPA</a>, an Emacs package repository. Now it’s built into Emacs.</p>
<p class=\" text-justify\">Both capabilities are capstones in an otherwise packed release full of exciting improvements and fixes. If you’re not using Emacs 29 already, you should definitely upgrade.</p>
") (guid ((isPermaLink . "false")) "/article/the-emacs-29-edition-of-mastering-emacs-out-now") (pubDate nil "Mon, 22 Jul 2024 14:17:36 +0000")) (item nil (title nil "Combobulate: Bulk Editing Tree-Sitter Nodes with Multiple Cursors") (link nil "https://www.masteringemacs.org/article/combobulate-bulk-editing-treesitter-nodes-multiple-cursors?utm_source=newsletter&utm_medium=rss") (description nil "Combobulate's long had the ability to bulk edit matches using the multiple cursors package, but building seamless and useful bulk editing tooling is not as straightforward as it seems. And what if you don't use multiple cursors? Combobulate now has its own field editor to help you bulk edit.") (encoded nil "
<p class=\" text-justify drop-cap\">I’m sure you’ve found yourself in this situation: you want to edit something, but in multiple places, and at the same time. You’re busy; you don’t want to repeat yourself, and this is the twenty-first century and we <em>do</em> have the technology to do this!</p>
<p class=\" text-justify\">I’ve talked about this too-common problem before: <a href=\"/article/iedit-interactive-multi-occurrence-editing-in-your-buffer\" class=\" article-link\">multi-occurrence editing with iedit</a> is one such package; the ubiquitous, and excellent, <a href=\"https://github.com/magnars/multiple-cursors.el\" class=\" article-link\">multiple cursors</a> package is another common one.</p>
<p class=\" text-justify\">Editing multiple occurrences either simultaneously or in sequence is not a new invention. Good, old <code>C-M-%</code> (<code>M-x query-replace-regexp</code>) is sometimes the right choice if you can capture your matches and desired replacements with a regular expression. If that approach does not work, then why not reach out and touch a bunch of stuff with multiple cursors? If you dislike multiple cursors, you can confect a <a href=\"/article/keyboard-macros-are-misunderstood\" class=\" article-link\">fancy keyboard macro</a> to do the work instead (sadly, the fans of keyboard macros are far too occupied to join us right now, as they are busy trying to re-record or edit the macro steps so it works properly.)</p>
<p class=\" text-justify\">No matter the tool, you’re still limited by your ability to collect the <em>right</em> places to edit. These tools can in principle drop cursors anywhere you want them to, but the problem is that outside of a handful of obvious things (same column offset on each line; each word or symbol matching something; the cadence of text using <code>forward-word</code>; etc.) you must compel these tools to place the cursors where you want them to, and that is often manual, verging on tedious, and not always possible.</p>
<p class=\" text-justify\">That’s where <a href=\"/article/tree-sitter-complications-of-parsing-languages\" class=\" article-link\">tree-sitter</a> and its concrete syntax tree of your source code enter the frame.</p>
<figure>
<img src=\"/static/uploads/combobulate/combobulate-field-editor-rename.gif\" alt=\"/static/uploads/combobulate/combobulate-field-editor-rename.gif\" class=\" center-block\">
<figcaption>Here I am using Combobulate’s node editor, bound to <code>C-c o t x</code>, to pick the node at point’s text (here named <code>n</code>) and then I progressively expand the search scope for similarly-named nodes before renaming them all using Combobulate’s new field editor. More on that below.</figcaption>
</figure>
<p class=\" text-justify\">In <a href=\"/article/combobulate-intuitive-structured-navigation-treesitter\" class=\" article-link\">Combobulate, my easy-to-use package</a> that adds navigation and editing to tree-sitter-supported languages, that was one of the first things I wanted to support way back in the day when I first built the prototype version.</p>
<p class=\" text-justify\">You see, with a concrete syntax tree, it’s trivial to throw down a cursor at every member of an array, for example, but <em>precisely</em> so there’s no worry about accidentally picking things that may <em>look</em> like an array element – something that is bound to happen if you were to try and do this using more naive means, like with imperative code or regular expressions – but isn’t. If you’ve ever over- or under-selected stuff with a keyboard macro or the likes of multiple cursors, then you know what I mean!</p>
<p class=\" text-justify\">That’s why I want to talk about Combobulate’s cursor editing functionality; some of the unexpected challenges around building it; and a new method of doing cursor editing without relying on third-party tools like multiple cursors.</p>
<H2 id=\"picking-the-right-things-with-a-query\">Picking the Right Things With a Query</H2>
<p class=\" text-justify\">Before I get into all the ways that Combobulate can help you edit with multiple cursors, I want to first outline some of the challenges around picking things the things you want to edit. For all the talk I did around how much better a concrete syntax tree is – and it <em>is</em> infinitely better – there are snags.</p>
<p class=\" text-justify\">Combobulate, when I first set out to write it, had to work uniformly across a wide range of languages that I used professionally: Python, bash, Typescript + TSX, HTML, CSS, etc.</p>
<p class=\" text-justify\">If you’re at all familiar with tree-sitter, you probably know that you can build s-expression-alike queries, and that is one of the main ways of interfacing with the tree it makes.</p>
<p class=\" text-justify\">Here’s one such made-up example, and it (or something akin to it) is a common thing to want to edit. Given the following query and a starting node, you can tag nodes in the query with <code>@mytag</code> to indicate that you want tree-sitter to return said nodes, provided there are matches of course:</p>
<pre><code>(object
   (pair
      key: (_) @match))</code></pre>
<p class=\" text-justify\">How do you edit the keys in an object/dictionary without tree-sitter? It’s easy enough with traditional tools if the keys line up in your buffer with surgical precision. But what if they don’t? Perhaps they’re disordered and not formatted well, so you can’t just go to the next line with the same offset, or hope <code>forward-sexp</code> and friends can get you there. Tree-sitter makes it a cinch to pluck them anyway.</p>
<p class=\" text-justify\">The example above works by tagging any node that matches <code>(_)</code> (we could limit it to <code>(string)</code> also, for example, to collect only string keys) using the <code>key:</code> field, which is inside a <code>pair</code>, which is also inside an <code>object</code>. Here <code>@match</code> is a made-up tag, so we’d have to do some leg work to feed it to multiple cursors, of course, but that is not terribly hard.</p>
<p class=\" text-justify\">That’s also how TS-based syntax highlighting works: you tag stuff with the name of the face (such as <code>@font-lock-string-face</code>) you want, and Emacs’s font lock engine colors the matches according to the list of queries you have given it. Same query engine, distinct use cases.</p>
<p class=\" text-justify\">It’s a defining feature of tree-sitter. I doubt it would have seen much adoption without it, to be honest. Combobulate has an excellent <a href=\"/article/combobulate-editing-searching-new-query-builder\" class=\" article-link\">interactive query builder</a> complete with code completion and syntax highlighting, so you can try it out yourself. (Spoiler alert: you can tell Combobulate to edit stuff based on a query. Give it a try!)</p>
<p class=\" text-justify\">For all the marvelous benefits of tree-sitter’s query matching engine, it has a humongous, frustrating black mark against it.</p>
<H3 id=\"when-queries-fail\">When Queries Fail</H3>
<p class=\" text-justify\">Can you guess what it is?</p>
<p class=\" text-justify\">Let me show you a picture — it’ll give it away:</p>
<figure>
<img src=\"/static/uploads/combobulate/combobulate-query-matches-all-keys.png\" alt=\"/static/uploads/combobulate/combobulate-query-matches-all-keys.png\" class=\" center-block\">
<figcaption>Combobulate’s query builder (<code>C-c o B q</code>) is highlighting all the matches using the aforementioned query. Observe how it matches all nested keys also.</figcaption>
</figure>
<p class=\" text-justify\">It’s recursive. That is a useful property for highlighters or general-purpose “sally forth and find me all matches” needs, which is admittedly a large tract of why you’d use the query engine.</p>
<p class=\" text-justify\">But it is not so useful if you want to edit just <em>one</em> level of keys in an object, or – as I discovered when I started using it in anger – the start and end elements in HTML or TSX. Any sort of self-similar nodes (nested <em>anything</em>, like HTML tags) are immediately snared by this feature.</p>
<p class=\" text-justify\">You know, I just wanted to add basic multi-editing to early versions of Combobulate: simultaneously renaming matching HTML tags. That sort of thing. The query system seemed like the perfect abstraction. I could <em>literally describe what I wanted to edit</em>.</p>
<p class=\" text-justify\">Womp, womp. Except I couldn’t. Not with the query engine, mind — not without attempting error-prone post-processing to weed out false positives, somehow. But that, in my mind, ran against the philosophy of capturing the requirements in a declarative query, and that Combobulate should not special-case code for each language it supports. (That is an adamantine rule that still stands.)</p>
<p class=\" text-justify\">The workaround, if you can call it that, is to anchor the query to the root node – that “disables”, by way of exclusively matching all of a node’s parents, for there is just one root node in a tree – the recursive check. Thus, given a node in a tree, it is possible to construct a query that matches <em>just</em> that node, though you would have to describe the entire relationship of the tree, from leaf-to-trunk, and all its siblings along the way.</p>
<p class=\" text-justify\">So to match an object, without recursion gumming things up, in Javascript, nested in a function somewhere, would look like this, but far more complex in real life:</p>
<pre><code>(program
  (some_function
     (something_else
       (...
          (object ...)))))</code></pre>
<p class=\" text-justify\">Alas, that is not exactly a solution worth talking about.</p>
<p class=\" text-justify\">So how to fix it, then?</p>
<H3 id=\"the-query-fix\">The Query “Fix”</H3>
<p class=\" text-justify\">So I “fixed” it by reimplementing a large proportion of the tree-sitter query engine in elisp. That was a complex project that took quite a long time to get “right”, for some definition of right, when I wrote it some years ago now. The implementation surely still has bugs. I know it does, because tree-sitter’s <em>official</em> query builder still has a steady stream of bug fixes getting merged. And if <em>that</em> is still buggy, then so is mine!</p>
<p class=\" text-justify\">It’s also kinda slow, so it’s never going to help you font lock your code! I also decided to take a few of the lesser-used features of Emacs core that are perfect for this type of Computer Science problem for a spin: generator functions using <code>iter-defun</code> and friends. Generators are implemented entirely using Lisp macros, which is kind of neat. Writing all that <em>Lisp macrology</em> must’ve been a fun hobby project to build and design, for sure, but it’s not so fun to use: it feels quite slow and cannot be debugged easily. And good luck understanding the macroexpanded code it makes. <em>Yikes</em>.</p>
<p class=\" text-justify\">So. Combobulate’s query engine is not designed to replace tree-sitters’. It’s now a complement to the little declarative mini-language in Combobulate that I settled on so I could support <a href=\"/article/combobulate-intuitive-structured-navigation-treesitter\" class=\" article-link\">intuitive, structured navigation</a> (called the <em>procedures</em>).</p>
<p class=\" text-justify\">That means it’s possible to ask Combobulate to find stuff the normal way, and then use its (or TS’) query language for finesse:</p>
<div class=\"sourceCode\" id=\"cb3\"><pre class=\"sourceCode commonlisp\"><code class=\"sourceCode commonlisp\"><span id=\"cb3-1\"><a href=\"#cb3-1\" aria-hidden=\"true\" tabindex=\"-1\" class=\" article-link\"></a>(procedures-sequence</span>
<span id=\"cb3-2\"><a href=\"#cb3-2\" aria-hidden=\"true\" tabindex=\"-1\" class=\" article-link\"></a>   '((:activation-nodes</span>
<span id=\"cb3-3\"><a href=\"#cb3-3\" aria-hidden=\"true\" tabindex=\"-1\" class=\" article-link\"></a>      ((:nodes (<span class=\"st\">\"tag_name\"</span>) :position any :has-ancestor (<span class=\"st\">\"element\"</span>)))</span>
<span id=\"cb3-4\"><a href=\"#cb3-4\" aria-hidden=\"true\" tabindex=\"-1\" class=\" article-link\"></a>      :selector (:choose parent :match-query</span>
<span id=\"cb3-5\"><a href=\"#cb3-5\" aria-hidden=\"true\" tabindex=\"-1\" class=\" article-link\"></a>                         (:query</span>
<span id=\"cb3-6\"><a href=\"#cb3-6\" aria-hidden=\"true\" tabindex=\"-1\" class=\" article-link\"></a>                          (_ (start_tag (tag_name) @match)</span>
<span id=\"cb3-7\"><a href=\"#cb3-7\" aria-hidden=\"true\" tabindex=\"-1\" class=\" article-link\"></a>                             (end_tag (tag_name) @match))</span>
<span id=\"cb3-8\"><a href=\"#cb3-8\" aria-hidden=\"true\" tabindex=\"-1\" class=\" article-link\"></a>                          :engine combobulate)))))</span></code></pre></div>
<p class=\" text-justify\">For example, you can use <code>C-c o t c</code> (cursor edit by sequence) to edit matching HTML tags, and when you do so, this is the DSL declaration it “runs” to determine what to do. (If you’re inside a <code>tag_name</code> and it has an ancestor <code>element</code> then trigger the <code>:selector</code>)</p>
<p class=\" text-justify\">The underlying query (see <code>:query</code>), such as it is, works fine in TS’s query engine also, but with the side-effect of being recursive.</p>
<p class=\" text-justify\">I wrote the query engine back when I thought queries would play a much larger role in Combobulate. Back then, I naively assumed (as you do) that with the bountiful choices made available by a concrete syntax tree, all I had to do was write The Right Query and I could avoid a lot of imperative hand-wringing.</p>
<p class=\" text-justify\">As it turns out, the query engines (plural) are useless for most things related to structured navigation and editing. So despite the <em>theoretical</em> utility of the query engines, in reality I am slowly replacing most of the queries – the few that still remain today – with the DSL.</p>
<p class=\" text-justify\">The DSL is ironically better at picking things, despite its imperative-yet-declarative nature than an all-singing, all-dancing but weirdly limiting set of query engines.</p>
<p class=\" text-justify\">One example of where the DSL wins is <a href=\"/article/combobulate-intuitive-structured-navigation-treesitter\" class=\" article-link\">sibling navigation</a>, a topic I have covered at length before. Before I came up with the DSL, I’d started the arduous task of using building queries to pick all the keys in a dictionary; the arguments in a function definition; and so on, and so forth. Far too tedious as the query language is too limiting.</p>
<p class=\" text-justify\">Who knew?</p>
<p class=\" text-justify\">So, today, the query engines remain useful mostly for ad hoc highlighting; bulk editing, yes, still; and deft selection of nodes when the mini-DSL fails to do the job.</p>
<p class=\" text-justify\">You might wonder why I haven’t just extended my query language to suit my every need.</p>
<p class=\" text-justify\">The answer is that I feel that it is not really feasible to express these ideas in a language that – if we are to hew somewhat close to the original intent of the tree-sitter query language, and if we do not do that, then my DSL is already such a language! – is boxed in by its desire to be (as it should be!) a pattern matching language with a bunch of deterministic finite automata tacked on to solve the unenviable problem of having to support optional matches, quantifiers, negation, and so on.</p>
<p class=\" text-justify\">The DSL meanwhile relies on the idea of doing simple node type matching and then ascending or descending the tree to match other things based on simple set-theoretic filters and a handful of hardcoded instructions, such as “give me all the things that can go in an <code>if</code> statement except for this or that and then give me all siblings that match something else entirely”.</p>
<p class=\" text-justify\">So that is a brief summary of how the query engine looks like a panacea, but is ultimately not a great fit for most multi-cursor editing tasks, and indeed most precision editing and movement tasks, as you’d have to fight it and write a lot of imperative code anyway.</p>
<p class=\" text-justify\">Right. Let’s talk about some fun things instead.</p>
<H2 id=\"cursor-editing\">Cursor Editing</H2>
<p class=\" text-justify\">Combobulate’s had cursor editing for a long time. I recently rewrote the system to get rid of what was formerly known as <em>cluster editing</em>: basically the stuff you just read about. Like editing matching HTML tags.</p>
<p class=\" text-justify\">That feature is now called <em>sequence editing</em>, which uses the procedure system to edit any <em>sequence</em> Combobulate knows about, such as the oft-repeated HTML tags.</p>
<p class=\" text-justify\">My impetus for doing this is that the bulk of the cluster editors I’d written were a parallel way of doing sibling editing before I had proper, reliable <a href=\"/article/combobulate-intuitive-structured-navigation-treesitter\" class=\" article-link\">sibling navigation</a>.</p>
<p class=\" text-justify\">Sibling navigation is one of the most important keystone features in Combobulate as it is such a powerful catalyst for nearly all other editing and movement features in Combobulate, surprising as that may sound!</p>
<p class=\" text-justify\">Case in point: keys in a dictionary; elements in an array; function arguments. They are all siblings. They should be editable <em>as</em> siblings. And now they are.</p>
<p class=\" text-justify\">The <code>C-c o t s</code> command invokes the sibling editor. It works in any place where regular <code>C-M-n</code> and <code>C-M-p</code> sibling navigation works, as it uses the same code base.</p>
<figure>
<img src=\"/static/uploads/combobulate/combobulate-query-edit-shorthand.gif\" alt=\"/static/uploads/combobulate/combobulate-query-edit-shorthand.gif\" class=\" center-block\">
<figcaption>Here’s a simple example where I drop in and edit the shorthands in Typescript using the sibling editing command and multiple cursors.</figcaption>
</figure>
<p class=\" text-justify\">If I <em>didn’t</em> use the sibling system, I would’ve had to build a custom cluster query to mark the nodes instead. Tedium squared.</p>
<p class=\" text-justify\">But that’s all gone now. Except…</p>
<H3 id=\"clusters-sequences\">Clusters &amp; Sequences</H3>
<p class=\" text-justify\">The tag names in HTML tags (the <code>div</code> in <code>&lt;div&gt;</code>) are <em>not</em> siblings:</p>
<pre><code>(element
  (start_tag (tag_name))
  (end_tag (tag_name)))</code></pre>
<p class=\" text-justify\">Start and end tag <em>are</em> siblings, but we do not sibling navigate by start or end tag, but <code>element</code>. (There are good reasons for this.) So a call to <code>C-c o t s</code> with point at <code>&lt;div&gt;</code> would instead edit all <em>sibling elements</em> and not the two tag names. That, and the point would be in the wrong place: it should be here: <code>-!-div</code>. Not to the left of <code>&lt;</code> in <code>&lt;div&gt;</code> and <code>&lt;/div&gt;</code>. You can’t even <code>C-f</code> once to correct for it, as closing tags terminate with <code>&lt;/</code> and not <code>&lt;</code>, so you’d be off by one!</p>
<p class=\" text-justify\">That’s why we still need some form of “clustered editing”. Though in this case I scried an opportunity to improve navigation <em>as well as</em> retaining tag editing.</p>
<p class=\" text-justify\">New to the latest version of Combobulate is <em>sequence navigation</em>, bound to <code>M-n</code> and <code>M-p</code>. Most nodes lack a <em>sequent</em>; it is not a general purpose movement command, as it only applies in situations where nodes are sequences but not strictly speaking siblings.</p>
<p class=\" text-justify\">Put point inside a <code>&lt;tag&gt;</code> and you can use <code>M-n/p</code> to cycle between the start and end tag. That is <em>super helpful</em> if you work with SGML-alike languages. Use <code>C-c o t c</code> to sequence edit them.</p>
<p class=\" text-justify\">Now you have useful navigation <em>and</em> editing capabilities for places where things are not-quite-adjacent (like JSX and HTML). (If you can think of other cases, do raise a Github issue.)</p>
<p class=\" text-justify\">Ironically, this is a fine use case for the DSL <em>and</em> Combobulate’s query engine to ensure I drill down and pluck the tag names from the start and end tags.</p>
<H4 id=\"sequence-scanning\">Sequence Scanning</H4>
<p class=\" text-justify\">16+ years ago I wrote an awful lot of Borland Delphi for a living. I won’t get into how amazing the UI development experience was except to say that where that was the zenith of productivity, its garbage-tier code editor was surely the nadir. It didn’t even <em>indent your code for you</em>. Bah.</p>
<p class=\" text-justify\">It was a terrible editing experience, except for one little feature I loved in a third-party plugin: keyword scanning. If you pressed <code>M-p</code> or <code>M-n</code> on any identifier in the editor, it’d jump to it, but without the obsequiously stupid “Find Dialog” getting in your way to “help you find what you want”.</p>
<p class=\" text-justify\">I loved it so much it was one of the first things I wrote in Emacs Lisp, and talked about much later here. I called it <a href=\"/article/smart-scan-jump-symbols-buffer\" class=\" article-link\">Smart Scan: Jump between symbols in a buffer</a>.</p>
<p class=\" text-justify\">I still use it. But it annoyed me that I didn’t have a similar feature in Combobulate so others can benefit from its utility, and that the two keys the new sequence key bindings are now bound to conflict with smart scan.</p>
<p class=\" text-justify\">So I merged the features. If your point is in one of the few supported <em>sequences</em>, Combobulate will abide and only move between them. Try to move outside the “range” of valid options, and you’re shown an error: tap the key <em>again</em> without hesitation, and it switches to free-form scanning for that keyword anywhere in the buffer and “outside” the reign of tree-sitter. (It’s effectively akin to regexp searching for <code>\\&lt;foo\\&gt;</code>.)</p>
<p class=\" text-justify\">Use it anywhere else, and it launches into a freeform search mode for the symbol at point without first raising an error. The end result is you can safely navigate sequences and not worry about getting pulled away from what you’re looking for, while still having the freedom to do search out of bounds, so to speak, if you tap the key again.</p>
<H3 id=\"bulk-editing-with-combobulate\">Bulk Editing with Combobulate</H3>
<p class=\" text-justify\">There’s a handful of bulk editing commands that come with Combobulate.</p>
<table style=\"width:86%;\" class=\" table\">
<colgroup>
<col style=\"width: 43%\">
<col style=\"width: 43%\">
</colgroup>
<tbody>
<tr class=\"odd\">
<td><strong>Key Bindings</strong></td>
<td><strong>Description</strong></td>
</tr>
<tr class=\"even\">
<td><code>C-c o t t</code></td>
<td>Edit by node type DWIM</td>
</tr>
<tr class=\"odd\">
<td><code>C-c o t x</code></td>
<td>Edit by node text DWIM</td>
</tr>
<tr class=\"even\">
<td><code>C-c o t c</code></td>
<td>Edit sequence</td>
</tr>
<tr class=\"odd\">
<td><code>C-c o t s</code></td>
<td>Edit siblings</td>
</tr>
<tr class=\"even\">
<td><code>C-c o B q</code></td>
<td>Open query builder (interactive query building)</td>
</tr>
<tr class=\"odd\">
<td><code>C-c o B r</code></td>
<td>Display query from root to point</td>
</tr>
<tr class=\"even\">
<td><code>C-c o B p</code></td>
<td>Display query that matches node text at point</td>
</tr>
</tbody>
</table>
<p class=\" text-justify\">Aside from a handful of defaults in the <code>C-c o t</code> keymap, there are commands that build queries you can use as a baseline to create your own custom editors. My article on <a href=\"/article/combobulate-editing-searching-new-query-builder\" class=\" article-link\">Editing and Searching with the new Query Builder</a> goes into more detail on those.</p>
<p class=\" text-justify\">Most commands that “Do What I Mean” require a context locus that serves as a limit for cursor editing. You rarely want to edit the whole buffer. That way you can limit your node editing to just the current statement or function, for example, without having to manually remove cursors after the fact.</p>
<figure>
<img src=\"/static/uploads/combobulate/combobulate-expand-edit.gif\" alt=\"/static/uploads/combobulate/combobulate-expand-edit.gif\" class=\" center-block\">
<figcaption>Edit nodes by type with <code>C-c o t t</code>. You’re asked to confirm the locus (how far Combobulate should go look for nodes of the same type) to edit in one go, starting with just the element pair.</figcaption>
</figure>
<H4 id=\"multiple-cursors\">Multiple Cursors</H4>
<p class=\" text-justify\">I like multiple cursors, and it’s a tool I use all the time, but it <em>is</em> an external, though optional, dependency in Combobulate, and while I’m OK with that, it’s also something I feel shouldn’t be <em>required</em> for basic bulk editing. I want people to at least be able to use Combobulate’s editing facilities without requiring multiple cursors.</p>
<p class=\" text-justify\">Having said that, multiple cursors is well integrated into Combobulate. Every node has a start and an end, for example, so having the ability to insert a cursor at either end is especially useful.</p>
<table style=\"width:86%;\" class=\" table\">
<colgroup>
<col style=\"width: 43%\">
<col style=\"width: 43%\">
</colgroup>
<tbody>
<tr class=\"odd\">
<td><strong>Modifier Arguments</strong></td>
<td><strong>Description</strong></td>
</tr>
<tr class=\"even\">
<td><em>None</em></td>
<td>Place cursor at the start (default)</td>
</tr>
<tr class=\"odd\">
<td><code>C-u</code></td>
<td>Place cursor at the end</td>
</tr>
<tr class=\"even\">
<td><code>C-u C-u</code></td>
<td>Mark the node</td>
</tr>
</tbody>
</table>
<p class=\" text-justify\">You can control the placement of the cursors for any of the <em>edit</em> commands in the <code>C-c o t</code> key map by giving it a prefix key. By default cursors are placed at the start of a node; a single <code>C-u</code> argument changes that to the end.</p>
<p class=\" text-justify\">One of the benefits of multiple cursors is that it supports non-contiguous regions, so each cursor can have its own region. To mark things instead, prefix with <code>C-u C-u</code> instead. At that point you can use <code>C-x C-x</code> to swap point and mark to move between the start and end of the node.</p>
<H4 id=\"combobulates-field-editor\">Combobulate’s Field Editor</H4>
<figure>
<img src=\"/static/uploads/combobulate/combobulate-field-number.gif\" alt=\"/static/uploads/combobulate/combobulate-field-number.gif\" class=\" center-block\">
<figcaption>Appending and prepending text with the field editor.</figcaption>
</figure>
<p class=\" text-justify\">Combobulate has an advanced snippet templating tool feature called <em>envelopes</em> (check out <code>C-c o e ...</code>.) It has been around for a long time now (and more on that in another post!) and, like any good templating tool, it supports <em>fields</em>, but with an important difference: it uses the minibuffer prompt mechanism to query for input instead of expecting you to type into an overlay dyed and imbued with special properties in your buffer. Unlike the abandoned <em>Tempo</em> and <em>Skeleton</em> templating packages in Emacs, Combobulate updates the fields as you type in the minibuffer.</p>
<p class=\" text-justify\">Because Combobulate already has a templating tool, it was a snap reusing the code as a cursor editing system that works a little bit like a trad templating tool crossed with <code>C-x r t</code> (<code>M-x string-rectangle</code>), another Emacs classic that uses the rectangle system in Emacs to prefix text. The string rectangle feature’s a little too basic on its own — it’s useful, for sure, but I figured I could make Combobulate’s editor a bit more ergonomic and flexible than simply reinventing such a basic mechanic.</p>
<p class=\" text-justify\">A large part of the edits I make when I use multiple cursors are simple append/prepend operations to the existing text. Not always, but often. To facilitate that sort of editing, I needed a placeholder symbol in the minibuffer to represent each node’s text. Otherwise, I’d have no way of prepending <em>and</em> appending in the minibuffer: there is one minibuffer prompt, after all, but more than one node field to update, and each may have vastly different text.</p>
<p class=\" text-justify\">Ergo, there must be a generic placeholder that represents each field’s node text. Thinking about it some more, I realized that this is really not all that different from the replace regexp’s capturing group feature found in, among other places, <code>C-M-%</code>.</p>
<p class=\" text-justify\">So why not just use that? You gain a number of other ancillary benefits for “free” (well, it required more coding, but they’re benefits to <em>you</em>) when you start thinking about each node as its own capturing group.</p>
<table style=\"width:58%;\" class=\" table\">
<colgroup>
<col style=\"width: 29%\">
<col style=\"width: 29%\">
</colgroup>
<tbody>
<tr class=\"odd\">
<td><strong>Feature</strong></td>
<td><strong>Description</strong></td>
</tr>
<tr class=\"even\">
<td><code>\\0</code></td>
<td>Inserts the original text for each field</td>
</tr>
<tr class=\"odd\">
<td><code>\\N</code></td>
<td>Inserts the Nth field’s text</td>
</tr>
<tr class=\"even\">
<td><code>\\#</code></td>
<td>Inserts the number of the field, starting from 0</td>
</tr>
<tr class=\"odd\">
<td><code>\\,FORM</code></td>
<td><p class=\" text-justify\">Evaluates the elisp form FORM.</p>
<p class=\" text-justify\">Capturing groups are valid inside the form.</p></td>
</tr>
</tbody>
</table>
<p class=\" text-justify\">With a regular replace regexp, the <code>\\N</code> notation represents the N’th match, with the number <code>0</code> being the whole match string. In Combobulate, <code>\\0</code> now represents the match string for each localized field you’re editing. So the default prompt value in Combobulate is <code>\\0</code> meaning: just insert the original text you started with.</p>
<p class=\" text-justify\">All other numbers represent that particular node’s text. So <code>\\1</code> is the first node; <code>\\2</code> is the second, and so forth.</p>
<p class=\" text-justify\">That means it’s possible to not only replace every match with the content of a particular field, but also combine them. Maybe you want to merge the second and third fields’ text?</p>
<p class=\" text-justify\">Another regexp feature is the ability to insert the match number. By counting from the top-most field, you can insert the index of each field with <code>\\#</code> as a practical and cheap way of enumerating things. It counts from 0.</p>
<p class=\" text-justify\"><code>C-M-%</code> has a really cool – and quite hidden – feature: <a href=\"/article/evaluating-lisp-forms-regular-expressions\" class=\" article-link\">it can evaluate Lisp Forms inside Regular Expressions</a>. I’ve written about it before; it’s such an underrated feature. I do not need it often, but when I do, it’s nice to know I can combine the power of elisp with regexp search and replace.</p>
<figure>
<img src=\"/static/uploads/combobulate/combobulate-field-editor-eval-form.gif\" alt=\"/static/uploads/combobulate/combobulate-field-editor-eval-form.gif\" class=\" center-block\">
<figcaption>Evaluating forms in Combobulate’s field editor works much the same as it does in <code>C-M-%</code>. Here I’m uppercasing all the fields’ names using <code>upcase</code> and the <code>\\0</code> capturing group.</figcaption>
</figure>
<p class=\" text-justify\">In addition to <em>all that</em>, there are key bindings in the field editor minibuffer (you can also see the key bindings by tapping <code>C-h</code> in the prompt):</p>
<table style=\"width:86%;\" class=\" table\">
<colgroup>
<col style=\"width: 43%\">
<col style=\"width: 43%\">
</colgroup>
<tbody>
<tr class=\"odd\">
<td><strong>Key Bindings</strong></td>
<td><strong>Description</strong></td>
</tr>
<tr class=\"even\">
<td><code>C-n</code></td>
<td>Move to next field</td>
</tr>
<tr class=\"odd\">
<td><code>C-p</code></td>
<td>Move to previous field</td>
</tr>
<tr class=\"even\">
<td><code>C-v</code></td>
<td>Toggle the current field on or off</td>
</tr>
<tr class=\"odd\">
<td><code>C-i</code></td>
<td>Invert fields’ editable state</td>
</tr>
<tr class=\"even\">
<td><code>C-h</code></td>
<td>Show the help</td>
</tr>
</tbody>
</table>
<p class=\" text-justify\">You can scroll through the fields with <code>C-n/p</code>. You’ll need these if you want a closer look at the matched fields. You’re free to just switch to the buffer and scroll also, of course!</p>
<p class=\" text-justify\"><em>Unlike</em> multiple cursors, you can toggle the fields on or off. Do you want to bulk edit all the keys in a JSON object <em>except</em> one key? Now you can. Just move with <code>C-n/p</code> to the field in question and toggle it with <code>C-v</code>. <code>C-i</code> does much the same: it inverts the state of all fields.</p>
<p class=\" text-justify\">The field editor’s not perfect, but then nor is multiple cursors.</p>
<H4 id=\"a-quick-comparison-between-the-two\">A quick Comparison between the two</H4>
<p class=\" text-justify\">Multiple cursors is, to me, an indispensable tool, and I will continue to use it for things that warrant it.</p>
<p class=\" text-justify\">The field editor is better for explicit, bulk edits where you do not require the flexibility or precision you get by having a point placed at every field.</p>
<p class=\" text-justify\">It is not possible to gingerly delete some characters or operate on partial node text matches with the field editor. (Though I suppose you could try with the Lisp form evaluation.)</p>
<p class=\" text-justify\">Simultaneously, it is not so easy to quickly prepend or append to the node text with MC. In fact, there is (to my knowledge) no way of declaring a ‘range’ to a cursor. Once it is created it is subject to the whims of the editing and movement you do in the buffer.</p>
<p class=\" text-justify\">You <em>can</em> use the <code>C-u C-u</code> argument to mark the nodes, which does give you some control over the start and end, but explicitly inserting something at the start of the node and then the end is perhaps not possible at all, if the node is not something you can quickly find the ‘end of’ with either Combobulate’s movement commands or Emacs’.</p>
<p class=\" text-justify\">MC does support some form of killing and yanking, but I find it awful and borderline unusable. If you want to merge or join nodes’ text together, you’re better off with a keyboard macro or the field editor.</p>
<p class=\" text-justify\">The other major advantage of the field editor is that it ships with Combobulate. It is also relatively easy to add new, explicit, commands to do things in the future.</p>
<p class=\" text-justify\">So. There are trade-offs to both approaches, but now you at least have a choice of what to use.</p>
<p class=\" text-justify\">Let me know what you think.</p>
<p class=\" text-justify\">Happy (bulk) editing!</p>
") (guid ((isPermaLink . "false")) "/article/combobulate-bulk-editing-treesitter-nodes-multiple-cursors") (pubDate nil "Thu, 19 Sep 2024 08:54:31 +0000")) (item nil (title nil "What's New in Emacs 30.1?") (link nil "https://www.masteringemacs.org/article/whats-new-in-emacs-301?utm_source=newsletter&utm_medium=rss") (description nil "What is new in Emacs 30.1? I go through every change in the NEWS file and talk about the most interesting and useful changes.") (encoded nil "
<p class=\" text-justify drop-cap\">Emacs 30.1 is upon us, and it’s time for another bumper release full of new features and improvements.</p>
<p class=\" text-justify\">As always, I have taken the time to go through most of the changes in Emacs 30.1 and annotated them to give perspective and clarity.</p>
<p class=\" text-justify\">Here is but a few of the highlights in 30.1:</p>
<ul>
<li><p class=\" text-justify\"><code>completion-preview-mode</code> is a tantalizing replacement for company mode and corfu as it combines the buffer and window system (the <code>*Completions*</code> window when you minibuffer complete with <code>TAB</code>) with an <em>excellent</em> user experience by adding a schnazzy predictive typing that the old auto complete package did. I think <code>*Completions*</code> system already in Emacs, combined with the preview option, makes it a useful alternative to Company / Corfu for some.</p>
<p class=\" text-justify\">You also get to leverage the full force of Emacs’s expansive set of minibuffer completion styles, orders and more, though preview mode does have a few limitations around the style you can use.</p>
<p class=\" text-justify\">This is my favorite feature in Emacs 30.1. The user experience is superb; someone really cared for this, and it shows.</p></li>
<li><p class=\" text-justify\">The Org URI protocol should now register automatically, meaning you can send data from a browser bookmarklet straight into org capture in your running Emacs instance.</p>
<p class=\" text-justify\">The org protocol feature’s not new to Emacs 30.1, but automatically configuring your Emacs on Linux so it works properly <em>is</em>.</p></li>
<li><p class=\" text-justify\">Which-key is now built in, which is good news for people who prefer that method of help (as opposed to typing <code>C-h</code> in a key chord).</p></li>
<li><p class=\" text-justify\"><code>libjansson</code> is dead; long live Emacs’s builtin JSON parser. The new parser is much faster.</p></li>
<li><p class=\" text-justify\">The tree-sitter-specific <code>*-sexp</code> commands (such as <code>forward-sexp</code>) now work well.</p></li>
<li><p class=\" text-justify\">Native compilation is on by default, provided your system has the required dependencies. A massive vote of confidence for a great feature.</p></li>
<li><p class=\" text-justify\">Full support for Emacs on Android, and a whole host of touch screen-related improvements to Emacs as a result.</p></li>
<li><p class=\" text-justify\">You can now request a diff of your multi-file replace regexp (see <code>C-h a replace diff</code>)</p></li>
<li><p class=\" text-justify\">More Tramp (Emacs’s remote file editing system) connections, including support for Kubernetes pods.</p></li>
</ul>
<p class=\" text-justify\">I will, as per usual, begin to update <a href=\"/book\" class=\" article-link\">my book, Mastering Emacs</a>, so it includes these latest changes.</p>
<p class=\" text-justify\">Until then, and for the next couple of days, you can enjoy a 30% discount on my book. Enjoy!</p>
<H2 id=\"installation-changes-in-emacs-30.1\">Installation Changes in Emacs 30.1</H2>
<pre><code>Native compilation is now enabled by default.
'configure' will enable the Emacs Lisp native compiler, so long as
libgccjit is present and functional on the system.  To disable native
compilation, configure Emacs with the option:

    ./configure --with-native-compilation=no</code></pre>
<p class=\" text-justify\">That is good news. I’m hoping by declaring that native compilation, a must-have feature that <a href=\"/article/speed-up-emacs-libjansson-native-elisp-compilation\" class=\" article-link\">compiles elisp into native code</a> and greatly speeds up your Emacs, it encourage more distros to adopt the setting, if they have not already. If you’re the type to compile your own Emacs, you may want to read my article as it does require a few mandatory components that most Linux distributions do not ship with.</p>
<pre><code>Emacs has been ported to the Android operating system.
This requires Emacs to be compiled on another computer.  The Android
NDK, SDK, and a suitable Java compiler must also be installed.

See the file \"java/INSTALL\" for more details.</code></pre>
<p class=\" text-justify\">I’ve been following this development for quite a while, and it’s wonderful to see that you can run a full-blown Emacs instance on Android <em>and</em> with the support of the Emacs developers behind it. How exciting. I’ll have to find the time to play around with it.</p>
<pre><code>Native JSON support is now always available; libjansson is no longer used.
No external library is required.  The '--with-json' configure option has
been removed.  'json-available-p' now always returns non-nil and is only
kept for compatibility.</code></pre>
<p class=\" text-justify\">JSON is a massive bottleneck when you’re using LSP servers, as LSPs are chatty and JSON is how they communicate. I wrote about the introduction of <a href=\"/article/speed-up-emacs-libjansson-native-elisp-compilation\" class=\" article-link\">libjansson</a> when it was first introduced as it made a noticeable difference in performance back when it made an optional dependency in Emacs. It turns out that libjansson is not that quick. One day, a new contributor, Géza Herman, showed up with a JSON parser that was not only faster than libjansson, but more complete in its implementation.</p>
<p class=\" text-justify\">As a result libjansson is not only deprecated but removed entirely. Excellent!</p>
<pre><code>Emacs now defaults to the ossaudio library for sound on NetBSD and OpenBSD.
Previously, configure used ALSA libraries if installed on the system
when configured '--with-sound=yes' (which is the default), with fallback
to libossaudio.  The libossaudio library included with the base system
is now used even if ALSA is found to avoid relying on external packages
and to resolve potential incompatibilities between GNU/Linux and *BSD
versions of ALSA.  Use '--with-sound=alsa' to build with ALSA on these
operating systems instead.</code></pre>
<pre><code>New configuration option '--disable-gc-mark-trace'.
This disables the GC mark trace buffer for about 5% better garbage
collection performance.  Doing so may make it more difficult for Emacs
developers to help finding GC-related bugs that you run into, which is
why the mark trace buffer is enabled by default.</code></pre>
<p class=\" text-justify\">If you’re the type of person to compile your own Emacs, you might as well give this one a whirl. GC bugs do happen, but I’d say they’re rare enough that you can turn it off and claim your 5% speed-up voucher.</p>
<H2 id=\"startup-changes-in-emacs-30.1\">Startup Changes in Emacs 30.1</H2>
<pre><code>On GNU/Linux, Emacs is now the default application for 'org-protocol'.
Org mode provides a way to quickly capture bookmarks, notes, and links
using 'emacsclient':

    emacsclient \"org-protocol://store-link?url=URL&amp;title=TITLE\"

Previously, users had to manually configure their GNU/Linux desktop
environment to open 'org-protocol' links in Emacs.  These links should
now open in Emacs automatically, as the \"emacsclient.desktop\" file now
arranges for Emacs to be the default application for the 'org-protocol'
URI scheme.  See the Org mode manual, Info node \"(org) Protocols\" for
more details.</code></pre>
<p class=\" text-justify\">OK, no lie, this is a really cool feature that just got easier to use.</p>
<p class=\" text-justify\">Org can register (on Windows, Linux, etc.) itself as a URI protocol controller. When you open a <code>https</code> hyperlink, your OS knows it has to use your preferred browser; ditto for e-mail. Here it’s called <code>org-protocol</code>, and with this new change (or the slightly more manual steps outlined <a href=\"https://orgmode.org/worg/org-contrib/org-protocol.html\" class=\" article-link\">in the org mode manual</a>) you can request that <code>org-protocol://....</code> contents are sent to your Emacs for processing.</p>
<p class=\" text-justify\">That means you can send information to Org from other tools — such as the commandline or, more tantalizingly, from your web browser or even e-mails, provided your e-mail client follows hyperlinks and supports custom protocols.</p>
<p class=\" text-justify\">Provided you’ve done the installation steps (I recommend you check out the <a href=\"https://orgmode.org/worg/org-contrib/org-protocol.html\" class=\" article-link\">the link</a> if the example below does not work) you can use a snippet like this in a Bookmarklet in your browser – or straight into the console for testing:</p>
<pre><code>javascript:location.href = 'org-protocol://capture?' +
    new URLSearchParams({
          template: \"m\",
          url: location.href,
          title: document.title,
          body: window.getSelection()})</code></pre>
<p class=\" text-justify\">Replacing <code>template: \"m\"</code> with the <code>M-x org-capture</code> template key of your choice. The document’s title, URL and text selection is then sent to your org capture.</p>
<p class=\" text-justify\">Pretty darn cool! If you’re an org mode user – I know you are! – you should get on top of this right away.</p>
<p class=\" text-justify\">You can even register your own protocols (<code>org-protocol-protocol-alist</code>) and build your own integrations, and it’s not like you have to feed it into org!</p>
<pre><code>New variable lets Lisp code read emacsclient arguments.
When '--eval' is passed to emacsclient and Emacs is evaluating each
argument, the new variable 'server-eval-args-left' is set to those
arguments not yet evaluated.  It can be used by Lisp code to 'pop'
arguments and process them by the function called in the '--eval'
expression, which is useful when those arguments contain arbitrary
characters that otherwise might require elaborate and error-prone
escaping (to protect them from the shell).</code></pre>
<p class=\" text-justify\">Do not sleep on Emacs’s client-server architecture, or the headless evaluation feature it has. My article on <a href=\"/article/fuzzy-finding-emacs-instead-of-fzf\" class=\" article-link\">Fuzzy Finding with Emacs Instead of fzf</a> is a great example of how two dozen lines of elisp and another baker’s dozen of bash can clone the keystone feature of <code>fzf</code>.</p>
<H2 id=\"incompatible-changes-in-emacs-30.1\">Incompatible Changes in Emacs 30.1</H2>
<pre><code>Tree-Sitter modes are now declared as submodes of the non-TS modes.
In order to help the use of those Tree-Sitter modes, they are now
declared to have the corresponding non-Tree-Sitter mode as an
additional parent.
This way, things like \".dir-locals.el\" settings, and YASnippet
collections of snippets automatically apply to the new Tree-Sitter modes.

Note that those modes still do not inherit from the non-TS mode, so
configuration settings installed via mode hooks are not affected.

Loading a Tree-Sitter mode (such as by using 'M-x load-library' or with
'M-x load-file') by default causes the corresponding non-Tree-Sitter
mode be remapped to the Tree-Sitter mode.  This remapping affects
visiting files for which 'auto-mode-alist' specifies a non-Tree-Sitter
mode, and also affects mode-specification cookies on the first line of a
file and mode specifications in file- and directory-local variables.  To
revert to using a non-Tree-Sitter mode, reload the corresponding mode
file anew.  To prevent file loading from turning on Tree-Sitter mode
when 'auto-mode-alist' or the file/directory-local variables specify a
non-Tree-Sitter mode, customize the user option 'major-mode-remap-alist'
to specify that a non-Tree-Sitter mode is \"remapped\" to itself.  For
example:

    (add-to-list 'major-mode-remap-alist '(c-mode))

specifies that C Mode should not be remapped to 'c-ts-mode' even if and
when 'c-ts-mode' is loaded.  Conversely,

    (add-to-list 'major-mode-remap-alist '(c-mode . c-ts-mode))

tells Emacs to always invoke 'c-ts-mode' whenever 'c-mode' is
requested, either by 'auto-mode-alist' or by file/directory-local
variables.

We recommend using 'major-mode-remap-alist' to express your preferences
for using Tree-Sitter or non-Tree-Sitter modes for files for which both
variants of major modes are available, because that variable overrides
the remapping Emacs might decide to perform as result of loading Lisp
files and features.</code></pre>
<p class=\" text-justify\">I mean, I’m glad they’re slowly making these changes, as the tree-sitter modes are threadbare. Aside from better (usually) syntax highlighting and indentation, they rarely offer much.</p>
<p class=\" text-justify\">But this is yet another thing to explain to people that, yes, now your dir-locals will pick up on the TS mode you’re using, but all the other features present in the old major modes probably don’t work.</p>
<p class=\" text-justify\">In my opinion, tree-sitter major modes should be deprecated and the syntax highlighting and indentation relegated to optional minor modes you can enable in the existing major modes (and obviously brand new ones, if no such major modes exist) and all other “tree-sitter-portable” custom commands are gated behind a feature flag that require the presence of TS and the right grammar file to work, with perhaps a fallback for things that can be implemented – or is already – with non-TS code.</p>
<pre><code>Mouse wheel events should now always be 'wheel-up/down/left/right'.
At those places where the old 'mouse-4/5/6/7' events could still occur
(i.e., X11 input in the absence of XInput2, and 'xterm-mouse-mode'),
we remap them to the corresponding 'wheel-up/down/left/right' event,
according to the new user option 'mouse-wheel-buttons'.
The old variables 'mouse-wheel-up-event', 'mouse-wheel-down-event',
'mouse-wheel-left-event', and 'mouse-wheel-right-event' are thereby
obsolete.</code></pre>
<p class=\" text-justify\">I’ve never in my life been able to remember what the numbers map to, so I this is a useful aid to me and, no doubt, anybody else looking to remap or just figure out what a mouse event is.</p>
<pre><code>'completion-auto-help' now affects 'icomplete-in-buffer'.
Previously, 'completion-auto-help' mostly affected only minibuffer
completion.  Now, if 'completion-auto-help' has the value 'lazy', then
Icomplete's in-buffer display of possible completions will only appear
after the 'completion-at-point' command has been invoked twice, and if
'completion-auto-help' is nil, then Icomplete's in-buffer display is
completely suppressed.  Thus, if you use 'icomplete-in-buffer', ensure
'completion-auto-help' is not customized to 'lazy' or nil.</code></pre>
<pre><code>The \"*Completions*\" buffer now always accompanies 'icomplete-in-buffer'.
Previously, it was not consistent whether the \"*Completions*\" buffer would
appear when using 'icomplete-in-buffer'.  Now the \"*Completions*\" buffer
and Icomplete's in-buffer display of possible completions always
appear together.  If you would prefer to see only Icomplete's
in-buffer display, and not the \"*Completions*\" buffer, you can add this
to your init file:

    (advice-add 'completion-at-point :after #'minibuffer-hide-completions)</code></pre>
<p class=\" text-justify\">This governs the <code>*Completions*</code> window that may (or may not, as the case may be) pop up to offer assistance if when you are completing. If you use the default completion mechanism in Emacs, you may want to consider looking into tweaking this, if you find the current <code>*Completions*</code> behavior is not to your liking.</p>
<pre><code>The default process filter was rewritten in native code.
The round-trip through the Lisp function
'internal-default-process-filter' is skipped when the process filter is
the default one.  It is reimplemented in native code, reducing GC churn.
To undo this change, set 'fast-read-process-output' to nil.</code></pre>
<p class=\" text-justify\">Anything that speeds up a known and serious IO bottleneck in Emacs is welcome news to me. The fact they named the variable <code>fast-read-process-output</code> says it all.</p>
<pre><code>Network Security Manager now warns about 3DES by default.
This cypher is no longer recommended owing to a major vulnerability
disclosed in 2016, and its small 112 bit key size.  Emacs now warns
about its use also when 'network-security-level' is set to 'medium'
(the default).  See 'network-security-protocol-checks'.</code></pre>
<pre><code>Network Security Manager now warns about &lt;2048 bits in DH key exchange.
Emacs used to warn for ephemeral Diffie-Hellman (DHE) key exchanges with
prime numbers smaller than 1024 bits.  Since more servers now support
it, this number has been bumped to 2048 bits.</code></pre>
<pre><code>URL now never sends user email addresses in HTTP requests.
Emacs never sent email addresses by default, but it used to be
possible to customize 'url-privacy-level' so that the user's email
address was sent along in HTTP requests.  This feature has now been
removed, as it was considered more dangerous than useful.  RFC 9110
(§ 10.1.2) also recommends against it.  The user option
'url-personal-mail-address' is now also obsolete.

To send an email address in the header of individual HTTP requests,
see the variable 'url-request-extra-headers'.</code></pre>
<p class=\" text-justify\">I am not sure why there was ever the option of sending email addressed alongside HTTP requests. I don’t recall that ever being a thing in the 90s either, but perhaps that is just my memory failing me.</p>
<pre><code>'pixel-scroll-precision-mode' sets 'make-cursor-line-fully-visible'.
'pixel-scroll-precision-mode' sets 'make-cursor-line-fully-visible' to a
nil value globally, since the usual requirement of the Emacs display to
make the cursor line fully visible contradicts the smooth scrolling
expectations.</code></pre>
<p class=\" text-justify\">I recommend you try <a href=\"https://github.com/jdtsmith/ultra-scroll\" class=\" article-link\">ultra-scroll</a> if you’re serious about wanting smooth scrolling in Emacs.</p>
<H2 id=\"changes-in-emacs-30.1\">Changes in Emacs 30.1</H2>
<pre><code>Fix shell injection vulnerability in man.el (CVE-2025-1244).
We urge all users to upgrade immediately.</code></pre>
<pre><code>New user option 'trusted-content' to allow potentially dangerous features.
This option lists those files and directories whose content Emacs should
consider as sufficiently trusted to run any part of the code contained
therein even without any explicit user request.

For example, Flymake's backend for Emacs Lisp consults this option
and disables itself with an \"untrusted content\" warning if the file
is not listed.

Emacs Lisp authors should note that a major or minor mode must never set
this option to the ':all' value.

This option is used to fix CVE-2024-53920.  See below for details.</code></pre>
<p class=\" text-justify\">It shouldn’t come as a surprise to anybody that Emacs, a dynamic computing environment, can be coaxed into running stuff it shouldn’t. Ideally that’d never happen, but given the nature of what Emacs does – and how integrated it is in our lives – it is no surprise that on occasion its power is turned against it. What surprises me is that these issues don’t happen more frequently.</p>
<pre><code>Emacs now supports Unicode Standard version 15.1.</code></pre>
<pre><code>Emacs now comes with Org v9.7.
See the file \"etc/ORG-NEWS\" for user-visible changes in Org.</code></pre>
<pre><code>Improved support for touchscreen devices.
On systems that understand them (at present X, Android, PGTK, and
MS-Windows), many touch screen gestures are now implemented and
translated into mouse or gesture events, and support for tapping tool
bar buttons and opening menus has been added.  Countless packages, such
as Dired and Custom, have been adjusted to better understand touch
screen input.</code></pre>
<p class=\" text-justify\">This obviously goes hand in hand with the Android changes. The myth that Emacs is a keyboard only system is obviously false, and it has been since Lucid/XEmacs improved mouse support in the 1990s. Now that touch screen support is improved, I’m curious to see if we’ll see the emergence of org packages/email clients on Android that lean into the new touch support.</p>
<pre><code>Support for styled underline face attributes.
These are implemented as new values of the 'style' attribute in a face
underline specification, 'double-line', 'dots', and 'dashes', and are
available on GUI systems.  If your terminal's termcap or terminfo
database entry defines the 'Su' or 'Smulx' capability, Emacs will also
emit the prescribed escape sequence to render faces with such styles on
TTY frames.</code></pre>
<pre><code>Support for underline colors on TTY frames.
Colors specified in the underline face will now also be displayed on TTY
frames on terminals that support the 'Su' or 'Smulx' capabilities.</code></pre>
<p class=\" text-justify\">This is addition to things like squiggly underlines that we’ve had for a long time now. I’m quite surprised that terminals can render anything other than a opaque line, though; that is news to me.</p>
<pre><code>Modeline elements can now be right-aligned.
Anything following the symbol 'mode-line-format-right-align' in
'mode-line-format' will be right-aligned.  Exactly where it is
right-aligned to is controlled by the new user option
'mode-line-right-align-edge'.</code></pre>
<p class=\" text-justify\">Can’t say I’ve ever had the desire to heavily mod my mode line, but I know that a lot of people care greatly about its aethestics. I’m sure this is of benefit to people who use right-to-left languages also; perhaps they are the primary users?</p>
<pre><code>X selection requests are now handled much faster and asynchronously.
This means it should be less necessary to disable the likes of
'select-active-regions' when Emacs is running over a slow network
connection.</code></pre>
<pre><code>Emacs now updates invisible frames that are made visible by a compositor.
If an invisible or an iconified frame is shown to the user by the
compositing manager, Emacs will now redisplay such a frame even though
'frame-visible-p' returns nil or 'icon' for it.  This can happen, for
example, as part of preview for iconified frames.</code></pre>
<p class=\" text-justify\">I guess this refers to the ‘window peek’ feature in Windows’ taskbar, and that it’s really more of a bugfix / tweak more than an actual feature.</p>
<pre><code>Most file notification backends detect unmounting of a watched filesystem.
The only exception is w32notify.</code></pre>
<p class=\" text-justify\">Emacs will watch file changes using a range of mechanisms depending on the platform of choice.</p>
<pre><code>The ':map' property of images is now recomputed when image is transformed.
Images with clickable maps now work as expected after you run commands
such as 'image-increase-size', 'image-decrease-size', 'image-rotate',
'image-flip-horizontally', and 'image-flip-vertically'.
Set the new user option 'image-recompute-map-p' to nil to prevent Emacs
from recomputing image maps.</code></pre>
<H2 id=\"minibuffer-and-completions\">Minibuffer and Completions</H2>
<pre><code>New commands 'previous-line-completion' and 'next-line-completion'.
Bound to '&lt;up&gt;' and '&lt;down&gt;' arrow keys, respectively, they navigate
the \"*Completions*\" buffer vertically by lines, wrapping at the
top/bottom when 'completion-auto-wrap' is non-nil.</code></pre>
<pre><code>New user option 'minibuffer-visible-completions'.
When customized to non-nil, you can use arrow keys in the minibuffer
to navigate the completions displayed in the \"*Completions*\" window.
Typing 'RET' selects the highlighted candidate.  'C-g' hides the
completions window.  When the completions window is not visible,
then all these keys have their usual meaning in the minibuffer.
This option is supported for in-buffer completion as well.</code></pre>
<pre><code>Selected completion candidates are deselected on typing.
When you type at the minibuffer prompt, the current completion
candidate will be un-highlighted, and point in the \"*Completions*\" window
will be moved off that candidate.  'minibuffer-choose-completion'
('M-RET') will still choose a previously-selected completion
candidate, but the new command 'minibuffer-choose-completion-or-exit'
(bound to 'RET' by 'minibuffer-visible-completions') will exit with
the minibuffer contents instead.  This deselection behavior can be
controlled with the new user option 'completion-auto-deselect', which
is t by default.</code></pre>
<p class=\" text-justify\">There’s a longer-running theme to try and make the <code>*Completions*</code> window useful in contexts outside the minibuffer’s completion mechanism. This mechanism is rather confusingly named <code>completion-in-region</code>, even though it’s not just about acting on a region. If you use popup completion tools like company and corfu, then you should consider experimenting with this improved completion system, as it’s a “native” buffer-and-window-based approach to the same.</p>
<pre><code>New value 'historical' for user option 'completions-sort'.
When 'completions-sort' is set to 'historical', completion candidates
will be first sorted alphabetically, and then re-sorted by their order
in the minibuffer history, with more recent candidates appearing first.</code></pre>
<p class=\" text-justify\">There are popular third-party packages that do much of this already, so it’s nice to see that a similar feature has made it into core. My article on <a href=\"/article/understanding-minibuffer-completion\" class=\" article-link\">Understanding Minibuffer Completion</a> goes into more detail on how to configure minibuffer completion in Emacs.</p>
<pre><code>'completion-category-overrides' supports more metadata.
The new supported completion properties are 'cycle-sort-function',
'display-sort-function', 'annotation-function', 'affixation-function',
and 'group-function'.  You can now customize them for any category in
'completion-category-overrides' that will override the properties
defined in completion metadata.</code></pre>
<pre><code>'completion-extra-properties' supports more metadata.
The new supported completion properties are 'category',
'group-function', 'display-sort-function', and 'cycle-sort-function'.</code></pre>
<p class=\" text-justify\">See <a href=\"/article/understanding-minibuffer-completion\" class=\" article-link\">my article</a> for more information on customizing Emacs’s minibuffer.</p>
<H2 id=\"windows\">Windows</H2>
<pre><code>New command 'toggle-window-dedicated'.
This makes it easy to interactively mark a specific window as
dedicated, so it won't be reused by 'display-buffer'.  This can be
useful for complicated window setups.  It is bound to 'C-x w d'
globally.</code></pre>
<pre><code>\"d\" in the mode line now indicates that the window is dedicated.
Windows have always been able to be dedicated to a specific buffer;
see 'window-dedicated-p'.  Now the mode line indicates the dedicated
status of a window, with \"d\" appearing in the mode line if a window is
dedicated and \"D\" if the window is strongly dedicated.  This indicator
appears before the buffer name, and after the buffer modification and
remote buffer indicators (usually \"---\" together).</code></pre>
<p class=\" text-justify\">Coaxing Emacs into putting your windows where you want them to go is a common source of frustrating. I wrote <a href=\"/article/demystifying-emacs-window-manager\" class=\" article-link\">Demystifying Emacs’s Window Manager</a> in part to help people wrangle the windows into place. Dedicated windows are a blunt (though useful) tool that tells Emacs not to use a window for anything other than what is in it already. This feature mirrors what you find in a lot of other IDEs and editors where most windows have a singular purpose, unlike Emacs’.</p>
<pre><code>New action alist entry 'some-window' for 'display-buffer'.
It specifies which window 'display-buffer-use-some-window' should prefer.
For example, when 'display-buffer-base-action' is customized to
'(nil . ((some-window . mru)))', then a buffer will be displayed
in the same most recently used window from consecutive calls of
'display-buffer' (in a configuration with more than two windows).</code></pre>
<p class=\" text-justify\">This is pretty advanced stuff, but if you’re unhappy with the default methods employed by Emacs (see <code>display-buffer-fallback-action</code>) you can now tell it to more aggressively reuse windows using the “most recently used” order of windows.</p>
<pre><code>New action alist entry 'category' for 'display-buffer'.
If the caller of 'display-buffer' passes '(category . symbol)'
in its 'action' argument, you can match the displayed buffer
by adding '(category . symbol)' to the condition part of
'display-buffer-alist' entries.</code></pre>
<p class=\" text-justify\">I do not think you’re likely to encounter code that does this just yet, but I suppose this is one way of disambiguating windows that may share the same buffer name or major mode, but differ in some crucial way that only a custom cons cell <code>category</code> can sort out.</p>
<p class=\" text-justify\">Pretty niche. You’re probably not going to use this <em>really</em> into <code>display-buffer-alist</code>.</p>
<pre><code>New action alist entry 'post-command-select-window' for 'display-buffer'.
It specifies whether the window of the displayed buffer should be
selected or deselected at the end of executing the current command.</code></pre>
<pre><code>New variable 'window-restore-killed-buffer-windows'.
It specifies how 'set-window-configuration' and 'window-state-put'
should proceed with windows whose buffer was killed after the
corresponding configuration or state was recorded.</code></pre>
<p class=\" text-justify\">Window configurations are, well, configurations of windows. They are snapshots of window layouts: <code>C-x r w</code> puts your current window configuration into a register, and that is one such use; the other is tab bars in <code>tab-bar-mode</code>. Both set and restore window configurations when you change tabs or explicitly change them with a register. This variable’s really quite complex, so if you have strong opinions on this (you probably do not) then you really should read the lengthy docstring for this variable.</p>
<pre><code>New variable 'window-point-context-set-function'.
It can be used to set a context for window point in all windows by
'window-point-context-set' before calling 'current-window-configuration'
and 'window-state-get'.  Then later another new variable
'window-point-context-use-function' can be used by
'window-point-context-use' after 'set-window-configuration' and
'window-state-put' to restore positions of window points
according to the context stored in a window parameter.</code></pre>
<p class=\" text-justify\">Emacs tracks the position of point by <em>window</em> and not by buffer, as you may think. Split your current buffer and then move the point in one window and switch to the other: observe that your point is remembered between each window. Very handy, that, and this (alongside the window configuration stuff I mentioned before) is what this is about. You… probably don’t care.</p>
<pre><code>New functions 'set-window-cursor-type' and 'window-cursor-type'.
'set-window-cursor-type' sets a per-window cursor type, and
'window-cursor-type' queries this setting for a given window.  Windows
are always created with a 'window-cursor-type' of t, which means to
consult the variable 'cursor-type' as before.</code></pre>
<p class=\" text-justify\">You can now change the cursor type for each window. Neat. The variable <code>cursor-type</code> used to just override it for the whole Emacs session.</p>
<pre><code>The user option 'display-comint-buffer-action' is now obsolete.
You can use a '(category . comint)' condition in 'display-buffer-alist'
to match buffers displayed by comint-related commands.  Another
user option 'display-tex-shell-buffer-action' is obsolete too
for which you can use '(category . tex-shell)'.</code></pre>
<p class=\" text-justify\">I suppose this is what the change above is really about: to remove bespoke code and generalize it into the new category system.</p>
<H2 id=\"tool-bars\">Tool bars</H2>
<pre><code>Tool bars can now be placed on the bottom on more systems.
The 'tool-bar-position' frame parameter can be set to 'bottom' on all
window systems other than macOS and GNUstep (Nextstep).</code></pre>
<pre><code>New global minor mode 'modifier-bar-mode'.
When this minor mode is enabled, the tool bar displays buttons
representing modifier keys.  Clicking on these buttons applies the
corresponding modifiers to the next input event.</code></pre>
<p class=\" text-justify\">Useful on portable devices (like Android) that may not have certain modifier keys on its native keyboard.</p>
<pre><code>New user option 'tool-bar-always-show-default'.
When non-nil, the tool bar at the top of a frame does not show buffer
local customization of the tool bar.  The default value is nil.</code></pre>
<H2 id=\"tab-bars-and-tab-lines\">Tab Bars and Tab Lines</H2>
<p class=\" text-justify\">Tab bars are window configurations; tab lines are basically tabs like they appear in your browser.</p>
<pre><code>New user option 'tab-bar-select-restore-context'.
It uses 'window-point-context-set' to save contexts where
window points were located before switching away from the tab,
and 'window-point-context-use' to restore positions of window
points after switching back to that tab.</code></pre>
<p class=\" text-justify\">If you have multiple tabs featuring the same buffer, you can now preserve the point location between tabs.</p>
<pre><code>New user option 'tab-bar-select-restore-windows'.
It defines what to do with windows whose buffer was killed since the tab
was last selected.  By default it displays a placeholder buffer
with the name \" *Old buffer &lt;name&gt;*\" that provides information about
the name of the killed buffer that was displayed in that window.</code></pre>
<pre><code>New user option 'tab-bar-tab-name-format-functions'.
It can be used to add, remove and reorder functions that change the
appearance of every tab on the tab bar.</code></pre>
<pre><code>New hook 'tab-bar-tab-post-select-functions'.</code></pre>
<pre><code>New keymap 'tab-bar-mode-map'.
By default it contains a keybinding 'C-TAB' to switch tabs, but only
when 'C-TAB' is not bound globally.  You can unbind it if it conflicts
with 'C-TAB' in other modes.</code></pre>
<pre><code>New keymap 'tab-line-mode-map'.
By default it contains keybindings for switching tabs: 'C-x &lt;left&gt;',
'C-x &lt;right&gt;', 'C-x C-&lt;left&gt;', 'C-x C-&lt;right&gt;'.  You can unbind them if
you want to use these keys for the commands 'previous-buffer' and
'next-buffer'.</code></pre>
<p class=\" text-justify\">A better way of configuring tab bar/line modes’ keys. You can opt for more complex keys, and even use keyboard repeat maps if you use <code>C-&lt;TAB&gt;</code> for other things.</p>
<pre><code>Default list of tab-line tabs is changed to support a fixed order.
This means that 'tab-line-tabs-fixed-window-buffers', the new default
tabs function, is like the previous 'tab-line-tabs-window-buffers' where
both of them show only buffers that were previously displayed in the
window.  But the difference is that the new function always keeps the
original order of buffers on the tab line, even after switching between
these buffers.  You can drag the tabs and release at a new position
to manually reorder the buffers on the tab line.</code></pre>
<pre><code>New user option 'tab-line-tabs-buffer-group-function'.
It provides two choices to group tab buffers by major mode and by
project name.</code></pre>
<pre><code>Buffers on tab-line group tabs are now sorted alphabetically.
This will keep the fixed order of tabs, even after switching between
them.</code></pre>
<H2 id=\"help\">Help</H2>
<pre><code>New command 'help-find-source'.
Switch to a buffer visiting the source of what is being described in
\"*Help*\".  It is bound to 'C-h 4 s' globally.</code></pre>
<p class=\" text-justify\">Other notable commands include <code>M-x find-variable</code>, <code>M-x find-function</code> and <code>M-x find-function-on-key</code> to jump to their source definitions. I use ’em all the time.</p>
<pre><code>New user option 'describe-bindings-outline-rules'.
This user option controls outline visibility in the output buffer of
'describe-bindings' when 'describe-bindings-outline' is non-nil.</code></pre>
<p class=\" text-justify\">All this does is determine whether <code>outline-minor-mode</code> is enabled and configured to make headings collapsible.</p>
<pre><code>'describe-function' shows the function's inferred type when available.
For native compiled Lisp functions, 'describe-function' prints (after
the signature) the automatically inferred function type as well.  If the
function's type was explicitly declared (via the 'declare' form's
'ftype' property), 'describe-function' shows the declared type.  This is
controlled by the new user option 'help-display-function-type', which is
by default t; customize to nil to disable function type display.</code></pre>
<p class=\" text-justify\">This is really only likely to be of interest and use to elisp hackers who know their way around Emacs’s internals. The declared type for <code>+</code> is <code>Declared type: (function (&amp;rest (or number marker)) number)</code> for example.</p>
<pre><code>'describe-function' now shows the type of the function object.
The text used to say things like \"car is a built-in function\" whereas it
now says \"car is a primitive-function\" where \"primitive-function\" is the
name of the symbol returned by 'cl-type-of'.  You can click on those
words to get information about that type.</code></pre>
<p class=\" text-justify\">It’s been a long-running saga to get some sort of type taxonomy into Emacs, and it’s slowly happening now. I am unsure how useful this is to your average elisp hacker; this is more likely to be of use for byte and native compilation. See also the entry further down on declaratively specifying the arguments and return type of a function.</p>
<pre><code>'C-h m' ('describe-mode') uses outlining by default.
Set 'describe-mode-outline' to nil to get back the old behavior.</code></pre>
<p class=\" text-justify\">See above.</p>
<pre><code>'C-h k' ('describe-key') shows Unicode name.
For keybindings which produce single characters via translation or input
methods, 'C-h k' now shows the Unicode name of the produced character in
addition to the character itself, e.g.

'C-h k C-x 8 E' =&gt;

    € 'EURO SIGN' (translated from C-x 8 E)</code></pre>
<p class=\" text-justify\">A useful change, even though I doubt I’ll remember that I can do this. For inputtable characters I normally type them then use <code>C-u C-x =</code> to see its unicode name along with a host of other useful information.</p>
<pre><code>'C-h b' ('describe-bindings') shows Unicode names.
For keybindings which produce single characters via translation (such as
those using the 'C-x 8' or 'A-' prefix, or 'dead-acute', 'dead-grave',
etc), the Unicode names will now be shown in addition to the character
itself, i.e.

    A-!         ¡   INVERTED EXCLAMATION MARK
    A-$         ¤   CURRENCY SIGN

and so on.</code></pre>
<p class=\" text-justify\">This I am more likely to find a use for. <code>C-h b</code> is a must-know command, and now it shows the unicode name for self-inserted characters.</p>
<pre><code>Multi-character key echo now ends with a suggestion to use Help.
Customize 'echo-keystrokes-help' to nil to prevent that.</code></pre>
<H2 id=\"customize\">Customize</H2>
<pre><code>New command 'customize-dirlocals'.
This command pops up a buffer to edit the settings in \".dir-locals.el\".</code></pre>
<p class=\" text-justify\">Wow. This change is great. Directory-local variables are elisp variables declared in one of several files (such as <code>.dir-locals.el</code>) that you can use to effect directory-specific changes to Emacs buffers. I really love dirlocals; however, they’re a pain to add and edit. <code>M-x add-dir-local-variable</code> is a newbie trap, and it’s easy to type the wrong thing and cause all sorts of issues (or worse: that nothing at all happens.)</p>
<p class=\" text-justify\">A nice customize UI will go a long way towards encouraging more people to use it.</p>
<pre><code>New command 'customize-toggle-option'.
This command can toggle boolean options for the duration of a session.</code></pre>
<p class=\" text-justify\">One cool aspect of Customize is that you can set settings for the duration only, and then later on return to finalize them and save them to a file. All this does is add that functionality to booleans.</p>
<pre><code>New prefix argument for modifying directory-local variables.
The commands 'add-dir-local-variable', 'delete-dir-local-variable' and
'copy-file-locals-to-dir-locals' now take an optional prefix argument,
to enter the file name where you want to modify directory-local
variables.</code></pre>
<pre><code>New user option 'safe-local-variable-directories'.
This user option names directories in which Emacs will treat all
directory-local variables as safe.</code></pre>
<p class=\" text-justify\">Very useful. Emacs is squeamish about dirlocals as it maintains a list of safe variables and anything else is considered unsafe, and you’re asked to approve every setting. Whitelisting certain directories is a great compromise for people who are OK with the risks that follow from such a feature.</p>
<H2 id=\"cl-print\">CL Print</H2>
<p class=\" text-justify\">This is for elisp programmers only, and governs how Elisp forms are printed on the screen for human consumption.</p>
<pre><code>There is a new chapter in the CL manual documenting cl-print.el.
See the Info node \"(cl) Printing\".</code></pre>
<pre><code>You can expand the \"...\" truncation everywhere.
The code that allowed \"...\" to be expanded in the \"*Backtrace*\" buffer
should now work anywhere the data is generated by 'cl-print'.</code></pre>
<pre><code>The 'backtrace-ellipsis' button is replaced by 'cl-print-ellipsis'.</code></pre>
<pre><code>hash-tables' contents can be expanded via the ellipsis.</code></pre>
<pre><code>Modes can control the expansion via 'cl-print-expand-ellipsis-function'.</code></pre>
<pre><code>New setting 'raw' for 'cl-print-compiled'.
This setting causes byte-compiled functions to be printed in full by
'prin1'.  A button on this output can be activated to disassemble the
function.</code></pre>
<H2 id=\"miscellaneous\">Miscellaneous</H2>
<pre><code>New command 'kill-matching-buffers-no-ask'.
This works like 'kill-matching-buffers', but without asking for
confirmation.</code></pre>
<p class=\" text-justify\"><code>M-x kill-matching-buffers</code> kills buffers by regexp; and now you can have it do so without asking your permission.</p>
<pre><code>'recover-file' can show diffs between auto save file and current file.
When answering the prompt with \"diff\" or \"=\", it now shows the diffs
between the auto save file and the current file.</code></pre>
<p class=\" text-justify\">Ah, very handy. You can already diff files you want to save with <code>C-x s</code> and then <code>d</code>.</p>
<pre><code>'read-passwd' can toggle the visibility of passwords.
Use 'TAB' in the minibuffer to show or hide the password.
Alternatively, click the new show-password icon on the mode-line with
'mouse-1' to toggle the visibility of the password.</code></pre>
<p class=\" text-justify\">TAB, eh? I’m most assuredly going to accidentally reveal a password that way. You can edit <code>read-passwd-map</code> to remove the TAB if you want, though.</p>
<pre><code>'advice-remove' is now an interactive command.
When called interactively, 'advice-remove' now prompts for an advised
function to the advice to remove.</code></pre>
<p class=\" text-justify\">Good. You can do this with <code>M-x remove-hook</code> also. Useful if you foolishly cram lambdas into hooks or advice… and are now struggling to remove them. But you’d never make that mistake, right? :)</p>
<pre><code>New user option 'uniquify-dirname-transform'.
This can be used to customize how buffer names are uniquified, by
making arbitrary transforms on the buffer's directory name (whose
components are used to uniquify buffer names when they clash).  You
can use this to distinguish between buffers visiting files with the
same base name that belong to different projects by using the provided
transform function 'project-uniquify-dirname-transform'.</code></pre>
<p class=\" text-justify\">Uniquify renames buffers (but not the underlying files, if any) to sensible names instead of <code>foo&lt;1&gt;</code>, <code>foo&lt;2&gt;</code>, etc. It’s enabled by default, nowadays, but if you use the projects feature in Emacs, and if you frequently open the same file name in multiple projects, give this setting a try.</p>
<pre><code>New user option 'remote-file-name-inhibit-delete-by-moving-to-trash'.
When non-nil, this option suppresses moving remote files to the local
trash when deleting.  Default is nil.</code></pre>
<pre><code>New user option 'remote-file-name-inhibit-auto-save'.
If this user option is non-nil, 'auto-save-mode' will not auto-save
remote buffers.  The default is nil.</code></pre>
<pre><code>New user option 'remote-file-name-access-timeout'.
If a positive number, this option limits the call of 'access-file'
for remote files to that number of seconds.  Default is nil.</code></pre>
<p class=\" text-justify\">These are Tramp features, part of Emacs’s remote file editing system.</p>
<pre><code>New user option 'yes-or-no-prompt'.
This allows the user to customize the prompt that is appended by
'yes-or-no-p' when asking questions.  The default value is
\"(yes or no) \".</code></pre>
<pre><code>New user option 'menu-bar-close-window'.
When non-nil, selecting \"Close\" from the \"File\" menu or clicking
\"Close\" in the tool bar will result in the current window being
deleted, if possible.  The default is nil, and these gestures kill the
buffer shown in the current window, but don't delete the window.</code></pre>
<pre><code>New face 'display-time-date-and-time'.
This is used for displaying the time and date components of
'display-time-mode'.</code></pre>
<pre><code>New face 'appt-notification' for 'appt-display-mode-line'.
It can be used to customize the look of the appointment notification
displayed on the mode line when 'appt-display-mode-line' is non-nil.</code></pre>
<pre><code>New icon images for general use.
Several symbolic icons have been added to \"etc/images/symbols\",
including plus, minus, check-mark, star, etc.</code></pre>
<pre><code>Emacs now recognizes shebang lines that pass '-S'/'--split-string' to 'env'.
When visiting a script that invokes 'env -S INTERPRETER ARGS...' in
its shebang line, Emacs will now skip over 'env -S' and deduce the
major mode based on the interpreter after 'env -S'.</code></pre>
<p class=\" text-justify\">Emacs uses a wide range of tools to infer the major mode to use. Filename is not the only way: Emacs will scan the file to try and determine the major mode if there is no obvious choice that matches its filename. Looking at <code>/usr/bin/env</code> is one such method.</p>
<pre><code>'insert-directory-program' is now a user option.
On *BSD and macOS systems, this user option now defaults to the \"gls\"
executable, if it exists.  This should remove the need to change its
value when installing GNU coreutils using something like ports or
Homebrew.</code></pre>
<pre><code>'write-region-inhibit-fsync' now defaults to t in interactive mode.
This is the default in batch mode since Emacs 24.</code></pre>
<pre><code>The default value of 'read-process-output-max' was increased to 65536.</code></pre>
<p class=\" text-justify\">You can probably experiment with setting this even higher to batch up output from commands. Your mileage may vary, though. Mine is set to <code>1048576</code>.</p>
<pre><code>'url-gateway-broken-resolution' is now obsolete.
This option was intended for use on SunOS 4.x and Ultrix systems,
neither of which have been supported by Emacs since version 23.1.
The user option 'url-gateway-nslookup-program' and the command
'url-gateway-nslookup-host' are consequently also obsolete.

</code></pre>
<H2 id=\"editing-changes-in-emacs-30.1\">Editing Changes in Emacs 30.1</H2>
<pre><code>New minor mode 'visual-wrap-prefix-mode'.
When enabled, continuation lines displayed for a wrapped long line
will receive a 'wrap-prefix' automatically computed from the line's
surrounding context, such that continuation lines are indented on
display as if they were filled with 'M-q' or similar.  Unlike 'M-q',
the indentation only happens on display, and doesn't change the buffer
text in any way.  The global minor mode
'global-visual-wrap-prefix-mode' enables this minor mode in all
buffers.

(This minor mode is the 'adaptive-wrap' ELPA package renamed and
lightly edited for inclusion in Emacs.)</code></pre>
<pre><code>New global minor mode 'kill-ring-deindent-mode'.
When enabled, text being saved to the kill ring will be de-indented by
the column number at its start.  For example, saving the entire
function call within an indented block:

foo ()
{
  long_function_with_several_arguments (argument_1_compute (),
                                        argument_2_compute (),
                                        argument_3_compute ());
}

will save this to the kill ring:

long_function_with_several_arguments (argument_1_compute (),
                                      argument_2_compute (),
                                      argument_3_compute ())

This omits the two columns of extra indentation that would otherwise be
copied from the second and third lines and saved to the kill ring.</code></pre>
<p class=\" text-justify\">This is worth enabling if inconsistent kill-yank indentation annoys you. Doing this correctly, especially in whitespace sensitive languages, is really important in structured editing tools such as my package, <a href=\"/article/combobulate-structured-movement-editing-treesitter\" class=\" article-link\">Combobulate</a>.</p>
<pre><code>New command 'replace-regexp-as-diff'.
It reads a regexp to search for and a string to replace with, then
displays a buffer with replacements as diffs.  After reviewing the
changes in the output buffer you can apply the replacements as
a patch to the current file buffer.  There are also new commands
'multi-file-replace-regexp-as-diff' that shows as diffs replacements
in a list of specified files, and 'dired-do-replace-regexp-as-diff'
that shows as diffs replacements in the marked files in Dired.</code></pre>
<p class=\" text-justify\">This is a very welcome addition for bulk text replacing. It’s a nervewracking thing to accept/reject changes and hope you didn’t screw it up. Having a dedicated diff window that works across multiple files is a superb addition to Emacs.</p>
<pre><code>New mode of prompting for register names and showing preview.
The new user option 'register-use-preview' can be customized to the
value t or 'insist' to request a different user interface of prompting for
register names and previewing the registers: Emacs will require
confirmation for overwriting the value of a register, and will show
the preview of registers without delay.  You can also customize this
new option to disable the preview completely.

The default value of 'register-use-preview' ('traditional') preserves the
behavior of Emacs 29 and before.  See the Info node \"(emacs) Registers\"
for more details about the new UI and its variants.</code></pre>
<p class=\" text-justify\">I love registers, and I use them a lot. I use them because they require no forethought on my part to use: set and recall; it’s that simple. No fuss. If you want added distractions like confirmation prompts if you override a register? Go ahead and change the new option. If you like registers the way they are, then you don’t have to do anything.</p>
<pre><code>New advanced macro counter commands.
New commands have been added to implement advanced macro counter
functions.

The commands 'C-x C-k C-r l' and 'C-x C-k C-r s' load and save the
macro counter from and to a number register, respectively.

The commands 'C-x C-k C-r a =', 'C-x C-k C-r a &lt;', and 'C-x C-k C-r a &gt;'
compare the macro counter with the contents of a number register and
increment the counter by an optional prefix if the comparison succeeds.

The commands 'C-x C-k C-q =', 'C-x C-k C-q &lt;', and 'C-x C-k C-q &gt;'
compare the macro counter with an optional prefix and terminate the
macro if the comparison succeeds.</code></pre>
<p class=\" text-justify\">Advanced indeed. Registers are capable of incrementing and decrementing a number already, and kmacro (Emacs’s keyboard macro facility) has its own internal counter (see <a href=\"/article/keyboard-macros-are-misunderstood\" class=\" article-link\">Keyboard Macros are Misunderstood</a>) also. Now you can switch values between them and also do simple comparisons. Combine it with the ability to physically move up or down a line; increment and decrement; and conditional termination, and I’m pretty sure kmacro close to Turing-complete.</p>
<pre><code>New mode 'kmacro-menu-mode' and new command 'list-keyboard-macros'.
The new command 'list-keyboard-macros' is the keyboard-macro version
of commands like 'list-buffers' and 'list-processes', creating a listing
of the currently existing keyboards macros using the new mode
'kmacro-menu-mode'.  It allows rearranging the macros in the ring,
duplicating them, deleting them, and editing their counters, formats,
and keys.</code></pre>
<p class=\" text-justify\">Excellent. There’s already a kmacro ring for macros known to Emacs, but it’s a bit awkward. Now you can list the macros.</p>
<pre><code>On X, Emacs now supports input methods which perform \"string conversion\".
This means an input method can now ask Emacs to delete text
surrounding point and replace it with something else, as well as query
Emacs for surrounding text.  If your input method allows you to \"undo\"
mistaken compositions, this will now work as well.</code></pre>
<pre><code>New user option 'duplicate-region-final-position'.
It controls the placement of point and the region after duplicating a
region with 'duplicate-dwim'.</code></pre>
<pre><code>New user option 'mouse-prefer-closest-glyph'.
When enabled, clicking or dragging with the mouse will put the point
or start the drag in front of the buffer position corresponding to the
glyph with the closest X coordinate to the click or start of the drag.
In other words, if the mouse pointer is in the right half of a glyph,
point will be put after the buffer position corresponding to that glyph,
whereas if the mouse pointer is in the left half of a glyph, point
will be put in front the buffer position corresponding to that glyph.
By default this is disabled.</code></pre>
<pre><code>New pre-defined values for 'electric-quote-chars'.
The available customization options for 'electric-quote-chars' have been
updated with common pairs of quotation characters, including \"‘\", \"’\",
\"“\", \"”\", \"«\", \"»\", \"‹\", \"›\", \"‚\", \"„\", \"「\", \"」\", \"『\", and \"』\".
The default is unchanged.</code></pre>
<p class=\" text-justify\">This is for <code>M-x electric-pair-mode</code>, which automatically pairs an opening character with its constituent closing character.</p>
<pre><code>'M-TAB' now invokes 'completion-at-point' in Text mode.
By default, Text mode no longer binds 'M-TAB' to 'ispell-complete-word'.
Instead, this mode arranges for 'completion-at-point', globally bound to
'M-TAB', to perform word completion as well.  You can have Text mode
binding 'M-TAB' to 'ispell-complete-word' as it did in previous Emacs
versions, or disable Ispell word completion in Text mode altogether, by
customizing the new user option 'text-mode-ispell-word-completion'.</code></pre>
<p class=\" text-justify\"><code>M-&lt;TAB&gt;</code> is also Alt+Tab. The key binding <code>C-M-i</code> is functionally equivalent.</p>
<H2 id=\"internationalization\">Internationalization</H2>
<pre><code>Mode-line mnemonics for some coding-systems have changed.
The mode-line mnemonic for 'utf-7' is now the lowercase 'u', to be
consistent with the other encodings of this family.

The mode-line mnemonic for 'koi8-u' is now 'У', U+0423 CYRILLIC
CAPITAL LETTER U, to distinguish between this encoding and the
UTF-8/UTF-16 family.

If your terminal cannot display 'У', or if you want to get the old
behavior back for any other reason, you can do that using the
'coding-system-put' function.  For example, the following restores the
previous behavior of showing 'U' in the mode line for 'koi8-u':

    (coding-system-put 'koi8-u :mnemonic ?U)</code></pre>
<p class=\" text-justify\">The mode line adopts a different character for the coding system in the active buffer. You can find it in the bottom left.</p>
<pre><code>'vietnamese-tcvn' is now a coding system alias for 'vietnamese-vscii'.
VSCII-1 and TCVN-5712 are different names for the same character
encoding.  Therefore, the duplicate coding system definition has been
dropped in favor of an alias.

The mode-line mnemonic for 'vietnamese-vscii' and its aliases is the
lowercase letter \"v\".</code></pre>
<pre><code>Users in CJK locales can control width of some non-CJK characters.
Some characters are considered by Unicode as \"ambiguous\" with respect
to their display width: either \"full-width\" (i.e., taking 2 columns on
display) or \"narrow\" (taking 1 column).  The actual width depends on
the fonts used for these characters by Emacs or (for text-mode frames)
by the terminal emulator.  Traditionally, font sets in CJK locales
were set up so as to display these characters as full-width, and thus
Emacs modified the char-width table in those locales to follow suit.
Lately, the tendency is to display these characters as narrow.  The
new user option 'cjk-ambiguous-chars-are-wide' allows users to control
whether Emacs considers these characters as full-width (the default)
or narrow (if the variable is customized to the nil value).

This setting affects the results of 'string-width' and similar
functions in CJK locales.</code></pre>
<pre><code>New input methods for the Urdu, Pashto, and Sindhi languages.
These languages are spoken in Pakistan and Afghanistan.</code></pre>
<pre><code>New input method \"english-colemak\".
This input method supports the Colemak keyboard layout.</code></pre>
<p class=\" text-justify\">Input methods are really neat. You can switch to a ‘virtual keyboard’ that behaves like another language, letting you enter diacritics and complex unicode characters using your current keyboard’s layout. You are not limited to actual languages, either: there are input methods to help you enter LaTeX for example.</p>
<p class=\" text-justify\">You can toggle the input method with <code>C-\\</code> and with a prefix argument to set the input method type. I wrote about them in <a href=\"/article/diacritics-in-emacs\" class=\" article-link\">Olé! Diacritics in Emacs</a>. I even wrote my own input method for <a href=\"/article/inserting-emoji-input-methods\" class=\" article-link\">Inserting Emoji</a> just to highlight how powerful and simple the system is.</p>
<pre><code>Additional 'C-x 8' key translations for \"æ\" and \"Æ\".
These characters can now be input with 'C-x 8 a e' and 'C-x 8 A E',
respectively, in addition to the existing translations 'C-x 8 / e' and
'C-x 8 / E'.</code></pre>
<p class=\" text-justify\">Wonderful news for people who prefer the original spelling of encyclopedia, and Danes, I suppose.</p>
<pre><code>New 'C-x 8' key translations for \"low\" quotes \"„\", and \"‚\".
These can now be entered with 'C-x , \"' and 'C-x , ''.</code></pre>
<pre><code>New German language 'C-x 8' key translations for quotation marks.
The characters \"„\", \"“\", and \"”\" can now be entered with 'C-x 8 v',
'C-x 8 b' and 'C-x 8 n'.  The single versions \"‚\", \"‘\", and \"’\" can now
be entered with 'C-x 8 V', 'C-x 8 B' and 'C-x 8 N'.  These characters
are used for the official German quoting style.  Using them requires
activating German language support via 'iso-transl-set-language'.</code></pre>
<pre><code>\"latin-prefix\" and \"latin-postfix\" quotation marks additions.
These input methods can now produce single, double and \"low\" left and
right quotation marks:

    \"‘\", \"’\", \"“\", \"”\", \"„\", and \"‚\"

by using \"[\", \"]\", and \",\" for \"left\", \"right\", and \"low\" respectively
to modify \"'\" and \"\"\".</code></pre>
<pre><code>\"latin-prefix\" and \"latin-postfix\" guillemets support.
These input methods can now produce single guillemets \"‹\" and \"›\".  For
\"latin-prefix\" use \"~~&lt;\" and \"~~&gt;\", for \"latin-postfix\" use \"&lt;~\" and
\"&gt;~\".  Double guillemets (\"«\" and \"»\") were already supported.</code></pre>
<pre><code>New French language 'C-x 8' key translations for \"‹\" and \"›\".
These characters can now be entered using 'C-x 8 ~ &lt;' and 'C-x 8 ~ &gt;',
respectively, after activating French language support via
'iso-transl-set-language'.  Double guillemets were already supported via
'C-x 8 &lt;' and 'C-x 8 &gt;'</code></pre>
<pre><code>Additional 'C-x 8' key translation for Euro \"€\" currency symbol.
This can now be entered using 'C-x 8 E' in addition to the existing
'C-x 8 * E' translation.</code></pre>
<H2 id=\"changes-in-specialized-modes-and-packages-in-emacs-30.1\">Changes in Specialized Modes and Packages in Emacs 30.1</H2>
<H3 id=\"outline-mode\">Outline mode</H3>
<p class=\" text-justify\">Outline mode is a cut-down outliner for collapsing and expanding headings.</p>
<pre><code>New commands to show/hide outlines by regexp.
'C-c / h' ('outline-hide-by-heading-regexp') asks for a regexp and then
hides the body lines of all outlines whose heading lines match the
regexp.  'C-c / s' ('outline-show-by-heading-regexp') does the inverse:
it shows the bodies of outlines that matched a regexp.</code></pre>
<pre><code>'outline-minor-mode' is supported in tree-sitter major modes.
It can be used in all tree-sitter major modes that set either the
variable 'treesit-simple-imenu-settings' or 'treesit-outline-predicate'.</code></pre>
<p class=\" text-justify\">Excellent news, and likely to be far more robust as it uses tree-sitter’s nodes to determine what to hide and show.</p>
<H3 id=\"info\">Info</H3>
<p class=\" text-justify\">Info mode is Emacs’s implementation of the TexInfo hypertext viewer.</p>
<pre><code>New user option 'Info-url-alist'.
This user option associates manual names with URLs.  It affects the
'Info-goto-node-web' command.  By default, associations for all
Emacs-included manuals are set.  Further associations can be added for
arbitrary Info manuals.</code></pre>
<pre><code>Emacs can now display Info manuals compressed with 'lzip'.
This requires the 'lzip' program to be installed on your system.</code></pre>
<H3 id=\"gud-grand-unified-debugger\">GUD (Grand Unified Debugger)</H3>
<p class=\" text-justify\">GUD is a user interface for debuggers such as GDB.</p>
<pre><code>New user option 'gud-highlight-current-line'.
When enabled, GUD will visually emphasize the line being executed upon
pauses in the debuggee's execution, such as those occasioned by
breakpoints being hit.</code></pre>
<pre><code>New command 'lldb'.
Run the LLDB debugger, analogous to the 'gud-gdb' command.</code></pre>
<pre><code>Variable order and truncation can now be configured in 'gdb-many-windows'.
The new user option 'gdb-locals-table-row-config' allows users to
configure the order and max length of various properties in the local
variables buffer when using 'gdb-many-windows'.

By default, this user option is set to write the properties in the order:
'name', 'type' and 'value', where the 'name' and 'type' are truncated to 20
characters, and the 'value' is truncated according to the value of
'gdb-locals-value-limit'.

If you want to get back the old behavior, set the user option to the value

    (setopt gdb-locals-table-row-config
            `((type . 0) (name . 0) (value . ,gdb-locals-value-limit)))</code></pre>
<pre><code>New user option 'gdb-display-io-buffer'.
If this is nil, command 'gdb' will neither create nor display a separate
buffer for the I/O of the program being debugged, but will instead
redirect the program's interaction to the GDB execution buffer.  The
default is t, to preserve previous behavior.</code></pre>
<H3 id=\"grep\">Grep</H3>
<p class=\" text-justify\">Grep (or rather the interface for talking to and displaying the results from <code>grep</code>) is a powerful feature in Emacs with a wide range of commands.</p>
<pre><code>New user option 'grep-use-headings'.
When non-nil, the output of Grep is split into sections, one for each
file, instead of having file names prefixed to each line.  It is
equivalent to the '--heading' option of some tools such as 'git grep'
and 'rg'.  The headings are displayed using the new 'grep-heading' face.
The default is nil.</code></pre>
<p class=\" text-justify\">Good news if you prefer the heading system used by tools such as <code>rg</code>. I have not tried it yet, but I wonder how easy it is to bulk edit the output of a grep command when it is in header mode.</p>
<H3 id=\"compilation-mode\">Compilation mode</H3>
<p class=\" text-justify\">Compilation mode (via <code>M-x compile</code> usually) is Emacs’s interface for talking to not just compilers but any tool that emits structured output.</p>
<pre><code>The 'omake' matching rule is now disabled by default.
This is because it partly acts by modifying other rules which may
occasionally be surprising.  It can be re-enabled by adding 'omake' to
'compilation-error-regexp-alist'.</code></pre>
<pre><code>Lua errors and stack traces are now recognized.
Compilation mode now recognizes Lua language errors and stack traces.
Every Lua error is recognized as a compilation error, and every Lua
stack frame is recognized as a compilation info.</code></pre>
<p class=\" text-justify\">Emacs already has a huge range of compilation rules, so I’m surprised it didn’t have it for Lua, given how popular it is.</p>
<H3 id=\"project\">Project</H3>
<p class=\" text-justify\">Project is one of many, many file project solutions built into Emacs, and arguably the best one to use. See <code>C-x p C-h</code>.</p>
<pre><code>New user option 'project-mode-line'.
When non-nil, display the name of the current project on the mode
line.  Clicking 'mouse-1' on the project name pops up the project
menu.  The default value is nil.</code></pre>
<p class=\" text-justify\">If you’re not strapped for space, why not enable this?</p>
<pre><code>New user option 'project-file-history-behavior'.
Customizing it to 'relativize' makes commands like 'project-find-file'
and 'project-find-dir' display previous history entries relative to
the current project.</code></pre>
<pre><code>New user option 'project-key-prompt-style'.
The look of the key prompt in the project switcher has been changed
slightly.  To get the previous one, set this option to 'brackets'.</code></pre>
<pre><code>Function 'project-try-vc' tries harder to find the responsible VCS.
When 'project-vc-extra-root-markers' is non-nil, and causes a
subdirectory project to be detected which is not a VCS root, Project now
additionally traverses the parent directories until a VCS root is found
(if any), so that the ignore rules for that repository are used, and
the file listing's performance is still optimized.</code></pre>
<p class=\" text-justify\">Root markers are used to find the boundaries of a project (for example the <code>.git</code> directory, or maybe a file such as a Makefile), and that works well enough for simple use cases. You can tell Emacs to look for other things in addition to its builtin rules, and this is where the contract of a root marker breaks down a little, particularly if you have a repo and another non-repo marker inside of that.</p>
<pre><code>New commands 'project-any-command' and 'project-prefix-or-any-command'.
The former is now bound to 'C-x p o' by default.
The latter is designed primarily for use as a value of
'project-switch-commands'.  If instead of a short menu you prefer to
have access to all keys defined inside 'project-prefix-map', as well
as global bindings (to run other commands inside the project root),
you can add this to your init script:

    (setopt project-switch-commands #'project-prefix-or-any-command)</code></pre>
<p class=\" text-justify\">This is effectively a way of executing a key bindings from the root directory of the current buffer’s root project.</p>
<pre><code>New variable 'project-files-relative-names'.
If it is non-nil, 'project-files' can return file names relative to the
project root.  Project backends can use this to improve the performance
of their 'project-files' implementation.</code></pre>
<H3 id=\"vc\">VC</H3>
<p class=\" text-justify\">VC is Emacs’s excellent generic version control interface. If you do not use <a href=\"/article/introduction-magit-emacs-mode-git\" class=\" article-link\">Magit, an Emacs mode for Git</a>, or if you use a source control that is not git, then I highly recommend you sit down and learn how to use VC. It’s really excellent.</p>
<pre><code>Log-Edit buffers now display a tool bar.
This tool bar contains items for committing log entries and editing or
generating log entries, among other editing operations.</code></pre>
<p class=\" text-justify\">I’ve long advocated using the menu bar because telling beginners to turn it off is <a href=\"/article/bad-emacs-advice\" class=\" article-link\">Bad Emacs Advice</a>. The toolbar is harder to justify turning on as it is a little bit threadbare. Having said that, making it even more contextual is still a very positive thing indeed.</p>
<pre><code>New user option 'vc-git-shortlog-switches'.
This is a string or a list of strings that specifies the Git log
switches for shortlogs, such as the one produced by 'C-x v L'.
'vc-git-log-switches' is no longer used for shortlogs.</code></pre>
<pre><code>New value 'no-backend' for user option 'vc-display-status'.
With this value only the revision number is displayed on the mode-line.</code></pre>
<pre><code>Obsolete command 'vc-switch-backend' re-added as 'vc-change-backend'.
The command was previously obsoleted and unbound in Emacs 28.</code></pre>
<p class=\" text-justify\">It is rare indeed for a command to get obsoleted and the unobsoleted.</p>
<pre><code>Support for viewing VC change history across renames.
When a fileset's VC change history ends at a rename, 'C-x v l' now
prints the old name(s) and shows a button which jumps to the history of
the files under the old names.  This feature is supported for Git and
Hg.  Naturally, 'vc-git-print-log-follow' should be nil for this to work
(or '--follow' should not be in 'vc-hg-log-switches', in Hg's case).
Unlike when the '--follow' switch is used, commands to see the diff of
the old revision ('d'), to check out an old file version ('f') or to
annotate it ('a'), also work on revisions which precede renames.</code></pre>
<pre><code>'vc-annotate' now abbreviates the Git revision in the buffer name.
When using the Git backend, 'vc-annotate' will use an abbreviated
revision identifier in its buffer name.  To restore the previous
behavior, set user option 'vc-annotate-use-short-revision' to nil.</code></pre>
<pre><code>New user option 'vc-git-file-name-changes-switches'.
It allows tweaking the thresholds for rename and copy detection.</code></pre>
<pre><code>VC Directory buffers now display the upstream branch in Git repositories.
The \"upstream branch\" is the branch from which 'vc-pull' fetches changes
by default.  In Git terms, the upstream branch of branch B is determined
by configuration variables 'branch.B.remote' and 'branch.B.merge'.

When these configuration variables are set for the current branch, the
VC Directory buffer will show the corresponding upstream branch under
the \"Tracking\" header.</code></pre>
<H3 id=\"diff-mode\">Diff mode</H3>
<p class=\" text-justify\">Diff mode is one of several modes for interacting with and browsing <code>.diff</code> files.</p>
<pre><code>New user option 'diff-refine-nonmodified'.
When this is non-nil, 'diff-refine-hunk' will highlight lines that were
added or removed in their entirety (as opposed to modified lines, where
some parts of the line were modified), using the same faces as for
highlighting the words added and removed within modified lines.  The
default value is nil.</code></pre>
<pre><code>'diff-ignore-whitespace-hunk' can now be applied to all hunks.
When called with a non-nil prefix argument,
'diff-ignore-whitespace-hunk' now iterates over all the hunks in the
current diff, regenerating them without whitespace changes.</code></pre>
<p class=\" text-justify\">Very useful in Lisp, in my opinion, where a change of indentation can easily happen when you change something else. I have git set to ignore whitespace by default to avoid indentation changes gumming up the staging area.</p>
<pre><code>New user option 'diff-ignore-whitespace-switches'.
This allows changing which type of whitespace changes are ignored when
regenerating hunks with 'diff-ignore-whitespace-hunk'.  Defaults to
the previously hard-coded \"-b\".</code></pre>
<pre><code>New command 'diff-apply-buffer' bound to 'C-c RET a'.
It applies the diff in the entire diff buffer and
saves all modified file buffers.</code></pre>
<p class=\" text-justify\">Good all-round command and saves having to do multiple keystrokes to achieve the same effect.</p>
<H3 id=\"dired\">Dired</H3>
<p class=\" text-justify\">Dired is Emacs’s all-singing, all-dancing directory and file editor, bound to <code>C-x d</code> and <code>M-x dired</code>.</p>
<pre><code>New user option 'dired-movement-style'.
When non-nil, make 'dired-next-line', 'dired-previous-line',
'dired-next-dirline', 'dired-prev-dirline' skip empty lines.
It also controls how to move point when encountering a boundary
(e.g., if every line is visible, invoking 'dired-next-line' at
the last line will move to the first line).  The default is nil.</code></pre>
<p class=\" text-justify\">Oh, this is much-needed. Here’s how it works: you can insert the contents of a directory into an existing dired buffer (find a directory and tap <code>i</code>) and act on the files across the directory boundaries as though they were one directory – very powerful, and it means you can use <a href=\"/article/dired-shell-commands-find-xargs-replacement\" class=\" article-link\">dired to replace find &amp; xargs</a> – but the <code>p</code> and <code>n</code> commands to move between files does not jump between these virtual directories, and so you’re stuck having to move point between a bunch of dead space. Until now, that is. I recommend you set it to <code>bounded</code> or <code>cycle</code>.</p>
<pre><code>New user option 'dired-filename-display-length'.
It is an integer representing the maximum display length of file names.
The middle part of a file name whose length exceeds the restriction is
hidden and an ellipsis is displayed instead.  A value of 'window'
means using the right edge of window as the display restriction.  The
default is nil.</code></pre>
<p class=\" text-justify\">If you squeeze dired into a side bar window, you can now truncate filenames to make them fit to the size of the window, which is a good quality of life improvement.</p>
<pre><code>New user option 'shell-command-guess-functions'.
It defines how to populate a list of commands available
for 'M-!', 'M-&amp;', '!', '&amp;' and the context menu \"Open With\"
based on marked files in Dired.  Possible backends are
'dired-guess-default', MIME types, XDG configuration
and a universal command such as \"open\" or \"start\"
that delegates to the OS.</code></pre>
<p class=\" text-justify\">Emacs has several ways of guessing the right command to run on a filename, and they are annoyingly different and only available in some parts of Emacs and not others. This is a clear attempt to clean up this mess and offer a unified way of picking the right command to run.</p>
<pre><code>New command 'dired-do-open'.
This command is bound to 'E' (mnemonics \"External\").  Also it can be
used by clicking \"Open\" in the context menu; it \"opens\" the marked or
clicked on files according to the OS conventions.  For example, on
systems supporting XDG, this runs 'xdg-open' on the files.</code></pre>
<p class=\" text-justify\">Excellent addition. I used to do <code>!</code> to do this, but now it has its own key.</p>
<pre><code>New variable 'dired-guess-shell-alist-optional'.
It contains commands for external viewers and players for various media
formats, moved to this list from 'dired-guess-shell-alist-default'.</code></pre>
<p class=\" text-justify\">Worth a look if you want Emacs to open your media files in other tools than its defaults.</p>
<pre><code>The default value of 'dired-omit-size-limit' was increased.
After performance improvements to omitting in large directories, the new
default value is 300k, up from 100k.  This means 'dired-omit-mode' will
omit files in directories whose directory listing is up to 300 kilobytes
in size.</code></pre>
<p class=\" text-justify\">Omit mode hides useless files based on regexp filters. Great way to hide backup files, compiler detritus and more. You may have to <code>(require 'dired-x)</code> first.</p>
<pre><code>'dired-listing-switches' handles connection-local values if exist.
This allows you to customize different switches for different remote machines.</code></pre>
<p class=\" text-justify\">This relates to Tramp, Emacs’s remote file editing protocol. Because Tramp sends commands to the remote host, you can now customize how dired should query for files on the remote file system.</p>
<H3 id=\"ediff\">Ediff</H3>
<p class=\" text-justify\">Ediff is another diff tool in Emacs, albeit a far more advanced one. It has a wide range of entrypoints: <code>C-h a ediff</code>.</p>
<pre><code>New user option 'ediff-floating-control-frame'.
If non-nil, try making the control frame be floating rather than tiled.

Many X tiling window managers make the Ediff control frame a tiled
window equal in size to the main Emacs frame, which works poorly.
This option is useful to set if you use such a window manager.</code></pre>
<p class=\" text-justify\">Ediff’s achilles’ heel is its awkward frame that it uses as a control interface; but now it at least grants succor to people who use tiling window managers.</p>
<H3 id=\"buffer-selection\">Buffer Selection</H3>
<p class=\" text-justify\">Buffer selection, not to be confused with <code>C-x b</code>, is one of, ah, several buffer switching tools in Emacs. Try it with <code>M-x bs-show</code>.</p>
<pre><code>New user option 'bs-default-action-list'.
You can now configure how to display the \"*buffer-selection*\" buffer
using this new option.  (Or set 'display-buffer-alist' directly.)</code></pre>
<H3 id=\"eshell\">Eshell</H3>
<p class=\" text-justify\">Eshell is an Emacs shell written entirely in Emacs. It’s worth <a href=\"/article/complete-guide-mastering-eshell\" class=\" article-link\">Mastering Eshell</a> if you want an all-Emacs command line experience.</p>
<pre><code>You can now run Eshell scripts in batch mode.
By adding the following interpreter directive to an Eshell script, you
can make it executable like other shell scripts:

    #!/usr/bin/env -S emacs --batch -f eshell-batch-file</code></pre>
<p class=\" text-justify\">If you thought someone using korn or c shell wasn’t bad enough, now you can frustrate your coworkers by writing your shell scripts in Eshells’ own zsh-like language.</p>
<pre><code>New builtin Eshell command 'compile'.
This command runs another command, sending its output to a compilation
buffer when the command would output interactively.  This can be useful
when defining aliases so that they produce a compilation buffer when
appropriate, but still allow piping the output elsewhere if desired.
For more information, see the \"(eshell) Built-ins\" node in the Eshell
manual.</code></pre>
<p class=\" text-justify\">Eshell has a huge range of commands that it exposes to its shell, only to intercept them and pass the input and output to a dedicated Emacs function. See <code>C-u C-h a eshell/</code>.</p>
<pre><code>Eshell's 'env' command now supports running commands.
Like in many other shells, Eshell's 'env' command now lets you run a
command passed as arguments to 'env'.  If you pass any initial
arguments of the form 'VAR=VALUE', 'env' will first set 'VAR' to
'VALUE' before running the command.</code></pre>
<pre><code>Eshell's 'umask' command now supports setting the mask symbolically.
Now, you can pass an argument like \"u+w,o-r\" to Eshell's 'umask'
command, which will give write permission for owners of newly-created
files and deny read permission for users who are not members of the
file's group.  See the Info node \"(coreutils) File permissions\" for
more information on this notation.</code></pre>
<pre><code>Performance improvements for interactive output in Eshell.
Interactive output in Eshell should now be significantly faster,
especially for commands that can print large amounts of output
(e.g. \"cat\").  For external commands, Eshell saves time by only looking
for password prompts in the last 256 characters of each block of output.
To restore the previous behavior when checking for password prompts, set
'eshell-password-prompt-max-length' to 'most-positive-fixnum'.</code></pre>
<pre><code>Eshell built-in commands can now display progress.
Eshell built-in commands like \"cat\" and \"ls\" now update the display
periodically while running to show their progress.</code></pre>
<pre><code>New special reference type '#&lt;marker POSITION BUFFER&gt;'.
This special reference type returns a marker at 'POSITION' in
'BUFFER'.  You can insert it by typing or using the new interactive
command 'eshell-insert-marker'.  You can also insert special
references of any type using the new interactive command
'eshell-insert-special-reference'.  See the \"(eshell) Arguments\" node
in the Eshell manual for more details.</code></pre>
<pre><code>New splice operator for Eshell dollar expansions.
Dollar expansions in Eshell now let you splice the elements of the
expansion in-place using '$@expr'.  This makes it easier to fill lists
of arguments into a command, such as when defining aliases.  For more
information, see the \"(eshell) Dollars Expansion\" node in the Eshell
manual.</code></pre>
<p class=\" text-justify\">Eshell’s expansion system is inspired by zsh’s, though they’re not at all interchangeable, as Eshell effectively passes things to elisp functions internally, arguments and all, so being able to split, splice and otherwise manipulate how entries are fed to the underlying commands is very important.</p>
<pre><code>You can now splice Eshell globs in-place into argument lists.
By setting 'eshell-glob-splice-results' to a non-nil value, Eshell
will expand glob results in-place as if you had typed each matching
file name individually.  For more information, see the \"(eshell)
Globbing\" node in the Eshell manual.</code></pre>
<pre><code>Eshell now supports negative numbers and ranges for indices.
Now, you can retrieve the last element of a list with '$my-list[-1]'
or get a sublist of elements 2 through 4 with '$my-list[2..5]'.  For
more information, see the \"(eshell) Dollars Expansion\" node in the
Eshell manual.</code></pre>
<pre><code>Eshell commands can now be explicitly-remote (or local).
By prefixing a command name in Eshell with a remote identifier, like
\"/ssh:user@remote:whoami\", you can now run commands on a particular
host no matter your current directory.  Likewise, you can run a
command on your local system no matter your current directory via
\"/local:whoami\".  For more information, see the \"(eshell) Remote Access\"
node in the Eshell manual.</code></pre>
<pre><code>Eshell's '$UID' and '$GID' variables are now connection-aware.
Now, when expanding '$UID' or '$GID' in a remote directory, the value
is the user or group ID associated with the remote connection.</code></pre>
<p class=\" text-justify\">One cool feature of Eshell is that you can <code>cd</code> into a remote system using Tramp – for example <code>cd /ssh:homer@powerplant:/etc/</code> – and then operate on the remote machine through Eshell and Tramp as though it were ‘local’. Really powerful, but sometimes there are cracks in the machinery, such as the case of the user and group id environment variables not being correct.</p>
<pre><code>Eshell now uses 'field' properties in its output.
In particular, this means that pressing the '&lt;home&gt;' key moves the
point to the beginning of your input, not the beginning of the whole
line.  If you want to go back to the old behavior, add something like
this to your configuration:

    (keymap-set eshell-mode-map \"&lt;home&gt;\" #'eshell-bol-ignoring-prompt)

This also means you no longer need to adjust 'eshell-prompt-regexp'
when customizing your Eshell prompt.</code></pre>
<p class=\" text-justify\">I long ago abandoned using <code>C-a</code> and friends to move the beginning of line, preferring <code>M-m</code> instead (as it skips forward past whitespace after moving to the beginning of the line) but this command obviously does not respect the prompt. So if you use <code>M-m</code>, just rebind it to the same key as <code>C-a</code>.</p>
<pre><code>You can now properly unload Eshell.
Calling '(unload-feature 'eshell)' no longer signals an error, and now
correctly unloads Eshell and all of its modules.</code></pre>
<pre><code>'eshell-read-aliases-list' is now an interactive command.
After manually editing 'eshell-aliases-file', you can use this command
to load the edited aliases.</code></pre>
<p class=\" text-justify\">Aliases here referring to the same aliasing you can do in other shells.</p>
<pre><code>'rgrep' is now a builtin Eshell command.
Running 'rgrep' in Eshell now uses the Emacs grep facility instead of
calling external rgrep.</code></pre>
<p class=\" text-justify\"><code>M-x rgrep</code> is a command I use all the time when I want more specificity around searching than what a tool like <code>rg</code> gives me. <code>grep</code> already works great in Eshell, so it’s nice to see that <code>rgrep</code> does so too.</p>
<pre><code>If a command exits abnormally, the Eshell prompt now shows its exit code.</code></pre>
<p class=\" text-justify\">I added this to my bash prompt decades ago, as I find it invaluable when I want to compare exit codes in scripts.</p>
<pre><code>New user option 'eshell-history-append'.
If non-nil, each Eshell session will save history by appending new
entries of that session to the history file rather than overwriting
the file with the whole history of the session.  The default is nil.</code></pre>
<H3 id=\"pcomplete\">Pcomplete</H3>
<p class=\" text-justify\">Pcomplete is the completer tool originally built for Eshell, but now has uses elsewhere. It’s a pretty nifty little completion engine, as I demonstrate in <a href=\"/article/pcomplete-context-sensitive-completion-emacs\" class=\" article-link\">PComplete: Context-Sensitive Completion in Emacs</a></p>
<pre><code>New user option 'pcomplete-remote-file-ignore'.
When this option is non-nil, remote file names are not completed by
Pcomplete.  Packages, like 'shell-mode', could set this in order to
suppress remote file name completion at all.</code></pre>
<pre><code>Completion for the 'doas' command has been added.
Command completion for 'doas' in Eshell and Shell mode will now work.</code></pre>
<p class=\" text-justify\">The mooted successor to <code>sudo</code>.</p>
<H3 id=\"shell-mode\">Shell mode</H3>
<p class=\" text-justify\">This is the shell I actually use the most day to day. Delightfully dumb and it behaves exactly like a souped-up Emacs buffer. See <a href=\"/article/running-shells-in-emacs-overview\" class=\" article-link\">Running Shells and Terminal Emulators in Emacs</a> if you want to know what all the differences are.</p>
<pre><code>New user option 'shell-get-old-input-include-continuation-lines'.
When this user option is non-nil, 'shell-get-old-input' ('C-RET')
includes multiple shell \"\\\" continuation lines from command output.
Default is nil.</code></pre>
<pre><code>New user option 'shell-history-file-name'.
When this user option is set to t, 'shell-mode' does not read the shell
history file.  Setting this user option to a string specifies the name
of the shell history file to be read.  A nil value triggers reading the
environment variable 'HISTFILE'.

In a 'shell' buffer, this user option is connection-local.</code></pre>
<p class=\" text-justify\">This is a nice change as Emacs will of course keep its own history (see <a href=\"/article/shell-comint-secrets-history-commands\" class=\" article-link\">Shell &amp; Comint Secrets: History commands</a>) but that history does not persist under normal circumstances. If you’re using a non-default history file for your shell and you want Emacs to respect it, now you can.</p>
<pre><code>Performance improvements for interactive output.
Interactive output in Shell mode now scans more selectively for password
prompts by only examining the last 256 characters of each block of
output, reducing the time spent when printing large amounts of output.
To restore the old behavior, set 'comint-password-prompt-max-length' to
'most-positive-fixnum'.</code></pre>
<p class=\" text-justify\">Anything that speeds up comint is a good thing in my book.</p>
<H3 id=\"prog-mode\">Prog mode</H3>
<p class=\" text-justify\">Prog mode is a generic major mode that programming modes should try to inherit from. It is not intended for normal users.</p>
<pre><code>New command 'prog-fill-reindent-defun'.
This command either fills a single paragraph in a defun, such as a
docstring, or a comment, or (re)indents the surrounding defun if point
is not in a comment or a string.  By default, it is bound to 'M-q' in
'prog-mode' and all its descendants.</code></pre>
<H3 id=\"imenu\">Imenu</H3>
<p class=\" text-justify\">Imenu is a lookup feature for structured elements in the current buffer, such as function and class names in code, and headings and sub-headings in text.</p>
<pre><code>New user option 'imenu-flatten'.
It controls whether to flatten the list of sections in an imenu, and
how to display the sections in the flattened list.</code></pre>
<p class=\" text-justify\">If you use a completion mechanism that makes accessing nested elements hard in imenu, you can now request that it flattens the hierarchy.</p>
<pre><code>The sort order of Imenu completions can now be customized.
You can customize the user option 'completion-category-overrides'
and set 'display-sort-function' for the category 'imenu'.</code></pre>
<H3 id=\"which-function-mode\">Which Function mode</H3>
<p class=\" text-justify\">Which function shows the current function in the mode line by default. It works anywhere <code>M-x imenu</code> works.</p>
<pre><code>Which Function mode can now display function names on the header line.
The new user option 'which-func-display' allows choosing where the
function name is displayed.  The default is 'mode' to display in the
mode line.  'header' will display in the header line;
'mode-and-header' displays in both the header line and mode line.</code></pre>
<p class=\" text-justify\">The mode line is crowded and often truncated if you split your windows. Having another place to put this information is useful.</p>
<pre><code>New user option 'which-func-update-delay'.
This replaces the user option 'idle-update-delay', which was previously
used to control the delay before 'which-function-mode' updated its
display.  The user option 'idle-update-delay', which was only used by
Which Function mode, is now obsolete.</code></pre>
<H3 id=\"tramp\">Tramp</H3>
<p class=\" text-justify\">Tramp is Emacs’s remote file editing facility.</p>
<pre><code>Tramp methods can be optional.
An optional connection method is not enabled by default.  The user must
enable it explicitly by the 'tramp-enable-method' command.  The existing
methods \"fcp\", \"krlogin\", \" ksu\" and \"nc\" are optional now.</code></pre>
<pre><code>New optional connection method \"androidsu\".
This provides access to system files with elevated privileges granted by
the idiosyncratic 'su' implementations and system utilities customary on
Android.</code></pre>
<p class=\" text-justify\">Tramp supports a dizzying array of “connection” methods, including things that aren’t “connections” in the traditional sense, such as <code>sudo</code> and now <code>androidsu</code>.</p>
<pre><code>New optional connection method \"run0\".
This connection method is similar to \"sudo\", but it uses the 'systemd'
framework internally.</code></pre>
<pre><code>New connection methods \"dockercp\" and \"podmancp\".
These are the external methods counterparts of \"docker\" and \"podman\".</code></pre>
<p class=\" text-justify\">Tramp added native docker support a version or two ago, which is super handy for editing or viewing stuff inside a container from the comfort of your own Emacs.</p>
<pre><code>New optional connection methods for containers.
There are new optional connection methods \"toolbox\", \"distrobox\",
\"flatpak\", \"apptainer\" and \"nspawn\".  They allow accessing system
containers provided by Toolbox or Distrobox, sandboxes provided by
Flatpak, instances managed by Apptainer, or accessing systemd-based
light-weight containers..</code></pre>
<p class=\" text-justify\">Good to see more support for namespace-based container solutions other than docker.</p>
<pre><code>Connection method \"kubernetes\" supports now optional container name.
The host name for Kubernetes connections can be of kind [CONTAINER.]POD,
in order to specify a dedicated container.  If there is just the pod
name, the first container in the pod is taken.  The new user options
'tramp-kubernetes-context' and 'tramp-kubernetes-namespace' allow
accessing pods with different context or namespace but the default one.</code></pre>
<p class=\" text-justify\">Tramp can chain connections, so you can connect to a bastion host first before you connect to kubernetes pods.</p>
<pre><code>Rename 'tramp-use-ssh-controlmaster-options' to 'tramp-use-connection-share'.
The old name still exists as obsolete variable alias.  This user
option controls now connection sharing for both ssh-based and
plink-based methods.  It allows the values t, nil, and 'suppress'.
The latter suppresses also \"ControlMaster\" settings in the user's
\"~/.ssh/config\" file, or connection share configuration in PuTTY
sessions, respectively.</code></pre>
<p class=\" text-justify\">You absolutely must enable connection sharing (controlmaster) if you use ssh. It makes a huge difference in performance.</p>
<pre><code>New command 'tramp-cleanup-some-buffers'.
It kills only a subset of opened remote buffers, subject to the user
option 'tramp-cleanup-some-buffers-hook'.</code></pre>
<pre><code>New command 'inhibit-remote-files'.
This command disables the handling of file names with the special
remote file name syntax.  It should be applied only when remote files
won't be used in this Emacs instance.  It provides a slightly improved
performance of file name handling in Emacs.</code></pre>
<pre><code>New macro 'without-remote-files'.
This macro could wrap code which handles local files only.  Due to the
temporary deactivation of remote files, it results in a slightly
improved performance of file name handling in Emacs.</code></pre>
<pre><code>New user option 'tramp-completion-multi-hop-methods'.
It contains a list of connection methods for which completion should
be attempted at the end of a multi-hop chain.  This allows completion
candidates to include a list of, for example, containers running on a
remote docker host.</code></pre>
<p class=\" text-justify\">Oh, cool! One common criticism I had of multi-hop/chaining connections is that you really need to know what you’re looking for when you are writing out these multi-hop connections, as the completion support is non-existent. Good to see that Tramp will now attempt to complete via the multi-hop links you have already written. Neat!</p>
<pre><code>New command 'tramp-revert-buffer-with-sudo'.
It reverts the current buffer to visit with \"sudo\" permissions.  The
buffer must either visit a file, or it must run 'dired-mode'.  Another
method but \"sudo\" can be configured with user option
'tramp-file-name-with-method'.</code></pre>
<p class=\" text-justify\">I’ve had a snippet of code called <code>sudo</code> that does exactly this for what must be a decade plus now. Now it’s built in, albeit with a harder-to-remember name.</p>
<pre><code>Direct asynchronous processes are indicated by a connection-local variable.
If direct asynchronous processes shall be used, set the connection-local
variable 'tramp-direct-async-process' to a non-nil value.  In previous
Emacs versions this was indicated by the connection property
\"direct-async-process\".  That connection property (though not connection
properties and 'tramp-connection-properties' in general) is now
deprecated.  See the Tramp manual \"(tramp) Improving performance of
asynchronous remote processes\".</code></pre>
<p class=\" text-justify\">If you have performance issues with Tramp, you should try this out.</p>
<pre><code>Direct asynchronous processes use 'tramp-remote-path'.
When a direct asynchronous process is invoked, it uses 'tramp-remote-path'
for setting the remote 'PATH' environment variable.</code></pre>
<H3 id=\"shr\">SHR</H3>
<p class=\" text-justify\">SHR is Emacs’s HTML rendering engine that powers EWW, the Emacs Web Wowser.</p>
<pre><code>New user option 'shr-fill-text'.
When 'shr-fill-text' is non-nil (the default), SHR will fill text
according to the width of the window.  If you customize it to nil, SHR
will leave the text as-is; in that case, EWW will automatically enable
'visual-line-mode' when displaying a page so that long lines are
visually wrapped at word boundaries.</code></pre>
<H3 id=\"eww\">EWW</H3>
<p class=\" text-justify\"><code>M-x eww</code> is Emacs’s builtin web browser.</p>
<pre><code>New mouse bindings in EWW buffers.
Certain form elements that were displayed as buttons, yet could only be
activated by keyboard input, are now operable using 'mouse-2'.  With
\"Submit\" buttons, this triggers submission of the form, while clicks on
other classes of buttons either toggle their values or prompt for user
input, as the case may be.</code></pre>
<pre><code>EWW text input fields and areas are now fields.
In consequence, movement commands and OS input method features now
recognize and confine their activities to the text input field around
point.  See also the Info node \"(elisp) Fields\".</code></pre>
<p class=\" text-justify\">Fields here meaning the widget system that Emacs has built in.</p>
<pre><code>'eww-open-file' can now display the file in a new buffer.
By default, the command reuses the \"*eww*\" buffer, but if called with
the new argument NEW-BUFFER non-nil, it will use a new buffer instead.
Interactively, invoke 'eww-open-file' with a prefix argument to
activate this behavior.</code></pre>
<pre><code>'eww' URL or keyword prompt now has tab completion.
The interactive minibuffer prompt when invoking 'eww' now has support
for tab completion.</code></pre>
<pre><code>'eww' URL and keyword prompt now completes suggested URIs and bookmarks.
The interactive minibuffer prompt when invoking 'eww' now provides
completions from 'eww-suggest-uris'.  'eww-suggest-uris' now includes
bookmark URIs.</code></pre>
<pre><code>New command 'eww-copy-alternate-url'.
It copies an alternate link on the page currently visited in EWW into
the kill ring.  Alternate links are optional metadata that HTML pages
use for linking to their alternative representations, such as translated
versions or associated RSS feeds.  It is bound to 'A' by default.</code></pre>
<pre><code>'eww-open-in-new-buffer' supports the prefix argument.
When invoked with the prefix argument ('C-u'),
'eww-open-in-new-buffer' will not make the new buffer the current one.
This is useful for continuing reading the URL in the current buffer
when the new URL is fetched.</code></pre>
<pre><code>History navigation in EWW now behaves as in other browsers.
Previously, when navigating back and forward through page history, EWW
would add a duplicate entry to the end of the history list each time.
This made it impossible to navigate to the \"end\" of the history list.
Now, navigating through history in EWW simply changes your position in
the history list, allowing you to reach the end as expected.  In
addition, when browsing to a new page from a \"historical\" one (i.e., a
page loaded by navigating back through history), EWW deletes the history
entries newer than the current page.  To change the behavior when
browsing from \"historical\" pages, you can customize
'eww-before-browse-history-function'.</code></pre>
<pre><code>'eww-readable' now toggles display of the readable parts of a web page.
When called interactively, 'eww-readable' toggles whether to display
only the readable parts of a page or the full page.  With a positive
prefix argument, it always displays the readable parts, and with a zero
or negative prefix, it always displays the full page.</code></pre>
<p class=\" text-justify\">This feature has been around for ages, and it’s great if you want to remove all the chaff from a page. Note that the only real change here is that it toggles.</p>
<pre><code>New user option 'eww-readable-urls'.
This is a list of regular expressions matching the URLs where EWW should
display only the readable parts by default.  For more details, see
\"(eww) Basics\" in the EWW manual.</code></pre>
<p class=\" text-justify\">Great stuff if you regularly visit pages that require toggling on readable mode.</p>
<pre><code>New user option 'eww-readable-adds-to-history'.
When non-nil (the default), calling 'eww-readable' adds a new entry to
the EWW page history.</code></pre>
<H3 id=\"go-ts-mode\">Go-ts mode</H3>
<p class=\" text-justify\">This is the tree-sitter version for Go.</p>
<pre><code>New command 'go-ts-mode-docstring'.
This command adds a docstring comment to the current defun.  If a
comment already exists, point is only moved to the comment.  It is
bound to 'C-c C-d' in 'go-ts-mode'.</code></pre>
<H3 id=\"man-mode\">Man mode</H3>
<p class=\" text-justify\">Man referring here to the manual page tool <code>man</code>.</p>
<pre><code>New user option 'Man-prefer-synchronous-call'.
When this is non-nil, run the 'man' command synchronously rather than
asynchronously (which is the default behavior).</code></pre>
<pre><code>New user option 'Man-support-remote-systems'.
This option controls whether the man page is formatted on the remote
system when the current buffer's default-directory is remote.  You can
invoke the 'man' command with a prefix argument to countermand the
value of this option for the current invocation of 'man'.</code></pre>
<H3 id=\"docview\">DocView</H3>
<p class=\" text-justify\">DocView is a generic tool for converting complex documents into images for display in Emacs (pdf, docx, etc.)</p>
<pre><code>New user option 'doc-view-mpdf-use-svg'.
If non-nil, DocView uses SVG images to display PDF documents.  The
default is non-nil if your system supports display of SVG images.</code></pre>
<p class=\" text-justify\">Emacs’s SVG engine is quite good nowadays, and it’s definitely better than a raster image of a PDF.</p>
<pre><code>New face 'doc-view-svg-face'.
This replaces 'doc-view-svg-foreground' and 'doc-view-svg-background'.
By default, this face has black foreground on white background and
inherits from the default face.  When unsetting the foreground and
background values, the display in DocView is styled according to the
current theme.  However, this, or any non-standard values, can result in
poor contrast for documents which aren't simply black text on white
background.</code></pre>
<p class=\" text-justify\">If your theme clashes with the colors in SVG files, you can now change them to better suit your theme.</p>
<pre><code>DocView buffers now display a new tool bar.
This tool bar contains options for searching and navigating within the
document, replacing the incompatible items for incremental search and
editing within the default tool bar displayed in the past.</code></pre>
<H3 id=\"shortdoc\">Shortdoc</H3>
<p class=\" text-justify\">Shortdoc is <a href=\"/article/emacs-builtin-elisp-cheat-sheet\" class=\" article-link\">Emacs’s Builtin Elisp Cheat Sheet</a>.</p>
<pre><code>New function 'shortdoc-function-examples'.
This function returns examples of use of a given Emacs Lisp function
from the available shortdoc information.</code></pre>
<pre><code>New function 'shortdoc-help-fns-examples-function'.
This function inserts into the current buffer examples of use of a
given Emacs Lisp function, which it gleans from the shortdoc
information.  If you want 'describe-function' ('C-h f') to insert
examples of using the function into regular \"*Help*\" buffers, add the
following to your init file:

    (add-hook 'help-fns-describe-function-functions
              #'shortdoc-help-fns-examples-function)</code></pre>
<H3 id=\"package\">Package</H3>
<p class=\" text-justify\">Package is the package manager and installer in Emacs.</p>
<pre><code>New user option 'package-vc-register-as-project'.
When non-nil, 'package-vc-install' and 'package-vc-checkout' will
automatically register every package they install as a project, that you
can quickly select using 'project-switch-project' ('C-x p p').  Default
is t.</code></pre>
<p class=\" text-justify\">Oh that is very nice. I will definitely enable this now that <code>package</code> can install from source control using <code>vc</code>.</p>
<pre><code>New user option 'package-vc-allow-build-commands'.
Controls for which packages Emacs runs extra build commands when
installing directly from the package VCS repository.</code></pre>
<pre><code>New command 'package-vc-log-incoming'.
This commands displays incoming changes for a VC package without
modifying the current checkout.</code></pre>
<pre><code>New command to start an inferior Emacs loading only specific packages.
The new command 'package-isolate' will start a new Emacs process, as
a sub-process of Emacs where you invoke the command, in a way that
causes the new process to load only some of the installed packages.
The command prompts for the packages to activate in this
sub-process, and is intended for testing Emacs and/or the packages
in a clean environment.</code></pre>
<p class=\" text-justify\">That’s a really cool addition, and I look forward to using it with my own packages. I normally maintain a separate Emacs installation just for this purpose, but this approach might save me the hassle of having to maintain that.</p>
<H3 id=\"flymake\">Flymake</H3>
<p class=\" text-justify\">Flymake is Emacs’s linter/on-the-fly-compiler interface.</p>
<pre><code>New user option 'flymake-indicator-type'.
This controls which error indicator type Flymake should use in the
current buffer.  Depending on your preference, this can either use
fringes or margins for indicating errors, the default is 'margins'.</code></pre>
<pre><code>New user option 'flymake-margin-indicators-string'.
It controls, for each error type, the string and its face to display as
the margin indicator.</code></pre>
<pre><code>New user option 'flymake-autoresize-margins'.
If non-nil (the default), Flymake will resize the margins when
'flymake-mode' is turned on or off.
Only relevant if 'flymake-indicator-type' is set to 'margins'.</code></pre>
<pre><code>New user option 'flymake-margin-indicator-position'.
It controls whether to use margins for margin indicators, and which
margin (left or right) to use.  Default is to use the left margin.</code></pre>
<pre><code>New user option 'flymake-show-diagnostics-at-end-of-line'.
When non-nil, Flymake shows summarized descriptions of diagnostics at
the end of the line.  Depending on your preference, this can either be
distracting and easily confused with actual code, or a significant
early aid that relieves you from moving the buffer or reaching for the
mouse to consult an error message.  Default is nil.</code></pre>
<p class=\" text-justify\">Worth enabling to see if it is something that helps or hinders. You should consider setting it in a dir locals variable or mode hook so it only applies to some buffers.</p>
<H3 id=\"flyspell\">Flyspell</H3>
<p class=\" text-justify\">Emacs’s on the fly spell checker.</p>
<pre><code>New user option 'flyspell-check-changes'.
When non-nil, Flyspell mode spell-checks only words that you edited; it
does not check unedited words just because you move point across them.
Default is nil.</code></pre>
<H3 id=\"js-mode\">JS mode</H3>
<p class=\" text-justify\">One of a dozen modes that edit Javascript.</p>
<pre><code>The binding 'M-.' has been removed from the major mode keymaps in
'js-mode' and 'js-ts-mode', having it default to the global binding
which calls 'xref-find-definitions'.  If the previous one worked
better for you, use 'define-key' in your init script to bind
'js-find-symbol' to that combination again.</code></pre>
<p class=\" text-justify\">This is just standardizing on the xref interface and its default global keys.</p>
<p class=\" text-justify\">:</p>
<pre><code>'js-json-mode' does not derive from 'js-mode' any more so as not
to confuse tools like Eglot or YASnippet into thinking that those
buffers contain Javascript code.</code></pre>
<H3 id=\"python-mode\">Python mode</H3>
<p class=\" text-justify\">The major mode for editing Python.</p>
<pre><code>New user option 'python-indent-block-paren-deeper'.
If non-nil, increase the indentation of the lines inside parens in a
header of a block when they are indented to the same level as the body
of the block, producing:

    if (some_expression
            and another_expression):
        do_something()

instead of:

    if (some_expression
        and another_expression):
        do_something()

Default is nil.</code></pre>
<p class=\" text-justify\">I long ago stopped worrying about this stuff when code formatting tools became prevalent. Why get angry at your coworkers’ bad code formatting habits when you can direct your anger at a faceless code formatting tool instead?</p>
<pre><code>New user option 'python-interpreter-args'.
This allows the user to specify command line arguments to the non
interactive Python interpreter specified by 'python-interpreter'.</code></pre>
<pre><code>New function 'python-shell-send-block'.
It sends the python block delimited by 'python-nav-beginning-of-block'
and 'python-nav-end-of-block' to the inferior Python process.</code></pre>
<H3 id=\"inferior-python-mode\">Inferior Python mode</H3>
<p class=\" text-justify\">Inferior Python mode refers to the comint version that talks to the external python interpreter.</p>
<pre><code>Default value of 'python-shell-compilation-regexp-alist' is changed.
Support for Python's ExceptionGroup has been added, so in the Python
shell, the line indicating the source of an error in the error messages
from ExceptionGroup will be recognized as well.</code></pre>
<H3 id=\"eldoc\">Eldoc</H3>
<p class=\" text-justify\">Eldoc is a generic documentation popup system.</p>
<pre><code>'eldoc' no longer truncates to a single line by default.
Previously, the entire docstring was not available to eldoc, which made
'eldoc-echo-area-use-multiline-p' ineffective.  The old behavior may be
kept by customizing 'eldoc-echo-area-use-multiline-p'.</code></pre>
<H3 id=\"scheme-mode\">Scheme mode</H3>
<pre><code>Scheme mode now handles the regular expression literal '#/regexp/' that
 is available in some Scheme implementations.
 Also, it should now handle nested sexp-comments.</code></pre>
<H3 id=\"use-package\">Use package</H3>
<p class=\" text-justify\"><a href=\"/article/spotlight-use-package-a-declarative-configuration-tool\" class=\" article-link\">use-package is a declarative configuration tool</a>.</p>
<pre><code>New ':vc' keyword.
This keyword enables the user to install packages using package-vc.el.</code></pre>
<p class=\" text-justify\">This is a great addition and it rounds off the ability to manually install packages with VC that arrived in Emacs 29. You can replace a lot of the third-party package managers now if your needs are simple.</p>
<pre><code>New user option 'use-package-vc-prefer-newest'.
If non-nil, always install the newest commit of a package when using the
':vc' keyword rather than its stable release.  Default is nil.</code></pre>
<H3 id=\"gnus\">Gnus</H3>
<p class=\" text-justify\">Gnus is an expansive mail and news agent in Emacs.</p>
<pre><code>New backend 'nnfeed'.
This allows backend developers to easily create new backends for web
feeds, as inheriting backends of 'nnfeed'.</code></pre>
<pre><code>New backend 'nnatom'.
This allow users to add Atom Syndication Format feeds to Gnus as
servers.</code></pre>
<pre><code>The 'nnweb-type' option 'gmane' has been removed.
The gmane.org website is, sadly, down since a number of years with no
prospect of it coming back.  Therefore, it is no longer valid to set
the server variable 'nnweb-type' to 'gmane'.</code></pre>
<pre><code>New user option 'gnus-mode-line-logo'.
This allows the user to either disable the display of any logo or
specify which logo will be displayed as part of the
buffer-identification in the mode-line of Gnus buffers.</code></pre>
<pre><code>'gnus-summary-limit-to-age' now counts days since midnight.
\"Less than 1 day\" now means \"since last midnight\", rather than \"less
than 24 hours old\".</code></pre>
<H3 id=\"rmail\">Rmail</H3>
<p class=\" text-justify\">Rmail is one of many ways of sending and reading email in Emacs.</p>
<pre><code>New commands for reading mailing lists.
The new Rmail commands 'rmail-mailing-list-post',
'rmail-mailing-list-unsubscribe', 'rmail-mailing-list-help', and
'rmail-mailing-list-archive' allow, respectively, posting to,
unsubscribing from, requesting help about, and browsing the archives
of, the mailing list from which the current email message was
delivered.</code></pre>
<H3 id=\"dictionary\">Dictionary</H3>
<p class=\" text-justify\">Dictionary is a lookup system for <a href=\"/article/wordsmithing-in-emacs\" class=\" article-link\">wordsmiths</a>.</p>
<pre><code>New user option 'dictionary-search-interface'.
Controls how the 'dictionary-search' command prompts for and displays
dictionary definitions.  Customize this user option to 'help' to have
'dictionary-search' display definitions in a \"*Help*\" buffer and
provide dictionary-based minibuffer completion for word selection.
Default is nil, which means to use a \"*Dictionary*\" buffer.</code></pre>
<pre><code>New user option 'dictionary-read-word-prompt'.
This allows the user to customize the prompt that is used by
'dictionary-search' when asking for a word to search in the
dictionaries.</code></pre>
<pre><code>New user option 'dictionary-display-definition-function'.
This allows the user to customize the way in which 'dictionary-search'
displays word definitions.  If non-nil, this user option should be set
to a function that displays a word definition obtained from a
dictionary server.  The new function
'dictionary-display-definition-in-help-buffer' can be used to display
the definition in a \"*Help*\" buffer, instead of the default
\"*Dictionary*\" buffer.</code></pre>
<pre><code>New user option 'dictionary-read-word-function'.
This allows the user to customize the way in which 'dictionary-search'
prompts for a word to search in the dictionary.  This user option
should be set to a function that lets the user select a word and
returns it as a string.  The new function
'dictionary-completing-read-word' can be used to prompt with
completion based on dictionary matches.</code></pre>
<pre><code>New user option 'dictionary-read-dictionary-function'.
This allows the user to customize the way in which 'dictionary-search'
prompts for a dictionary to search in.  This user option should be set
to a function that lets the user select a dictionary and returns its
name as a string.  The new function
'dictionary-completing-read-dictionary' can be used to prompt with
completion based on dictionaries that the server supports.</code></pre>
<pre><code>The default value of 'dictionary-tooltip-dictionary' has changed.
The new default value is t, which means use the same dictionary as the
value of 'dictionary-default-dictionary'.  The previous default value
was nil, which effectively disabled 'dictionary-tooltip-mode', even if
the mode was turned on.</code></pre>
<H3 id=\"pp\">Pp</H3>
<p class=\" text-justify\">Pp is the pretty printing functionality for elisp.</p>
<pre><code>New 'pp-default-function' user option replaces 'pp-use-max-width'.
Its default value is 'pp-fill', a new default pretty-printing function,
which tries to obey 'fill-column'.</code></pre>
<pre><code>'pp-to-string' takes an additional PP-FUNCTION argument.
This argument specifies the prettifying algorithm to use.</code></pre>
<pre><code>'pp' and 'pp-to-string' now always include a terminating newline.
In the past they included a terminating newline in most cases but not all.</code></pre>
<H3 id=\"emacs-lisp-mode\">Emacs Lisp mode</H3>
<p class=\" text-justify\">The major mode used to edit elisp code.</p>
<pre><code>'elisp-flymake-byte-compile' is disabled for untrusted files.
For security reasons, this backend can be used only in those files
specified as trusted according to 'trusted-content' and emits an
\"untrusted content\" warning otherwise.
This fixes CVE-2024-53920.</code></pre>
<pre><code>',@' now has 'prefix' syntax.
Previously, the '@' character, which normally has 'symbol' syntax,
would combine with a following Lisp symbol and interfere with symbol
searching.</code></pre>
<pre><code>'emacs-lisp-docstring-fill-column' now defaults to 72.
It was previously 65.  The new default formats documentation strings to
fit on fewer lines without negatively impacting readability.</code></pre>
<H3 id=\"cperl-mode\">CPerl mode</H3>
<p class=\" text-justify\">One of two Perl modes in Emacs.</p>
<pre><code>Subroutine signatures are now supported.
CPerl mode fontifies subroutine signatures like variable declarations
which makes them visually distinct from subroutine prototypes.</code></pre>
<pre><code>Syntax of Perl up to version 5.40 is supported.
CPerl mode supports the new keywords for exception handling and the
object oriented syntax which were added in Perl 5.36, 5.38 and 5.40.</code></pre>
<pre><code>New user option 'cperl-fontify-trailer'.
This user option takes the values 'perl-code' or 'comment' and treats
text after an \"__END__\" or \"__DATA__\" token accordingly.  The default
value of 'perl-code' is useful for trailing POD and for AutoSplit
modules, the value 'comment' makes CPerl mode treat trailers as
comment, like Perl mode does.</code></pre>
<pre><code>New command 'cperl-file-style'.
This command sets the indentation style for the current buffer.  To
change the default style, either use the user option with the same name
or use the command 'cperl-set-style'.</code></pre>
<pre><code>New minor mode 'cperl-extra-paired-delimiters-mode'.
Perl 5.36 and newer allows using more than 200 non-ASCII paired
delimiters for quote-like constructs, e.g. \"q«text»\".  Use this minor
mode in buffers where this feature is activated.</code></pre>
<pre><code>Commands using the Perl Info manual are obsolete.
The Perl documentation in Info format is no longer distributed with
Perl or on CPAN since more than 10 years.  Perl documentation can be
read with 'cperl-perldoc' instead.</code></pre>
<pre><code>Highlighting trailing whitespace has been removed.
The user option 'cperl-invalid-face' is now obsolete, and does
nothing.  See the user option 'show-trailing-whitespace' instead.</code></pre>
<H3 id=\"emacs-sessions-desktop\">Emacs Sessions (Desktop)</H3>
<p class=\" text-justify\">Desktop saves and restores your Emacs buffers and files between sessions.</p>
<pre><code>Restoring buffers visiting remote files can now time out.
When a buffer is restored which visits a remote file, the restoration
of the session could hang if the remote host is off-line or slow to
respond.  Setting the user option 'remote-file-name-access-timeout' to
a positive number will abandon the attempt to restore such buffers
after a timeout of that many seconds, thus allowing the rest of
desktop restoration to continue.</code></pre>
<p class=\" text-justify\">I have absolutely been caught out by this before, so that is a welcome change indeed.</p>
<H3 id=\"recentf\">Recentf</H3>
<p class=\" text-justify\">Recentf remembers files you have visited and lets you re-visit them quickly.</p>
<pre><code>Checking recent remote files can now time out.
Similarly to buffer restoration by Desktop, 'recentf-mode' checking
of the accessibility of remote files can now time out if
'remote-file-name-access-timeout' is set to a positive number.</code></pre>
<H3 id=\"image-dired\">Image Dired</H3>
<p class=\" text-justify\">One of several ways of displaying images in Emacs.</p>
<pre><code>New user option 'image-dired-thumb-naming'.
You can now configure how thumbnails are named using this option.</code></pre>
<H3 id=\"ert\">ERT</H3>
<p class=\" text-justify\">This is a test runner framework for Emacs, and a rather useful one at that.</p>
<pre><code>New macro 'skip-when' to skip 'ert-deftest' tests.
This can help to avoid some awkward skip conditions.  For example
'(skip-unless (not noninteractive))' can be changed to the easier
to read '(skip-when noninteractive)'.</code></pre>
<pre><code>Syntax highlighting unit testing support.
An ERT extension ('ert-font-lock') now provides support for face
assignment unit testing.  For more information, see the \"(ert) Syntax
Highlighting Tests\" node in the ERT manual.</code></pre>
<H3 id=\"socks\">Socks</H3>
<p class=\" text-justify\">SOCKS is a proxy-like protocol that, quite frankly, I don’t think I’ve used in decades.</p>
<pre><code>Socks supports version 4a.
The 'socks-server' user option accepts '4a' as a value for its version
field.</code></pre>
<H3 id=\"edmacro\">Edmacro</H3>
<p class=\" text-justify\">This is the major mode for interactively editing keyboard macros.</p>
<pre><code>New command 'edmacro-set-macro-to-region-lines'.
Bound to 'C-c C-r', this command replaces the macro text with the
lines of the region.  If needed, the region is extended to include
whole lines.  If the region ends at the beginning of a line, that last
line is excluded.</code></pre>
<pre><code>New user option 'edmacro-reverse-macro-lines'.
When this is non-nil, the lines of key sequences are displayed with
the most recent line first.  This is can be useful when working with
macros with many lines, such as from 'kmacro-edit-lossage'.</code></pre>
<H3 id=\"calc\">Calc</H3>
<p class=\" text-justify\">This is Emacs’s advanced symbolic computer algebra system.</p>
<pre><code>Calc parses fractions written using U+2044 FRACTION SLASH.
Fractions of the form \"123⁄456\" are handled as if written \"123:456\".
Note in particular the difference in behavior from U+2215 DIVISION SLASH
and U+002F SOLIDUS, which result in division rather than a rational
fraction.  In addition, precomposed fraction characters, such as ½
(U+00BD VULGAR FRACTION ONE HALF), are also recognized as rational
fractions.  (They have been recognized since 2004, but it looks like it
was never mentioned in the NEWS, or even the Calc manual.)</code></pre>
<H3 id=\"ielm\">IELM</H3>
<p class=\" text-justify\">IELM is the interactive shell for <a href=\"/article/evaluating-elisp-emacs\" class=\" article-link\">Evaluating Elisp in Emacs</a>.</p>
<pre><code>IELM now remembers input history between sessions.
The new user option 'ielm-history-file-name' is the name of the file
where IELM input history will be saved.  Customize it to nil to revert
to the old behavior of not remembering input history between sessions.</code></pre>
<H3 id=\"easypg\">EasyPG</H3>
<p class=\" text-justify\">EasyPG is a wrapper for GnuPG and friends. See <a href=\"/article/keeping-secrets-in-emacs-gnupg-auth-sources\" class=\" article-link\">Keeping Secrets in Emacs with GnuPG and Auth Sources</a>.</p>
<pre><code>New user option 'epa-keys-select-method'.
This allows the user to customize the key selection method, which can be
either by using a pop-up buffer or from the minibuffer.  The pop-up
buffer method is the default, which preserves previous behavior.</code></pre>
<H3 id=\"widget\">Widget</H3>
<p class=\" text-justify\">This is the internal library used by Emacs for buttons, edit fields, etc. in places like the Customize interface.</p>
<pre><code>New face 'widget-unselected'.
Customize this face to a non-default value to visually distinguish the
labels of unselected active radio-button or checkbox widgets from the
labels of unselected inactive widgets (the default value inherits from
the 'widget-inactive' face).</code></pre>
<pre><code>New user option 'widget-skip-inactive'.
If non-nil, moving point forward or backward between widgets by typing
'TAB' or 'S-TAB' skips over inactive widgets.  The default value is nil.</code></pre>
<H3 id=\"ruby-mode\">Ruby mode</H3>
<p class=\" text-justify\">Programming mode for Ruby.</p>
<pre><code>New user option 'ruby-rubocop-use-bundler'.
By default it retains the previous behavior: read the contents of
Gemfile and act accordingly.  But you can also set it to t or nil to
skip checking the Gemfile.</code></pre>
<pre><code>New user option 'ruby-bracketed-args-indent'.
When it is set to nil, multiple consecutive open braces/brackets/parens
result in only one additional indentation level.  Default is t.</code></pre>
<H3 id=\"thingatpt\">Thingatpt</H3>
<p class=\" text-justify\">A framework for plucking the thing at point: words, functions, emails, urls, you name it. A useful thing to learn about and use, as it has a wide range of applications.</p>
<pre><code>New variables for providing custom thingatpt implementations.
The new variables 'bounds-of-thing-at-point-provider-alist' and
'forward-thing-provider-alist' now allow defining custom implementations
of 'bounds-of-thing-at-point' and 'forward-thing', respectively.</code></pre>
<pre><code>New helper functions for text property-based thingatpt providers.
The new helper functions 'thing-at-point-for-char-property',
'bounds-of-thing-at-point-for-char-property', and
'forward-thing-for-char-property' can help to implement custom thingatpt
providers for \"things\" that are defined by text properties.</code></pre>
<pre><code>'bug-reference-mode' now supports 'thing-at-point'.
Now, calling '(thing-at-point 'url)' when point is on a bug reference
will return the URL for that bug.</code></pre>
<p class=\" text-justify\">Bug reference mode is a small minor mode that makes ‘bug references’ (such as #2823) clickable.</p>
<H3 id=\"buffer-menu\">Buffer-menu</H3>
<p class=\" text-justify\">Yet another buffer selection and display system in Emacs.</p>
<pre><code>New user option 'Buffer-menu-group-by'.
It controls how buffers are divided into groups that are displayed with
headings using Outline minor mode.  Using commands that mark buffers
on the outline heading line will mark all buffers in the outline.  By
default, no grouping is performed.</code></pre>
<pre><code>New command 'Buffer-menu-toggle-internal'.
This command toggles the display of internal buffers in Buffer Menu mode;
that is, buffers not visiting a file and whose names start with a space.
Previously, such buffers were never shown.  This command is bound to 'I'
in Buffer Menu mode.</code></pre>
<H3 id=\"miscellaneous-1\">Miscellaneous</H3>
<pre><code>New user option 'rcirc-log-time-format'.
This allows for rcirc logs to use a custom timestamp format, which the
chat buffers use by default.</code></pre>
<p class=\" text-justify\">RCIRC is one of two IRC clients in Emacs, the other being ERC.</p>
<pre><code>'ffap-lax-url' now defaults to nil.
Previously, it was set to t, but this broke remote file name detection.</code></pre>
<p class=\" text-justify\">FFAP is Find File At Point is a system for plucking the file at point and opening it.</p>
<pre><code>More control on automatic update of Proced buffers.
The user option 'proced-auto-update-flag' can now be set to an
additional value 'visible', which controls automatic updates of Proced
buffers that are displayed in some window.</code></pre>
<p class=\" text-justify\">Proced’s basically Emacs’s answer to <code>top</code>. See <a href=\"/article/displaying-interacting-processes-proced\" class=\" article-link\">Displaying and Interacting with processes using Proced</a>.</p>
<pre><code>nXML Mode now comes with schemas for Mono/.NET development.
The following new XML schemas are now supported:
- MSBuild project files
- Dotnet package properties files
- Dotnet resource extension files
- Dotnet Application config files
- Nuget config file
- Nuget package specification file
- Nuget packages config file</code></pre>
<pre><code>color.el now supports the Oklab color representation.</code></pre>
<p class=\" text-justify\">The color file has a large range of advanced color conversion routines. Worth a look if that is something you interact with a lot.</p>
<pre><code>New user option 'xwidget-webkit-disable-javascript'.
This allows disabling JavaScript in xwidget Webkit sessions.</code></pre>
<p class=\" text-justify\">XWidget is a half-abandoned, half-working attempt at bringing the Webkit browser to Emacs.</p>
<pre><code>'ls-lisp--insert-directory' supports more long options of 'ls'.
'ls-lisp--insert-directory', the ls-lisp implementation of
'insert-directory', now supports the '--time=TIME' and '--sort=time'
options of GNU 'ls'.</code></pre>
<p class=\" text-justify\">How does dired work on platforms (such as MS-DOS or Windows) where there is no <code>ls</code> program? The answer is simple: Emacs has an elisp emulation layer that talks to the underlying system directly.</p>
<pre><code>'M-x ping' can now give additional flags to the 'ping' program.
Typing 'C-u M-x ping' prompts first for the host, and then for the flags
to give to the 'ping' command.</code></pre>
<p class=\" text-justify\">There is a host of network utility wrappers in Emacs. See <a href=\"/article/network-utilities-emacs\" class=\" article-link\">Using the commandline network utilities from Emacs</a>.</p>
<pre><code>Webjump now assumes URIs are HTTPS instead of HTTP.
For links in 'webjump-sites' without an explicit URI scheme, it was
previously assumed that they should be prefixed with \"http://\".  Such
URIs are now prefixed with \"https://\" instead.</code></pre>
<p class=\" text-justify\">Another obscure feature in Emacs. Here it’s a flat list of common URLs and a command to select and then open one of them. The fact that “Yahoo” is still in there says it all.</p>
<pre><code>Added prefixes in titdic-cnv library.
Most of the variables and functions in the file have been renamed to
make sure they all use a 'tit-' namespace prefix.</code></pre>
<p class=\" text-justify\">Obscure library for working with Quail, a format used in multilingual systems.</p>
<pre><code>'xref-revert-buffer' is now an alias of 'revert-buffer'.
The Xref buffer now sets up 'revert-buffer-function' such that
'revert-buffer' behaves like 'xref-revert-buffer' did in previous Emacs
versions, and the latter is now an alias of the former.</code></pre>
<p class=\" text-justify\">Xref is Emacs’s cross-referencing system, and all this change does is make it so <code>M-x revert-buffer</code> (which I have a version of that reverts the current buffer bound to <code>F6</code>) reverts properly in xref buffers also.</p>
<pre><code>The Makefile browser is now obsolete.
The command 'makefile-switch-to-browser' command is now obsolete,
together with related commands used in the \"*Macros and Targets*\"
buffer.  We recommend using an alternative like 'imenu' instead.</code></pre>
<pre><code>'jsonrpc-default-request-timeout' is now a defcustom.</code></pre>
<H2 id=\"new-modes-and-packages-in-emacs-30.1\">New Modes and Packages in Emacs 30.1</H2>
<H3 id=\"new-major-modes-based-on-the-tree-sitter-library\">New major modes based on the tree-sitter library</H3>
<pre><code>New major mode 'elixir-ts-mode'.
A major mode based on the tree-sitter library for editing Elixir files.</code></pre>
<pre><code>New major mode 'heex-ts-mode'.
A major mode based on the tree-sitter library for editing HEEx files.</code></pre>
<pre><code>New major mode 'html-ts-mode'.
An optional major mode based on the tree-sitter library for editing
HTML files.</code></pre>
<pre><code>New major mode 'lua-ts-mode'.
A major mode based on the tree-sitter library for editing Lua files.</code></pre>
<pre><code>New major mode 'php-ts-mode'.
A major mode based on the tree-sitter library for editing PHP files.</code></pre>
<p class=\" text-justify\">Good to see more tree-sitter major modes.</p>
<pre><code>New package EditorConfig.
This package provides support for the EditorConfig standard,
an editor-neutral way to provide directory local (project-wide) settings.
It is enabled via a new global minor mode 'editorconfig-mode'
which makes Emacs obey the '.editorconfig' files.
There is also a new major mode 'editorconfig-conf-mode'
to edit those configuration files.</code></pre>
<p class=\" text-justify\">Long overdue, even if I find the capabilities of editorconfig rather basic.</p>
<pre><code>New global minor mode 'etags-regen-mode'.
This minor mode generates the tags table automatically based on the
current project configuration, and later updates it as you edit the
files and save the changes.</code></pre>
<pre><code>New package 'which-key'.
The 'which-key' package from GNU ELPA is now included in Emacs.  It
implements the global minor mode 'which-key-mode' that displays a table
of key bindings upon entering a partial key chord and waiting for a
moment.  For example, after enabling the minor mode, if you enter 'C-x'
and wait for one second, the minibuffer will expand with all available
key bindings that follow 'C-x' (or as many as space allows).</code></pre>
<p class=\" text-justify\">This is a long-awaited inclusion for some people. Which-key pops up a list of key bindings if you partially type a key and a wait a little while.</p>
<pre><code>New minor mode 'completion-preview-mode'.
This minor mode shows you symbol completion suggestions as you type,
using an inline preview.  New user options in the 'completion-preview'
customization group control exactly when Emacs displays this preview.
'completion-preview-mode' is buffer-local, to enable it globally use
'global-completion-preview-mode'.</code></pre>
<p class=\" text-justify\">Buried in the foot of the NEWS file is one of the best new additions in Emacs. A window-based answer to Company / Corfu, with a host of really nice ergonomic features. I really, really recommend you disable your in-line completer (corfu, company, auto-complete, whatever) and give this one a try for a little while.</p>
<pre><code>New package Window-Tool-Bar.
This provides a new minor mode, 'window-tool-bar-mode'.  When this minor
mode is enabled, a tool bar is displayed at the top of a window.  To
conserve space, no tool bar is shown if 'tool-bar-map' is nil.  The
global minor mode 'global-window-tool-bar-mode' enables this minor mode
in all buffers.</code></pre>
<p class=\" text-justify\">A compromise for people who want the toolbar but only when it has something interesting to offer.</p>
<pre><code>New library Track-Changes.
This library is a layer of abstraction above 'before-change-functions'
and 'after-change-functions' which provides a superset of
the functionality of 'after-change-functions':
- It provides the actual previous text rather than only its length.
- It takes care of accumulating and bundling changes until a time when
  its client finds it convenient to react to them.
- It detects most cases where some changes were not properly
  reported (calls to 'before/after-change-functions' that are
  incorrectly paired, missing, etc...) and reports them adequately.</code></pre>
<p class=\" text-justify\">Building this sort of thing is surprisingly tricky, as the text above briefly alludes to. It does not seem to be used in many places yet, but I foresee that it will play an important role in tools that want to provide in-buffer tracking of changes without the tears of having to build all this infrastructure from scratch. I especially like the feature that it collects the changes until such a time that the client deems it needs them; very useful, and hard to do well with nothing more than a set of before/after change hooks.</p>
<pre><code>New global minor mode 'minibuffer-regexp-mode'.
This is a minor mode for editing regular expressions in the minibuffer,
for example in 'query-replace-regexp'.  It correctly highlights parens
via 'show-paren-mode' and 'blink-matching-paren' in a user-friendly way,
avoids reporting alleged paren mismatches and makes sexp navigation more
intuitive.  It is enabled by default, 'minibuffer-regexp-prompts' can be
used to tune when it takes effect.</code></pre>
<p class=\" text-justify\">Excellent feature that is enabled by default, so no need to do anything.</p>
<pre><code>The highly accessible Modus themes collection has eight items.
The 'modus-operandi' and 'modus-vivendi' are the main themes that have
been part of Emacs since version 28.  The former is light, the latter
dark.  In addition to these, we now have 'modus-operandi-tinted' and
'modus-vivendi-tinted' for easier legibility, as well as
'modus-operandi-deuteranopia', 'modus-vivendi-deuteranopia',
'modus-operandi-tritanopia', and 'modus-vivendi-tritanopia' to cover
the needs of users with red-green or blue-yellow color deficiency.
The Info manual \"(modus-themes) Top\" describes the details and
showcases all their user options.</code></pre>
<p class=\" text-justify\">A popular set of themes beloved by many.</p>
<H3 id=\"new-library-peg\">New library PEG</H3>
<pre><code>Emacs now includes a library for writing Parsing Expression
Grammars (PEG), an approach to text parsing that provides more structure
than regular expressions, but less complexity than context-free
grammars.  The Info manual \"(elisp) Parsing Expression Grammars\" has
documentation and examples.</code></pre>
<p class=\" text-justify\">Interesting inclusion and I am curious to see it in use. Emacs already has parsing tools already (Semantic Bovinator being one such example) so I guess this will find a home in Org mode as it has a range of custom query languages.</p>
<pre><code>New major mode 'shell-command-mode'.
This mode is used by default for the output of asynchronous 'shell-command'.
To revert to the previous behavior, set the (also new) variable
'async-shell-command-mode' to 'shell-mode'.  Any hooks or mode-specific
variables used should be adapted appropriately.</code></pre>
<pre><code>New package Compat.
Emacs now comes with a stub implementation of the
forwards-compatibility Compat package from GNU ELPA.  This allows
built-in packages to use the library more effectively, and helps
preventing the installation of Compat if unnecessary.</code></pre>
<p class=\" text-justify\">Compat provides backwards and forwards compatible changes for package authors so they can target older versions of Emacs, and keep older packages working in newer ones, too.</p>
<H3 id=\"incompatible-lisp-changes-in-emacs-30.1\">Incompatible Lisp Changes in Emacs 30.1</H3>
<pre><code>Evaluating a 'lambda' returns an object of type 'interpreted-function'.
Instead of representing interpreted functions as lists that start with
either 'lambda' or 'closure', Emacs now represents them as objects
of their own 'interpreted-function' type, which is very similar
to 'byte-code-function' objects (the argument list, docstring, and
interactive forms are placed in the same slots).
Lists that start with 'lambda' are now used only for non-evaluated
functions (in other words, for source code), but for backward compatibility
reasons, 'functionp' still recognizes them as functions and you can
still call them as before.
Thus code that attempts to \"dig\" into the internal structure of an
interpreted function's object with the likes of 'car' or 'cdr' will
no longer work and will need to use 'aref' instead to extract its
various subparts (when 'interactive-form', 'documentation', and
'help-function-arglist' aren't adequate).</code></pre>
<p class=\" text-justify\">The heart of this is that in Lisp, code and data are the same, and when Emacs emits a readable form of a lambda or closure you just created, it does so in a way that looks like a list. In older Emacsen, you could write <code>(car (lambda))</code> and it’d spit out <code>closure</code> (provided <code>lexical-binding</code> is enabled), and now you cannot do this; it’s not a list any more.</p>
<p class=\" text-justify\">It’s very unlikely this will affect you in any way.</p>
<pre><code>The escape sequence '\\x' not followed by hex digits is now an error.
Previously, '\\x' without at least one hex digit denoted character code
zero (NUL) but as this was neither intended nor documented or even
known by anyone, it is now treated as an error by the Lisp reader.</code></pre>
<pre><code>'subr-native-elisp-p' is renamed to 'native-comp-function-p'.
The previous name still exists but is marked as obsolete.</code></pre>
<pre><code>'define-globalized-minor-mode' requires that modes use 'run-mode-hooks'.
Minor modes defined with 'define-globalized-minor-mode', such as
'global-font-lock-mode', will not be enabled any more in those buffers
whose major modes fail to use 'run-mode-hooks'.  Major modes defined
with 'define-derived-mode' are not affected.  'run-mode-hooks' has been the
recommended way to run major mode hooks since Emacs 22.</code></pre>
<pre><code>'buffer-match-p' and 'match-buffers' take '&amp;rest ARGS'.
They used to take a single '&amp;optional ARG' and were documented to use
an unreliable hack to try and support condition predicates that
don't accept this optional ARG.
The new semantics makes no such accommodation, but the code still
supports it (with a warning) for backward compatibility.</code></pre>
<pre><code>'post-gc-hook' runs after updating 'gcs-done' and 'gc-elapsed'.</code></pre>
<pre><code>Connection-local variables are applied in buffers visiting remote files.
This overrides possible directory-local or file-local variables with
the same name.</code></pre>
<pre><code>'copy-tree' now copies records when its optional 2nd argument is non-nil.</code></pre>
<pre><code>Regexp zero-width assertions followed by operators are better defined.
Previously, regexps such as \"xy\\\\B*\" would have ill-defined behavior.
Now any operator following a zero-width assertion applies to that
assertion only (which is useless).  For historical compatibility, an
operator character following '^' or '\\`' becomes literal, but we
advise against relying on this.</code></pre>
<pre><code>Infinities and NaNs no longer act as symbols on non-IEEE platforms.
On old platforms like the VAX that do not support IEEE floating-point,
tokens like '0.0e+NaN' and '1.0e+INF' are no longer read as symbols.
Instead, the Lisp reader approximates an infinity with the nearest
finite value, and a NaN with some other non-numeric object that
provokes an error if used numerically.</code></pre>
<pre><code>Conversion of strings to and from byte-arrays works with multibyte strings.
The functions 'dbus-string-to-byte-array' and
'dbus-byte-array-to-string' now accept and return multibyte Lisp
strings, encoding to UTF-8 and decoding from UTF-8 internally.  This
means that the argument to 'dbus-byte-array-to-string' must be a valid
UTF-8 byte sequence, and the optional parameter MULTIBYTE of
'dbus-byte-array-to-string' is now obsolete and unused.  The argument of
'dbus-string-to-byte-array' should be a regular Lisp string, not a
unibyte string.</code></pre>
<pre><code>'minibuffer-allow-text-properties' now can be set buffer-local.
'read-from-minibuffer' and functions that use it can take the
buffer-local value from the minibuffer.</code></pre>
<pre><code>'minibuffer-allow-text-properties' now also affects completions.
When it has a non-nil value, then completion functions like
'completing-read' don't discard text properties from the returned
completion candidate.</code></pre>
<pre><code>X color support compatibility aliases are now obsolete.
The compatibility aliases 'x-defined-colors', 'x-color-defined-p',
'x-color-values', and 'x-display-color-p' are now obsolete.</code></pre>
<pre><code>'easy-mmode-define-{minor,global}-mode' aliases are now obsolete.
Use 'define-minor-mode' and 'define-globalized-minor-mode' instead.</code></pre>
<pre><code>The 'millisec' argument of 'sleep-for' is now obsolete.
Use a float value for the first argument instead.</code></pre>
<pre><code>User options 'eshell-NAME-unload-hook' are now obsolete.
These hooks were named incorrectly, and so they never actually ran
when unloading the corresponding feature.  Instead, you should use
hooks named after the feature name, like 'esh-mode-unload-hook'.</code></pre>
<pre><code>User options 'eshell-process-wait-{seconds,milliseconds}' are now obsolete.
Instead, use 'eshell-process-wait-time', which supports floating-point
values.</code></pre>
<pre><code>User option 'tramp-completion-reread-directory-timeout' has been removed.
This user option was obsoleted in Emacs 27, use
'remote-file-name-inhibit-cache' instead.</code></pre>
<pre><code>The obsolete calling convention of 'sit-for' has been removed.
That convention was: '(sit-for SECONDS MILLISEC &amp;optional NODISP)'.</code></pre>
<pre><code>'defadvice' is marked as obsolete.
See the \"(elisp) Porting Old Advice\" Info node for help converting
them to use 'advice-add' or 'define-advice' instead.</code></pre>
<p class=\" text-justify\">Emacs added a new advice system many versions ago; it’s better, and I should get around to removing the old advice forms…</p>
<pre><code>'cl-old-struct-compat-mode' is marked as obsolete.
You may need to recompile your code if it was compiled with Emacs &lt; 24.3.</code></pre>
<pre><code>Old derived.el functions removed.
The following functions have been deleted because they were only used
by code compiled with Emacs &lt; 21:
'derived-mode-init-mode-variables', 'derived-mode-merge-abbrev-tables',
'derived-mode-merge-keymaps', 'derived-mode-merge-syntax-tables',
'derived-mode-run-hooks', 'derived-mode-set-abbrev-table',
'derived-mode-set-keymap', 'derived-mode-set-syntax-table',
'derived-mode-setup-function-name'.

</code></pre>
<H3 id=\"lisp-changes-in-emacs-30.1\">Lisp Changes in Emacs 30.1</H3>
<pre><code>The 'wheel-up/down/left/right' events are now bound unconditionally.
The 'mouse-wheel-up/down/left/right-event' variables are thus used only
to specify the 'mouse-4/5/6/7' events that might still happen to be
generated by some old packages (or if 'mouse-wheel-buttons' has been set
to nil).</code></pre>
<pre><code>Xterm Mouse mode now emits 'wheel-up/down/right/left' events.
This is instead of 'mouse-4/5/6/7' events for the mouse wheel.  It uses
the new variable 'mouse-wheel-buttons' to decide which button maps to
which wheel event (if any).</code></pre>
<pre><code>In batch mode, tracing now sends the trace to stdout.</code></pre>
<pre><code>New hook 'hack-dir-local-get-variables-functions'.
This can be used to provide support for other directory-local settings
beside \".dir-locals.el\".</code></pre>
<pre><code>'auto-coding-functions' can know the name of the file.
The functions on this hook can now find the name of the file to
which the text belongs by consulting the variable 'auto-coding-file-name'.</code></pre>
<pre><code>New user option 'compilation-safety' to control safety of native code.
It is now possible to control how safe is the code generated by native
compilation, by customizing this user option.  It is also possible to
control this at function granularity by using the new 'safety' parameter
in the function's 'declare' form.</code></pre>
<pre><code>New types 'closure' and 'interpreted-function'.
'interpreted-function' is the new type used for interpreted functions,
and 'closure' is the common parent type of 'interpreted-function'
and 'byte-code-function'.

Those new types come with the associated new predicates 'closurep' and
'interpreted-function-p' as well as a new constructor
'make-interpreted-closure'.</code></pre>
<pre><code>New function 'help-fns-function-name'.
For named functions, it just returns the name and otherwise
it returns a short \"unique\" string that identifies the function.
In either case, the string is propertized so clicking on it gives
further details.</code></pre>
<pre><code>New function 'char-to-name'.
This is a convenience function to return the Unicode name of a char (if
it has one).</code></pre>
<pre><code>New function 'cl-type-of'.
This function is like 'type-of' except that it sometimes returns
a more precise type.  For example, for nil and t it returns 'null'
and 'boolean' respectively, instead of just 'symbol'.</code></pre>
<pre><code>New functions 'primitive-function-p' and 'cl-functionp'.
'primitive-function-p' is like 'subr-primitive-p' except that it returns
t only if the argument is a function rather than a special-form,
and 'cl-functionp' is like 'functionp' except it returns nil
for lists and symbols.</code></pre>
<pre><code>Built-in types now have corresponding classes.
At the Lisp level, this means that things like '(cl-find-class 'integer)'
will now return a class object, and at the UI level it means that
things like 'C-h o integer RET' will show some information about that type.</code></pre>
<pre><code>New variable 'major-mode-remap-defaults' and function 'major-mode-remap'.
The first is like Emacs-29's 'major-mode-remap-alist' but to be set by
packages (instead of users).  The second looks up those two variables.</code></pre>
<p class=\" text-justify\">Yet more complexity around how to remap major modes to accommodate tree-sitter major modes.</p>
<pre><code>Pcase's functions (in 'pred' and 'app') can specify the argument position.
For example, instead of '(pred (&lt; 5))' you can write '(pred (&gt; _ 5))'.</code></pre>
<p class=\" text-justify\">Ah good. I always found it odd that it would bind to the left-most argument, but now I can specify which one I want.</p>
<pre><code>'define-advice' now sets the new advice's 'name' property to NAME.
Named advices defined with 'define-advice' can now be removed with
'(advice-remove SYMBOL NAME)' in addition to '(advice-remove SYMBOL
SYMBOL@NAME)'.</code></pre>
<pre><code>New function 'require-with-check' to detect new versions shadowing.
This is like 'require', but it checks whether the argument 'feature'
is already loaded, in which case it either signals an error or
forcibly reloads the file that defines the feature.</code></pre>
<pre><code>New variable 'lisp-eval-depth-reserve'.
It puts a limit to the amount by which Emacs can temporarily increase
'max-lisp-eval-depth' when handling signals.</code></pre>
<pre><code>New special form 'handler-bind'.
It provides a functionality similar to 'condition-case' except it runs
the handler code without unwinding the stack, such that we can record
the backtrace and other dynamic state at the point of the error.  See
the Info node \"(elisp) Handling Errors\".</code></pre>
<pre><code>New text properties add tooltips on fringes.
It is now possible to provide tooltips on fringes by adding special text
properties 'left-fringe-help' and 'right-fringe-help'.  See the \"(elisp)
Special Properties\" Info node in the Emacs Lisp Reference Manual for
more details.</code></pre>
<pre><code>New 'display-buffer' action alist entry 'pop-up-frames'.
This has the same effect as the variable of the same name and takes
precedence over the variable when present.</code></pre>
<pre><code>New function 'merge-ordered-lists'.
Mostly used internally to do a kind of topological sort of
inheritance hierarchies.</code></pre>
<pre><code>'drop' is now an alias for the function 'nthcdr'.</code></pre>
<pre><code>New polymorphic comparison function 'value&lt;'.
This function returns non-nil if the first argument is less than the
second.  It works for any two values of the same type with reasonable
ordering for numbers, strings, symbols, bool-vectors, markers, buffers
and processes.  Conses, lists, vectors and records are ordered
lexicographically.
It is intended as a convenient ordering predicate for sorting, and is
likely to be faster than hand-written Lisp functions.</code></pre>
<p class=\" text-justify\">Ah that is very useful actually. Now to remember that it exists…</p>
<pre><code>New 'sort' arguments and features.
The 'sort' function can now be called using the signature

    (sort SEQ &amp;rest KEYWORD-ARGUMENTS)

where arguments after the first are keyword/value pairs, all optional:
':key' specifies a function that produces the sorting key from an element,
':lessp' specifies the ordering predicate, defaulting to 'value&lt;',
':reverse' is used to reverse the sorting order,
':in-place' is used for in-place sorting, as the default is now to
sort a copy of the input.

The new signature is less error-prone and reduces the need to write
ordering predicates by hand.  We recommend that you use the ':key'
argument instead of ':lessp' unless a suitable ordering predicate is
already available.  This can also be used for multi-key sorting:

    (sort seq :key (lambda (x) (list (age x) (size x) (cost x))))

sorts by the return value of 'age', then by 'size', then by 'cost'.

The old signature, '(sort SEQ PREDICATE)', can still be used and sorts
its input in-place as before.</code></pre>
<pre><code>New API for 'derived-mode-p' and control of the graph of major modes</code></pre>
<pre><code>'derived-mode-p' now takes the list of modes as a single argument.
The same holds for 'provided-mode-derived-p'.
The old calling convention where multiple modes are passed as
separate arguments is deprecated.</code></pre>
<pre><code>New functions to access the graph of major modes.
While 'define-derived-mode' still only supports single inheritance,
modes can declare additional parents (for tests like 'derived-mode-p')
with 'derived-mode-add-parents'.
Accessing the 'derived-mode-parent' property directly is now
deprecated in favor of the new functions 'derived-mode-set-parent'
and 'derived-mode-all-parents'.</code></pre>
<p class=\" text-justify\">This complexity is yet again borne out of tree-sitter’s introduction to Emacs. I do wonder if all this complexity (remember diamond pattern inheritance in OO?) will come back to bite us in a few years… I hope not.</p>
<pre><code>Drag-and-drop functions can now be called once for compound drops.
It is now possible for drag-and-drop handler functions to respond to
drops incorporating more than one URL.  Functions capable of this must
set their 'dnd-multiple-handler' symbol properties to a non-nil value.
See the Info node \"(elisp) Drag and Drop\".

The function 'dnd-handle-one-url' has been made obsolete, since it
cannot take these new handlers into account.</code></pre>
<pre><code>'notifications-notify' can use Icon Naming Specification for ':app-icon'.
You can use a symbol as the value for ':app-icon' to provide icon name
without specifying a file, like this:

    (notifications-notify
      :title \"I am playing music\" :app-icon 'multimedia-player)</code></pre>
<pre><code>New function 're-disassemble' to see the innards of a regexp.
If you built Emacs with '--enable-checking', you can use this to help
debug either your regexp performance problems or the regexp engine.</code></pre>
<pre><code>XLFDs are no longer restricted to 255 characters.
'font-xlfd-name' now returns an XLFD even if it is greater than 255
characters in length, provided that the LONG_XLFDs argument is true.
Other features in Emacs which employ XLFDs have been modified to
produce and understand XLFDs larger than 255 characters.</code></pre>
<pre><code>New macro 'static-if' for conditional evaluation of code.
This macro hides a form from the evaluator or byte-compiler based on a
compile-time condition.  This is handy for avoiding byte-compilation
warnings about code that will never actually run under some conditions.</code></pre>
<pre><code>Desktop notifications are now supported on the Haiku operating system.
The new function 'haiku-notifications-notify' provides a subset of the
capabilities of the 'notifications-notify' function in a manner
analogous to 'w32-notification-notify'.</code></pre>
<pre><code>New Haiku specific variable 'haiku-pass-control-tab-to-system'.
This sets whether Emacs should pass 'C-TAB' on to the system instead of
handling it, fixing a problem where window switching would not activate
if an Emacs frame had focus on the Haiku operating system.  Default
value is t.</code></pre>
<pre><code>New value 'if-regular' for the REPLACE argument to 'insert-file-contents'.
It results in 'insert-file-contents' erasing the buffer instead of
preserving markers if the file being inserted is not a regular file,
rather than signaling an error.</code></pre>
<pre><code>New variable 'current-key-remap-sequence'.
It is bound to the key sequence that caused a call to a function bound
within 'function-key-map' or 'input-decode-map' around those calls.</code></pre>
<pre><code>The function 'key-translate' can now remove translations.
If the second argument TO is nil, the existing key translation is
removed.</code></pre>
<pre><code>New variables describing the names of built in programs.
The new variables 'ctags-program-name', 'ebrowse-program-name',
'etags-program-name', 'hexl-program-name', 'emacsclient-program-name'
'movemail-program-name', and 'rcs2log-program-name' should be used
instead of \"ctags\", \"ebrowse\", \"etags\", \"hexl\", \"emacsclient\", and
\"rcs2log\", when starting one of these built in programs in a subprocess.</code></pre>
<pre><code>New variable 'case-symbols-as-words' affects case operations for symbols.
If non-nil, then case operations such as 'upcase-initials' or
'replace-match' (with nil FIXEDCASE) will treat the entire symbol name
as a single word.  This is useful for programming languages and styles
where only the first letter of a symbol's name is ever capitalized.
The default value of this variable is nil.</code></pre>
<pre><code>Bytecode is now always loaded eagerly.
Bytecode compiled with older Emacs versions for lazy loading using
'byte-compile-dynamic' is now loaded all at once.
As a consequence, 'fetch-bytecode' has no use, does nothing, and is
now obsolete.  The variable 'byte-compile-dynamic' has no effect any
more; compilation will always yield bytecode for eager loading.</code></pre>
<pre><code>Returned strings from functions and macros are never docstrings.
Functions and macros whose bodies consist of a single string literal now
only return that string, and will not use it as a docstring.  Example:

    (defun sing-a-song ()
      \"Sing a song.\")

The above function returns the string \"Sing a song.\" and has no
docstring.  Previously, that string was used as both the docstring and
return value, which was never what the programmer wanted.  If you want
the string to be a docstring, add an explicit return value.

This change applies to 'defun', 'defsubst', 'defmacro' and 'lambda'
forms; other defining forms such as 'cl-defun' already worked this way.</code></pre>
<H3 id=\"new-or-changed-byte-compilation-warnings\">New or changed byte-compilation warnings</H3>
<pre><code>Warn about missing 'lexical-binding' directive.
The compiler now warns if an Elisp file lacks the standard
'-*- lexical-binding: ... -*-' cookie on the first line.
This line typically looks something like

    ;;; My little pony mode  -*- lexical-binding: t -*-

It is needed to inform the compiler about which dialect of ELisp
your code is using: the modern dialect with lexical binding or
the old dialect with only dynamic binding.

Lexical binding avoids some name conflicts and allows the compiler to
detect more mistakes and generate more efficient code, so it is
recommended.  For how to adapt your code to lexical binding, see the
manual section \"(elisp) Converting to Lexical Binding\".

If your code cannot be converted to lexical binding, you can insert
the line

    ;;; -*- lexical-binding: nil -*-

first in the file to declare that it uses the old dialect.</code></pre>
<pre><code>Warn about empty bodies for more special forms and macros.
The compiler now warns about an empty body argument to 'when',
'unless', 'ignore-error' and 'with-suppressed-warnings' in addition to
the existing warnings for 'let' and 'let*'.  Example:

    (when (&gt; x 2))

This warning can be suppressed using 'with-suppressed-warnings' with
the warning name 'empty-body'.</code></pre>
<pre><code>Warn about quoted error names in 'condition-case' and 'ignore-error'.
The compiler now warns about quoted condition (error) names
in 'condition-case' and 'ignore-error'.  Example:

    (condition-case nil
        (/ x y)
      ('arith-error \"division by zero\"))

Quoting them adds the error name 'quote' to those handled or ignored
respectively, which was probably not intended.</code></pre>
<pre><code>Warn about comparison with literal constants without defined identity.
The compiler now warns about comparisons by identity with a literal
string, cons, vector, record, function, large integer or float as this
may not match any value at all.  Example:

    (eq x \"hello\")

Only literals for symbols and small integers (fixnums), including
characters, are guaranteed to have a consistent (unique) identity.
This warning applies to 'eq', 'eql', 'memq', 'memql', 'assq', 'rassq',
'remq' and 'delq'.

To compare by (structural) value, use 'equal', 'member', 'assoc',
'rassoc', 'remove' or 'delete' instead.  Floats and bignums can also
be compared using 'eql', '=' and 'memql'.  Function literals cannot be
compared reliably at all.

This warning can be suppressed using 'with-suppressed-warnings' with
the warning name 'suspicious'.</code></pre>
<pre><code>Warn about 'condition-case' without handlers.
The compiler now warns when the 'condition-case' form is used without
any actual handlers, as in

    (condition-case nil (read buffer))

because it has no effect other than the execution of the body form.
In particular, no errors are caught or suppressed.  If the intention
was to catch all errors, add an explicit handler for 'error', or use
'ignore-error' or 'ignore-errors'.

This warning can be suppressed using 'with-suppressed-warnings' with
the warning name 'suspicious'.</code></pre>
<pre><code>Warn about 'unwind-protect' without unwind forms.
The compiler now warns when the 'unwind-protect' form is used without
any unwind forms, as in

    (unwind-protect (read buffer))

because the behavior is identical to that of the argument; there is
no protection of any kind.  Perhaps the intended unwind forms have
been misplaced or forgotten, or the use of 'unwind-protect' could be
simplified away.

This warning can be suppressed using 'with-suppressed-warnings' with
the warning name 'suspicious'.</code></pre>
<pre><code>Warn about useless trailing 'cond' clauses.
The compiler now warns when a 'cond' form contains clauses following a
default (unconditional) clause.  Example:

    (cond ((= x 0) (say \"none\"))
          (t (say \"some\"))
          (say \"goodbye\"))

Such a clause will never be executed, and is likely to be a mistake,
perhaps due to misplaced parens.

This warning can be suppressed using 'with-suppressed-warnings' with
the warning name 'suspicious'.</code></pre>
<pre><code>Warn about mutation of constant values.
The compiler now warns about code that modifies program constants in
some obvious cases.  Examples:

    (setcar '(1 2) 7)
    (aset [3 4] 0 8)
    (aset \"abc\" 1 ?d)

Such code may have unpredictable behavior because the constants are part
of the program and are not data structures generated afresh during
execution; the compiler does not expect them to change.

To avoid the warning, operate on an object created by the program
(maybe a copy of the constant), or use a non-destructive operation
instead.

This warning can be suppressed using 'with-suppressed-warnings' with
the warning name 'mutate-constant'.</code></pre>
<pre><code>Warn about more ignored function return values.
The compiler now warns when the return value from certain functions is
implicitly ignored.  Example:

    (progn (nreverse my-list) my-list)

will elicit a warning because it is usually pointless to call
'nreverse' on a list without using the returned value.

To silence the warning, make use of the value in some way, such as
assigning it to a variable.  You can also wrap the function call in
'(ignore ...)', or use 'with-suppressed-warnings' with the warning
name 'ignored-return-value'.

The warning will only be issued for calls to functions declared
'important-return-value' or 'side-effect-free' (but not 'error-free').</code></pre>
<pre><code>Warn about docstrings that contain control characters.
The compiler now warns about docstrings with control characters other
than newline and tab.  This is often a result of improper escaping.
Example:

    (defun my-fun ()
      \"Uses c:\\remote\\dir\\files and the key \\C-x.\"
      ...)

where the docstring contains the four control characters 'CR', 'DEL',
'FF' and 'C-x'.

The warning name is 'docstrings-control-chars'.</code></pre>
<pre><code>The warning about wide docstrings can now be disabled separately.
Its warning name is 'docstrings-wide'.</code></pre>
<pre><code>'fset', 'defalias' and 'defvaralias' now signal an error for cyclic aliases.
Previously, 'fset', 'defalias' and 'defvaralias' could be made to
build circular function and variable indirection chains as in

    (defalias 'able 'baker)
    (defalias 'baker 'able)

but trying to use them would sometimes make Emacs hang.  Now, an attempt
to create such a loop results in an error.

Since circular alias chains now cannot occur, 'function-alias-p',
'indirect-function' and 'indirect-variable' will never signal an error.
Their 'noerror' arguments have no effect and are therefore obsolete.</code></pre>
<H3 id=\"touch-screen-support\">Touch Screen support</H3>
<pre><code>'x-popup-menu' now understands touch screen events.
When a 'touchscreen-begin' or 'touchscreen-end' event is passed as the
POSITION argument, it will behave as if that event was a mouse event.</code></pre>
<pre><code>New functions for handling touch screen events.
The new functions 'touch-screen-track-tap' and 'touch-screen-track-drag'
handle tracking common touch screen gestures from within a command.</code></pre>
<pre><code>New parameter to 'touchscreen-end' events.
CANCEL non-nil establishes that the touch sequence has been intercepted
by programs such as window managers and should be ignored with Emacs.</code></pre>
<pre><code>New variable 'inhibit-auto-fill' to temporarily prevent auto-fill.</code></pre>
<pre><code>New variable 'secondary-tool-bar-map'.
If non-nil, this variable contains a keymap of menu items that are
displayed along tool bar items defined by 'tool-bar-map'.  These items
are displayed below the tool bar if the value of 'tool-bar-position' is
'top', and above it if the value is 'bottom'.  This is used by
'modifier-bar-mode'.</code></pre>
<pre><code>New variable 'completion-lazy-hilit'.
Lisp programs that present completion candidates may bind this
variable non-nil around calls to functions such as
'completion-all-completions'.  This tells the underlying completion
styles to skip eager fontification of completion candidates, which
improves performance.  Such a Lisp program can then use the
'completion-lazy-hilit' function to fontify candidates just in time.</code></pre>
<pre><code>New primitive 'buffer-last-name'.
It returns the name of a buffer before the last time it was renamed or
killed.</code></pre>
<pre><code>New primitive 'marker-last-position'.
It returns the last position of a marker in its buffer even if that
buffer has been killed.  ('marker-position' would return nil in that
case.)</code></pre>
<H3 id=\"functions-and-variables-to-transpose-sexps\">Functions and variables to transpose sexps</H3>
<p class=\" text-justify\">Juri Linkov did an awful lot of work to try and salvage the rather broken tree-sitter “sexp” commands and I think he’s done a stellar job, considering how hard it is to do <a href=\"/article/combobulate-structured-movement-editing-treesitter\" class=\" article-link\">Structured Movement and Editing with Tree-Sitter</a> in a way that works the way users expect it work.</p>
<pre><code>New helper variable 'transpose-sexps-function'.
Lisp programs can now set this variable to customize the behavior of the
'transpose-sexps' command.</code></pre>
<pre><code>New function 'transpose-sexps-default-function'.
The previous implementation of 'transpose-sexps' was moved into its own
function, to be used in 'transpose-sexps-function'.</code></pre>
<pre><code>New function 'treesit-transpose-sexps'.
Tree-sitter now unconditionally sets 'transpose-sexps-function' for all
tree-sitter enabled modes to this function.</code></pre>
<H3 id=\"functions-and-variables-to-move-by-program-statements\">Functions and variables to move by program statements</H3>
<pre><code>New variable 'forward-sentence-function'.
Major modes can now set this variable to customize the behavior of the
'forward-sentence' command.</code></pre>
<pre><code>New function 'forward-sentence-default-function'.
The previous implementation of 'forward-sentence' is moved into its
own function, to be bound by 'forward-sentence-function'.</code></pre>
<pre><code>New function 'treesit-forward-sentence'.
All tree-sitter enabled modes that define 'sentence' in
'treesit-thing-settings' now set 'forward-sentence-function' to call
'treesit-forward-sentence'.</code></pre>
<H3 id=\"functions-and-variables-to-move-by-program-sexps\">Functions and variables to move by program sexps</H3>
<pre><code>New function 'treesit-forward-sexp'.
Tree-sitter conditionally sets 'forward-sexp-function' for major modes
that have defined 'sexp' in 'treesit-thing-settings' to enable
sexp-related motion commands.</code></pre>
<pre><code>New user option 'native-comp-async-warnings-errors-kind'.
It allows control of what kinds of warnings and errors from asynchronous
native compilation are reported to the parent Emacs process.  The
default is to report all errors and only important warnings.  If you
were used to customizing 'native-comp-async-report-warnings-errors' to
nil or 'silent', we suggest that you now leave it at its default value,
and see if you get only warnings that matter.</code></pre>
<pre><code>New 'ftype' function declaration.
The declaration '(ftype TYPE)' specifies the type of a function.
Example:

    (defun hello (x y)
      (declare (ftype (function (integer boolean) string)))
      ...)

specifies that the function takes two arguments, an integer and a
boolean, and returns a string.  If the compilation happens with
'compilation-safety' set to zero, this information can be used by the
native compiler to produce better code, but specifying an incorrect type
may lead to Emacs crashing.  See the Info node \"(elisp) Declare Form\"
for further information.</code></pre>
<p class=\" text-justify\">You can now declare the type of functions in Emacs, presumably to help the native compiler make informed choices about the input and return value. We are moving inexorably closer to Common Lisp…</p>
<pre><code>New 'important-return-value' function declaration and property.
The declaration '(important-return-value t)' sets the
'important-return-value' property which indicates that the function
return value should probably not be thrown away implicitly.</code></pre>
<pre><code>New functions 'file-user-uid' and 'file-group-gid'.
These functions are like 'user-uid' and 'group-gid', respectively, but
are aware of file name handlers, so they will return the remote UID or
GID for remote files (or -1 if the connection has no associated user).</code></pre>
<pre><code>'treesit-font-lock-rules' now accepts additional global keywords.
When supplied with ':default-language LANGUAGE', rules after it will
default to use 'LANGUAGE'.</code></pre>
<p class=\" text-justify\">A welcome bit of syntactic sugar.</p>
<pre><code>New optional argument to 'modify-dir-local-variable'.
An optional 5th argument FILE has been added to
'modify-dir-local-variable'.  It can be used to specify which file to
modify instead of the default \".dir-locals.el\".</code></pre>
<H3 id=\"connection-local-variables\">Connection local variables</H3>
<p class=\" text-justify\">Connection local variables are variables local to Tramp-specific connections.</p>
<pre><code>New macros 'connection-local-p' and 'connection-local-value'.
The former macro returns non-nil if a variable has a connection-local
binding.  The latter macro returns the connection-local value of a
variable if any, or its current value.</code></pre>
<H3 id=\"hash-tables\">Hash tables</H3>
<pre><code>':rehash-size' and ':rehash-threshold' args no longer have any effect.
These keyword arguments are now ignored by 'make-hash-table'.  Emacs
manages the memory for all hash table objects in the same way.
The functions 'hash-table-rehash-size' and 'hash-table-rehash-threshold'
remain for compatibility but now always return the old default values.</code></pre>
<pre><code>The printed representation has been shrunk and simplified.
The 'test' parameter is omitted if it is 'eql' (the default), as is
'data' if empty.  'rehash-size', 'rehash-threshold' and 'size' are
always omitted, and ignored if present when the object is read back in.</code></pre>
<H3 id=\"obarrays\">Obarrays</H3>
<pre><code>New obarray type.
Obarrays are now represented by an opaque type instead of using vectors.
They are created by 'obarray-make' and manage their internal storage
automatically, which means that the size parameter to 'obarray-make' can
safely be omitted.  That is, they do not become slower as they fill up.

The old vector representation is still accepted by functions operating
on obarrays, but 'obarrayp' only returns t for obarray objects.
'type-of' now returns 'obarray' for obarray objects.

Old code which (incorrectly) created \"obarrays\" as Lisp vectors filled
with something other than 0, as in '(make-vector N nil)', will no longer
work, and should be rewritten to use 'obarray-make'.  Alternatively, you
can fill the vector with 0.</code></pre>
<pre><code>New function 'obarray-clear' removes all symbols from an obarray.</code></pre>
<pre><code>'obarray-size' and 'obarray-default-size' are now obsolete.
They pertained to the internal storage size which is now irrelevant.</code></pre>
<pre><code>'treesit-install-language-grammar' can handle local directory instead of URL.
It is now possible to pass a directory of a local repository as URL
inside 'treesit-language-source-alist', so that calling
'treesit-install-language-grammar' will avoid cloning the repository.
It may be useful, for example, for the purposes of bisecting a
treesitter grammar.</code></pre>
<pre><code>New buffer-local variable 'tabulated-list-groups'.
It controls display and separate sorting of groups of entries.  By
default no grouping or sorting is done.</code></pre>
<pre><code>New variable 'revert-buffer-restore-functions'.
It helps to preserve various states after reverting the buffer.</code></pre>
<pre><code>New text property 'context-menu-functions'.
Like the variable with the same name, it adds menus from the list that
is the value of the property to context menus shown when clicking on the
text which as this property.</code></pre>
<pre><code>Detecting the end of an iteration of a keyboard macro.
'read-event', 'read-char', and 'read-char-exclusive' no longer return -1
when called at the end of an iteration of the execution of a keyboard
macro.  Instead, they will transparently continue reading available input
(e.g., from the keyboard).  If you need to detect the end of a macro
iteration, check the following condition before calling one of the
aforementioned functions:

    (and (arrayp executing-kbd-macro)
         (&gt;= executing-kbd-macro-index (length executing-kbd-macro)))</code></pre>
<pre><code>'vtable-update-object' updates an existing object with just two arguments.
It is now possible to update the representation of an object in a vtable
by calling 'vtable-update-object' with just the vtable and the object as
arguments.  (Previously, the OLD-OBJECT argument was required which, in
this case, would mean repeating the object in the argument list.)  When
replacing an object with a different one, passing both the new and old
objects is still necessary.</code></pre>
<pre><code>'vtable-insert-object' can insert \"before\" or at an index.
The signature of 'vtable-insert-object' has changed and is now:

    (vtable-insert-object TABLE OBJECT &amp;optional LOCATION BEFORE)

LOCATION corresponds to the old AFTER-OBJECT argument; if BEFORE is
non-nil, the new object is inserted before the LOCATION object, making
it possible to insert a new object at the top of the table.  (Before,
this was not possible.)  In addition, LOCATION can be an integer, a
(zero-based) index into the table at which the new object is inserted
(BEFORE is ignored in this case).</code></pre>
<pre><code>New function 'sqlite-execute-batch'.
This function lets the user execute multiple SQL statements in one go.
It is useful, for example, when a Lisp program needs to evaluate an
entire SQL file.</code></pre>
<H3 id=\"json\">JSON</H3>
<pre><code>'json-serialize' now always returns a unibyte string.
This is appropriate since it is an encoding operation.  In the unlikely
event that a multibyte string is needed, the result can be decoded using

    (decode-coding-string RESULT 'utf-8)</code></pre>
<pre><code>The parser keeps duplicated object keys in alist and plist output.
A JSON object such as '{\"a\":1,\"a\":2}' will now be translated into the
Lisp values '((a . 1) (a . 2))' or '(:a 1 :a 2)' if alist or plist
object types are requested.</code></pre>
<pre><code>The parser sometimes signals different types of errors.
It will now signal 'json-utf8-decode-error' for inputs that are not
correctly UTF-8 encoded.</code></pre>
<pre><code>The parser and encoder now accept arbitrarily large integers.
Previously, they were limited to the range of signed 64-bit integers.</code></pre>
<pre><code>New tree-sitter functions and variables for defining and using \"things\"</code></pre>
<pre><code>New variable 'treesit-thing-settings'.
It allows modes to define \"things\" like 'defun', 'text', 'sexp', and
'sentence' for navigation commands and tree-traversal functions.</code></pre>
<pre><code>New functions for navigating \"things\".
There are new navigation functions 'treesit-thing-prev',
'treesit-thing-next', 'treesit-navigate-thing',
'treesit-beginning-of-thing', and 'treesit-end-of-thing'.</code></pre>
<pre><code>New functions 'treesit-thing-at', 'treesit-thing-at-point'.</code></pre>
<p class=\" text-justify\">The tree-sitter-enabled equivalent of <code>thing-at-point</code>. This really should be merged into the existing thing at point system; if TS is available, then its settings should take precedence.</p>
<pre><code>Tree-traversing functions.
The functions 'treesit-search-subtree', 'treesit-search-forward',
'treesit-search-forward-goto', and 'treesit-induce-sparse-tree' now
accept more kinds of predicates.  Lisp programs can now use thing
symbols (defined in 'treesit-thing-settings') and any thing definitions
for the predicate argument.</code></pre>
<H3 id=\"other-tree-sitter-function-and-variable-changes\">Other tree-sitter function and variable changes</H3>
<pre><code>'treesit-parser-list' now takes additional optional arguments.
The additional arguments are LANGUAGE and TAG.  If LANGUAGE is given,
only return parsers for that language.  If TAG is given, only return
parsers with that tag.  Note that passing nil as tag doesn't mean return
all parsers, but rather \"all parsers with no tags\".</code></pre>
<pre><code>New variable 'treesit-primary-parser'.
This variable should be set by multi-langauge major modes before calling
'treesit-major-mode-setup', in order for tree-sitter integration
functionalities to operate correctly.</code></pre>
<p class=\" text-justify\">I’m not convinced having the notion of a primary parser is the right approach for multi-language support in a buffer. The notion of primacy is not going to resolve problems where multiple languages that do not know of each other have to coexist in the same buffer; those languages by definition do not have a primary language, and trying to coax Emacs and thus tree-sitter into thinking there is such a thing is flawed.</p>
<H3 id=\"changes-in-emacs-30.1-on-non-free-operating-systems\">Changes in Emacs 30.1 on Non-Free Operating Systems</H3>
<H3 id=\"ms-windows\">MS-Windows</H3>
<pre><code>You can now opt out of following MS-Windows' Dark mode.
By default, Emacs on MS-Windows follows the system's Dark mode for its
title bars' and scroll bars' appearance.  If the new user option
'w32-follow-system-dark-mode' is customized to the nil value, Emacs
will disregard the system's Dark mode and will always use the default
Light mode.</code></pre>
<pre><code>You can now use Image-Dired even if the 'convert' program is not installed.
If you don't have GraphicsMagick or ImageMagick installed, and thus the
'gm convert'/'convert' program is not available, Emacs on MS-Windows
will now use its own function 'w32image-create-thumbnail' to create
thumbnail images and show them in the thumbnail buffer.  Unlike with
using 'convert', this fallback method is synchronous, so Emacs will wait
until all the thumbnails are created and displayed, before showing them.</code></pre>
<pre><code>Emacs on MS-Windows now supports the ':stipple' face attribute.</code></pre>
") (guid ((isPermaLink . "false")) "/article/whats-new-in-emacs-301") (pubDate nil "Mon, 24 Feb 2025 08:28:41 +0000")) (item nil (title nil "Replacing tmux and GNU screen with Emacs") (link nil "https://www.masteringemacs.org/article/replacing-tmux-gnu-screen-emacs?utm_source=newsletter&utm_medium=rss") (description nil "If you live and breathe the terminal, then you are no doubt using a terminal multiplexer like GNU screen or tmux. But why not replace it with 100% all-natural Emacs? It can do everything your favorite multiplexer can do --- it can even edit text.") (encoded nil "
<p class=\" text-justify drop-cap\">If you’re a command line hacker – and I know you are – then I am sure you are familiar with, and possibly use, GNU <code>screen</code> or its contemporary replacement, <code>tmux</code>. If you are in the process of <a href=\"/article/switching-from-vim-to-emacs\" class=\" article-link\">switching from Vim to Emacs</a>, then <code>tmux</code> is no doubt a large part of your workflow.</p>
<p class=\" text-justify\">But here’s the thing: you do not need a terminal multiplexer if you are already using Emacs. Emacs can accomplish nearly everything your terminal multiplexer can do. If you’re not a serious user of <code>screen</code> or <code>tmux</code>, but you’re still addicted to the command line, then I’m sure this article will convince you of the merits of multiplexers, and how Emacs can slot right in. If you’re still unconvinced after having read this article, then my parting advice is to read about the <a href=\"/article/keyboard-shortcuts-every-command-line-hacker-should-know-about-gnu-readline\" class=\" article-link\">keyboard shortcuts in GNU readline</a> as that’ll at least bring more of Emacs to your command line life.</p>
<p class=\" text-justify\">Before I get into the weeds of why, let me just quickly state that, sure, <code>tmux</code> and friends will always have their uses: on remote servers for people who insist on running their daemons inside a <code>screen</code> session like it’s 1997 (bonus points if it’s an IRC client); and of course for actual terminal use on machines where Emacs is not available, or where you have to work with others who may not know Emacs.</p>
<p class=\" text-justify\">Caveats aside, let me share why I think you should consider using Emacs for some or all of your multiplexing needs, as it can do everything from detaching and re-attaching sessions; to windowing; to terminal emulation and running shells; and even the odd bit of text editing…</p>
<H2 id=\"the-perils-of-terminal-programs\">The Perils of Terminal Programs</H2>
<p class=\" text-justify\">Naturally, terminal multiplexers are meant for terminals, and as such, I’ll talk exclusively about running Emacs in a terminal from now on, although nearly all the advice I write applies equally to GUI Emacs. My thoughts on terminal Emacs are well known if you’re a frequent reader, but I will restate them again by saying that running GUI Emacs is a far better proposition than running Emacs in a terminal (multiplexer or not) for the following simple reasons:</p>
<dl>
<dt>Key Bindings often clash with your terminal</dt>
<dd>
<p class=\" text-justify\">It’s such a common problem for beginners: they fire up Emacs in a terminal, and wonder why some keys don’t work at all. The answer is usually the terminal tool itself. You’ll have to disable their invasive overreach of your key bindings so they pass through to the terminal, but now you lose said key bindings as you may want to use them elsewhere.</p>
</dd>
<dt>Not all key bindings work in a terminal</dt>
<dd>
<p class=\" text-justify\">Despite a lot of bolted-on protocols, additions and extensions made over the years, the fact of the matter is that some keys are simply not possible to represent and transmit to a terminal and the underlying program. This is another common newbie trap.</p>
</dd>
<dt>Lack of fidelity</dt>
<dd>
<p class=\" text-justify\">You cannot view PDFs, use images, or rice your Emacs with fancy SVG icons; some terminal emulators have limited color bit depth. The value of this is debatable, but I find the ability to view PDFs and images useful.</p>
</dd>
<dt>Flow Control Chaos</dt>
<dd>
<p class=\" text-justify\">And the ultimate trap of them all: the ossified flow control feature that some terminals still enable by default. Type <code>Control+s</code> in some terminal setups, and your terminal freezes, so as to give you enough time to read the text before it can scroll by. <code>Control+q</code> thaws your terminal. A fantastic feature when you’re downloading Dr. Who fan scripts from a dusty newsgroup back in the 1980s. Today… not so much. You can permanently disable flow control with <code>stty -ixon</code>, but it’s just one more thing to think about.</p>
</dd>
</dl>
<p class=\" text-justify\">There’s one more reason not to run terminal Emacs inside a <em>terminal multiplexer</em> and that is… well, everything, actually. The multiplexer gets first dips on the ANSI escape codes terminals use to move the cursor and draw stuff to the screen, and it’s oh-so-easy to break or gum things up. Mismatched colors; loss of color bit-depth; keys not getting translated properly; keys intercepted and repurposed by the multiplexer; weird scrollback and buffering issues; the list goes on and on.</p>
<p class=\" text-justify\">Terminal multiplexers are awesome, but they’re also faced with a tricky problem: they <em>must</em> work with nearly everything in a way that is sensible and consistent and often across a wide range of terminal capabilities and platforms. Sure, you can tweak this stuff: do you really want to, though?</p>
<p class=\" text-justify\">So those are the downsides of terminal Emacs with or without the lather of a multiplexer messing with your escape codes. But as annoying as these issues are, terminal Emacs is a full-fledged Emacs experience otherwise.</p>
<p class=\" text-justify\">Now let’s replicate the multiplexing experience inside Emacs.</p>
<H2 id=\"emacss-client-server-architecture\">Emacs’s Client-Server Architecture</H2>
<p class=\" text-justify\">Of course Emacs has a client-server architecture. It’s a <em>text editor!</em></p>
<p class=\" text-justify\">Run <code>M-x server-start</code> in an active Emacs instance and your current Emacs becomes the server host. Note that there are multiple ways of running Emacs in server mode. If you use <code>emacs --daemon</code> to start the daemon, you’ll get a persistent daemon that does not spawn a frame; you must then type <code>emacsclient -c</code> to connect to your Emacs. A third way is <code>systemctl --user enable emacs</code> and you can let systemd run Emacs as a daemon.</p>
<p class=\" text-justify\">Either way, from that moment on, if you call <code>emacsclient</code>, Emacs will talk to your Emacs server. This is how experienced hackers prefer to use Emacs, but you do not have to, of course. If you run <code>emacs</code> it will launch a standalone instance. You can even mix and match.</p>
<p class=\" text-justify\">Now you can set <code>emacsclient</code> to your <code>$EDITOR</code> and everything Just Works.</p>
<blockquote>
<p class=\" text-justify\"><em>NOTE</em>: Emacs’s client-server architecture is not intended to straddle multiple computers; both should be run on the same machine, lest you run into weird, hard-to-debug problems. If you want to use Emacs ‘remotely’, you can use <a href=\"https://www.gnu.org/software/tramp/\" class=\" article-link\">Tramp</a> or <code>ssh</code> to your target machine and run Emacs as a client-server architecture there.</p>
</blockquote>
<H2 id=\"running-programs-from-emacs\">Running Programs from Emacs</H2>
<p class=\" text-justify\">Obviously this is the main purpose of a multiplexer, and Emacs is more than capable of doing this. Running instances of your favorite shell is the most common, so let’s start with that.</p>
<H3 id=\"shells-and-terminal-emulators\">Shells and Terminal Emulators</H3>
<table class=\" table\">
<colgroup>
<col style=\"width: 50%\">
<col style=\"width: 50%\">
</colgroup>
<tbody>
<tr class=\"odd\">
<td><strong>Command</strong></td>
<td><strong>Description</strong></td>
</tr>
<tr class=\"even\">
<td><code>M-x shell</code></td>
<td><p class=\" text-justify\">Runs your preferred shell via a pseudo-terminal or pipe. Uses Emacs keys, Emacs for scrollback, its own history, better search and a plain Emacs buffer.</p>
<p class=\" text-justify\">Limited emulation; cannot handle curses apps without third-party packages like <code>xterm-color</code>.</p></td>
</tr>
<tr class=\"odd\">
<td><code>M-x term</code></td>
<td>Emacs’s builtin terminal emulator. Can switch between traditional terminal mode and a mode that makes it temporarily behave like an Emacs buffer. Can be quite slow.</td>
</tr>
<tr class=\"even\">
<td><code>M-x vterm</code></td>
<td><p class=\" text-justify\">Uses <code>libvterm</code> to provide a modern, fast and compliant terminal emulator.</p>
<p class=\" text-justify\"><strong>NOTE</strong>: Requires a third-party package.</p></td>
</tr>
<tr class=\"odd\">
<td><code>M-x eat</code></td>
<td><p class=\" text-justify\">EAT is another terminal emulator that plugs into Eshell and also has its own terminal mode. Very fast.</p>
<p class=\" text-justify\"><strong>NOTE</strong>: Requires a third-party package.</p></td>
</tr>
<tr class=\"even\">
<td><code>M-x eshell</code></td>
<td><p class=\" text-justify\">Not a terminal emulator, but instead a replacement for your preferred shell. It’s loosely inspired by <code>zsh</code> and friends, and is written entirely in Emacs Lisp.</p>
<p class=\" text-justify\"><strong>NOTE</strong>: Eshell is a pathway to many abilities some consider to be unnatural.</p></td>
</tr>
</tbody>
</table>
<p class=\" text-justify\">My article on <a href=\"/article/running-shells-in-emacs-overview\" class=\" article-link\">Running Shells and Terminal Emulators in Emacs</a> is a more in-depth look at these options. If you want a near-terminal-like experience, then <code>vterm</code> is a great package. If you want to lean into the Emacs way of doing things, then <code>M-x shell</code> is a good choice, and that is what I mostly use, unless I absolutely have to run a curses app (then I use <code>M-x vterm</code>.) If you are unsure, then I recommend you install <code>vterm</code> and start with that.</p>
<p class=\" text-justify\">Another way – the more Emacsy way – is to instead consider that most things may not require a shell (and a terminal) at all for common tasks. If you just want to compile stuff (or run your development server, test harness, etc. etc.), then <a href=\"/article/compiling-running-scripts-emacs\" class=\" article-link\">compiling and running scripts in Emacs</a> is the way to go. You gain the added benefit of error highlighting (with hyperlinks to the erroneous file) that works with darn near every structured error output you can throw at it.</p>
<p class=\" text-justify\">But wait, there’s more: you can run a range of <a href=\"/article/network-utilities-emacs\" class=\" article-link\">command line network utilities</a>; <a href=\"/article/displaying-interacting-processes-proced\" class=\" article-link\">use M-x proced, Emacs’s replacement for top</a>; and use dired, Emacs’s <a href=\"/article/dired-shell-commands-find-xargs-replacement\" class=\" article-link\">directory editor</a> to do all sorts of cool stuff.</p>
<p class=\" text-justify\">For simple things? You can <a href=\"/article/executing-shell-commands-emacs\" class=\" article-link\">execute shell commands</a> directly, or even feed buffer text to the standard input of a command line program and get the output piped back. That solves a whole swathe of problems also.</p>
<H4 id=\"interacting-with-fzf\">Interacting with <code>fzf</code></H4>
<p class=\" text-justify\">Not really multiplexer related per se, so I’m going to point out that you can use <a href=\"/article/fuzzy-finding-emacs-instead-of-fzf\" class=\" article-link\">Emacs for fuzzy finding</a> instead of <code>fzf</code> using a fistful of shell script code. Kinda cool.</p>
<H3 id=\"starting-programs-from-outside-or-inside-emacs\">Starting programs from outside or inside Emacs</H3>
<p class=\" text-justify\">Another common thing to do with a multiplexer is to quickly open a program inside a running tmux instance; perhaps from a shell pane <em>inside</em> your <code>tmux</code> instance, or perhaps outside it.</p>
<p class=\" text-justify\">You can do this with Emacs also (with <code>M-x vterm</code> if it’s installed, otherwise <code>M-x term</code>) with the provided bash script. Let’s call it <code>emux.sh</code>:</p>
<div class=\"sourceCode\" id=\"cb1\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><span id=\"cb1-1\"><a href=\"#cb1-1\" aria-hidden=\"true\" tabindex=\"-1\" class=\" article-link\"></a><span class=\"co\">#!/usr/bin/env bash</span></span>
<span id=\"cb1-2\"><a href=\"#cb1-2\" aria-hidden=\"true\" tabindex=\"-1\" class=\" article-link\"></a><span class=\"bu\">set</span> <span class=\"at\">-o</span> nounset <span class=\"at\">-o</span> errexit <span class=\"at\">-o</span> pipefail</span>
<span id=\"cb1-3\"><a href=\"#cb1-3\" aria-hidden=\"true\" tabindex=\"-1\" class=\" article-link\"></a><span class=\"va\">argcmd</span><span class=\"op\">=</span><span class=\"st\">\"</span><span class=\"va\">$@</span><span class=\"st\">\"</span></span>
<span id=\"cb1-4\"><a href=\"#cb1-4\" aria-hidden=\"true\" tabindex=\"-1\" class=\" article-link\"></a><span class=\"va\">cmd</span><span class=\"op\">=</span><span class=\"st\">\"</span><span class=\"va\">${argcmd</span><span class=\"op\">:=</span><span class=\"va\">$SHELL}</span><span class=\"st\">\"</span></span>
<span id=\"cb1-5\"><a href=\"#cb1-5\" aria-hidden=\"true\" tabindex=\"-1\" class=\" article-link\"></a><span class=\"bu\">exec</span> emacsclient <span class=\"at\">-e</span> <span class=\"op\">&lt;&lt;EOF</span></span>
<span id=\"cb1-6\"><a href=\"#cb1-6\" aria-hidden=\"true\" tabindex=\"-1\" class=\" article-link\"></a><span class=\"st\">(let ((vterm-shell \"</span><span class=\"va\">${cmd}</span><span class=\"st\">\")) (if (fboundp 'vterm) (vterm t) (term vterm-shell)))</span></span>
<span id=\"cb1-7\"><a href=\"#cb1-7\" aria-hidden=\"true\" tabindex=\"-1\" class=\" article-link\"></a><span class=\"op\">EOF</span></span></code></pre></div>
<p class=\" text-justify\">Here I temporarily bind the Emacs variable <code>vterm-shell</code> to the command to run (it defaults to your shell). Then I invoke <code>vterm</code> (if it’s installed, otherwise I use <code>term</code>) and start a new instance.</p>
<p class=\" text-justify\">To use it is simple:</p>
<ul>
<li><code>./emux.sh top</code> runs <code>top</code> inside your active Emacs instance.</li>
<li><code>./emus.sh watch free -hg</code> calls <code>watch</code> and tells it to run <code>free -hg</code>.</li>
<li><code>./emux.sh</code> on its own will call your <code>$SHELL</code> instead.</li>
</ul>
<p class=\" text-justify\">All from the comfort of your Emacs. You don’t have to run this from inside an Emacs instance, either. Provided you’ve got the client-server feature enabled, it’ll work anywhere.</p>
<H3 id=\"detaching-and-attaching-long-running-programs\">Detaching and Attaching &amp; Long-running programs</H3>
<p class=\" text-justify\">By running programs in an Emacs server instance, you can leave them running even if you hang up your remote connection (such as when you disconnect from <code>ssh</code>) but that does depend a bit on the method you used to start your server. I recommend you daemonize it with <code>emacs --daemon</code>, or run it through systemd, to ensure this works.</p>
<p class=\" text-justify\">Your Emacs server remembers everything: processes, sockets, buffers — you name it. You can even have multiple daemons if you really, really want to.</p>
<p class=\" text-justify\">So if your workflow depends heavily on the ability to engage and disengage from a ‘running’ session of work, then Emacs can definitely do this.</p>
<p class=\" text-justify\">If you regularly work on remote servers, a lot of your work could be done from your local Emacs by talking to the remote server directly with Emacs’s <a href=\"https://www.gnu.org/software/tramp/\" class=\" article-link\">Tramp</a>.</p>
<H2 id=\"panes-windows-buffers-frames\">Panes, Windows, Buffers, Frames</H2>
<p class=\" text-justify\">Emacs’s windowing technology is so far ahead of every other terminal or GUI application that I’d struggle to even begin to cover all the things you can do with it. Emacs is a tiling window manager onto itself (and some do indeed use it as their tiling window manager!), with hundreds of commands and variables that govern how it works. It also has <em>frames</em> (Emacs’s name for what most people call <em>windows</em>), if you prefer a non-tiling approach.</p>
<p class=\" text-justify\">I’ve made a handy table of the window-related nomenclature used in <code>screen</code> and <code>tmux</code> and of course Emacs. They do differ, so let’s just quickly cover that.</p>
<table style=\"width:99%;\" class=\" table\">
<colgroup>
<col style=\"width: 24%\">
<col style=\"width: 24%\">
<col style=\"width: 24%\">
<col style=\"width: 24%\">
</colgroup>
<tbody>
<tr class=\"odd\">
<td><strong>Term</strong></td>
<td><strong>Emacs</strong></td>
<td><strong>tmux</strong></td>
<td><strong>GNU Screen</strong></td>
</tr>
<tr class=\"even\">
<td><strong>Frame</strong></td>
<td>The entire Emacs instance visible on screen, can contain multiple windows</td>
<td>The entire terminal instance running tmux, equivalent to the terminal window</td>
<td>The entire terminal instance running Screen, equivalent to the terminal window</td>
</tr>
<tr class=\"odd\">
<td><strong>Window</strong></td>
<td>A subdivision within a frame that displays one buffer</td>
<td>A full-screen view within a session that can be divided into panes (similar to tabs)</td>
<td>A full-screen virtual terminal identified by a number or name</td>
</tr>
<tr class=\"even\">
<td><strong>Buffer</strong></td>
<td>Container for text being edited, displayed within windows</td>
<td>No direct equivalent (closest is the content displayed in a pane)</td>
<td>No direct equivalent (closest is the content displayed in a window)</td>
</tr>
<tr class=\"odd\">
<td><strong>Pane</strong></td>
<td>No direct equivalent (similar to windows)</td>
<td>Subdivision of a window that contains a separate terminal instance</td>
<td>Called “regions” — subdivisions of the display when split screen is used</td>
</tr>
<tr class=\"even\">
<td><strong>Session</strong></td>
<td>Another term for an Emacs server instance</td>
<td>A collection of windows under a single server instance that can be detached/reattached</td>
<td>A detachable collection of windows running as a single process</td>
</tr>
</tbody>
</table>
<p class=\" text-justify\">Of note is that in Emacs, a <em>frame</em> is of course what most people would call a <em>window</em>, but there’s another dimension to it: frames behave differently in a terminal Emacs session.</p>
<p class=\" text-justify\">In terminal Emacs, a frame is really more like <em>window</em> in <code>tmux</code> or <code>screen</code>. Only one is ever visible at a time; in GUI Emacs, you can have many visible at the same time, subject to the whims of your window manager (tiling vs stacking for example) and Emacs has another set of complex commands for interacting with frames specifically. Emacs does its level best to provide parity between the GUI and terminal versions, but this is one area where there is some difference in appearance and behavior.</p>
<p class=\" text-justify\">Now let’s talk about – let’s call it “windowing features” for want of a better phrase – across the multiplexers and Emacs. There’s an awful lot of asterisks attached to some of these, but more on that below.</p>
<table style=\"width:99%;\" class=\" table\">
<colgroup>
<col style=\"width: 24%\">
<col style=\"width: 24%\">
<col style=\"width: 24%\">
<col style=\"width: 24%\">
</colgroup>
<tbody>
<tr class=\"odd\">
<td><strong>tmux Feature</strong></td>
<td><strong>screen Key Binding</strong></td>
<td><strong>tmux Key Binding</strong></td>
<td><strong>Emacs Key Binding</strong></td>
</tr>
<tr class=\"even\">
<td>Create new window</td>
<td><code>C-a c</code></td>
<td><code>C-b c</code></td>
<td><code>C-x 2</code>, <code>C-x 3</code> (splits instead)</td>
</tr>
<tr class=\"odd\">
<td>Close current window</td>
<td><code>C-a K</code></td>
<td><code>C-b &amp;</code></td>
<td><code>C-x 0</code> (close window), <code>C-x k</code> (kill buffer)</td>
</tr>
<tr class=\"even\">
<td>Rename current window</td>
<td><code>C-a A</code></td>
<td><code>C-b ,</code></td>
<td><code>M-x rename-buffer</code> or <code>C-x x r</code></td>
</tr>
<tr class=\"odd\">
<td>List all windows</td>
<td><code>C-a \"</code></td>
<td><code>C-b w</code></td>
<td><code>C-x b</code> (switch to) or <code>C-x C-b</code></td>
</tr>
<tr class=\"even\">
<td>Next window</td>
<td><code>C-a n</code></td>
<td><code>C-b n</code></td>
<td><code>C-x o</code> (other window)</td>
</tr>
<tr class=\"odd\">
<td>Previous window</td>
<td><code>C-a p</code></td>
<td><code>C-b p</code></td>
<td>N/A but you can fiddle with numeric arguments to <code>C-x o</code> to simulate it, or use windmove.</td>
</tr>
<tr class=\"even\">
<td>Go to window by number</td>
<td><code>C-a [0-9]</code></td>
<td><code>C-b [0-9]</code></td>
<td>Registers can sort of stand in for this, but there is no simple equivalent.</td>
</tr>
<tr class=\"odd\">
<td>Go to last active window</td>
<td><code>C-a C-a</code></td>
<td><code>C-b l</code></td>
<td>Maybe <code>M-x mode-line-other-buffer</code></td>
</tr>
<tr class=\"even\">
<td>Split window horizontally</td>
<td><code>C-a S</code> (added later)</td>
<td><code>C-b \"</code></td>
<td><code>C-x 2</code></td>
</tr>
<tr class=\"odd\">
<td>Split window vertically</td>
<td><code>C-a |</code> (added later)</td>
<td><code>C-b %</code></td>
<td><code>C-x 3</code></td>
</tr>
<tr class=\"even\">
<td>Move to next pane</td>
<td><code>C-a tab</code></td>
<td><code>C-b o</code></td>
<td><code>C-x o</code></td>
</tr>
<tr class=\"odd\">
<td>Convert pane to window</td>
<td>N/A</td>
<td><code>C-b !</code></td>
<td>N/A</td>
</tr>
<tr class=\"even\">
<td>Show pane numbers</td>
<td>N/A</td>
<td><code>C-b q</code></td>
<td>N/A</td>
</tr>
<tr class=\"odd\">
<td>Toggle between pane layouts</td>
<td>N/A</td>
<td><code>C-b space</code></td>
<td>Window Configurations; <code>M-x tab-bar-mode</code></td>
</tr>
<tr class=\"even\">
<td>Resize pane</td>
<td>N/A (not as intuitive)</td>
<td><code>C-b C-[arrow keys]</code></td>
<td><code>C-x {</code> / <code>C-x }</code></td>
</tr>
<tr class=\"odd\">
<td>Break pane into window</td>
<td>N/A</td>
<td><code>C-b !</code></td>
<td>N/A</td>
</tr>
<tr class=\"even\">
<td>Join pane from window</td>
<td>N/A</td>
<td><code>C-b :join-pane -s [window]</code></td>
<td>N/A</td>
</tr>
<tr class=\"odd\">
<td>Enter copy mode</td>
<td><code>C-a [</code></td>
<td><code>C-b [</code></td>
<td>N/A</td>
</tr>
<tr class=\"even\">
<td>Search in copy mode</td>
<td><code>/</code> (forward), <code>?</code> (backward)</td>
<td><code>/</code> (forward), <code>?</code> (backward)</td>
<td><code>C-s</code> (forward), <code>C-r</code> (backward)</td>
</tr>
<tr class=\"odd\">
<td>Swap window positions</td>
<td><code>C-a :number [n]</code></td>
<td><code>C-b .</code> (prompt for new number)</td>
<td>Use Windmove</td>
</tr>
<tr class=\"even\">
<td>Detach from session</td>
<td><code>C-a d</code></td>
<td><code>C-b d</code></td>
<td><code>C-x #</code> (if in an emacs client)</td>
</tr>
<tr class=\"odd\">
<td>Choose a session</td>
<td>N/A (via command line)</td>
<td><code>C-b s</code></td>
<td>Technically a thing, but multiple daemons is a rarely used feature.</td>
</tr>
<tr class=\"even\">
<td>Zoom pane (toggle full-screen)</td>
<td>N/A</td>
<td><code>C-b z</code></td>
<td><code>C-x 1</code></td>
</tr>
<tr class=\"odd\">
<td>Rotate panes</td>
<td>N/A</td>
<td><code>C-b C-o</code></td>
<td>N/A</td>
</tr>
<tr class=\"even\">
<td>Display clock</td>
<td><code>C-a t</code></td>
<td><code>C-b t</code></td>
<td><code>M-x display-time</code></td>
</tr>
<tr class=\"odd\">
<td>Command prompt</td>
<td><code>C-a :</code></td>
<td><code>C-b :</code></td>
<td><code>M-x</code></td>
</tr>
</tbody>
</table>
<p class=\" text-justify\"><code>tmux</code> and <code>screen</code> are not trying to be Emacs, and Emacs did not set out to replace either of these tools — it’s just that it is so advanced that it can step into the role of multiplexer with relative ease.</p>
<p class=\" text-justify\">Windows in Emacs are <em>transient</em> and considered disposable, and the commands are sort of built around that idea. That is a stark difference to other IDEs and editors, but consider that this is a complex topic with a lot of opinions. Luckily, Emacs can accommodate most of people’s complex windowing requirements, if you’re willing to <a href=\"/article/demystifying-emacs-window-manager\" class=\" article-link\">learn how Emacs’s Window Manager works</a>. As such swapping windows or referencing them by number is not really an Emacsy thing to do, though you can with a little bit of code (or using a third-party package like <code>avy</code>), or perhaps by bending registers to your will.</p>
<p class=\" text-justify\">In Emacs you have to contend with buffers first and foremost, as that is the <a href=\"/article/why-emacs-has-buffers\" class=\" article-link\">currency of Emacs</a>. Buffers, though, have no real equivalents in the multiplexers, as you can preserve the window layout in Emacs but change their buffers to show something else (though you technically <em>can</em> do this in <code>tmux</code>, it’s clearly not a well-trodden path) so in Emacs I’ve crammed both buffer and window switching commands into the mix. I would be remiss if I did not also mention both <code>M-x global-tab-line-mode</code>, for browser-style tabs; and <code>M-x tab-bar-mode</code> to set up and switch between window configurations (“pane layouts” in <code>tmux</code>), but more on that below.</p>
<p class=\" text-justify\">The builtin package <em>windmove</em> adds ortographic movement from the current active window (for example, <code>C-x &lt;up&gt;</code> to pick the window above the current one) as opposed to layout-driven keys like <code>C-x o</code> that cycle through the windows on your screen. It’s a useful package, and one a lot of people use to make movement between windows more intuitive and faster.</p>
<p class=\" text-justify\">Detaching / attaching to a session is best done by explicitly launching a server daemon (as I mentioned before) with <code>emacs --daemon</code> and then connecting and disconnecting (<code>C-x #</code>) at will with <code>emacsclient</code>.</p>
<p class=\" text-justify\">Because GUI frames and terminal frames behave differently, I have opted to use a mix of buffer and window commands to represent the pane/window commands as that is ultimately what you are going to use in Emacs. But that’s obviously not the only way of looking at this: if you want to mirror the behavior of <code>screen</code> or <code>tmux</code> you can use Emacs’s frames for some of this:</p>
<table style=\"width:99%;\" class=\" table\">
<colgroup>
<col style=\"width: 25%\">
<col style=\"width: 24%\">
<col style=\"width: 24%\">
<col style=\"width: 24%\">
</colgroup>
<tbody>
<tr class=\"odd\">
<td><strong>Operation</strong></td>
<td><strong>Terminal Emacs Frame</strong></td>
<td><strong>tmux</strong></td>
<td><strong>GNU Screen</strong></td>
</tr>
<tr class=\"even\">
<td>Create new frame</td>
<td><code>C-x 5 2</code></td>
<td><code>C-b c</code> (new window)</td>
<td><code>C-a c</code> (new window)</td>
</tr>
<tr class=\"odd\">
<td>Switch to next frame</td>
<td><code>C-x 5 o</code></td>
<td><code>C-b n</code> (next window)</td>
<td><code>C-a n</code> (next window)</td>
</tr>
<tr class=\"even\">
<td>Previous frame</td>
<td>N/A</td>
<td><code>C-b p</code> (previous window)</td>
<td><code>C-a p</code> (previous window)</td>
</tr>
<tr class=\"odd\">
<td>Close current frame</td>
<td><code>C-x 5 0</code></td>
<td><code>C-b &amp;</code> (kill window)</td>
<td><code>C-a K</code> (kill window)</td>
</tr>
<tr class=\"even\">
<td>Open file in new frame</td>
<td><code>C-x 5 f</code></td>
<td><code>C-b c</code></td>
<td><code>C-a c</code></td>
</tr>
<tr class=\"odd\">
<td>Open buffer in new frame</td>
<td><code>C-x 5 b</code></td>
<td><code>C-b c</code></td>
<td><code>C-a c</code></td>
</tr>
<tr class=\"even\">
<td>List all frames</td>
<td><code>M-x select-frame-by-name</code></td>
<td><code>C-b w</code> (list windows)</td>
<td><code>C-a \"</code> (list windows)</td>
</tr>
<tr class=\"odd\">
<td>Rename current frame</td>
<td><code>M-x set-frame-name</code></td>
<td><code>C-b ,</code> (rename window)</td>
<td><code>C-a A</code> (rename window)</td>
</tr>
</tbody>
</table>
<p class=\" text-justify\">Personally, I think the frame approach is an average facsimile, and that it’s better to just embrace Emacs’s way of doing things, instead of shoehorning frames into the multiplexers’ notion of “windows”.</p>
<p class=\" text-justify\">For that, I recommend you just use <code>M-x tab-bar-mode</code>. Each tab is its own window configuration, and you can interact with tabs in many ways. Note again that tab <em>bars</em> are not like tab <em>lines</em>, the latter being more like a browser’s open tabs.</p>
<table class=\" table\">
<colgroup>
<col style=\"width: 51%\">
<col style=\"width: 48%\">
</colgroup>
<tbody>
<tr class=\"odd\">
<td><strong>Operation</strong></td>
<td><strong>Emacs tab-bar-mode Key Binding</strong></td>
</tr>
<tr class=\"even\">
<td>Enable tab-bar-mode</td>
<td><code>M-x tab-bar-mode</code></td>
</tr>
<tr class=\"odd\">
<td>Create new tab</td>
<td><code>C-x t 2</code> or <code>C-x t n</code></td>
</tr>
<tr class=\"even\">
<td>Close current tab</td>
<td><code>C-x t 0</code> or <code>C-x t k</code></td>
</tr>
<tr class=\"odd\">
<td>Rename current tab</td>
<td><code>C-x t r</code></td>
</tr>
<tr class=\"even\">
<td>Switch to next tab</td>
<td><code>C-x t o</code> or <code>C-TAB</code></td>
</tr>
<tr class=\"odd\">
<td>Switch to previous tab</td>
<td><code>C-S-TAB</code></td>
</tr>
<tr class=\"even\">
<td>Switch to tab by name</td>
<td><code>C-x t RET</code></td>
</tr>
<tr class=\"odd\">
<td>Duplicate current tab</td>
<td><code>C-x t n</code></td>
</tr>
<tr class=\"even\">
<td>List all tabs</td>
<td><code>M-x tab-switcher</code> or <code>M-x tab-list</code></td>
</tr>
<tr class=\"odd\">
<td>Open file in new tab</td>
<td><code>C-x t f</code></td>
</tr>
</tbody>
</table>
<p class=\" text-justify\">So that’s yet another way to do it. This is my preferred approach: it’s consistent across GUI and terminal Emacs, and it’s a more ergonomic way of interacting with window setups in Emacs. It is also a close approximation of how your terminal multiplexer treats distinct “windows”.</p>
<H2 id=\"prefix-keys\">Prefix Keys</H2>
<p class=\" text-justify\">The problem with <code>screen</code> and <code>tmux</code> is that their default prefix keys override two rather useful Emacs key bindings that <a href=\"/article/keyboard-shortcuts-every-command-line-hacker-should-know-about-gnu-readline\" class=\" article-link\">also work everywhere GNU Readline</a> is used: <code>C-a</code>, to move to the beginning of a line; and <code>C-b</code> to move backward a character.</p>
<p class=\" text-justify\">In Emacs, that obviously isn’t a problem, as the key bindings you’ll need are scattered across a range of keys, and in any event, you’ll have full control over the keys available to you inside Emacs and which ones are sent to the underlying process, should you choose to use Emacs as your terminal emulator.</p>
<H2 id=\"scrollback-copying-and-searching\">Scrollback, Copying and Searching</H2>
<p class=\" text-justify\">Emacs is a full-fledged text editor, and it has scrollback everywhere, so there’s not much more to say about that. Selecting (marking) and copying is available everywhere, and Emacs’s terminal emulators can switch from “terminal mode” to “cooked” (meaning it behaves like a regular Emacs buffer with freeform navigation) so you can copy and search as you please. Now is the time mention occur mode, one of many ways of sifting through text. It lets you <a href=\"/article/searching-buffers-occur-mode\" class=\" article-link\">regexp search in Buffers</a> with a handy popup window of the matches. Terminal multiplexers can’t do that without plugins.</p>
<H2 id=\"my-workflow\">My Workflow</H2>
<p class=\" text-justify\">Workflow are personal things, but I’ll quickly talk about how I use Emacs in lieu of a multiplexer.</p>
<ol type=\"1\">
<li><p class=\" text-justify\">I prefer to do everything local to my machine, where feasible.</p>
<p class=\" text-justify\">For remote sessions, I will use <code>ssh</code> in a <code>M-x shell</code> instance (unless I have to interface with curses apps, then I use <code>M-x vterm</code>) and combine it with <a href=\"https://www.gnu.org/software/tramp/\" class=\" article-link\">Tramp</a> for file editing.</p></li>
<li><p class=\" text-justify\">I avoid running Emacs on a remote machine directly because I will always opt for local, as I mentioned in #1. But when I <em>have</em> to, I will run emacs in a client-server architecture. Having said that, it is very rare that I cannot do 90% of my work from my local machine.</p>
<p class=\" text-justify\">For things like docker containers or even talking to kubernetes pods, I can do this with Tramp also. I can also ssh to a bastion host and then onwards to root with <code>sudo</code> and then perhaps into a container with <code>docker</code>. I can bookmark these things in Emacs so I can return to them with the snap of a finger.</p></li>
<li><p class=\" text-justify\">Emacs’s Tramp can execute command line programs remotely for you. If you’re editing a remote file in a buffer, then <code>M-x dired</code> (<code>C-x d</code>) and tools like <code>M-x compile</code>, <code>M-x grep</code>, etc. automatically call out to their remote counterpart and return the results back to your local Emacs instance. Very powerful.</p></li>
<li><p class=\" text-justify\"><code>M-x shell</code> is the right tool for me. It’s a ‘dumb terminal’ in the sense that everything is fed into an Emacs buffer which is then enriched with features such as history, prompt detection, and more. Works great, except when it does not. However, I can live with the tradeoffs. I prefer a free-flowing buffer with all the advantages and disadvantages that brings. For example, I can type <code>M-s h p</code> (<code>M-x highlight-phrase</code>) and highlight stuff in the buffer by regexp. Emacs will highlight current and future instances.</p>
<p class=\" text-justify\">I’m sure you’re thinking of all the many, many instances in your career where you wished you could do such a simple, simple thing like highlight stuff.</p></li>
<li><p class=\" text-justify\">Watching logs and other changing files. Again with Tramp: open the file then <code>M-x auto-revert-mode</code> or <code>M-x auto-revert-tail-mode</code> and Emacs will revert the file when it changes. Simple.</p></li>
</ol>
<p class=\" text-justify\">And that’s just <em>some</em> of the things I do. The main thing to take away from my workflow – and this article – is that things orbit around Emacs, because I am proficient at using Emacs, and it is capable of a great many things.</p>
<p class=\" text-justify\">Honestly? Thrashing around on the command line – no matter your shell, even with nice ones like fish – feels like an enormous step back in productivity compared to using Emacs and regular old bash.</p>
<p class=\" text-justify\">But that’s me. You’ll build your own workflow that meets your needs.</p>
<H2 id=\"conclusion\">Conclusion</H2>
<p class=\" text-justify\">If you’re familiar with Emacs then most of my advice should not come as a surprise to you. If you’re new or still learning, then I hope this will give you some food for thought.</p>
<p class=\" text-justify\">You can pare back your use of your if it makes sense to do so: but most of the day-to-day grind I see <code>tmux</code> users do can easily be done from within Emacs, but with a real gain to your productivity. Switching to Emacs <em>just</em> to replace your terminal multiplexer is perhaps a harder sell, but if you can learn and memorize your multiplexer’s commands, then you’ll do just fine learning Emacs also.</p>
<p class=\" text-justify\">Let me know in the comments if ditching a multiplexer helps (or hinders!) your workflow!</p>
") (guid ((isPermaLink . "false")) "/article/replacing-tmux-gnu-screen-emacs") (pubDate nil "Thu, 06 Mar 2025 10:26:50 +0000")))) ("Combobulate: Interactive Node Editing with Tree-Sitter" "<p class=\" text-justify drop-cap\">Recently, I talked about the challenges around improving <a href=\"/article/combobulate-structured-movement-editing-treesitter\" class=\" article-link\">Combobulate</a>, my package that adds structured editing and movement to Emacs, so navigation is <a href=\"/article/combobulate-intuitive-structured-navigation-treesitter\" class=\" article-link\">intuitive and works the way a human expects</a>. Briefly, instead of relying on elaborate guesswork that breaks easily, there is now a little mini-language that captures how to pluck the right node from the concrete syntax tree provided by tree-sitter, a library that makes it a snap to parse and access said tree of any language for which there is a supported grammar.</p>
<p class=\" text-justify\">Intuitive navigation is hard because if you ask a human developer to navigate up, down, left or right in their code, they can do so effortlessly, as there’s little ambiguity around, say, what constitutes the next “line of code”. Good luck asking a computer to make the right choice when it’s got a baker’s dozen of wildly different nodes to contend with. Hence the mini-language.</p>
<p class=\" text-justify\">But I’ve talked about <a href=\"/article/combobulate-intuitive-structured-navigation-treesitter\" class=\" article-link\">that already</a>. You should read that article first, if you haven’t. So today I’d like to talk about a related issue: when you ask Combobulate to do something – say, cloning the node at point, and in effect duplicating a piece of code – and Combobulate can’t decide which node is the right one, because there’s more than one legitimate node to clone at point.</p>
<p class=\" text-justify\">The problem space is similar to intuitive navigation, but with a twist. When we navigate we have a limited number of sensible directions we can move (up, down, left, right) and the bindings to go with it – <code>C-M-n</code> to move to the next sibling, <code>C-M-u</code> to move up to a parent, etc. – and when we invoke them we’d expect Emacs to just, you know, go to the right place. You don’t <em>really</em> want annoying minibuffer prompts, banners, billboards, smoke signals, crop circles or much of anything else to petition you and impede your train of thought. You just want to scoot away and not have Emacs stop you to ask for directions.</p>
<p class=\" text-justify\">Fair enough. Combobulate goes to a lot of trouble to try and pick the right thing for you in most cases, whether you’re editing or moving. Sometimes, though, you must ask the user to make a choice.</p>
<p class=\" text-justify\">And what’s the best way to do that?</p>
<H2 id=\"decisions-decisions\">Decisions, decisions…</H2>
<figure>
<img src=\"/static/uploads/combobulate/combobulate-python-indent.gif\" alt=\"\" class=\" center-block\">
<figcaption>The indentation 'carousel' in action. Tapping <code>TAB</code> at the start of a statement and Combobulate will calculate all possible indentation levels and let you choose the one you want interactively.</figcaption>
</figure>
<p class=\" text-justify\">It’s a quagmire, really, because I’d had this issue multiple times where I really wanted some way of asking the user to make a choice. I had played around with the obvious contenders: some form of <code>completing-read</code> (Emacs’s way of doing <a href=\"/article/understanding-minibuffer-completion\" class=\" article-link\">minibuffer completion</a>) and a hook to update the buffer as you browse through the candidates. It didn’t really work all that well as it assumes you have a completion system that lets you cruise through the candidates interactively. Not everyone uses that; default Emacs has you <code>TAB</code> endlessly to scratch out a completion like some sort of neolithic farm hand. So that method wouldn’t work well for people who use that type of completion, and it also has the annoying problem of feeling like it was the wrong tool for the job. What if someone uses Helm or any number of other completion systems?</p>
<p class=\" text-justify\">I brainstormed some other methods like a <a href=\"/article/introduction-magit-emacs-mode-git\" class=\" article-link\">Magit</a> transient popup-like thing that you’d pick nodes from, but it also felt cumbersome and I couldn’t figure out how to get transient to do what I wanted it to do.</p>
<p class=\" text-justify\">So I did what I always do: I got bored and went off in search of something else to do.</p>
<p class=\" text-justify\">Right around that time I’d added a primitive version of “expand region”. It is a simple concept, really: given successive key presses, expand the region to incorporate larger and larger structural elements, starting from point. It’s a nifty way of picking things that ordinary Emacs methods struggle to do well at, though I never cared much for it pre-tree-sitter as I found it too imprecise. Lots of people love it, though, and I figured that it’d be super handy with tree-sitter, as it’s so granular, and I wanted to support a wide range of workflows. So I added a basic version in about 30 minutes, and off it went to Github.</p>
<figure>
<img src=\"/static/uploads/combobulate/combobulate-expand-region.gif\" alt=\"\" class=\" center-block\">
<figcaption>Combobulate can expand the region with <code>M-h</code>. It highlights the item ahead of the current region,  to give you an idea of where you are going. A customizable feature to let you select by number is also enabled here, and Combobulate will show you how much it has selected in the tree view as well.</figcaption>
</figure>
<p class=\" text-justify\">A few days later I got a polite and <em>totally obvious in hindsight</em> request to make possible to <em>shrink</em> the region. It’s all too easy to overshoot your mark as you’re tapping away and, having done so, you’d have no recourse but to start from scratch. Argh. Terrible UX!</p>
<p class=\" text-justify\">So I put on my thinking cap and started wondering how I could crowbar something into <code>combobulate-mark-node-dwim</code> (bound to <code>M-h</code>) so it can toggle the direction and, I… I realized I should just re-use <em>another</em> feature I’d added some months prior: a node / region-based indentation command in Python that lets you interactively browse and select the indentation level you want your node or region to have. (Believe it or not, but Emacs’s crummy Python mode can’t cycle all possible indentations of a region. It’s madness. The crux of the code to build it is <em>right there</em>, too. No TS required at all.)</p>
<p class=\" text-justify\">The python indentation command (see above) acts like a carousel: keep moving in one or the other direction and you’ll wind up back where you started. That’s great for a wide range of things, particularly when you’re not sure how many finger taps away something is: is it two or <em>three</em> indentations I want? Tap a bit and find out, as your buffer updates automatically.</p>
<p class=\" text-justify\">The indentation command was also a bit ham fisted in some ways, but it was a huge improvement over the ghastly python-mode indentation logic you had before which involved manual tedium and <code>C-x TAB</code> to indent by column.</p>
<p class=\" text-justify\">I gambled that if I could file off the rough edges, and build some tooling around it into Combobulate, it could work well for a wide range of tasks. I sat down and spent a fair bit of time hammering out a system of rules and concepts that makes for, I think, a pleasant user experience. Carousel seems like as good a name for it as anything, so that’s what I’ll call it from now on.</p>
<p class=\" text-justify\">If you’re already using Combobulate you’ll of course be familiar with the carousel concept already as it’s been in Combobulate for quite a while.</p>
<H3 id=\"reading-a-key-vs-minibuffer-prompting\">Reading a Key vs Minibuffer Prompting</H3>
<p class=\" text-justify\">Let me explain. There’s a philosophical view (and some who disagree with this) that certain user-facing actions in Emacs don’t require a full-blown <em>minibuffer prompt</em> and that <em>reading a key</em> is enough. Which one is the right choice is rarely too contentious, but in a few instances you could lean towards either method, and that’s usually where tempers flash.</p>
<p class=\" text-justify\">Reading a key is mechanically simple: you call <code>read-key</code> (or one of its close relatives) and Emacs will patiently wait for a <em>key</em>; any key or key sequence, really. There is no minibuffer history to contend with; recursive minibuffers don’t apply, so you can’t switch out of the minibuffer window, either. You can display a prompt, but the main focus is really about user anticipation: once you know how the command works, and you know it expects a key, you just type it and get on with it. It is about as zero-effort as requesting user input could ever be. It’s used in a wide range of contexts in Emacs today, and it’s perfect when all you need from a user is a key.</p>
<p class=\" text-justify\">The alternative is <em>minibuffer prompting</em> which is the all-singing, all-dancing prompt experience you know already.</p>
<p class=\" text-justify\">I want Combobulate’s carousel to read a key: the reason is that it means I can capture the key you typed and, if I decide I have no use for it, I can put the key back on the <code>unread-command-events</code>. I could in theory still do that with the minibuffer prompt, but I still have to deal with the fact that it’s a complex system designed for non-trivial user interactions.</p>
<p class=\" text-justify\">Reading a key is simpler, and that’s important because it meshes well with the idea that the carousel is there to offer a seamless transition in to, and out of it.</p>
<H3 id=\"seamless-transition\">Seamless transition</H3>
<p class=\" text-justify\">If you want to expand the region with <code>M-h</code>, you probably want to follow that up with another key. Perhaps <code>C-w</code> to kill the region you just expanded. By <em>reading the key</em> I can separate <code>TAB</code> and <code>S-TAB</code> (to cycle to the next and previous choice in the carousel) from irrelevant keys the carousel does not care about. Then, by putting the key the carousel <em>does not</em> care about back into the event loop, you can have Emacs carry out what ever it was going to do as though the carousel wasn’t there at all.</p>
<p class=\" text-justify\">End result? You can hit <code>M-h</code> and tap, tap, tap and press any other key that is not recognized by the carousel, and it’ll just execute the key as though you’d never had the carousel at all. No transition; no annoying in-your-face “are you really sure?” prompting; and no thinking required. It behaves the way an experienced Emacs user would expect it to work, and as if you never had the carousel active, even though, there it is, indicating in the echo area that it’s active and awaiting your input.</p>
<H3 id=\"maintaining-your-tempo\">Maintaining your tempo</H3>
<p class=\" text-justify\">I mentioned that <code>TAB</code> and <code>S-TAB</code> cycle nodes. But if you tap, say, <code>M-h</code> for the first time, the carousel interface appears, and you can then repeatedly type <code>M-h</code> again which is the same as pressing <code>TAB</code>. That way you don’t have to move your fingers away from the triggering key and that helps preserve tempo. It makes for a smoother and easier user experience as you don’t have to context shift: oh I hit <code>M-h</code> and now I have to <code>TAB</code> to expand.</p>
<p class=\" text-justify\">Because I look up the key in a boring, old <a href=\"/article/mastering-key-bindings-emacs\" class=\" article-link\">keymap</a> it’s easy for anyone to come along and modify it if they want the carousel to use other keys. It also means I can add additional keys that only apply to specific commands: Combobulate’s expand region functionality lets you cycle between the next and previous candidates with <code>M-h</code> and <code>M-S-h</code>, respectively.</p>
<p class=\" text-justify\">The third reason why it’s useful to have the same key is that some operations are incredibly destructive and may leave your buffer in a “broken” state: the syntax is invalid, and tree-sitter may struggle to glue it back together. Having a cohesive view of the buffer at the beginning and operating on it from a clean slate is crucial.</p>
<H3 id=\"cohesion\">Cohesion</H3>
<p class=\" text-justify\">Let’s say you’re deleting code as part of a refactoring operation you’re doing. As you go about doing it, you’re definitely going to leave your code in a broken state at some point. That’s all well and good: you’re a human, and you can fix it.</p>
<p class=\" text-justify\">Tree-sitter has error-correction built into its parser, but just because it can mend, and partially recover from, broken syntax, does not mean it leaves the resulting tree in a state where an automated tool like Combobulate can make sensible decisions.</p>
<p class=\" text-justify\">That’s particularly true of highly destructive operations like Combobulate’s <em>splicing</em> where you’re eliding text as you try to snip and glue two pieces of code back together: the code you’ve decided to keep, and the code <em>around</em> the code you’re keeping that the splice deleted. Think of HTML where you want to delete the outer tag but keep the things inside it - that’s one part of what you can do with splicing.</p>
<p class=\" text-justify\">The problem is, maybe you want to splice two times, but the first splice irrevocably breaks your code in such a way that you’d never be able to make it to the second splice. And how do you delete the “outer” something of any old random piece of code, anyway? Take a look at the figure below to see what I mean.</p>
<figure>
<img src=\"/static/uploads/combobulate/combobulate-splice-go.gif\" alt=\"\" class=\" center-block\">
<figcaption><code>M-&lt;up&gt;</code> splices up, keeping the siblings, which in this case is one line of code, and then deletes successive parents until it's at the root of the buffer. Note that along the way it leaves the tree in a broken state.</figcaption>
</figure>
<p class=\" text-justify\">Combobulate can splice nearly anything into something else. But that doesn’t mean it makes <em>syntactic sense</em> to do so. Maybe you do want it in a broken state; perhaps you want to tweak something to make it legal syntax again. Combobulate can’t read your mind so it has to calculate all possible paths.</p>
<p class=\" text-justify\">If the splice up command – as it used to do – only went up one level, you could easily break the tree in such a way that you wouldn’t be able to splice again. A broken tree often begets an even more broken tree.</p>
<p class=\" text-justify\">To work around <em>that</em>, the carousel virtualizes editing and computes everything on the fly, starting from the clean slate your buffer is (presumably!) in when you first initiate the command.</p>
<H3 id=\"virtualized-editing\">Virtualized Editing</H3>
<figure>
<img src=\"/static/uploads/combobulate/combobulate-clone-dwim.gif\" alt=\"\" class=\" center-block\">
<figcaption><code>C-c o c</code> clones a node and, if there are ambiguities, Combobulate will let you cycle through all the choices and interactively preview the change it'll make to your buffer.</figcaption>
</figure>
<p class=\" text-justify\">This was one of the harder things to build.</p>
<p class=\" text-justify\">Tree-sitter generates your tree on-the-fly as you type. Every key press compels tree-sitter to rebuild all or parts of the tree. That is its main benefit, and a lot of work was put into making it fast enough for even the fastest typist to not experience any lag or latency.</p>
<p class=\" text-justify\">Unfortunately, if you ask for a node and subsequently edit the buffer, that node is invalidated and marked outdated. If you try to do anything with it – anything at all, even asking it for its type or where it was in the buffer – it throws an error in your face.</p>
<p class=\" text-justify\">So you can’t collect the node(s) you want at the start and then modify the buffer in-situ, like the indentation example above shows. The first tap would kill the old nodes (we changed the indentation!), and render that approach useless.</p>
<p class=\" text-justify\">Combobulate constructs proxy nodes, and almost every part of Combobulate will accept these proxy nodes in lieu of the real deal. They are slimmed-down versions of the real things, but they reify the most important things we’d want to cling to: the point range in the buffer; the type; the text contained therein; etc.</p>
<p class=\" text-justify\">So when you ask Combobulate to present a carousel it actually virtualizes the nodes before any sort of change can take place. It neatly skirts most issues and lets you write code that can in theory modify the buffer without worrying about your nodes expiring when you touch the buffer. Of course, modifying the buffer means you hold on to outdated information, and Combobulate is no oracle, so if you make substantial changes, the proxy nodes might be thoroughly useless.</p>
<p class=\" text-justify\">Luckily, that’s usually not a problem because of Combobulate’s refactoring display system.</p>
<p class=\" text-justify\">Part of the challenge around the proxy node thing is that most commands do small, localized editing operations: indent some code; expand an envelope; splice some code; clone a node. You get the idea.</p>
<p class=\" text-justify\">As you tap through the carousel’s list of valid nodes, it should show you what would happen if the transformation you asked for is carried out on the currently selected node.</p>
<p class=\" text-justify\">For this to work well, the carousel works in unison with Combobulate’s refactoring system. The latter sounds fancier than it really is: all it lets you do is describe simple transformations, and visual ones to aid users, to make to a buffer. Add in the carousel’s ability to use <em>undo change groups</em> to revert buffer changes between choices and you can have visible modifications made to your buffer that is properly restored as you cycle through the choices.</p>
<p class=\" text-justify\">I think it’s important that, if you ask a command to make changes to your buffer, and if there’s more than one way to make that change, that you can preview all possible options. Combine it with the carousel interface and you’re afforded a fair amount of slop when it comes to point positioning.</p>
<p class=\" text-justify\">And if you don’t like the change? You can hit <code>C-g</code>, as with most things in Emacs, to abort the command.</p>
<p class=\" text-justify\">So that’s the carousel interface. I think it makes it much easier to visualize what’s going to happen in a non-committal way, and at the same time scroll through the valid node choices available to you.</p>" "https://www.masteringemacs.org/article/combobulate-interactive-node-editing-treesitter?utm_source=newsletter&utm_medium=rss" (26110 57718) new 1 nil nil ((title nil "Combobulate: Interactive Node Editing with Tree-Sitter") (link nil "https://www.masteringemacs.org/article/combobulate-interactive-node-editing-treesitter?utm_source=newsletter&utm_medium=rss") (description nil "Editing code using a concrete syntax tree may seem straightforward, but it's a complex task fraught with challenges. For every command that modifies the code, there's ample room for ambiguity. What if there are multiple legal choices available? How do you create a user experience in Emacs that not only displays the intended changes but also caters to the needs of power users seamlessly? Here I talk about how I've solved that problem in Combobulate.") (encoded nil "
<p class=\" text-justify drop-cap\">Recently, I talked about the challenges around improving <a href=\"/article/combobulate-structured-movement-editing-treesitter\" class=\" article-link\">Combobulate</a>, my package that adds structured editing and movement to Emacs, so navigation is <a href=\"/article/combobulate-intuitive-structured-navigation-treesitter\" class=\" article-link\">intuitive and works the way a human expects</a>. Briefly, instead of relying on elaborate guesswork that breaks easily, there is now a little mini-language that captures how to pluck the right node from the concrete syntax tree provided by tree-sitter, a library that makes it a snap to parse and access said tree of any language for which there is a supported grammar.</p>
<p class=\" text-justify\">Intuitive navigation is hard because if you ask a human developer to navigate up, down, left or right in their code, they can do so effortlessly, as there’s little ambiguity around, say, what constitutes the next “line of code”. Good luck asking a computer to make the right choice when it’s got a baker’s dozen of wildly different nodes to contend with. Hence the mini-language.</p>
<p class=\" text-justify\">But I’ve talked about <a href=\"/article/combobulate-intuitive-structured-navigation-treesitter\" class=\" article-link\">that already</a>. You should read that article first, if you haven’t. So today I’d like to talk about a related issue: when you ask Combobulate to do something – say, cloning the node at point, and in effect duplicating a piece of code – and Combobulate can’t decide which node is the right one, because there’s more than one legitimate node to clone at point.</p>
<p class=\" text-justify\">The problem space is similar to intuitive navigation, but with a twist. When we navigate we have a limited number of sensible directions we can move (up, down, left, right) and the bindings to go with it – <code>C-M-n</code> to move to the next sibling, <code>C-M-u</code> to move up to a parent, etc. – and when we invoke them we’d expect Emacs to just, you know, go to the right place. You don’t <em>really</em> want annoying minibuffer prompts, banners, billboards, smoke signals, crop circles or much of anything else to petition you and impede your train of thought. You just want to scoot away and not have Emacs stop you to ask for directions.</p>
<p class=\" text-justify\">Fair enough. Combobulate goes to a lot of trouble to try and pick the right thing for you in most cases, whether you’re editing or moving. Sometimes, though, you must ask the user to make a choice.</p>
<p class=\" text-justify\">And what’s the best way to do that?</p>
<H2 id=\"decisions-decisions\">Decisions, decisions…</H2>
<figure>
<img src=\"/static/uploads/combobulate/combobulate-python-indent.gif\" alt=\"\" class=\" center-block\">
<figcaption>The indentation 'carousel' in action. Tapping <code>TAB</code> at the start of a statement and Combobulate will calculate all possible indentation levels and let you choose the one you want interactively.</figcaption>
</figure>
<p class=\" text-justify\">It’s a quagmire, really, because I’d had this issue multiple times where I really wanted some way of asking the user to make a choice. I had played around with the obvious contenders: some form of <code>completing-read</code> (Emacs’s way of doing <a href=\"/article/understanding-minibuffer-completion\" class=\" article-link\">minibuffer completion</a>) and a hook to update the buffer as you browse through the candidates. It didn’t really work all that well as it assumes you have a completion system that lets you cruise through the candidates interactively. Not everyone uses that; default Emacs has you <code>TAB</code> endlessly to scratch out a completion like some sort of neolithic farm hand. So that method wouldn’t work well for people who use that type of completion, and it also has the annoying problem of feeling like it was the wrong tool for the job. What if someone uses Helm or any number of other completion systems?</p>
<p class=\" text-justify\">I brainstormed some other methods like a <a href=\"/article/introduction-magit-emacs-mode-git\" class=\" article-link\">Magit</a> transient popup-like thing that you’d pick nodes from, but it also felt cumbersome and I couldn’t figure out how to get transient to do what I wanted it to do.</p>
<p class=\" text-justify\">So I did what I always do: I got bored and went off in search of something else to do.</p>
<p class=\" text-justify\">Right around that time I’d added a primitive version of “expand region”. It is a simple concept, really: given successive key presses, expand the region to incorporate larger and larger structural elements, starting from point. It’s a nifty way of picking things that ordinary Emacs methods struggle to do well at, though I never cared much for it pre-tree-sitter as I found it too imprecise. Lots of people love it, though, and I figured that it’d be super handy with tree-sitter, as it’s so granular, and I wanted to support a wide range of workflows. So I added a basic version in about 30 minutes, and off it went to Github.</p>
<figure>
<img src=\"/static/uploads/combobulate/combobulate-expand-region.gif\" alt=\"\" class=\" center-block\">
<figcaption>Combobulate can expand the region with <code>M-h</code>. It highlights the item ahead of the current region,  to give you an idea of where you are going. A customizable feature to let you select by number is also enabled here, and Combobulate will show you how much it has selected in the tree view as well.</figcaption>
</figure>
<p class=\" text-justify\">A few days later I got a polite and <em>totally obvious in hindsight</em> request to make possible to <em>shrink</em> the region. It’s all too easy to overshoot your mark as you’re tapping away and, having done so, you’d have no recourse but to start from scratch. Argh. Terrible UX!</p>
<p class=\" text-justify\">So I put on my thinking cap and started wondering how I could crowbar something into <code>combobulate-mark-node-dwim</code> (bound to <code>M-h</code>) so it can toggle the direction and, I… I realized I should just re-use <em>another</em> feature I’d added some months prior: a node / region-based indentation command in Python that lets you interactively browse and select the indentation level you want your node or region to have. (Believe it or not, but Emacs’s crummy Python mode can’t cycle all possible indentations of a region. It’s madness. The crux of the code to build it is <em>right there</em>, too. No TS required at all.)</p>
<p class=\" text-justify\">The python indentation command (see above) acts like a carousel: keep moving in one or the other direction and you’ll wind up back where you started. That’s great for a wide range of things, particularly when you’re not sure how many finger taps away something is: is it two or <em>three</em> indentations I want? Tap a bit and find out, as your buffer updates automatically.</p>
<p class=\" text-justify\">The indentation command was also a bit ham fisted in some ways, but it was a huge improvement over the ghastly python-mode indentation logic you had before which involved manual tedium and <code>C-x TAB</code> to indent by column.</p>
<p class=\" text-justify\">I gambled that if I could file off the rough edges, and build some tooling around it into Combobulate, it could work well for a wide range of tasks. I sat down and spent a fair bit of time hammering out a system of rules and concepts that makes for, I think, a pleasant user experience. Carousel seems like as good a name for it as anything, so that’s what I’ll call it from now on.</p>
<p class=\" text-justify\">If you’re already using Combobulate you’ll of course be familiar with the carousel concept already as it’s been in Combobulate for quite a while.</p>
<H3 id=\"reading-a-key-vs-minibuffer-prompting\">Reading a Key vs Minibuffer Prompting</H3>
<p class=\" text-justify\">Let me explain. There’s a philosophical view (and some who disagree with this) that certain user-facing actions in Emacs don’t require a full-blown <em>minibuffer prompt</em> and that <em>reading a key</em> is enough. Which one is the right choice is rarely too contentious, but in a few instances you could lean towards either method, and that’s usually where tempers flash.</p>
<p class=\" text-justify\">Reading a key is mechanically simple: you call <code>read-key</code> (or one of its close relatives) and Emacs will patiently wait for a <em>key</em>; any key or key sequence, really. There is no minibuffer history to contend with; recursive minibuffers don’t apply, so you can’t switch out of the minibuffer window, either. You can display a prompt, but the main focus is really about user anticipation: once you know how the command works, and you know it expects a key, you just type it and get on with it. It is about as zero-effort as requesting user input could ever be. It’s used in a wide range of contexts in Emacs today, and it’s perfect when all you need from a user is a key.</p>
<p class=\" text-justify\">The alternative is <em>minibuffer prompting</em> which is the all-singing, all-dancing prompt experience you know already.</p>
<p class=\" text-justify\">I want Combobulate’s carousel to read a key: the reason is that it means I can capture the key you typed and, if I decide I have no use for it, I can put the key back on the <code>unread-command-events</code>. I could in theory still do that with the minibuffer prompt, but I still have to deal with the fact that it’s a complex system designed for non-trivial user interactions.</p>
<p class=\" text-justify\">Reading a key is simpler, and that’s important because it meshes well with the idea that the carousel is there to offer a seamless transition in to, and out of it.</p>
<H3 id=\"seamless-transition\">Seamless transition</H3>
<p class=\" text-justify\">If you want to expand the region with <code>M-h</code>, you probably want to follow that up with another key. Perhaps <code>C-w</code> to kill the region you just expanded. By <em>reading the key</em> I can separate <code>TAB</code> and <code>S-TAB</code> (to cycle to the next and previous choice in the carousel) from irrelevant keys the carousel does not care about. Then, by putting the key the carousel <em>does not</em> care about back into the event loop, you can have Emacs carry out what ever it was going to do as though the carousel wasn’t there at all.</p>
<p class=\" text-justify\">End result? You can hit <code>M-h</code> and tap, tap, tap and press any other key that is not recognized by the carousel, and it’ll just execute the key as though you’d never had the carousel at all. No transition; no annoying in-your-face “are you really sure?” prompting; and no thinking required. It behaves the way an experienced Emacs user would expect it to work, and as if you never had the carousel active, even though, there it is, indicating in the echo area that it’s active and awaiting your input.</p>
<H3 id=\"maintaining-your-tempo\">Maintaining your tempo</H3>
<p class=\" text-justify\">I mentioned that <code>TAB</code> and <code>S-TAB</code> cycle nodes. But if you tap, say, <code>M-h</code> for the first time, the carousel interface appears, and you can then repeatedly type <code>M-h</code> again which is the same as pressing <code>TAB</code>. That way you don’t have to move your fingers away from the triggering key and that helps preserve tempo. It makes for a smoother and easier user experience as you don’t have to context shift: oh I hit <code>M-h</code> and now I have to <code>TAB</code> to expand.</p>
<p class=\" text-justify\">Because I look up the key in a boring, old <a href=\"/article/mastering-key-bindings-emacs\" class=\" article-link\">keymap</a> it’s easy for anyone to come along and modify it if they want the carousel to use other keys. It also means I can add additional keys that only apply to specific commands: Combobulate’s expand region functionality lets you cycle between the next and previous candidates with <code>M-h</code> and <code>M-S-h</code>, respectively.</p>
<p class=\" text-justify\">The third reason why it’s useful to have the same key is that some operations are incredibly destructive and may leave your buffer in a “broken” state: the syntax is invalid, and tree-sitter may struggle to glue it back together. Having a cohesive view of the buffer at the beginning and operating on it from a clean slate is crucial.</p>
<H3 id=\"cohesion\">Cohesion</H3>
<p class=\" text-justify\">Let’s say you’re deleting code as part of a refactoring operation you’re doing. As you go about doing it, you’re definitely going to leave your code in a broken state at some point. That’s all well and good: you’re a human, and you can fix it.</p>
<p class=\" text-justify\">Tree-sitter has error-correction built into its parser, but just because it can mend, and partially recover from, broken syntax, does not mean it leaves the resulting tree in a state where an automated tool like Combobulate can make sensible decisions.</p>
<p class=\" text-justify\">That’s particularly true of highly destructive operations like Combobulate’s <em>splicing</em> where you’re eliding text as you try to snip and glue two pieces of code back together: the code you’ve decided to keep, and the code <em>around</em> the code you’re keeping that the splice deleted. Think of HTML where you want to delete the outer tag but keep the things inside it - that’s one part of what you can do with splicing.</p>
<p class=\" text-justify\">The problem is, maybe you want to splice two times, but the first splice irrevocably breaks your code in such a way that you’d never be able to make it to the second splice. And how do you delete the “outer” something of any old random piece of code, anyway? Take a look at the figure below to see what I mean.</p>
<figure>
<img src=\"/static/uploads/combobulate/combobulate-splice-go.gif\" alt=\"\" class=\" center-block\">
<figcaption><code>M-&lt;up&gt;</code> splices up, keeping the siblings, which in this case is one line of code, and then deletes successive parents until it's at the root of the buffer. Note that along the way it leaves the tree in a broken state.</figcaption>
</figure>
<p class=\" text-justify\">Combobulate can splice nearly anything into something else. But that doesn’t mean it makes <em>syntactic sense</em> to do so. Maybe you do want it in a broken state; perhaps you want to tweak something to make it legal syntax again. Combobulate can’t read your mind so it has to calculate all possible paths.</p>
<p class=\" text-justify\">If the splice up command – as it used to do – only went up one level, you could easily break the tree in such a way that you wouldn’t be able to splice again. A broken tree often begets an even more broken tree.</p>
<p class=\" text-justify\">To work around <em>that</em>, the carousel virtualizes editing and computes everything on the fly, starting from the clean slate your buffer is (presumably!) in when you first initiate the command.</p>
<H3 id=\"virtualized-editing\">Virtualized Editing</H3>
<figure>
<img src=\"/static/uploads/combobulate/combobulate-clone-dwim.gif\" alt=\"\" class=\" center-block\">
<figcaption><code>C-c o c</code> clones a node and, if there are ambiguities, Combobulate will let you cycle through all the choices and interactively preview the change it'll make to your buffer.</figcaption>
</figure>
<p class=\" text-justify\">This was one of the harder things to build.</p>
<p class=\" text-justify\">Tree-sitter generates your tree on-the-fly as you type. Every key press compels tree-sitter to rebuild all or parts of the tree. That is its main benefit, and a lot of work was put into making it fast enough for even the fastest typist to not experience any lag or latency.</p>
<p class=\" text-justify\">Unfortunately, if you ask for a node and subsequently edit the buffer, that node is invalidated and marked outdated. If you try to do anything with it – anything at all, even asking it for its type or where it was in the buffer – it throws an error in your face.</p>
<p class=\" text-justify\">So you can’t collect the node(s) you want at the start and then modify the buffer in-situ, like the indentation example above shows. The first tap would kill the old nodes (we changed the indentation!), and render that approach useless.</p>
<p class=\" text-justify\">Combobulate constructs proxy nodes, and almost every part of Combobulate will accept these proxy nodes in lieu of the real deal. They are slimmed-down versions of the real things, but they reify the most important things we’d want to cling to: the point range in the buffer; the type; the text contained therein; etc.</p>
<p class=\" text-justify\">So when you ask Combobulate to present a carousel it actually virtualizes the nodes before any sort of change can take place. It neatly skirts most issues and lets you write code that can in theory modify the buffer without worrying about your nodes expiring when you touch the buffer. Of course, modifying the buffer means you hold on to outdated information, and Combobulate is no oracle, so if you make substantial changes, the proxy nodes might be thoroughly useless.</p>
<p class=\" text-justify\">Luckily, that’s usually not a problem because of Combobulate’s refactoring display system.</p>
<p class=\" text-justify\">Part of the challenge around the proxy node thing is that most commands do small, localized editing operations: indent some code; expand an envelope; splice some code; clone a node. You get the idea.</p>
<p class=\" text-justify\">As you tap through the carousel’s list of valid nodes, it should show you what would happen if the transformation you asked for is carried out on the currently selected node.</p>
<p class=\" text-justify\">For this to work well, the carousel works in unison with Combobulate’s refactoring system. The latter sounds fancier than it really is: all it lets you do is describe simple transformations, and visual ones to aid users, to make to a buffer. Add in the carousel’s ability to use <em>undo change groups</em> to revert buffer changes between choices and you can have visible modifications made to your buffer that is properly restored as you cycle through the choices.</p>
<p class=\" text-justify\">I think it’s important that, if you ask a command to make changes to your buffer, and if there’s more than one way to make that change, that you can preview all possible options. Combine it with the carousel interface and you’re afforded a fair amount of slop when it comes to point positioning.</p>
<p class=\" text-justify\">And if you don’t like the change? You can hit <code>C-g</code>, as with most things in Emacs, to abort the command.</p>
<p class=\" text-justify\">So that’s the carousel interface. I think it makes it much easier to visualize what’s going to happen in a non-committal way, and at the same time scroll through the valid node choices available to you.</p>
") (guid ((isPermaLink . "false")) "/article/combobulate-interactive-node-editing-treesitter") (pubDate nil "Sat, 23 Mar 2024 14:04:38 +0000"))) ("The Emacs 29 Edition of Mastering Emacs is out now" "<p class=\" text-justify drop-cap\">It’s taken a little bit longer than I would have liked to get the next edition out the door. I also felt the site needed a lick of paint which, if you’re a regular and astute reader, you may have noticed already.</p>
<p class=\" text-justify\">But as I explain in the book update below, the two headline features are tree-sitter support and Eglot. To say nothing of the <a href=\"/article/whats-new-in-emacs-29-1\" class=\" article-link\">million other new Emacs 29.1 features</a> that were added.</p>
<p class=\" text-justify\">A couple of years ago, I wrote about <a href=\"/article/tree-sitter-complications-of-parsing-languages\" class=\" article-link\">Tree Sitter and the Complications of Parsing Languages</a>. In it, I talk about the immense difficulties around parsing languages in a way that is both useful and consistent for a wide range of programming languages and structured texts. Tree-sitter is one of the few that have managed to cross that chasm; no small feat, in my opinion.</p>
<p class=\" text-justify\">The other major inclusion is Eglot. It’s another smart and sensible addition to Emacs core. Combined with tree-sitter, you now have access to top-notch syntax highlighting and IDE-like features right out of the box.</p>
<H2 id=\"edition-update\">2024 Edition Update</H2>
<p class=\" text-justify\"><em>This is 2024 Edition update the excerpt from the book.</em></p>
<p class=\" text-justify\">Emacs 29 continues the long-running trend of keeping up with advances in technology. That is commendable. Emacs is an old piece of software, and yet it is continuously improving.</p>
<p class=\" text-justify\">One of the hardest things to get right in a text editor is syntax highlighting (<em>font locking</em> in Emacs parlance) and writing a robust indentation engine. You see, when Emacs – and many other editors, old and new – syntax highlight your source code, they do so using <em>regular expressions</em>, a terse method for matching text using pattern matching. Regular expressions are great; they’re a succinct way of matching and extracting important information from text. They are the backbone of syntax highlighters nearly everywhere, but they also have a flaw: they can be imprecise, and can impede performance if they are poorly written.</p>
<p class=\" text-justify\">A regular expression also cannot contextualize what it is matching: just that it did (or did not) match something. For a wide range of granular tasks, it is simply not possible to rely on regular expressions. That is a problem as you want as much precision as you can get. Yet it’s often impossible to tell some things apart with a regular expression, such as whether a series of characters is a variable or a function call. The same series of characters may have one meaning in one context, and an altogether different one in another. Regular expressions are rarely powerful enough to capture that nuance. And so most text editors build their syntax highlighting and indentation engines with a medley of regular expressions and hand-tuned, imperative code to try to work around the limitations of the former.</p>
<p class=\" text-justify\">Good news, then, as Emacs 29 adds optional support for <a href=\"/article/how-to-get-started-tree-sitter\" class=\" article-link\">tree-sitter</a>, a parser library with an exacting eye for source code parsing that constructs a <em>Concrete Syntax Tree</em> from any text for which it has a valid grammar. Such a tree is the perfect medium for a computer (or willing user) to query. It makes correct syntax highlighting possible with little more than a few dozen lines of code. It also adds the tantalizing promise of <em>structured editing and movement</em>, a sprawling concept that reuses the tree-like structure tree-sitter yields to offer unparalleled editing and movement in your code base.</p>
<p class=\" text-justify\">Tree-sitter’s not the only game in town. What it <em>does</em> bring to the table, and what has eluded most other attempts (in Emacs and beyond), is that is has the largest repository of parsers for both common and uncommon languages and structured text files. Tree-sitter is thus capable <em>and</em> popular. It helps that it is quite straightforward to write your own parser using tree-sitter’s tooling. The cherry on top is a query language to quickly find and match segments of the parsed <em>tree</em> that it emits. That is perhaps its ace in the hole: being able to ask it to show you (for example) all the functions that contain one or more variables with a given name is a powerful feature indeed. Modeled on LISP’s S-expressions, the query language also feels right at home in an Emacs ecosystem.</p>
<p class=\" text-justify\">Presently, the feature is optional, as you must compile Emacs with tree-sitter support. So it is unlikely to replace, wholesale, the existing major modes and the old way of doing things. But it’s a large step forward for Emacs, as it makes writing syntax highlighting and indentation code <a href=\"/article/lets-write-a-treesitter-major-mode\" class=\" article-link\">downright easy</a>. Its adoption into Emacs core is a positive development, and a repudiation against the entrenched belief that Emacs can never fundamentally change. <em>Font locking</em> in Emacs was first introduced around 35 years ago, and now there is a new way – and often much better way – than the old regular expressions. Its successful integration into Emacs is also reflected in the wider Emacs community where it has proven to be a popular feature, despite the fact that tree-sitter is, being new to Emacs, cumbersome to set up and use.</p>
<p class=\" text-justify\">The other major inclusion is Eglot, a client that understands the language server protocol (LSP). Eglot adds IDE-like features to any buffer for which there is a language server available. It’s designed to work with nothing more than base Emacs and the requisite language server. Provided you’ve got your language server set up, all you need to type is <code>M-x eglot</code> (or select <code>Tools -&gt; Language Server Support</code>) to get started. Eglot’s been around for a long time on <a href=\"http://elpa.gnu.org/\" class=\" article-link\">ELPA</a>, an Emacs package repository. Now it’s built into Emacs.</p>
<p class=\" text-justify\">Both capabilities are capstones in an otherwise packed release full of exciting improvements and fixes. If you’re not using Emacs 29 already, you should definitely upgrade.</p>" "https://www.masteringemacs.org/article/the-emacs-29-edition-of-mastering-emacs-out-now?utm_source=newsletter&utm_medium=rss" (26270 27136) new 2 nil nil ((title nil " The Emacs 29 Edition of Mastering Emacs is out now") (link nil "https://www.masteringemacs.org/article/the-emacs-29-edition-of-mastering-emacs-out-now?utm_source=newsletter&utm_medium=rss") (description nil "The Emacs 29 edition of Mastering Emacs is now available.") (encoded nil "
<p class=\" text-justify drop-cap\">It’s taken a little bit longer than I would have liked to get the next edition out the door. I also felt the site needed a lick of paint which, if you’re a regular and astute reader, you may have noticed already.</p>
<p class=\" text-justify\">But as I explain in the book update below, the two headline features are tree-sitter support and Eglot. To say nothing of the <a href=\"/article/whats-new-in-emacs-29-1\" class=\" article-link\">million other new Emacs 29.1 features</a> that were added.</p>
<p class=\" text-justify\">A couple of years ago, I wrote about <a href=\"/article/tree-sitter-complications-of-parsing-languages\" class=\" article-link\">Tree Sitter and the Complications of Parsing Languages</a>. In it, I talk about the immense difficulties around parsing languages in a way that is both useful and consistent for a wide range of programming languages and structured texts. Tree-sitter is one of the few that have managed to cross that chasm; no small feat, in my opinion.</p>
<p class=\" text-justify\">The other major inclusion is Eglot. It’s another smart and sensible addition to Emacs core. Combined with tree-sitter, you now have access to top-notch syntax highlighting and IDE-like features right out of the box.</p>
<H2 id=\"edition-update\">2024 Edition Update</H2>
<p class=\" text-justify\"><em>This is 2024 Edition update the excerpt from the book.</em></p>
<p class=\" text-justify\">Emacs 29 continues the long-running trend of keeping up with advances in technology. That is commendable. Emacs is an old piece of software, and yet it is continuously improving.</p>
<p class=\" text-justify\">One of the hardest things to get right in a text editor is syntax highlighting (<em>font locking</em> in Emacs parlance) and writing a robust indentation engine. You see, when Emacs – and many other editors, old and new – syntax highlight your source code, they do so using <em>regular expressions</em>, a terse method for matching text using pattern matching. Regular expressions are great; they’re a succinct way of matching and extracting important information from text. They are the backbone of syntax highlighters nearly everywhere, but they also have a flaw: they can be imprecise, and can impede performance if they are poorly written.</p>
<p class=\" text-justify\">A regular expression also cannot contextualize what it is matching: just that it did (or did not) match something. For a wide range of granular tasks, it is simply not possible to rely on regular expressions. That is a problem as you want as much precision as you can get. Yet it’s often impossible to tell some things apart with a regular expression, such as whether a series of characters is a variable or a function call. The same series of characters may have one meaning in one context, and an altogether different one in another. Regular expressions are rarely powerful enough to capture that nuance. And so most text editors build their syntax highlighting and indentation engines with a medley of regular expressions and hand-tuned, imperative code to try to work around the limitations of the former.</p>
<p class=\" text-justify\">Good news, then, as Emacs 29 adds optional support for <a href=\"/article/how-to-get-started-tree-sitter\" class=\" article-link\">tree-sitter</a>, a parser library with an exacting eye for source code parsing that constructs a <em>Concrete Syntax Tree</em> from any text for which it has a valid grammar. Such a tree is the perfect medium for a computer (or willing user) to query. It makes correct syntax highlighting possible with little more than a few dozen lines of code. It also adds the tantalizing promise of <em>structured editing and movement</em>, a sprawling concept that reuses the tree-like structure tree-sitter yields to offer unparalleled editing and movement in your code base.</p>
<p class=\" text-justify\">Tree-sitter’s not the only game in town. What it <em>does</em> bring to the table, and what has eluded most other attempts (in Emacs and beyond), is that is has the largest repository of parsers for both common and uncommon languages and structured text files. Tree-sitter is thus capable <em>and</em> popular. It helps that it is quite straightforward to write your own parser using tree-sitter’s tooling. The cherry on top is a query language to quickly find and match segments of the parsed <em>tree</em> that it emits. That is perhaps its ace in the hole: being able to ask it to show you (for example) all the functions that contain one or more variables with a given name is a powerful feature indeed. Modeled on LISP’s S-expressions, the query language also feels right at home in an Emacs ecosystem.</p>
<p class=\" text-justify\">Presently, the feature is optional, as you must compile Emacs with tree-sitter support. So it is unlikely to replace, wholesale, the existing major modes and the old way of doing things. But it’s a large step forward for Emacs, as it makes writing syntax highlighting and indentation code <a href=\"/article/lets-write-a-treesitter-major-mode\" class=\" article-link\">downright easy</a>. Its adoption into Emacs core is a positive development, and a repudiation against the entrenched belief that Emacs can never fundamentally change. <em>Font locking</em> in Emacs was first introduced around 35 years ago, and now there is a new way – and often much better way – than the old regular expressions. Its successful integration into Emacs is also reflected in the wider Emacs community where it has proven to be a popular feature, despite the fact that tree-sitter is, being new to Emacs, cumbersome to set up and use.</p>
<p class=\" text-justify\">The other major inclusion is Eglot, a client that understands the language server protocol (LSP). Eglot adds IDE-like features to any buffer for which there is a language server available. It’s designed to work with nothing more than base Emacs and the requisite language server. Provided you’ve got your language server set up, all you need to type is <code>M-x eglot</code> (or select <code>Tools -&gt; Language Server Support</code>) to get started. Eglot’s been around for a long time on <a href=\"http://elpa.gnu.org/\" class=\" article-link\">ELPA</a>, an Emacs package repository. Now it’s built into Emacs.</p>
<p class=\" text-justify\">Both capabilities are capstones in an otherwise packed release full of exciting improvements and fixes. If you’re not using Emacs 29 already, you should definitely upgrade.</p>
") (guid ((isPermaLink . "false")) "/article/the-emacs-29-edition-of-mastering-emacs-out-now") (pubDate nil "Mon, 22 Jul 2024 14:17:36 +0000"))) ("Combobulate: Bulk Editing Tree-Sitter Nodes with Multiple Cursors" "<p class=\" text-justify drop-cap\">I’m sure you’ve found yourself in this situation: you want to edit something, but in multiple places, and at the same time. You’re busy; you don’t want to repeat yourself, and this is the twenty-first century and we <em>do</em> have the technology to do this!</p>
<p class=\" text-justify\">I’ve talked about this too-common problem before: <a href=\"/article/iedit-interactive-multi-occurrence-editing-in-your-buffer\" class=\" article-link\">multi-occurrence editing with iedit</a> is one such package; the ubiquitous, and excellent, <a href=\"https://github.com/magnars/multiple-cursors.el\" class=\" article-link\">multiple cursors</a> package is another common one.</p>
<p class=\" text-justify\">Editing multiple occurrences either simultaneously or in sequence is not a new invention. Good, old <code>C-M-%</code> (<code>M-x query-replace-regexp</code>) is sometimes the right choice if you can capture your matches and desired replacements with a regular expression. If that approach does not work, then why not reach out and touch a bunch of stuff with multiple cursors? If you dislike multiple cursors, you can confect a <a href=\"/article/keyboard-macros-are-misunderstood\" class=\" article-link\">fancy keyboard macro</a> to do the work instead (sadly, the fans of keyboard macros are far too occupied to join us right now, as they are busy trying to re-record or edit the macro steps so it works properly.)</p>
<p class=\" text-justify\">No matter the tool, you’re still limited by your ability to collect the <em>right</em> places to edit. These tools can in principle drop cursors anywhere you want them to, but the problem is that outside of a handful of obvious things (same column offset on each line; each word or symbol matching something; the cadence of text using <code>forward-word</code>; etc.) you must compel these tools to place the cursors where you want them to, and that is often manual, verging on tedious, and not always possible.</p>
<p class=\" text-justify\">That’s where <a href=\"/article/tree-sitter-complications-of-parsing-languages\" class=\" article-link\">tree-sitter</a> and its concrete syntax tree of your source code enter the frame.</p>
<figure>
<img src=\"/static/uploads/combobulate/combobulate-field-editor-rename.gif\" alt=\"/static/uploads/combobulate/combobulate-field-editor-rename.gif\" class=\" center-block\">
<figcaption>Here I am using Combobulate’s node editor, bound to <code>C-c o t x</code>, to pick the node at point’s text (here named <code>n</code>) and then I progressively expand the search scope for similarly-named nodes before renaming them all using Combobulate’s new field editor. More on that below.</figcaption>
</figure>
<p class=\" text-justify\">In <a href=\"/article/combobulate-intuitive-structured-navigation-treesitter\" class=\" article-link\">Combobulate, my easy-to-use package</a> that adds navigation and editing to tree-sitter-supported languages, that was one of the first things I wanted to support way back in the day when I first built the prototype version.</p>
<p class=\" text-justify\">You see, with a concrete syntax tree, it’s trivial to throw down a cursor at every member of an array, for example, but <em>precisely</em> so there’s no worry about accidentally picking things that may <em>look</em> like an array element – something that is bound to happen if you were to try and do this using more naive means, like with imperative code or regular expressions – but isn’t. If you’ve ever over- or under-selected stuff with a keyboard macro or the likes of multiple cursors, then you know what I mean!</p>
<p class=\" text-justify\">That’s why I want to talk about Combobulate’s cursor editing functionality; some of the unexpected challenges around building it; and a new method of doing cursor editing without relying on third-party tools like multiple cursors.</p>
<H2 id=\"picking-the-right-things-with-a-query\">Picking the Right Things With a Query</H2>
<p class=\" text-justify\">Before I get into all the ways that Combobulate can help you edit with multiple cursors, I want to first outline some of the challenges around picking things the things you want to edit. For all the talk I did around how much better a concrete syntax tree is – and it <em>is</em> infinitely better – there are snags.</p>
<p class=\" text-justify\">Combobulate, when I first set out to write it, had to work uniformly across a wide range of languages that I used professionally: Python, bash, Typescript + TSX, HTML, CSS, etc.</p>
<p class=\" text-justify\">If you’re at all familiar with tree-sitter, you probably know that you can build s-expression-alike queries, and that is one of the main ways of interfacing with the tree it makes.</p>
<p class=\" text-justify\">Here’s one such made-up example, and it (or something akin to it) is a common thing to want to edit. Given the following query and a starting node, you can tag nodes in the query with <code>@mytag</code> to indicate that you want tree-sitter to return said nodes, provided there are matches of course:</p>
<pre><code>(object
   (pair
      key: (_) @match))</code></pre>
<p class=\" text-justify\">How do you edit the keys in an object/dictionary without tree-sitter? It’s easy enough with traditional tools if the keys line up in your buffer with surgical precision. But what if they don’t? Perhaps they’re disordered and not formatted well, so you can’t just go to the next line with the same offset, or hope <code>forward-sexp</code> and friends can get you there. Tree-sitter makes it a cinch to pluck them anyway.</p>
<p class=\" text-justify\">The example above works by tagging any node that matches <code>(_)</code> (we could limit it to <code>(string)</code> also, for example, to collect only string keys) using the <code>key:</code> field, which is inside a <code>pair</code>, which is also inside an <code>object</code>. Here <code>@match</code> is a made-up tag, so we’d have to do some leg work to feed it to multiple cursors, of course, but that is not terribly hard.</p>
<p class=\" text-justify\">That’s also how TS-based syntax highlighting works: you tag stuff with the name of the face (such as <code>@font-lock-string-face</code>) you want, and Emacs’s font lock engine colors the matches according to the list of queries you have given it. Same query engine, distinct use cases.</p>
<p class=\" text-justify\">It’s a defining feature of tree-sitter. I doubt it would have seen much adoption without it, to be honest. Combobulate has an excellent <a href=\"/article/combobulate-editing-searching-new-query-builder\" class=\" article-link\">interactive query builder</a> complete with code completion and syntax highlighting, so you can try it out yourself. (Spoiler alert: you can tell Combobulate to edit stuff based on a query. Give it a try!)</p>
<p class=\" text-justify\">For all the marvelous benefits of tree-sitter’s query matching engine, it has a humongous, frustrating black mark against it.</p>
<H3 id=\"when-queries-fail\">When Queries Fail</H3>
<p class=\" text-justify\">Can you guess what it is?</p>
<p class=\" text-justify\">Let me show you a picture — it’ll give it away:</p>
<figure>
<img src=\"/static/uploads/combobulate/combobulate-query-matches-all-keys.png\" alt=\"/static/uploads/combobulate/combobulate-query-matches-all-keys.png\" class=\" center-block\">
<figcaption>Combobulate’s query builder (<code>C-c o B q</code>) is highlighting all the matches using the aforementioned query. Observe how it matches all nested keys also.</figcaption>
</figure>
<p class=\" text-justify\">It’s recursive. That is a useful property for highlighters or general-purpose “sally forth and find me all matches” needs, which is admittedly a large tract of why you’d use the query engine.</p>
<p class=\" text-justify\">But it is not so useful if you want to edit just <em>one</em> level of keys in an object, or – as I discovered when I started using it in anger – the start and end elements in HTML or TSX. Any sort of self-similar nodes (nested <em>anything</em>, like HTML tags) are immediately snared by this feature.</p>
<p class=\" text-justify\">You know, I just wanted to add basic multi-editing to early versions of Combobulate: simultaneously renaming matching HTML tags. That sort of thing. The query system seemed like the perfect abstraction. I could <em>literally describe what I wanted to edit</em>.</p>
<p class=\" text-justify\">Womp, womp. Except I couldn’t. Not with the query engine, mind — not without attempting error-prone post-processing to weed out false positives, somehow. But that, in my mind, ran against the philosophy of capturing the requirements in a declarative query, and that Combobulate should not special-case code for each language it supports. (That is an adamantine rule that still stands.)</p>
<p class=\" text-justify\">The workaround, if you can call it that, is to anchor the query to the root node – that “disables”, by way of exclusively matching all of a node’s parents, for there is just one root node in a tree – the recursive check. Thus, given a node in a tree, it is possible to construct a query that matches <em>just</em> that node, though you would have to describe the entire relationship of the tree, from leaf-to-trunk, and all its siblings along the way.</p>
<p class=\" text-justify\">So to match an object, without recursion gumming things up, in Javascript, nested in a function somewhere, would look like this, but far more complex in real life:</p>
<pre><code>(program
  (some_function
     (something_else
       (...
          (object ...)))))</code></pre>
<p class=\" text-justify\">Alas, that is not exactly a solution worth talking about.</p>
<p class=\" text-justify\">So how to fix it, then?</p>
<H3 id=\"the-query-fix\">The Query “Fix”</H3>
<p class=\" text-justify\">So I “fixed” it by reimplementing a large proportion of the tree-sitter query engine in elisp. That was a complex project that took quite a long time to get “right”, for some definition of right, when I wrote it some years ago now. The implementation surely still has bugs. I know it does, because tree-sitter’s <em>official</em> query builder still has a steady stream of bug fixes getting merged. And if <em>that</em> is still buggy, then so is mine!</p>
<p class=\" text-justify\">It’s also kinda slow, so it’s never going to help you font lock your code! I also decided to take a few of the lesser-used features of Emacs core that are perfect for this type of Computer Science problem for a spin: generator functions using <code>iter-defun</code> and friends. Generators are implemented entirely using Lisp macros, which is kind of neat. Writing all that <em>Lisp macrology</em> must’ve been a fun hobby project to build and design, for sure, but it’s not so fun to use: it feels quite slow and cannot be debugged easily. And good luck understanding the macroexpanded code it makes. <em>Yikes</em>.</p>
<p class=\" text-justify\">So. Combobulate’s query engine is not designed to replace tree-sitters’. It’s now a complement to the little declarative mini-language in Combobulate that I settled on so I could support <a href=\"/article/combobulate-intuitive-structured-navigation-treesitter\" class=\" article-link\">intuitive, structured navigation</a> (called the <em>procedures</em>).</p>
<p class=\" text-justify\">That means it’s possible to ask Combobulate to find stuff the normal way, and then use its (or TS’) query language for finesse:</p>
<div class=\"sourceCode\" id=\"cb3\"><pre class=\"sourceCode commonlisp\"><code class=\"sourceCode commonlisp\"><span id=\"cb3-1\"><a href=\"#cb3-1\" aria-hidden=\"true\" tabindex=\"-1\" class=\" article-link\"></a>(procedures-sequence</span>
<span id=\"cb3-2\"><a href=\"#cb3-2\" aria-hidden=\"true\" tabindex=\"-1\" class=\" article-link\"></a>   '((:activation-nodes</span>
<span id=\"cb3-3\"><a href=\"#cb3-3\" aria-hidden=\"true\" tabindex=\"-1\" class=\" article-link\"></a>      ((:nodes (<span class=\"st\">\"tag_name\"</span>) :position any :has-ancestor (<span class=\"st\">\"element\"</span>)))</span>
<span id=\"cb3-4\"><a href=\"#cb3-4\" aria-hidden=\"true\" tabindex=\"-1\" class=\" article-link\"></a>      :selector (:choose parent :match-query</span>
<span id=\"cb3-5\"><a href=\"#cb3-5\" aria-hidden=\"true\" tabindex=\"-1\" class=\" article-link\"></a>                         (:query</span>
<span id=\"cb3-6\"><a href=\"#cb3-6\" aria-hidden=\"true\" tabindex=\"-1\" class=\" article-link\"></a>                          (_ (start_tag (tag_name) @match)</span>
<span id=\"cb3-7\"><a href=\"#cb3-7\" aria-hidden=\"true\" tabindex=\"-1\" class=\" article-link\"></a>                             (end_tag (tag_name) @match))</span>
<span id=\"cb3-8\"><a href=\"#cb3-8\" aria-hidden=\"true\" tabindex=\"-1\" class=\" article-link\"></a>                          :engine combobulate)))))</span></code></pre></div>
<p class=\" text-justify\">For example, you can use <code>C-c o t c</code> (cursor edit by sequence) to edit matching HTML tags, and when you do so, this is the DSL declaration it “runs” to determine what to do. (If you’re inside a <code>tag_name</code> and it has an ancestor <code>element</code> then trigger the <code>:selector</code>)</p>
<p class=\" text-justify\">The underlying query (see <code>:query</code>), such as it is, works fine in TS’s query engine also, but with the side-effect of being recursive.</p>
<p class=\" text-justify\">I wrote the query engine back when I thought queries would play a much larger role in Combobulate. Back then, I naively assumed (as you do) that with the bountiful choices made available by a concrete syntax tree, all I had to do was write The Right Query and I could avoid a lot of imperative hand-wringing.</p>
<p class=\" text-justify\">As it turns out, the query engines (plural) are useless for most things related to structured navigation and editing. So despite the <em>theoretical</em> utility of the query engines, in reality I am slowly replacing most of the queries – the few that still remain today – with the DSL.</p>
<p class=\" text-justify\">The DSL is ironically better at picking things, despite its imperative-yet-declarative nature than an all-singing, all-dancing but weirdly limiting set of query engines.</p>
<p class=\" text-justify\">One example of where the DSL wins is <a href=\"/article/combobulate-intuitive-structured-navigation-treesitter\" class=\" article-link\">sibling navigation</a>, a topic I have covered at length before. Before I came up with the DSL, I’d started the arduous task of using building queries to pick all the keys in a dictionary; the arguments in a function definition; and so on, and so forth. Far too tedious as the query language is too limiting.</p>
<p class=\" text-justify\">Who knew?</p>
<p class=\" text-justify\">So, today, the query engines remain useful mostly for ad hoc highlighting; bulk editing, yes, still; and deft selection of nodes when the mini-DSL fails to do the job.</p>
<p class=\" text-justify\">You might wonder why I haven’t just extended my query language to suit my every need.</p>
<p class=\" text-justify\">The answer is that I feel that it is not really feasible to express these ideas in a language that – if we are to hew somewhat close to the original intent of the tree-sitter query language, and if we do not do that, then my DSL is already such a language! – is boxed in by its desire to be (as it should be!) a pattern matching language with a bunch of deterministic finite automata tacked on to solve the unenviable problem of having to support optional matches, quantifiers, negation, and so on.</p>
<p class=\" text-justify\">The DSL meanwhile relies on the idea of doing simple node type matching and then ascending or descending the tree to match other things based on simple set-theoretic filters and a handful of hardcoded instructions, such as “give me all the things that can go in an <code>if</code> statement except for this or that and then give me all siblings that match something else entirely”.</p>
<p class=\" text-justify\">So that is a brief summary of how the query engine looks like a panacea, but is ultimately not a great fit for most multi-cursor editing tasks, and indeed most precision editing and movement tasks, as you’d have to fight it and write a lot of imperative code anyway.</p>
<p class=\" text-justify\">Right. Let’s talk about some fun things instead.</p>
<H2 id=\"cursor-editing\">Cursor Editing</H2>
<p class=\" text-justify\">Combobulate’s had cursor editing for a long time. I recently rewrote the system to get rid of what was formerly known as <em>cluster editing</em>: basically the stuff you just read about. Like editing matching HTML tags.</p>
<p class=\" text-justify\">That feature is now called <em>sequence editing</em>, which uses the procedure system to edit any <em>sequence</em> Combobulate knows about, such as the oft-repeated HTML tags.</p>
<p class=\" text-justify\">My impetus for doing this is that the bulk of the cluster editors I’d written were a parallel way of doing sibling editing before I had proper, reliable <a href=\"/article/combobulate-intuitive-structured-navigation-treesitter\" class=\" article-link\">sibling navigation</a>.</p>
<p class=\" text-justify\">Sibling navigation is one of the most important keystone features in Combobulate as it is such a powerful catalyst for nearly all other editing and movement features in Combobulate, surprising as that may sound!</p>
<p class=\" text-justify\">Case in point: keys in a dictionary; elements in an array; function arguments. They are all siblings. They should be editable <em>as</em> siblings. And now they are.</p>
<p class=\" text-justify\">The <code>C-c o t s</code> command invokes the sibling editor. It works in any place where regular <code>C-M-n</code> and <code>C-M-p</code> sibling navigation works, as it uses the same code base.</p>
<figure>
<img src=\"/static/uploads/combobulate/combobulate-query-edit-shorthand.gif\" alt=\"/static/uploads/combobulate/combobulate-query-edit-shorthand.gif\" class=\" center-block\">
<figcaption>Here’s a simple example where I drop in and edit the shorthands in Typescript using the sibling editing command and multiple cursors.</figcaption>
</figure>
<p class=\" text-justify\">If I <em>didn’t</em> use the sibling system, I would’ve had to build a custom cluster query to mark the nodes instead. Tedium squared.</p>
<p class=\" text-justify\">But that’s all gone now. Except…</p>
<H3 id=\"clusters-sequences\">Clusters &amp; Sequences</H3>
<p class=\" text-justify\">The tag names in HTML tags (the <code>div</code> in <code>&lt;div&gt;</code>) are <em>not</em> siblings:</p>
<pre><code>(element
  (start_tag (tag_name))
  (end_tag (tag_name)))</code></pre>
<p class=\" text-justify\">Start and end tag <em>are</em> siblings, but we do not sibling navigate by start or end tag, but <code>element</code>. (There are good reasons for this.) So a call to <code>C-c o t s</code> with point at <code>&lt;div&gt;</code> would instead edit all <em>sibling elements</em> and not the two tag names. That, and the point would be in the wrong place: it should be here: <code>-!-div</code>. Not to the left of <code>&lt;</code> in <code>&lt;div&gt;</code> and <code>&lt;/div&gt;</code>. You can’t even <code>C-f</code> once to correct for it, as closing tags terminate with <code>&lt;/</code> and not <code>&lt;</code>, so you’d be off by one!</p>
<p class=\" text-justify\">That’s why we still need some form of “clustered editing”. Though in this case I scried an opportunity to improve navigation <em>as well as</em> retaining tag editing.</p>
<p class=\" text-justify\">New to the latest version of Combobulate is <em>sequence navigation</em>, bound to <code>M-n</code> and <code>M-p</code>. Most nodes lack a <em>sequent</em>; it is not a general purpose movement command, as it only applies in situations where nodes are sequences but not strictly speaking siblings.</p>
<p class=\" text-justify\">Put point inside a <code>&lt;tag&gt;</code> and you can use <code>M-n/p</code> to cycle between the start and end tag. That is <em>super helpful</em> if you work with SGML-alike languages. Use <code>C-c o t c</code> to sequence edit them.</p>
<p class=\" text-justify\">Now you have useful navigation <em>and</em> editing capabilities for places where things are not-quite-adjacent (like JSX and HTML). (If you can think of other cases, do raise a Github issue.)</p>
<p class=\" text-justify\">Ironically, this is a fine use case for the DSL <em>and</em> Combobulate’s query engine to ensure I drill down and pluck the tag names from the start and end tags.</p>
<H4 id=\"sequence-scanning\">Sequence Scanning</H4>
<p class=\" text-justify\">16+ years ago I wrote an awful lot of Borland Delphi for a living. I won’t get into how amazing the UI development experience was except to say that where that was the zenith of productivity, its garbage-tier code editor was surely the nadir. It didn’t even <em>indent your code for you</em>. Bah.</p>
<p class=\" text-justify\">It was a terrible editing experience, except for one little feature I loved in a third-party plugin: keyword scanning. If you pressed <code>M-p</code> or <code>M-n</code> on any identifier in the editor, it’d jump to it, but without the obsequiously stupid “Find Dialog” getting in your way to “help you find what you want”.</p>
<p class=\" text-justify\">I loved it so much it was one of the first things I wrote in Emacs Lisp, and talked about much later here. I called it <a href=\"/article/smart-scan-jump-symbols-buffer\" class=\" article-link\">Smart Scan: Jump between symbols in a buffer</a>.</p>
<p class=\" text-justify\">I still use it. But it annoyed me that I didn’t have a similar feature in Combobulate so others can benefit from its utility, and that the two keys the new sequence key bindings are now bound to conflict with smart scan.</p>
<p class=\" text-justify\">So I merged the features. If your point is in one of the few supported <em>sequences</em>, Combobulate will abide and only move between them. Try to move outside the “range” of valid options, and you’re shown an error: tap the key <em>again</em> without hesitation, and it switches to free-form scanning for that keyword anywhere in the buffer and “outside” the reign of tree-sitter. (It’s effectively akin to regexp searching for <code>\\&lt;foo\\&gt;</code>.)</p>
<p class=\" text-justify\">Use it anywhere else, and it launches into a freeform search mode for the symbol at point without first raising an error. The end result is you can safely navigate sequences and not worry about getting pulled away from what you’re looking for, while still having the freedom to do search out of bounds, so to speak, if you tap the key again.</p>
<H3 id=\"bulk-editing-with-combobulate\">Bulk Editing with Combobulate</H3>
<p class=\" text-justify\">There’s a handful of bulk editing commands that come with Combobulate.</p>
<table style=\"width:86%;\" class=\" table\">
<colgroup>
<col style=\"width: 43%\">
<col style=\"width: 43%\">
</colgroup>
<tbody>
<tr class=\"odd\">
<td><strong>Key Bindings</strong></td>
<td><strong>Description</strong></td>
</tr>
<tr class=\"even\">
<td><code>C-c o t t</code></td>
<td>Edit by node type DWIM</td>
</tr>
<tr class=\"odd\">
<td><code>C-c o t x</code></td>
<td>Edit by node text DWIM</td>
</tr>
<tr class=\"even\">
<td><code>C-c o t c</code></td>
<td>Edit sequence</td>
</tr>
<tr class=\"odd\">
<td><code>C-c o t s</code></td>
<td>Edit siblings</td>
</tr>
<tr class=\"even\">
<td><code>C-c o B q</code></td>
<td>Open query builder (interactive query building)</td>
</tr>
<tr class=\"odd\">
<td><code>C-c o B r</code></td>
<td>Display query from root to point</td>
</tr>
<tr class=\"even\">
<td><code>C-c o B p</code></td>
<td>Display query that matches node text at point</td>
</tr>
</tbody>
</table>
<p class=\" text-justify\">Aside from a handful of defaults in the <code>C-c o t</code> keymap, there are commands that build queries you can use as a baseline to create your own custom editors. My article on <a href=\"/article/combobulate-editing-searching-new-query-builder\" class=\" article-link\">Editing and Searching with the new Query Builder</a> goes into more detail on those.</p>
<p class=\" text-justify\">Most commands that “Do What I Mean” require a context locus that serves as a limit for cursor editing. You rarely want to edit the whole buffer. That way you can limit your node editing to just the current statement or function, for example, without having to manually remove cursors after the fact.</p>
<figure>
<img src=\"/static/uploads/combobulate/combobulate-expand-edit.gif\" alt=\"/static/uploads/combobulate/combobulate-expand-edit.gif\" class=\" center-block\">
<figcaption>Edit nodes by type with <code>C-c o t t</code>. You’re asked to confirm the locus (how far Combobulate should go look for nodes of the same type) to edit in one go, starting with just the element pair.</figcaption>
</figure>
<H4 id=\"multiple-cursors\">Multiple Cursors</H4>
<p class=\" text-justify\">I like multiple cursors, and it’s a tool I use all the time, but it <em>is</em> an external, though optional, dependency in Combobulate, and while I’m OK with that, it’s also something I feel shouldn’t be <em>required</em> for basic bulk editing. I want people to at least be able to use Combobulate’s editing facilities without requiring multiple cursors.</p>
<p class=\" text-justify\">Having said that, multiple cursors is well integrated into Combobulate. Every node has a start and an end, for example, so having the ability to insert a cursor at either end is especially useful.</p>
<table style=\"width:86%;\" class=\" table\">
<colgroup>
<col style=\"width: 43%\">
<col style=\"width: 43%\">
</colgroup>
<tbody>
<tr class=\"odd\">
<td><strong>Modifier Arguments</strong></td>
<td><strong>Description</strong></td>
</tr>
<tr class=\"even\">
<td><em>None</em></td>
<td>Place cursor at the start (default)</td>
</tr>
<tr class=\"odd\">
<td><code>C-u</code></td>
<td>Place cursor at the end</td>
</tr>
<tr class=\"even\">
<td><code>C-u C-u</code></td>
<td>Mark the node</td>
</tr>
</tbody>
</table>
<p class=\" text-justify\">You can control the placement of the cursors for any of the <em>edit</em> commands in the <code>C-c o t</code> key map by giving it a prefix key. By default cursors are placed at the start of a node; a single <code>C-u</code> argument changes that to the end.</p>
<p class=\" text-justify\">One of the benefits of multiple cursors is that it supports non-contiguous regions, so each cursor can have its own region. To mark things instead, prefix with <code>C-u C-u</code> instead. At that point you can use <code>C-x C-x</code> to swap point and mark to move between the start and end of the node.</p>
<H4 id=\"combobulates-field-editor\">Combobulate’s Field Editor</H4>
<figure>
<img src=\"/static/uploads/combobulate/combobulate-field-number.gif\" alt=\"/static/uploads/combobulate/combobulate-field-number.gif\" class=\" center-block\">
<figcaption>Appending and prepending text with the field editor.</figcaption>
</figure>
<p class=\" text-justify\">Combobulate has an advanced snippet templating tool feature called <em>envelopes</em> (check out <code>C-c o e ...</code>.) It has been around for a long time now (and more on that in another post!) and, like any good templating tool, it supports <em>fields</em>, but with an important difference: it uses the minibuffer prompt mechanism to query for input instead of expecting you to type into an overlay dyed and imbued with special properties in your buffer. Unlike the abandoned <em>Tempo</em> and <em>Skeleton</em> templating packages in Emacs, Combobulate updates the fields as you type in the minibuffer.</p>
<p class=\" text-justify\">Because Combobulate already has a templating tool, it was a snap reusing the code as a cursor editing system that works a little bit like a trad templating tool crossed with <code>C-x r t</code> (<code>M-x string-rectangle</code>), another Emacs classic that uses the rectangle system in Emacs to prefix text. The string rectangle feature’s a little too basic on its own — it’s useful, for sure, but I figured I could make Combobulate’s editor a bit more ergonomic and flexible than simply reinventing such a basic mechanic.</p>
<p class=\" text-justify\">A large part of the edits I make when I use multiple cursors are simple append/prepend operations to the existing text. Not always, but often. To facilitate that sort of editing, I needed a placeholder symbol in the minibuffer to represent each node’s text. Otherwise, I’d have no way of prepending <em>and</em> appending in the minibuffer: there is one minibuffer prompt, after all, but more than one node field to update, and each may have vastly different text.</p>
<p class=\" text-justify\">Ergo, there must be a generic placeholder that represents each field’s node text. Thinking about it some more, I realized that this is really not all that different from the replace regexp’s capturing group feature found in, among other places, <code>C-M-%</code>.</p>
<p class=\" text-justify\">So why not just use that? You gain a number of other ancillary benefits for “free” (well, it required more coding, but they’re benefits to <em>you</em>) when you start thinking about each node as its own capturing group.</p>
<table style=\"width:58%;\" class=\" table\">
<colgroup>
<col style=\"width: 29%\">
<col style=\"width: 29%\">
</colgroup>
<tbody>
<tr class=\"odd\">
<td><strong>Feature</strong></td>
<td><strong>Description</strong></td>
</tr>
<tr class=\"even\">
<td><code>\\0</code></td>
<td>Inserts the original text for each field</td>
</tr>
<tr class=\"odd\">
<td><code>\\N</code></td>
<td>Inserts the Nth field’s text</td>
</tr>
<tr class=\"even\">
<td><code>\\#</code></td>
<td>Inserts the number of the field, starting from 0</td>
</tr>
<tr class=\"odd\">
<td><code>\\,FORM</code></td>
<td><p class=\" text-justify\">Evaluates the elisp form FORM.</p>
<p class=\" text-justify\">Capturing groups are valid inside the form.</p></td>
</tr>
</tbody>
</table>
<p class=\" text-justify\">With a regular replace regexp, the <code>\\N</code> notation represents the N’th match, with the number <code>0</code> being the whole match string. In Combobulate, <code>\\0</code> now represents the match string for each localized field you’re editing. So the default prompt value in Combobulate is <code>\\0</code> meaning: just insert the original text you started with.</p>
<p class=\" text-justify\">All other numbers represent that particular node’s text. So <code>\\1</code> is the first node; <code>\\2</code> is the second, and so forth.</p>
<p class=\" text-justify\">That means it’s possible to not only replace every match with the content of a particular field, but also combine them. Maybe you want to merge the second and third fields’ text?</p>
<p class=\" text-justify\">Another regexp feature is the ability to insert the match number. By counting from the top-most field, you can insert the index of each field with <code>\\#</code> as a practical and cheap way of enumerating things. It counts from 0.</p>
<p class=\" text-justify\"><code>C-M-%</code> has a really cool – and quite hidden – feature: <a href=\"/article/evaluating-lisp-forms-regular-expressions\" class=\" article-link\">it can evaluate Lisp Forms inside Regular Expressions</a>. I’ve written about it before; it’s such an underrated feature. I do not need it often, but when I do, it’s nice to know I can combine the power of elisp with regexp search and replace.</p>
<figure>
<img src=\"/static/uploads/combobulate/combobulate-field-editor-eval-form.gif\" alt=\"/static/uploads/combobulate/combobulate-field-editor-eval-form.gif\" class=\" center-block\">
<figcaption>Evaluating forms in Combobulate’s field editor works much the same as it does in <code>C-M-%</code>. Here I’m uppercasing all the fields’ names using <code>upcase</code> and the <code>\\0</code> capturing group.</figcaption>
</figure>
<p class=\" text-justify\">In addition to <em>all that</em>, there are key bindings in the field editor minibuffer (you can also see the key bindings by tapping <code>C-h</code> in the prompt):</p>
<table style=\"width:86%;\" class=\" table\">
<colgroup>
<col style=\"width: 43%\">
<col style=\"width: 43%\">
</colgroup>
<tbody>
<tr class=\"odd\">
<td><strong>Key Bindings</strong></td>
<td><strong>Description</strong></td>
</tr>
<tr class=\"even\">
<td><code>C-n</code></td>
<td>Move to next field</td>
</tr>
<tr class=\"odd\">
<td><code>C-p</code></td>
<td>Move to previous field</td>
</tr>
<tr class=\"even\">
<td><code>C-v</code></td>
<td>Toggle the current field on or off</td>
</tr>
<tr class=\"odd\">
<td><code>C-i</code></td>
<td>Invert fields’ editable state</td>
</tr>
<tr class=\"even\">
<td><code>C-h</code></td>
<td>Show the help</td>
</tr>
</tbody>
</table>
<p class=\" text-justify\">You can scroll through the fields with <code>C-n/p</code>. You’ll need these if you want a closer look at the matched fields. You’re free to just switch to the buffer and scroll also, of course!</p>
<p class=\" text-justify\"><em>Unlike</em> multiple cursors, you can toggle the fields on or off. Do you want to bulk edit all the keys in a JSON object <em>except</em> one key? Now you can. Just move with <code>C-n/p</code> to the field in question and toggle it with <code>C-v</code>. <code>C-i</code> does much the same: it inverts the state of all fields.</p>
<p class=\" text-justify\">The field editor’s not perfect, but then nor is multiple cursors.</p>
<H4 id=\"a-quick-comparison-between-the-two\">A quick Comparison between the two</H4>
<p class=\" text-justify\">Multiple cursors is, to me, an indispensable tool, and I will continue to use it for things that warrant it.</p>
<p class=\" text-justify\">The field editor is better for explicit, bulk edits where you do not require the flexibility or precision you get by having a point placed at every field.</p>
<p class=\" text-justify\">It is not possible to gingerly delete some characters or operate on partial node text matches with the field editor. (Though I suppose you could try with the Lisp form evaluation.)</p>
<p class=\" text-justify\">Simultaneously, it is not so easy to quickly prepend or append to the node text with MC. In fact, there is (to my knowledge) no way of declaring a ‘range’ to a cursor. Once it is created it is subject to the whims of the editing and movement you do in the buffer.</p>
<p class=\" text-justify\">You <em>can</em> use the <code>C-u C-u</code> argument to mark the nodes, which does give you some control over the start and end, but explicitly inserting something at the start of the node and then the end is perhaps not possible at all, if the node is not something you can quickly find the ‘end of’ with either Combobulate’s movement commands or Emacs’.</p>
<p class=\" text-justify\">MC does support some form of killing and yanking, but I find it awful and borderline unusable. If you want to merge or join nodes’ text together, you’re better off with a keyboard macro or the field editor.</p>
<p class=\" text-justify\">The other major advantage of the field editor is that it ships with Combobulate. It is also relatively easy to add new, explicit, commands to do things in the future.</p>
<p class=\" text-justify\">So. There are trade-offs to both approaches, but now you at least have a choice of what to use.</p>
<p class=\" text-justify\">Let me know what you think.</p>
<p class=\" text-justify\">Happy (bulk) editing!</p>" "https://www.masteringemacs.org/article/combobulate-bulk-editing-treesitter-nodes-multiple-cursors?utm_source=newsletter&utm_medium=rss" (26347 59079) new 3 nil nil ((title nil "Combobulate: Bulk Editing Tree-Sitter Nodes with Multiple Cursors") (link nil "https://www.masteringemacs.org/article/combobulate-bulk-editing-treesitter-nodes-multiple-cursors?utm_source=newsletter&utm_medium=rss") (description nil "Combobulate's long had the ability to bulk edit matches using the multiple cursors package, but building seamless and useful bulk editing tooling is not as straightforward as it seems. And what if you don't use multiple cursors? Combobulate now has its own field editor to help you bulk edit.") (encoded nil "
<p class=\" text-justify drop-cap\">I’m sure you’ve found yourself in this situation: you want to edit something, but in multiple places, and at the same time. You’re busy; you don’t want to repeat yourself, and this is the twenty-first century and we <em>do</em> have the technology to do this!</p>
<p class=\" text-justify\">I’ve talked about this too-common problem before: <a href=\"/article/iedit-interactive-multi-occurrence-editing-in-your-buffer\" class=\" article-link\">multi-occurrence editing with iedit</a> is one such package; the ubiquitous, and excellent, <a href=\"https://github.com/magnars/multiple-cursors.el\" class=\" article-link\">multiple cursors</a> package is another common one.</p>
<p class=\" text-justify\">Editing multiple occurrences either simultaneously or in sequence is not a new invention. Good, old <code>C-M-%</code> (<code>M-x query-replace-regexp</code>) is sometimes the right choice if you can capture your matches and desired replacements with a regular expression. If that approach does not work, then why not reach out and touch a bunch of stuff with multiple cursors? If you dislike multiple cursors, you can confect a <a href=\"/article/keyboard-macros-are-misunderstood\" class=\" article-link\">fancy keyboard macro</a> to do the work instead (sadly, the fans of keyboard macros are far too occupied to join us right now, as they are busy trying to re-record or edit the macro steps so it works properly.)</p>
<p class=\" text-justify\">No matter the tool, you’re still limited by your ability to collect the <em>right</em> places to edit. These tools can in principle drop cursors anywhere you want them to, but the problem is that outside of a handful of obvious things (same column offset on each line; each word or symbol matching something; the cadence of text using <code>forward-word</code>; etc.) you must compel these tools to place the cursors where you want them to, and that is often manual, verging on tedious, and not always possible.</p>
<p class=\" text-justify\">That’s where <a href=\"/article/tree-sitter-complications-of-parsing-languages\" class=\" article-link\">tree-sitter</a> and its concrete syntax tree of your source code enter the frame.</p>
<figure>
<img src=\"/static/uploads/combobulate/combobulate-field-editor-rename.gif\" alt=\"/static/uploads/combobulate/combobulate-field-editor-rename.gif\" class=\" center-block\">
<figcaption>Here I am using Combobulate’s node editor, bound to <code>C-c o t x</code>, to pick the node at point’s text (here named <code>n</code>) and then I progressively expand the search scope for similarly-named nodes before renaming them all using Combobulate’s new field editor. More on that below.</figcaption>
</figure>
<p class=\" text-justify\">In <a href=\"/article/combobulate-intuitive-structured-navigation-treesitter\" class=\" article-link\">Combobulate, my easy-to-use package</a> that adds navigation and editing to tree-sitter-supported languages, that was one of the first things I wanted to support way back in the day when I first built the prototype version.</p>
<p class=\" text-justify\">You see, with a concrete syntax tree, it’s trivial to throw down a cursor at every member of an array, for example, but <em>precisely</em> so there’s no worry about accidentally picking things that may <em>look</em> like an array element – something that is bound to happen if you were to try and do this using more naive means, like with imperative code or regular expressions – but isn’t. If you’ve ever over- or under-selected stuff with a keyboard macro or the likes of multiple cursors, then you know what I mean!</p>
<p class=\" text-justify\">That’s why I want to talk about Combobulate’s cursor editing functionality; some of the unexpected challenges around building it; and a new method of doing cursor editing without relying on third-party tools like multiple cursors.</p>
<H2 id=\"picking-the-right-things-with-a-query\">Picking the Right Things With a Query</H2>
<p class=\" text-justify\">Before I get into all the ways that Combobulate can help you edit with multiple cursors, I want to first outline some of the challenges around picking things the things you want to edit. For all the talk I did around how much better a concrete syntax tree is – and it <em>is</em> infinitely better – there are snags.</p>
<p class=\" text-justify\">Combobulate, when I first set out to write it, had to work uniformly across a wide range of languages that I used professionally: Python, bash, Typescript + TSX, HTML, CSS, etc.</p>
<p class=\" text-justify\">If you’re at all familiar with tree-sitter, you probably know that you can build s-expression-alike queries, and that is one of the main ways of interfacing with the tree it makes.</p>
<p class=\" text-justify\">Here’s one such made-up example, and it (or something akin to it) is a common thing to want to edit. Given the following query and a starting node, you can tag nodes in the query with <code>@mytag</code> to indicate that you want tree-sitter to return said nodes, provided there are matches of course:</p>
<pre><code>(object
   (pair
      key: (_) @match))</code></pre>
<p class=\" text-justify\">How do you edit the keys in an object/dictionary without tree-sitter? It’s easy enough with traditional tools if the keys line up in your buffer with surgical precision. But what if they don’t? Perhaps they’re disordered and not formatted well, so you can’t just go to the next line with the same offset, or hope <code>forward-sexp</code> and friends can get you there. Tree-sitter makes it a cinch to pluck them anyway.</p>
<p class=\" text-justify\">The example above works by tagging any node that matches <code>(_)</code> (we could limit it to <code>(string)</code> also, for example, to collect only string keys) using the <code>key:</code> field, which is inside a <code>pair</code>, which is also inside an <code>object</code>. Here <code>@match</code> is a made-up tag, so we’d have to do some leg work to feed it to multiple cursors, of course, but that is not terribly hard.</p>
<p class=\" text-justify\">That’s also how TS-based syntax highlighting works: you tag stuff with the name of the face (such as <code>@font-lock-string-face</code>) you want, and Emacs’s font lock engine colors the matches according to the list of queries you have given it. Same query engine, distinct use cases.</p>
<p class=\" text-justify\">It’s a defining feature of tree-sitter. I doubt it would have seen much adoption without it, to be honest. Combobulate has an excellent <a href=\"/article/combobulate-editing-searching-new-query-builder\" class=\" article-link\">interactive query builder</a> complete with code completion and syntax highlighting, so you can try it out yourself. (Spoiler alert: you can tell Combobulate to edit stuff based on a query. Give it a try!)</p>
<p class=\" text-justify\">For all the marvelous benefits of tree-sitter’s query matching engine, it has a humongous, frustrating black mark against it.</p>
<H3 id=\"when-queries-fail\">When Queries Fail</H3>
<p class=\" text-justify\">Can you guess what it is?</p>
<p class=\" text-justify\">Let me show you a picture — it’ll give it away:</p>
<figure>
<img src=\"/static/uploads/combobulate/combobulate-query-matches-all-keys.png\" alt=\"/static/uploads/combobulate/combobulate-query-matches-all-keys.png\" class=\" center-block\">
<figcaption>Combobulate’s query builder (<code>C-c o B q</code>) is highlighting all the matches using the aforementioned query. Observe how it matches all nested keys also.</figcaption>
</figure>
<p class=\" text-justify\">It’s recursive. That is a useful property for highlighters or general-purpose “sally forth and find me all matches” needs, which is admittedly a large tract of why you’d use the query engine.</p>
<p class=\" text-justify\">But it is not so useful if you want to edit just <em>one</em> level of keys in an object, or – as I discovered when I started using it in anger – the start and end elements in HTML or TSX. Any sort of self-similar nodes (nested <em>anything</em>, like HTML tags) are immediately snared by this feature.</p>
<p class=\" text-justify\">You know, I just wanted to add basic multi-editing to early versions of Combobulate: simultaneously renaming matching HTML tags. That sort of thing. The query system seemed like the perfect abstraction. I could <em>literally describe what I wanted to edit</em>.</p>
<p class=\" text-justify\">Womp, womp. Except I couldn’t. Not with the query engine, mind — not without attempting error-prone post-processing to weed out false positives, somehow. But that, in my mind, ran against the philosophy of capturing the requirements in a declarative query, and that Combobulate should not special-case code for each language it supports. (That is an adamantine rule that still stands.)</p>
<p class=\" text-justify\">The workaround, if you can call it that, is to anchor the query to the root node – that “disables”, by way of exclusively matching all of a node’s parents, for there is just one root node in a tree – the recursive check. Thus, given a node in a tree, it is possible to construct a query that matches <em>just</em> that node, though you would have to describe the entire relationship of the tree, from leaf-to-trunk, and all its siblings along the way.</p>
<p class=\" text-justify\">So to match an object, without recursion gumming things up, in Javascript, nested in a function somewhere, would look like this, but far more complex in real life:</p>
<pre><code>(program
  (some_function
     (something_else
       (...
          (object ...)))))</code></pre>
<p class=\" text-justify\">Alas, that is not exactly a solution worth talking about.</p>
<p class=\" text-justify\">So how to fix it, then?</p>
<H3 id=\"the-query-fix\">The Query “Fix”</H3>
<p class=\" text-justify\">So I “fixed” it by reimplementing a large proportion of the tree-sitter query engine in elisp. That was a complex project that took quite a long time to get “right”, for some definition of right, when I wrote it some years ago now. The implementation surely still has bugs. I know it does, because tree-sitter’s <em>official</em> query builder still has a steady stream of bug fixes getting merged. And if <em>that</em> is still buggy, then so is mine!</p>
<p class=\" text-justify\">It’s also kinda slow, so it’s never going to help you font lock your code! I also decided to take a few of the lesser-used features of Emacs core that are perfect for this type of Computer Science problem for a spin: generator functions using <code>iter-defun</code> and friends. Generators are implemented entirely using Lisp macros, which is kind of neat. Writing all that <em>Lisp macrology</em> must’ve been a fun hobby project to build and design, for sure, but it’s not so fun to use: it feels quite slow and cannot be debugged easily. And good luck understanding the macroexpanded code it makes. <em>Yikes</em>.</p>
<p class=\" text-justify\">So. Combobulate’s query engine is not designed to replace tree-sitters’. It’s now a complement to the little declarative mini-language in Combobulate that I settled on so I could support <a href=\"/article/combobulate-intuitive-structured-navigation-treesitter\" class=\" article-link\">intuitive, structured navigation</a> (called the <em>procedures</em>).</p>
<p class=\" text-justify\">That means it’s possible to ask Combobulate to find stuff the normal way, and then use its (or TS’) query language for finesse:</p>
<div class=\"sourceCode\" id=\"cb3\"><pre class=\"sourceCode commonlisp\"><code class=\"sourceCode commonlisp\"><span id=\"cb3-1\"><a href=\"#cb3-1\" aria-hidden=\"true\" tabindex=\"-1\" class=\" article-link\"></a>(procedures-sequence</span>
<span id=\"cb3-2\"><a href=\"#cb3-2\" aria-hidden=\"true\" tabindex=\"-1\" class=\" article-link\"></a>   '((:activation-nodes</span>
<span id=\"cb3-3\"><a href=\"#cb3-3\" aria-hidden=\"true\" tabindex=\"-1\" class=\" article-link\"></a>      ((:nodes (<span class=\"st\">\"tag_name\"</span>) :position any :has-ancestor (<span class=\"st\">\"element\"</span>)))</span>
<span id=\"cb3-4\"><a href=\"#cb3-4\" aria-hidden=\"true\" tabindex=\"-1\" class=\" article-link\"></a>      :selector (:choose parent :match-query</span>
<span id=\"cb3-5\"><a href=\"#cb3-5\" aria-hidden=\"true\" tabindex=\"-1\" class=\" article-link\"></a>                         (:query</span>
<span id=\"cb3-6\"><a href=\"#cb3-6\" aria-hidden=\"true\" tabindex=\"-1\" class=\" article-link\"></a>                          (_ (start_tag (tag_name) @match)</span>
<span id=\"cb3-7\"><a href=\"#cb3-7\" aria-hidden=\"true\" tabindex=\"-1\" class=\" article-link\"></a>                             (end_tag (tag_name) @match))</span>
<span id=\"cb3-8\"><a href=\"#cb3-8\" aria-hidden=\"true\" tabindex=\"-1\" class=\" article-link\"></a>                          :engine combobulate)))))</span></code></pre></div>
<p class=\" text-justify\">For example, you can use <code>C-c o t c</code> (cursor edit by sequence) to edit matching HTML tags, and when you do so, this is the DSL declaration it “runs” to determine what to do. (If you’re inside a <code>tag_name</code> and it has an ancestor <code>element</code> then trigger the <code>:selector</code>)</p>
<p class=\" text-justify\">The underlying query (see <code>:query</code>), such as it is, works fine in TS’s query engine also, but with the side-effect of being recursive.</p>
<p class=\" text-justify\">I wrote the query engine back when I thought queries would play a much larger role in Combobulate. Back then, I naively assumed (as you do) that with the bountiful choices made available by a concrete syntax tree, all I had to do was write The Right Query and I could avoid a lot of imperative hand-wringing.</p>
<p class=\" text-justify\">As it turns out, the query engines (plural) are useless for most things related to structured navigation and editing. So despite the <em>theoretical</em> utility of the query engines, in reality I am slowly replacing most of the queries – the few that still remain today – with the DSL.</p>
<p class=\" text-justify\">The DSL is ironically better at picking things, despite its imperative-yet-declarative nature than an all-singing, all-dancing but weirdly limiting set of query engines.</p>
<p class=\" text-justify\">One example of where the DSL wins is <a href=\"/article/combobulate-intuitive-structured-navigation-treesitter\" class=\" article-link\">sibling navigation</a>, a topic I have covered at length before. Before I came up with the DSL, I’d started the arduous task of using building queries to pick all the keys in a dictionary; the arguments in a function definition; and so on, and so forth. Far too tedious as the query language is too limiting.</p>
<p class=\" text-justify\">Who knew?</p>
<p class=\" text-justify\">So, today, the query engines remain useful mostly for ad hoc highlighting; bulk editing, yes, still; and deft selection of nodes when the mini-DSL fails to do the job.</p>
<p class=\" text-justify\">You might wonder why I haven’t just extended my query language to suit my every need.</p>
<p class=\" text-justify\">The answer is that I feel that it is not really feasible to express these ideas in a language that – if we are to hew somewhat close to the original intent of the tree-sitter query language, and if we do not do that, then my DSL is already such a language! – is boxed in by its desire to be (as it should be!) a pattern matching language with a bunch of deterministic finite automata tacked on to solve the unenviable problem of having to support optional matches, quantifiers, negation, and so on.</p>
<p class=\" text-justify\">The DSL meanwhile relies on the idea of doing simple node type matching and then ascending or descending the tree to match other things based on simple set-theoretic filters and a handful of hardcoded instructions, such as “give me all the things that can go in an <code>if</code> statement except for this or that and then give me all siblings that match something else entirely”.</p>
<p class=\" text-justify\">So that is a brief summary of how the query engine looks like a panacea, but is ultimately not a great fit for most multi-cursor editing tasks, and indeed most precision editing and movement tasks, as you’d have to fight it and write a lot of imperative code anyway.</p>
<p class=\" text-justify\">Right. Let’s talk about some fun things instead.</p>
<H2 id=\"cursor-editing\">Cursor Editing</H2>
<p class=\" text-justify\">Combobulate’s had cursor editing for a long time. I recently rewrote the system to get rid of what was formerly known as <em>cluster editing</em>: basically the stuff you just read about. Like editing matching HTML tags.</p>
<p class=\" text-justify\">That feature is now called <em>sequence editing</em>, which uses the procedure system to edit any <em>sequence</em> Combobulate knows about, such as the oft-repeated HTML tags.</p>
<p class=\" text-justify\">My impetus for doing this is that the bulk of the cluster editors I’d written were a parallel way of doing sibling editing before I had proper, reliable <a href=\"/article/combobulate-intuitive-structured-navigation-treesitter\" class=\" article-link\">sibling navigation</a>.</p>
<p class=\" text-justify\">Sibling navigation is one of the most important keystone features in Combobulate as it is such a powerful catalyst for nearly all other editing and movement features in Combobulate, surprising as that may sound!</p>
<p class=\" text-justify\">Case in point: keys in a dictionary; elements in an array; function arguments. They are all siblings. They should be editable <em>as</em> siblings. And now they are.</p>
<p class=\" text-justify\">The <code>C-c o t s</code> command invokes the sibling editor. It works in any place where regular <code>C-M-n</code> and <code>C-M-p</code> sibling navigation works, as it uses the same code base.</p>
<figure>
<img src=\"/static/uploads/combobulate/combobulate-query-edit-shorthand.gif\" alt=\"/static/uploads/combobulate/combobulate-query-edit-shorthand.gif\" class=\" center-block\">
<figcaption>Here’s a simple example where I drop in and edit the shorthands in Typescript using the sibling editing command and multiple cursors.</figcaption>
</figure>
<p class=\" text-justify\">If I <em>didn’t</em> use the sibling system, I would’ve had to build a custom cluster query to mark the nodes instead. Tedium squared.</p>
<p class=\" text-justify\">But that’s all gone now. Except…</p>
<H3 id=\"clusters-sequences\">Clusters &amp; Sequences</H3>
<p class=\" text-justify\">The tag names in HTML tags (the <code>div</code> in <code>&lt;div&gt;</code>) are <em>not</em> siblings:</p>
<pre><code>(element
  (start_tag (tag_name))
  (end_tag (tag_name)))</code></pre>
<p class=\" text-justify\">Start and end tag <em>are</em> siblings, but we do not sibling navigate by start or end tag, but <code>element</code>. (There are good reasons for this.) So a call to <code>C-c o t s</code> with point at <code>&lt;div&gt;</code> would instead edit all <em>sibling elements</em> and not the two tag names. That, and the point would be in the wrong place: it should be here: <code>-!-div</code>. Not to the left of <code>&lt;</code> in <code>&lt;div&gt;</code> and <code>&lt;/div&gt;</code>. You can’t even <code>C-f</code> once to correct for it, as closing tags terminate with <code>&lt;/</code> and not <code>&lt;</code>, so you’d be off by one!</p>
<p class=\" text-justify\">That’s why we still need some form of “clustered editing”. Though in this case I scried an opportunity to improve navigation <em>as well as</em> retaining tag editing.</p>
<p class=\" text-justify\">New to the latest version of Combobulate is <em>sequence navigation</em>, bound to <code>M-n</code> and <code>M-p</code>. Most nodes lack a <em>sequent</em>; it is not a general purpose movement command, as it only applies in situations where nodes are sequences but not strictly speaking siblings.</p>
<p class=\" text-justify\">Put point inside a <code>&lt;tag&gt;</code> and you can use <code>M-n/p</code> to cycle between the start and end tag. That is <em>super helpful</em> if you work with SGML-alike languages. Use <code>C-c o t c</code> to sequence edit them.</p>
<p class=\" text-justify\">Now you have useful navigation <em>and</em> editing capabilities for places where things are not-quite-adjacent (like JSX and HTML). (If you can think of other cases, do raise a Github issue.)</p>
<p class=\" text-justify\">Ironically, this is a fine use case for the DSL <em>and</em> Combobulate’s query engine to ensure I drill down and pluck the tag names from the start and end tags.</p>
<H4 id=\"sequence-scanning\">Sequence Scanning</H4>
<p class=\" text-justify\">16+ years ago I wrote an awful lot of Borland Delphi for a living. I won’t get into how amazing the UI development experience was except to say that where that was the zenith of productivity, its garbage-tier code editor was surely the nadir. It didn’t even <em>indent your code for you</em>. Bah.</p>
<p class=\" text-justify\">It was a terrible editing experience, except for one little feature I loved in a third-party plugin: keyword scanning. If you pressed <code>M-p</code> or <code>M-n</code> on any identifier in the editor, it’d jump to it, but without the obsequiously stupid “Find Dialog” getting in your way to “help you find what you want”.</p>
<p class=\" text-justify\">I loved it so much it was one of the first things I wrote in Emacs Lisp, and talked about much later here. I called it <a href=\"/article/smart-scan-jump-symbols-buffer\" class=\" article-link\">Smart Scan: Jump between symbols in a buffer</a>.</p>
<p class=\" text-justify\">I still use it. But it annoyed me that I didn’t have a similar feature in Combobulate so others can benefit from its utility, and that the two keys the new sequence key bindings are now bound to conflict with smart scan.</p>
<p class=\" text-justify\">So I merged the features. If your point is in one of the few supported <em>sequences</em>, Combobulate will abide and only move between them. Try to move outside the “range” of valid options, and you’re shown an error: tap the key <em>again</em> without hesitation, and it switches to free-form scanning for that keyword anywhere in the buffer and “outside” the reign of tree-sitter. (It’s effectively akin to regexp searching for <code>\\&lt;foo\\&gt;</code>.)</p>
<p class=\" text-justify\">Use it anywhere else, and it launches into a freeform search mode for the symbol at point without first raising an error. The end result is you can safely navigate sequences and not worry about getting pulled away from what you’re looking for, while still having the freedom to do search out of bounds, so to speak, if you tap the key again.</p>
<H3 id=\"bulk-editing-with-combobulate\">Bulk Editing with Combobulate</H3>
<p class=\" text-justify\">There’s a handful of bulk editing commands that come with Combobulate.</p>
<table style=\"width:86%;\" class=\" table\">
<colgroup>
<col style=\"width: 43%\">
<col style=\"width: 43%\">
</colgroup>
<tbody>
<tr class=\"odd\">
<td><strong>Key Bindings</strong></td>
<td><strong>Description</strong></td>
</tr>
<tr class=\"even\">
<td><code>C-c o t t</code></td>
<td>Edit by node type DWIM</td>
</tr>
<tr class=\"odd\">
<td><code>C-c o t x</code></td>
<td>Edit by node text DWIM</td>
</tr>
<tr class=\"even\">
<td><code>C-c o t c</code></td>
<td>Edit sequence</td>
</tr>
<tr class=\"odd\">
<td><code>C-c o t s</code></td>
<td>Edit siblings</td>
</tr>
<tr class=\"even\">
<td><code>C-c o B q</code></td>
<td>Open query builder (interactive query building)</td>
</tr>
<tr class=\"odd\">
<td><code>C-c o B r</code></td>
<td>Display query from root to point</td>
</tr>
<tr class=\"even\">
<td><code>C-c o B p</code></td>
<td>Display query that matches node text at point</td>
</tr>
</tbody>
</table>
<p class=\" text-justify\">Aside from a handful of defaults in the <code>C-c o t</code> keymap, there are commands that build queries you can use as a baseline to create your own custom editors. My article on <a href=\"/article/combobulate-editing-searching-new-query-builder\" class=\" article-link\">Editing and Searching with the new Query Builder</a> goes into more detail on those.</p>
<p class=\" text-justify\">Most commands that “Do What I Mean” require a context locus that serves as a limit for cursor editing. You rarely want to edit the whole buffer. That way you can limit your node editing to just the current statement or function, for example, without having to manually remove cursors after the fact.</p>
<figure>
<img src=\"/static/uploads/combobulate/combobulate-expand-edit.gif\" alt=\"/static/uploads/combobulate/combobulate-expand-edit.gif\" class=\" center-block\">
<figcaption>Edit nodes by type with <code>C-c o t t</code>. You’re asked to confirm the locus (how far Combobulate should go look for nodes of the same type) to edit in one go, starting with just the element pair.</figcaption>
</figure>
<H4 id=\"multiple-cursors\">Multiple Cursors</H4>
<p class=\" text-justify\">I like multiple cursors, and it’s a tool I use all the time, but it <em>is</em> an external, though optional, dependency in Combobulate, and while I’m OK with that, it’s also something I feel shouldn’t be <em>required</em> for basic bulk editing. I want people to at least be able to use Combobulate’s editing facilities without requiring multiple cursors.</p>
<p class=\" text-justify\">Having said that, multiple cursors is well integrated into Combobulate. Every node has a start and an end, for example, so having the ability to insert a cursor at either end is especially useful.</p>
<table style=\"width:86%;\" class=\" table\">
<colgroup>
<col style=\"width: 43%\">
<col style=\"width: 43%\">
</colgroup>
<tbody>
<tr class=\"odd\">
<td><strong>Modifier Arguments</strong></td>
<td><strong>Description</strong></td>
</tr>
<tr class=\"even\">
<td><em>None</em></td>
<td>Place cursor at the start (default)</td>
</tr>
<tr class=\"odd\">
<td><code>C-u</code></td>
<td>Place cursor at the end</td>
</tr>
<tr class=\"even\">
<td><code>C-u C-u</code></td>
<td>Mark the node</td>
</tr>
</tbody>
</table>
<p class=\" text-justify\">You can control the placement of the cursors for any of the <em>edit</em> commands in the <code>C-c o t</code> key map by giving it a prefix key. By default cursors are placed at the start of a node; a single <code>C-u</code> argument changes that to the end.</p>
<p class=\" text-justify\">One of the benefits of multiple cursors is that it supports non-contiguous regions, so each cursor can have its own region. To mark things instead, prefix with <code>C-u C-u</code> instead. At that point you can use <code>C-x C-x</code> to swap point and mark to move between the start and end of the node.</p>
<H4 id=\"combobulates-field-editor\">Combobulate’s Field Editor</H4>
<figure>
<img src=\"/static/uploads/combobulate/combobulate-field-number.gif\" alt=\"/static/uploads/combobulate/combobulate-field-number.gif\" class=\" center-block\">
<figcaption>Appending and prepending text with the field editor.</figcaption>
</figure>
<p class=\" text-justify\">Combobulate has an advanced snippet templating tool feature called <em>envelopes</em> (check out <code>C-c o e ...</code>.) It has been around for a long time now (and more on that in another post!) and, like any good templating tool, it supports <em>fields</em>, but with an important difference: it uses the minibuffer prompt mechanism to query for input instead of expecting you to type into an overlay dyed and imbued with special properties in your buffer. Unlike the abandoned <em>Tempo</em> and <em>Skeleton</em> templating packages in Emacs, Combobulate updates the fields as you type in the minibuffer.</p>
<p class=\" text-justify\">Because Combobulate already has a templating tool, it was a snap reusing the code as a cursor editing system that works a little bit like a trad templating tool crossed with <code>C-x r t</code> (<code>M-x string-rectangle</code>), another Emacs classic that uses the rectangle system in Emacs to prefix text. The string rectangle feature’s a little too basic on its own — it’s useful, for sure, but I figured I could make Combobulate’s editor a bit more ergonomic and flexible than simply reinventing such a basic mechanic.</p>
<p class=\" text-justify\">A large part of the edits I make when I use multiple cursors are simple append/prepend operations to the existing text. Not always, but often. To facilitate that sort of editing, I needed a placeholder symbol in the minibuffer to represent each node’s text. Otherwise, I’d have no way of prepending <em>and</em> appending in the minibuffer: there is one minibuffer prompt, after all, but more than one node field to update, and each may have vastly different text.</p>
<p class=\" text-justify\">Ergo, there must be a generic placeholder that represents each field’s node text. Thinking about it some more, I realized that this is really not all that different from the replace regexp’s capturing group feature found in, among other places, <code>C-M-%</code>.</p>
<p class=\" text-justify\">So why not just use that? You gain a number of other ancillary benefits for “free” (well, it required more coding, but they’re benefits to <em>you</em>) when you start thinking about each node as its own capturing group.</p>
<table style=\"width:58%;\" class=\" table\">
<colgroup>
<col style=\"width: 29%\">
<col style=\"width: 29%\">
</colgroup>
<tbody>
<tr class=\"odd\">
<td><strong>Feature</strong></td>
<td><strong>Description</strong></td>
</tr>
<tr class=\"even\">
<td><code>\\0</code></td>
<td>Inserts the original text for each field</td>
</tr>
<tr class=\"odd\">
<td><code>\\N</code></td>
<td>Inserts the Nth field’s text</td>
</tr>
<tr class=\"even\">
<td><code>\\#</code></td>
<td>Inserts the number of the field, starting from 0</td>
</tr>
<tr class=\"odd\">
<td><code>\\,FORM</code></td>
<td><p class=\" text-justify\">Evaluates the elisp form FORM.</p>
<p class=\" text-justify\">Capturing groups are valid inside the form.</p></td>
</tr>
</tbody>
</table>
<p class=\" text-justify\">With a regular replace regexp, the <code>\\N</code> notation represents the N’th match, with the number <code>0</code> being the whole match string. In Combobulate, <code>\\0</code> now represents the match string for each localized field you’re editing. So the default prompt value in Combobulate is <code>\\0</code> meaning: just insert the original text you started with.</p>
<p class=\" text-justify\">All other numbers represent that particular node’s text. So <code>\\1</code> is the first node; <code>\\2</code> is the second, and so forth.</p>
<p class=\" text-justify\">That means it’s possible to not only replace every match with the content of a particular field, but also combine them. Maybe you want to merge the second and third fields’ text?</p>
<p class=\" text-justify\">Another regexp feature is the ability to insert the match number. By counting from the top-most field, you can insert the index of each field with <code>\\#</code> as a practical and cheap way of enumerating things. It counts from 0.</p>
<p class=\" text-justify\"><code>C-M-%</code> has a really cool – and quite hidden – feature: <a href=\"/article/evaluating-lisp-forms-regular-expressions\" class=\" article-link\">it can evaluate Lisp Forms inside Regular Expressions</a>. I’ve written about it before; it’s such an underrated feature. I do not need it often, but when I do, it’s nice to know I can combine the power of elisp with regexp search and replace.</p>
<figure>
<img src=\"/static/uploads/combobulate/combobulate-field-editor-eval-form.gif\" alt=\"/static/uploads/combobulate/combobulate-field-editor-eval-form.gif\" class=\" center-block\">
<figcaption>Evaluating forms in Combobulate’s field editor works much the same as it does in <code>C-M-%</code>. Here I’m uppercasing all the fields’ names using <code>upcase</code> and the <code>\\0</code> capturing group.</figcaption>
</figure>
<p class=\" text-justify\">In addition to <em>all that</em>, there are key bindings in the field editor minibuffer (you can also see the key bindings by tapping <code>C-h</code> in the prompt):</p>
<table style=\"width:86%;\" class=\" table\">
<colgroup>
<col style=\"width: 43%\">
<col style=\"width: 43%\">
</colgroup>
<tbody>
<tr class=\"odd\">
<td><strong>Key Bindings</strong></td>
<td><strong>Description</strong></td>
</tr>
<tr class=\"even\">
<td><code>C-n</code></td>
<td>Move to next field</td>
</tr>
<tr class=\"odd\">
<td><code>C-p</code></td>
<td>Move to previous field</td>
</tr>
<tr class=\"even\">
<td><code>C-v</code></td>
<td>Toggle the current field on or off</td>
</tr>
<tr class=\"odd\">
<td><code>C-i</code></td>
<td>Invert fields’ editable state</td>
</tr>
<tr class=\"even\">
<td><code>C-h</code></td>
<td>Show the help</td>
</tr>
</tbody>
</table>
<p class=\" text-justify\">You can scroll through the fields with <code>C-n/p</code>. You’ll need these if you want a closer look at the matched fields. You’re free to just switch to the buffer and scroll also, of course!</p>
<p class=\" text-justify\"><em>Unlike</em> multiple cursors, you can toggle the fields on or off. Do you want to bulk edit all the keys in a JSON object <em>except</em> one key? Now you can. Just move with <code>C-n/p</code> to the field in question and toggle it with <code>C-v</code>. <code>C-i</code> does much the same: it inverts the state of all fields.</p>
<p class=\" text-justify\">The field editor’s not perfect, but then nor is multiple cursors.</p>
<H4 id=\"a-quick-comparison-between-the-two\">A quick Comparison between the two</H4>
<p class=\" text-justify\">Multiple cursors is, to me, an indispensable tool, and I will continue to use it for things that warrant it.</p>
<p class=\" text-justify\">The field editor is better for explicit, bulk edits where you do not require the flexibility or precision you get by having a point placed at every field.</p>
<p class=\" text-justify\">It is not possible to gingerly delete some characters or operate on partial node text matches with the field editor. (Though I suppose you could try with the Lisp form evaluation.)</p>
<p class=\" text-justify\">Simultaneously, it is not so easy to quickly prepend or append to the node text with MC. In fact, there is (to my knowledge) no way of declaring a ‘range’ to a cursor. Once it is created it is subject to the whims of the editing and movement you do in the buffer.</p>
<p class=\" text-justify\">You <em>can</em> use the <code>C-u C-u</code> argument to mark the nodes, which does give you some control over the start and end, but explicitly inserting something at the start of the node and then the end is perhaps not possible at all, if the node is not something you can quickly find the ‘end of’ with either Combobulate’s movement commands or Emacs’.</p>
<p class=\" text-justify\">MC does support some form of killing and yanking, but I find it awful and borderline unusable. If you want to merge or join nodes’ text together, you’re better off with a keyboard macro or the field editor.</p>
<p class=\" text-justify\">The other major advantage of the field editor is that it ships with Combobulate. It is also relatively easy to add new, explicit, commands to do things in the future.</p>
<p class=\" text-justify\">So. There are trade-offs to both approaches, but now you at least have a choice of what to use.</p>
<p class=\" text-justify\">Let me know what you think.</p>
<p class=\" text-justify\">Happy (bulk) editing!</p>
") (guid ((isPermaLink . "false")) "/article/combobulate-bulk-editing-treesitter-nodes-multiple-cursors") (pubDate nil "Thu, 19 Sep 2024 08:54:31 +0000"))) ("What's New in Emacs 30.1?" "<p class=\" text-justify drop-cap\">Emacs 30.1 is upon us, and it’s time for another bumper release full of new features and improvements.</p>
<p class=\" text-justify\">As always, I have taken the time to go through most of the changes in Emacs 30.1 and annotated them to give perspective and clarity.</p>
<p class=\" text-justify\">Here is but a few of the highlights in 30.1:</p>
<ul>
<li><p class=\" text-justify\"><code>completion-preview-mode</code> is a tantalizing replacement for company mode and corfu as it combines the buffer and window system (the <code>*Completions*</code> window when you minibuffer complete with <code>TAB</code>) with an <em>excellent</em> user experience by adding a schnazzy predictive typing that the old auto complete package did. I think <code>*Completions*</code> system already in Emacs, combined with the preview option, makes it a useful alternative to Company / Corfu for some.</p>
<p class=\" text-justify\">You also get to leverage the full force of Emacs’s expansive set of minibuffer completion styles, orders and more, though preview mode does have a few limitations around the style you can use.</p>
<p class=\" text-justify\">This is my favorite feature in Emacs 30.1. The user experience is superb; someone really cared for this, and it shows.</p></li>
<li><p class=\" text-justify\">The Org URI protocol should now register automatically, meaning you can send data from a browser bookmarklet straight into org capture in your running Emacs instance.</p>
<p class=\" text-justify\">The org protocol feature’s not new to Emacs 30.1, but automatically configuring your Emacs on Linux so it works properly <em>is</em>.</p></li>
<li><p class=\" text-justify\">Which-key is now built in, which is good news for people who prefer that method of help (as opposed to typing <code>C-h</code> in a key chord).</p></li>
<li><p class=\" text-justify\"><code>libjansson</code> is dead; long live Emacs’s builtin JSON parser. The new parser is much faster.</p></li>
<li><p class=\" text-justify\">The tree-sitter-specific <code>*-sexp</code> commands (such as <code>forward-sexp</code>) now work well.</p></li>
<li><p class=\" text-justify\">Native compilation is on by default, provided your system has the required dependencies. A massive vote of confidence for a great feature.</p></li>
<li><p class=\" text-justify\">Full support for Emacs on Android, and a whole host of touch screen-related improvements to Emacs as a result.</p></li>
<li><p class=\" text-justify\">You can now request a diff of your multi-file replace regexp (see <code>C-h a replace diff</code>)</p></li>
<li><p class=\" text-justify\">More Tramp (Emacs’s remote file editing system) connections, including support for Kubernetes pods.</p></li>
</ul>
<p class=\" text-justify\">I will, as per usual, begin to update <a href=\"/book\" class=\" article-link\">my book, Mastering Emacs</a>, so it includes these latest changes.</p>
<p class=\" text-justify\">Until then, and for the next couple of days, you can enjoy a 30% discount on my book. Enjoy!</p>
<H2 id=\"installation-changes-in-emacs-30.1\">Installation Changes in Emacs 30.1</H2>
<pre><code>Native compilation is now enabled by default.
'configure' will enable the Emacs Lisp native compiler, so long as
libgccjit is present and functional on the system.  To disable native
compilation, configure Emacs with the option:

    ./configure --with-native-compilation=no</code></pre>
<p class=\" text-justify\">That is good news. I’m hoping by declaring that native compilation, a must-have feature that <a href=\"/article/speed-up-emacs-libjansson-native-elisp-compilation\" class=\" article-link\">compiles elisp into native code</a> and greatly speeds up your Emacs, it encourage more distros to adopt the setting, if they have not already. If you’re the type to compile your own Emacs, you may want to read my article as it does require a few mandatory components that most Linux distributions do not ship with.</p>
<pre><code>Emacs has been ported to the Android operating system.
This requires Emacs to be compiled on another computer.  The Android
NDK, SDK, and a suitable Java compiler must also be installed.

See the file \"java/INSTALL\" for more details.</code></pre>
<p class=\" text-justify\">I’ve been following this development for quite a while, and it’s wonderful to see that you can run a full-blown Emacs instance on Android <em>and</em> with the support of the Emacs developers behind it. How exciting. I’ll have to find the time to play around with it.</p>
<pre><code>Native JSON support is now always available; libjansson is no longer used.
No external library is required.  The '--with-json' configure option has
been removed.  'json-available-p' now always returns non-nil and is only
kept for compatibility.</code></pre>
<p class=\" text-justify\">JSON is a massive bottleneck when you’re using LSP servers, as LSPs are chatty and JSON is how they communicate. I wrote about the introduction of <a href=\"/article/speed-up-emacs-libjansson-native-elisp-compilation\" class=\" article-link\">libjansson</a> when it was first introduced as it made a noticeable difference in performance back when it made an optional dependency in Emacs. It turns out that libjansson is not that quick. One day, a new contributor, Géza Herman, showed up with a JSON parser that was not only faster than libjansson, but more complete in its implementation.</p>
<p class=\" text-justify\">As a result libjansson is not only deprecated but removed entirely. Excellent!</p>
<pre><code>Emacs now defaults to the ossaudio library for sound on NetBSD and OpenBSD.
Previously, configure used ALSA libraries if installed on the system
when configured '--with-sound=yes' (which is the default), with fallback
to libossaudio.  The libossaudio library included with the base system
is now used even if ALSA is found to avoid relying on external packages
and to resolve potential incompatibilities between GNU/Linux and *BSD
versions of ALSA.  Use '--with-sound=alsa' to build with ALSA on these
operating systems instead.</code></pre>
<pre><code>New configuration option '--disable-gc-mark-trace'.
This disables the GC mark trace buffer for about 5% better garbage
collection performance.  Doing so may make it more difficult for Emacs
developers to help finding GC-related bugs that you run into, which is
why the mark trace buffer is enabled by default.</code></pre>
<p class=\" text-justify\">If you’re the type of person to compile your own Emacs, you might as well give this one a whirl. GC bugs do happen, but I’d say they’re rare enough that you can turn it off and claim your 5% speed-up voucher.</p>
<H2 id=\"startup-changes-in-emacs-30.1\">Startup Changes in Emacs 30.1</H2>
<pre><code>On GNU/Linux, Emacs is now the default application for 'org-protocol'.
Org mode provides a way to quickly capture bookmarks, notes, and links
using 'emacsclient':

    emacsclient \"org-protocol://store-link?url=URL&amp;title=TITLE\"

Previously, users had to manually configure their GNU/Linux desktop
environment to open 'org-protocol' links in Emacs.  These links should
now open in Emacs automatically, as the \"emacsclient.desktop\" file now
arranges for Emacs to be the default application for the 'org-protocol'
URI scheme.  See the Org mode manual, Info node \"(org) Protocols\" for
more details.</code></pre>
<p class=\" text-justify\">OK, no lie, this is a really cool feature that just got easier to use.</p>
<p class=\" text-justify\">Org can register (on Windows, Linux, etc.) itself as a URI protocol controller. When you open a <code>https</code> hyperlink, your OS knows it has to use your preferred browser; ditto for e-mail. Here it’s called <code>org-protocol</code>, and with this new change (or the slightly more manual steps outlined <a href=\"https://orgmode.org/worg/org-contrib/org-protocol.html\" class=\" article-link\">in the org mode manual</a>) you can request that <code>org-protocol://....</code> contents are sent to your Emacs for processing.</p>
<p class=\" text-justify\">That means you can send information to Org from other tools — such as the commandline or, more tantalizingly, from your web browser or even e-mails, provided your e-mail client follows hyperlinks and supports custom protocols.</p>
<p class=\" text-justify\">Provided you’ve done the installation steps (I recommend you check out the <a href=\"https://orgmode.org/worg/org-contrib/org-protocol.html\" class=\" article-link\">the link</a> if the example below does not work) you can use a snippet like this in a Bookmarklet in your browser – or straight into the console for testing:</p>
<pre><code>javascript:location.href = 'org-protocol://capture?' +
    new URLSearchParams({
          template: \"m\",
          url: location.href,
          title: document.title,
          body: window.getSelection()})</code></pre>
<p class=\" text-justify\">Replacing <code>template: \"m\"</code> with the <code>M-x org-capture</code> template key of your choice. The document’s title, URL and text selection is then sent to your org capture.</p>
<p class=\" text-justify\">Pretty darn cool! If you’re an org mode user – I know you are! – you should get on top of this right away.</p>
<p class=\" text-justify\">You can even register your own protocols (<code>org-protocol-protocol-alist</code>) and build your own integrations, and it’s not like you have to feed it into org!</p>
<pre><code>New variable lets Lisp code read emacsclient arguments.
When '--eval' is passed to emacsclient and Emacs is evaluating each
argument, the new variable 'server-eval-args-left' is set to those
arguments not yet evaluated.  It can be used by Lisp code to 'pop'
arguments and process them by the function called in the '--eval'
expression, which is useful when those arguments contain arbitrary
characters that otherwise might require elaborate and error-prone
escaping (to protect them from the shell).</code></pre>
<p class=\" text-justify\">Do not sleep on Emacs’s client-server architecture, or the headless evaluation feature it has. My article on <a href=\"/article/fuzzy-finding-emacs-instead-of-fzf\" class=\" article-link\">Fuzzy Finding with Emacs Instead of fzf</a> is a great example of how two dozen lines of elisp and another baker’s dozen of bash can clone the keystone feature of <code>fzf</code>.</p>
<H2 id=\"incompatible-changes-in-emacs-30.1\">Incompatible Changes in Emacs 30.1</H2>
<pre><code>Tree-Sitter modes are now declared as submodes of the non-TS modes.
In order to help the use of those Tree-Sitter modes, they are now
declared to have the corresponding non-Tree-Sitter mode as an
additional parent.
This way, things like \".dir-locals.el\" settings, and YASnippet
collections of snippets automatically apply to the new Tree-Sitter modes.

Note that those modes still do not inherit from the non-TS mode, so
configuration settings installed via mode hooks are not affected.

Loading a Tree-Sitter mode (such as by using 'M-x load-library' or with
'M-x load-file') by default causes the corresponding non-Tree-Sitter
mode be remapped to the Tree-Sitter mode.  This remapping affects
visiting files for which 'auto-mode-alist' specifies a non-Tree-Sitter
mode, and also affects mode-specification cookies on the first line of a
file and mode specifications in file- and directory-local variables.  To
revert to using a non-Tree-Sitter mode, reload the corresponding mode
file anew.  To prevent file loading from turning on Tree-Sitter mode
when 'auto-mode-alist' or the file/directory-local variables specify a
non-Tree-Sitter mode, customize the user option 'major-mode-remap-alist'
to specify that a non-Tree-Sitter mode is \"remapped\" to itself.  For
example:

    (add-to-list 'major-mode-remap-alist '(c-mode))

specifies that C Mode should not be remapped to 'c-ts-mode' even if and
when 'c-ts-mode' is loaded.  Conversely,

    (add-to-list 'major-mode-remap-alist '(c-mode . c-ts-mode))

tells Emacs to always invoke 'c-ts-mode' whenever 'c-mode' is
requested, either by 'auto-mode-alist' or by file/directory-local
variables.

We recommend using 'major-mode-remap-alist' to express your preferences
for using Tree-Sitter or non-Tree-Sitter modes for files for which both
variants of major modes are available, because that variable overrides
the remapping Emacs might decide to perform as result of loading Lisp
files and features.</code></pre>
<p class=\" text-justify\">I mean, I’m glad they’re slowly making these changes, as the tree-sitter modes are threadbare. Aside from better (usually) syntax highlighting and indentation, they rarely offer much.</p>
<p class=\" text-justify\">But this is yet another thing to explain to people that, yes, now your dir-locals will pick up on the TS mode you’re using, but all the other features present in the old major modes probably don’t work.</p>
<p class=\" text-justify\">In my opinion, tree-sitter major modes should be deprecated and the syntax highlighting and indentation relegated to optional minor modes you can enable in the existing major modes (and obviously brand new ones, if no such major modes exist) and all other “tree-sitter-portable” custom commands are gated behind a feature flag that require the presence of TS and the right grammar file to work, with perhaps a fallback for things that can be implemented – or is already – with non-TS code.</p>
<pre><code>Mouse wheel events should now always be 'wheel-up/down/left/right'.
At those places where the old 'mouse-4/5/6/7' events could still occur
(i.e., X11 input in the absence of XInput2, and 'xterm-mouse-mode'),
we remap them to the corresponding 'wheel-up/down/left/right' event,
according to the new user option 'mouse-wheel-buttons'.
The old variables 'mouse-wheel-up-event', 'mouse-wheel-down-event',
'mouse-wheel-left-event', and 'mouse-wheel-right-event' are thereby
obsolete.</code></pre>
<p class=\" text-justify\">I’ve never in my life been able to remember what the numbers map to, so I this is a useful aid to me and, no doubt, anybody else looking to remap or just figure out what a mouse event is.</p>
<pre><code>'completion-auto-help' now affects 'icomplete-in-buffer'.
Previously, 'completion-auto-help' mostly affected only minibuffer
completion.  Now, if 'completion-auto-help' has the value 'lazy', then
Icomplete's in-buffer display of possible completions will only appear
after the 'completion-at-point' command has been invoked twice, and if
'completion-auto-help' is nil, then Icomplete's in-buffer display is
completely suppressed.  Thus, if you use 'icomplete-in-buffer', ensure
'completion-auto-help' is not customized to 'lazy' or nil.</code></pre>
<pre><code>The \"*Completions*\" buffer now always accompanies 'icomplete-in-buffer'.
Previously, it was not consistent whether the \"*Completions*\" buffer would
appear when using 'icomplete-in-buffer'.  Now the \"*Completions*\" buffer
and Icomplete's in-buffer display of possible completions always
appear together.  If you would prefer to see only Icomplete's
in-buffer display, and not the \"*Completions*\" buffer, you can add this
to your init file:

    (advice-add 'completion-at-point :after #'minibuffer-hide-completions)</code></pre>
<p class=\" text-justify\">This governs the <code>*Completions*</code> window that may (or may not, as the case may be) pop up to offer assistance if when you are completing. If you use the default completion mechanism in Emacs, you may want to consider looking into tweaking this, if you find the current <code>*Completions*</code> behavior is not to your liking.</p>
<pre><code>The default process filter was rewritten in native code.
The round-trip through the Lisp function
'internal-default-process-filter' is skipped when the process filter is
the default one.  It is reimplemented in native code, reducing GC churn.
To undo this change, set 'fast-read-process-output' to nil.</code></pre>
<p class=\" text-justify\">Anything that speeds up a known and serious IO bottleneck in Emacs is welcome news to me. The fact they named the variable <code>fast-read-process-output</code> says it all.</p>
<pre><code>Network Security Manager now warns about 3DES by default.
This cypher is no longer recommended owing to a major vulnerability
disclosed in 2016, and its small 112 bit key size.  Emacs now warns
about its use also when 'network-security-level' is set to 'medium'
(the default).  See 'network-security-protocol-checks'.</code></pre>
<pre><code>Network Security Manager now warns about &lt;2048 bits in DH key exchange.
Emacs used to warn for ephemeral Diffie-Hellman (DHE) key exchanges with
prime numbers smaller than 1024 bits.  Since more servers now support
it, this number has been bumped to 2048 bits.</code></pre>
<pre><code>URL now never sends user email addresses in HTTP requests.
Emacs never sent email addresses by default, but it used to be
possible to customize 'url-privacy-level' so that the user's email
address was sent along in HTTP requests.  This feature has now been
removed, as it was considered more dangerous than useful.  RFC 9110
(§ 10.1.2) also recommends against it.  The user option
'url-personal-mail-address' is now also obsolete.

To send an email address in the header of individual HTTP requests,
see the variable 'url-request-extra-headers'.</code></pre>
<p class=\" text-justify\">I am not sure why there was ever the option of sending email addressed alongside HTTP requests. I don’t recall that ever being a thing in the 90s either, but perhaps that is just my memory failing me.</p>
<pre><code>'pixel-scroll-precision-mode' sets 'make-cursor-line-fully-visible'.
'pixel-scroll-precision-mode' sets 'make-cursor-line-fully-visible' to a
nil value globally, since the usual requirement of the Emacs display to
make the cursor line fully visible contradicts the smooth scrolling
expectations.</code></pre>
<p class=\" text-justify\">I recommend you try <a href=\"https://github.com/jdtsmith/ultra-scroll\" class=\" article-link\">ultra-scroll</a> if you’re serious about wanting smooth scrolling in Emacs.</p>
<H2 id=\"changes-in-emacs-30.1\">Changes in Emacs 30.1</H2>
<pre><code>Fix shell injection vulnerability in man.el (CVE-2025-1244).
We urge all users to upgrade immediately.</code></pre>
<pre><code>New user option 'trusted-content' to allow potentially dangerous features.
This option lists those files and directories whose content Emacs should
consider as sufficiently trusted to run any part of the code contained
therein even without any explicit user request.

For example, Flymake's backend for Emacs Lisp consults this option
and disables itself with an \"untrusted content\" warning if the file
is not listed.

Emacs Lisp authors should note that a major or minor mode must never set
this option to the ':all' value.

This option is used to fix CVE-2024-53920.  See below for details.</code></pre>
<p class=\" text-justify\">It shouldn’t come as a surprise to anybody that Emacs, a dynamic computing environment, can be coaxed into running stuff it shouldn’t. Ideally that’d never happen, but given the nature of what Emacs does – and how integrated it is in our lives – it is no surprise that on occasion its power is turned against it. What surprises me is that these issues don’t happen more frequently.</p>
<pre><code>Emacs now supports Unicode Standard version 15.1.</code></pre>
<pre><code>Emacs now comes with Org v9.7.
See the file \"etc/ORG-NEWS\" for user-visible changes in Org.</code></pre>
<pre><code>Improved support for touchscreen devices.
On systems that understand them (at present X, Android, PGTK, and
MS-Windows), many touch screen gestures are now implemented and
translated into mouse or gesture events, and support for tapping tool
bar buttons and opening menus has been added.  Countless packages, such
as Dired and Custom, have been adjusted to better understand touch
screen input.</code></pre>
<p class=\" text-justify\">This obviously goes hand in hand with the Android changes. The myth that Emacs is a keyboard only system is obviously false, and it has been since Lucid/XEmacs improved mouse support in the 1990s. Now that touch screen support is improved, I’m curious to see if we’ll see the emergence of org packages/email clients on Android that lean into the new touch support.</p>
<pre><code>Support for styled underline face attributes.
These are implemented as new values of the 'style' attribute in a face
underline specification, 'double-line', 'dots', and 'dashes', and are
available on GUI systems.  If your terminal's termcap or terminfo
database entry defines the 'Su' or 'Smulx' capability, Emacs will also
emit the prescribed escape sequence to render faces with such styles on
TTY frames.</code></pre>
<pre><code>Support for underline colors on TTY frames.
Colors specified in the underline face will now also be displayed on TTY
frames on terminals that support the 'Su' or 'Smulx' capabilities.</code></pre>
<p class=\" text-justify\">This is addition to things like squiggly underlines that we’ve had for a long time now. I’m quite surprised that terminals can render anything other than a opaque line, though; that is news to me.</p>
<pre><code>Modeline elements can now be right-aligned.
Anything following the symbol 'mode-line-format-right-align' in
'mode-line-format' will be right-aligned.  Exactly where it is
right-aligned to is controlled by the new user option
'mode-line-right-align-edge'.</code></pre>
<p class=\" text-justify\">Can’t say I’ve ever had the desire to heavily mod my mode line, but I know that a lot of people care greatly about its aethestics. I’m sure this is of benefit to people who use right-to-left languages also; perhaps they are the primary users?</p>
<pre><code>X selection requests are now handled much faster and asynchronously.
This means it should be less necessary to disable the likes of
'select-active-regions' when Emacs is running over a slow network
connection.</code></pre>
<pre><code>Emacs now updates invisible frames that are made visible by a compositor.
If an invisible or an iconified frame is shown to the user by the
compositing manager, Emacs will now redisplay such a frame even though
'frame-visible-p' returns nil or 'icon' for it.  This can happen, for
example, as part of preview for iconified frames.</code></pre>
<p class=\" text-justify\">I guess this refers to the ‘window peek’ feature in Windows’ taskbar, and that it’s really more of a bugfix / tweak more than an actual feature.</p>
<pre><code>Most file notification backends detect unmounting of a watched filesystem.
The only exception is w32notify.</code></pre>
<p class=\" text-justify\">Emacs will watch file changes using a range of mechanisms depending on the platform of choice.</p>
<pre><code>The ':map' property of images is now recomputed when image is transformed.
Images with clickable maps now work as expected after you run commands
such as 'image-increase-size', 'image-decrease-size', 'image-rotate',
'image-flip-horizontally', and 'image-flip-vertically'.
Set the new user option 'image-recompute-map-p' to nil to prevent Emacs
from recomputing image maps.</code></pre>
<H2 id=\"minibuffer-and-completions\">Minibuffer and Completions</H2>
<pre><code>New commands 'previous-line-completion' and 'next-line-completion'.
Bound to '&lt;up&gt;' and '&lt;down&gt;' arrow keys, respectively, they navigate
the \"*Completions*\" buffer vertically by lines, wrapping at the
top/bottom when 'completion-auto-wrap' is non-nil.</code></pre>
<pre><code>New user option 'minibuffer-visible-completions'.
When customized to non-nil, you can use arrow keys in the minibuffer
to navigate the completions displayed in the \"*Completions*\" window.
Typing 'RET' selects the highlighted candidate.  'C-g' hides the
completions window.  When the completions window is not visible,
then all these keys have their usual meaning in the minibuffer.
This option is supported for in-buffer completion as well.</code></pre>
<pre><code>Selected completion candidates are deselected on typing.
When you type at the minibuffer prompt, the current completion
candidate will be un-highlighted, and point in the \"*Completions*\" window
will be moved off that candidate.  'minibuffer-choose-completion'
('M-RET') will still choose a previously-selected completion
candidate, but the new command 'minibuffer-choose-completion-or-exit'
(bound to 'RET' by 'minibuffer-visible-completions') will exit with
the minibuffer contents instead.  This deselection behavior can be
controlled with the new user option 'completion-auto-deselect', which
is t by default.</code></pre>
<p class=\" text-justify\">There’s a longer-running theme to try and make the <code>*Completions*</code> window useful in contexts outside the minibuffer’s completion mechanism. This mechanism is rather confusingly named <code>completion-in-region</code>, even though it’s not just about acting on a region. If you use popup completion tools like company and corfu, then you should consider experimenting with this improved completion system, as it’s a “native” buffer-and-window-based approach to the same.</p>
<pre><code>New value 'historical' for user option 'completions-sort'.
When 'completions-sort' is set to 'historical', completion candidates
will be first sorted alphabetically, and then re-sorted by their order
in the minibuffer history, with more recent candidates appearing first.</code></pre>
<p class=\" text-justify\">There are popular third-party packages that do much of this already, so it’s nice to see that a similar feature has made it into core. My article on <a href=\"/article/understanding-minibuffer-completion\" class=\" article-link\">Understanding Minibuffer Completion</a> goes into more detail on how to configure minibuffer completion in Emacs.</p>
<pre><code>'completion-category-overrides' supports more metadata.
The new supported completion properties are 'cycle-sort-function',
'display-sort-function', 'annotation-function', 'affixation-function',
and 'group-function'.  You can now customize them for any category in
'completion-category-overrides' that will override the properties
defined in completion metadata.</code></pre>
<pre><code>'completion-extra-properties' supports more metadata.
The new supported completion properties are 'category',
'group-function', 'display-sort-function', and 'cycle-sort-function'.</code></pre>
<p class=\" text-justify\">See <a href=\"/article/understanding-minibuffer-completion\" class=\" article-link\">my article</a> for more information on customizing Emacs’s minibuffer.</p>
<H2 id=\"windows\">Windows</H2>
<pre><code>New command 'toggle-window-dedicated'.
This makes it easy to interactively mark a specific window as
dedicated, so it won't be reused by 'display-buffer'.  This can be
useful for complicated window setups.  It is bound to 'C-x w d'
globally.</code></pre>
<pre><code>\"d\" in the mode line now indicates that the window is dedicated.
Windows have always been able to be dedicated to a specific buffer;
see 'window-dedicated-p'.  Now the mode line indicates the dedicated
status of a window, with \"d\" appearing in the mode line if a window is
dedicated and \"D\" if the window is strongly dedicated.  This indicator
appears before the buffer name, and after the buffer modification and
remote buffer indicators (usually \"---\" together).</code></pre>
<p class=\" text-justify\">Coaxing Emacs into putting your windows where you want them to go is a common source of frustrating. I wrote <a href=\"/article/demystifying-emacs-window-manager\" class=\" article-link\">Demystifying Emacs’s Window Manager</a> in part to help people wrangle the windows into place. Dedicated windows are a blunt (though useful) tool that tells Emacs not to use a window for anything other than what is in it already. This feature mirrors what you find in a lot of other IDEs and editors where most windows have a singular purpose, unlike Emacs’.</p>
<pre><code>New action alist entry 'some-window' for 'display-buffer'.
It specifies which window 'display-buffer-use-some-window' should prefer.
For example, when 'display-buffer-base-action' is customized to
'(nil . ((some-window . mru)))', then a buffer will be displayed
in the same most recently used window from consecutive calls of
'display-buffer' (in a configuration with more than two windows).</code></pre>
<p class=\" text-justify\">This is pretty advanced stuff, but if you’re unhappy with the default methods employed by Emacs (see <code>display-buffer-fallback-action</code>) you can now tell it to more aggressively reuse windows using the “most recently used” order of windows.</p>
<pre><code>New action alist entry 'category' for 'display-buffer'.
If the caller of 'display-buffer' passes '(category . symbol)'
in its 'action' argument, you can match the displayed buffer
by adding '(category . symbol)' to the condition part of
'display-buffer-alist' entries.</code></pre>
<p class=\" text-justify\">I do not think you’re likely to encounter code that does this just yet, but I suppose this is one way of disambiguating windows that may share the same buffer name or major mode, but differ in some crucial way that only a custom cons cell <code>category</code> can sort out.</p>
<p class=\" text-justify\">Pretty niche. You’re probably not going to use this <em>really</em> into <code>display-buffer-alist</code>.</p>
<pre><code>New action alist entry 'post-command-select-window' for 'display-buffer'.
It specifies whether the window of the displayed buffer should be
selected or deselected at the end of executing the current command.</code></pre>
<pre><code>New variable 'window-restore-killed-buffer-windows'.
It specifies how 'set-window-configuration' and 'window-state-put'
should proceed with windows whose buffer was killed after the
corresponding configuration or state was recorded.</code></pre>
<p class=\" text-justify\">Window configurations are, well, configurations of windows. They are snapshots of window layouts: <code>C-x r w</code> puts your current window configuration into a register, and that is one such use; the other is tab bars in <code>tab-bar-mode</code>. Both set and restore window configurations when you change tabs or explicitly change them with a register. This variable’s really quite complex, so if you have strong opinions on this (you probably do not) then you really should read the lengthy docstring for this variable.</p>
<pre><code>New variable 'window-point-context-set-function'.
It can be used to set a context for window point in all windows by
'window-point-context-set' before calling 'current-window-configuration'
and 'window-state-get'.  Then later another new variable
'window-point-context-use-function' can be used by
'window-point-context-use' after 'set-window-configuration' and
'window-state-put' to restore positions of window points
according to the context stored in a window parameter.</code></pre>
<p class=\" text-justify\">Emacs tracks the position of point by <em>window</em> and not by buffer, as you may think. Split your current buffer and then move the point in one window and switch to the other: observe that your point is remembered between each window. Very handy, that, and this (alongside the window configuration stuff I mentioned before) is what this is about. You… probably don’t care.</p>
<pre><code>New functions 'set-window-cursor-type' and 'window-cursor-type'.
'set-window-cursor-type' sets a per-window cursor type, and
'window-cursor-type' queries this setting for a given window.  Windows
are always created with a 'window-cursor-type' of t, which means to
consult the variable 'cursor-type' as before.</code></pre>
<p class=\" text-justify\">You can now change the cursor type for each window. Neat. The variable <code>cursor-type</code> used to just override it for the whole Emacs session.</p>
<pre><code>The user option 'display-comint-buffer-action' is now obsolete.
You can use a '(category . comint)' condition in 'display-buffer-alist'
to match buffers displayed by comint-related commands.  Another
user option 'display-tex-shell-buffer-action' is obsolete too
for which you can use '(category . tex-shell)'.</code></pre>
<p class=\" text-justify\">I suppose this is what the change above is really about: to remove bespoke code and generalize it into the new category system.</p>
<H2 id=\"tool-bars\">Tool bars</H2>
<pre><code>Tool bars can now be placed on the bottom on more systems.
The 'tool-bar-position' frame parameter can be set to 'bottom' on all
window systems other than macOS and GNUstep (Nextstep).</code></pre>
<pre><code>New global minor mode 'modifier-bar-mode'.
When this minor mode is enabled, the tool bar displays buttons
representing modifier keys.  Clicking on these buttons applies the
corresponding modifiers to the next input event.</code></pre>
<p class=\" text-justify\">Useful on portable devices (like Android) that may not have certain modifier keys on its native keyboard.</p>
<pre><code>New user option 'tool-bar-always-show-default'.
When non-nil, the tool bar at the top of a frame does not show buffer
local customization of the tool bar.  The default value is nil.</code></pre>
<H2 id=\"tab-bars-and-tab-lines\">Tab Bars and Tab Lines</H2>
<p class=\" text-justify\">Tab bars are window configurations; tab lines are basically tabs like they appear in your browser.</p>
<pre><code>New user option 'tab-bar-select-restore-context'.
It uses 'window-point-context-set' to save contexts where
window points were located before switching away from the tab,
and 'window-point-context-use' to restore positions of window
points after switching back to that tab.</code></pre>
<p class=\" text-justify\">If you have multiple tabs featuring the same buffer, you can now preserve the point location between tabs.</p>
<pre><code>New user option 'tab-bar-select-restore-windows'.
It defines what to do with windows whose buffer was killed since the tab
was last selected.  By default it displays a placeholder buffer
with the name \" *Old buffer &lt;name&gt;*\" that provides information about
the name of the killed buffer that was displayed in that window.</code></pre>
<pre><code>New user option 'tab-bar-tab-name-format-functions'.
It can be used to add, remove and reorder functions that change the
appearance of every tab on the tab bar.</code></pre>
<pre><code>New hook 'tab-bar-tab-post-select-functions'.</code></pre>
<pre><code>New keymap 'tab-bar-mode-map'.
By default it contains a keybinding 'C-TAB' to switch tabs, but only
when 'C-TAB' is not bound globally.  You can unbind it if it conflicts
with 'C-TAB' in other modes.</code></pre>
<pre><code>New keymap 'tab-line-mode-map'.
By default it contains keybindings for switching tabs: 'C-x &lt;left&gt;',
'C-x &lt;right&gt;', 'C-x C-&lt;left&gt;', 'C-x C-&lt;right&gt;'.  You can unbind them if
you want to use these keys for the commands 'previous-buffer' and
'next-buffer'.</code></pre>
<p class=\" text-justify\">A better way of configuring tab bar/line modes’ keys. You can opt for more complex keys, and even use keyboard repeat maps if you use <code>C-&lt;TAB&gt;</code> for other things.</p>
<pre><code>Default list of tab-line tabs is changed to support a fixed order.
This means that 'tab-line-tabs-fixed-window-buffers', the new default
tabs function, is like the previous 'tab-line-tabs-window-buffers' where
both of them show only buffers that were previously displayed in the
window.  But the difference is that the new function always keeps the
original order of buffers on the tab line, even after switching between
these buffers.  You can drag the tabs and release at a new position
to manually reorder the buffers on the tab line.</code></pre>
<pre><code>New user option 'tab-line-tabs-buffer-group-function'.
It provides two choices to group tab buffers by major mode and by
project name.</code></pre>
<pre><code>Buffers on tab-line group tabs are now sorted alphabetically.
This will keep the fixed order of tabs, even after switching between
them.</code></pre>
<H2 id=\"help\">Help</H2>
<pre><code>New command 'help-find-source'.
Switch to a buffer visiting the source of what is being described in
\"*Help*\".  It is bound to 'C-h 4 s' globally.</code></pre>
<p class=\" text-justify\">Other notable commands include <code>M-x find-variable</code>, <code>M-x find-function</code> and <code>M-x find-function-on-key</code> to jump to their source definitions. I use ’em all the time.</p>
<pre><code>New user option 'describe-bindings-outline-rules'.
This user option controls outline visibility in the output buffer of
'describe-bindings' when 'describe-bindings-outline' is non-nil.</code></pre>
<p class=\" text-justify\">All this does is determine whether <code>outline-minor-mode</code> is enabled and configured to make headings collapsible.</p>
<pre><code>'describe-function' shows the function's inferred type when available.
For native compiled Lisp functions, 'describe-function' prints (after
the signature) the automatically inferred function type as well.  If the
function's type was explicitly declared (via the 'declare' form's
'ftype' property), 'describe-function' shows the declared type.  This is
controlled by the new user option 'help-display-function-type', which is
by default t; customize to nil to disable function type display.</code></pre>
<p class=\" text-justify\">This is really only likely to be of interest and use to elisp hackers who know their way around Emacs’s internals. The declared type for <code>+</code> is <code>Declared type: (function (&amp;rest (or number marker)) number)</code> for example.</p>
<pre><code>'describe-function' now shows the type of the function object.
The text used to say things like \"car is a built-in function\" whereas it
now says \"car is a primitive-function\" where \"primitive-function\" is the
name of the symbol returned by 'cl-type-of'.  You can click on those
words to get information about that type.</code></pre>
<p class=\" text-justify\">It’s been a long-running saga to get some sort of type taxonomy into Emacs, and it’s slowly happening now. I am unsure how useful this is to your average elisp hacker; this is more likely to be of use for byte and native compilation. See also the entry further down on declaratively specifying the arguments and return type of a function.</p>
<pre><code>'C-h m' ('describe-mode') uses outlining by default.
Set 'describe-mode-outline' to nil to get back the old behavior.</code></pre>
<p class=\" text-justify\">See above.</p>
<pre><code>'C-h k' ('describe-key') shows Unicode name.
For keybindings which produce single characters via translation or input
methods, 'C-h k' now shows the Unicode name of the produced character in
addition to the character itself, e.g.

'C-h k C-x 8 E' =&gt;

    € 'EURO SIGN' (translated from C-x 8 E)</code></pre>
<p class=\" text-justify\">A useful change, even though I doubt I’ll remember that I can do this. For inputtable characters I normally type them then use <code>C-u C-x =</code> to see its unicode name along with a host of other useful information.</p>
<pre><code>'C-h b' ('describe-bindings') shows Unicode names.
For keybindings which produce single characters via translation (such as
those using the 'C-x 8' or 'A-' prefix, or 'dead-acute', 'dead-grave',
etc), the Unicode names will now be shown in addition to the character
itself, i.e.

    A-!         ¡   INVERTED EXCLAMATION MARK
    A-$         ¤   CURRENCY SIGN

and so on.</code></pre>
<p class=\" text-justify\">This I am more likely to find a use for. <code>C-h b</code> is a must-know command, and now it shows the unicode name for self-inserted characters.</p>
<pre><code>Multi-character key echo now ends with a suggestion to use Help.
Customize 'echo-keystrokes-help' to nil to prevent that.</code></pre>
<H2 id=\"customize\">Customize</H2>
<pre><code>New command 'customize-dirlocals'.
This command pops up a buffer to edit the settings in \".dir-locals.el\".</code></pre>
<p class=\" text-justify\">Wow. This change is great. Directory-local variables are elisp variables declared in one of several files (such as <code>.dir-locals.el</code>) that you can use to effect directory-specific changes to Emacs buffers. I really love dirlocals; however, they’re a pain to add and edit. <code>M-x add-dir-local-variable</code> is a newbie trap, and it’s easy to type the wrong thing and cause all sorts of issues (or worse: that nothing at all happens.)</p>
<p class=\" text-justify\">A nice customize UI will go a long way towards encouraging more people to use it.</p>
<pre><code>New command 'customize-toggle-option'.
This command can toggle boolean options for the duration of a session.</code></pre>
<p class=\" text-justify\">One cool aspect of Customize is that you can set settings for the duration only, and then later on return to finalize them and save them to a file. All this does is add that functionality to booleans.</p>
<pre><code>New prefix argument for modifying directory-local variables.
The commands 'add-dir-local-variable', 'delete-dir-local-variable' and
'copy-file-locals-to-dir-locals' now take an optional prefix argument,
to enter the file name where you want to modify directory-local
variables.</code></pre>
<pre><code>New user option 'safe-local-variable-directories'.
This user option names directories in which Emacs will treat all
directory-local variables as safe.</code></pre>
<p class=\" text-justify\">Very useful. Emacs is squeamish about dirlocals as it maintains a list of safe variables and anything else is considered unsafe, and you’re asked to approve every setting. Whitelisting certain directories is a great compromise for people who are OK with the risks that follow from such a feature.</p>
<H2 id=\"cl-print\">CL Print</H2>
<p class=\" text-justify\">This is for elisp programmers only, and governs how Elisp forms are printed on the screen for human consumption.</p>
<pre><code>There is a new chapter in the CL manual documenting cl-print.el.
See the Info node \"(cl) Printing\".</code></pre>
<pre><code>You can expand the \"...\" truncation everywhere.
The code that allowed \"...\" to be expanded in the \"*Backtrace*\" buffer
should now work anywhere the data is generated by 'cl-print'.</code></pre>
<pre><code>The 'backtrace-ellipsis' button is replaced by 'cl-print-ellipsis'.</code></pre>
<pre><code>hash-tables' contents can be expanded via the ellipsis.</code></pre>
<pre><code>Modes can control the expansion via 'cl-print-expand-ellipsis-function'.</code></pre>
<pre><code>New setting 'raw' for 'cl-print-compiled'.
This setting causes byte-compiled functions to be printed in full by
'prin1'.  A button on this output can be activated to disassemble the
function.</code></pre>
<H2 id=\"miscellaneous\">Miscellaneous</H2>
<pre><code>New command 'kill-matching-buffers-no-ask'.
This works like 'kill-matching-buffers', but without asking for
confirmation.</code></pre>
<p class=\" text-justify\"><code>M-x kill-matching-buffers</code> kills buffers by regexp; and now you can have it do so without asking your permission.</p>
<pre><code>'recover-file' can show diffs between auto save file and current file.
When answering the prompt with \"diff\" or \"=\", it now shows the diffs
between the auto save file and the current file.</code></pre>
<p class=\" text-justify\">Ah, very handy. You can already diff files you want to save with <code>C-x s</code> and then <code>d</code>.</p>
<pre><code>'read-passwd' can toggle the visibility of passwords.
Use 'TAB' in the minibuffer to show or hide the password.
Alternatively, click the new show-password icon on the mode-line with
'mouse-1' to toggle the visibility of the password.</code></pre>
<p class=\" text-justify\">TAB, eh? I’m most assuredly going to accidentally reveal a password that way. You can edit <code>read-passwd-map</code> to remove the TAB if you want, though.</p>
<pre><code>'advice-remove' is now an interactive command.
When called interactively, 'advice-remove' now prompts for an advised
function to the advice to remove.</code></pre>
<p class=\" text-justify\">Good. You can do this with <code>M-x remove-hook</code> also. Useful if you foolishly cram lambdas into hooks or advice… and are now struggling to remove them. But you’d never make that mistake, right? :)</p>
<pre><code>New user option 'uniquify-dirname-transform'.
This can be used to customize how buffer names are uniquified, by
making arbitrary transforms on the buffer's directory name (whose
components are used to uniquify buffer names when they clash).  You
can use this to distinguish between buffers visiting files with the
same base name that belong to different projects by using the provided
transform function 'project-uniquify-dirname-transform'.</code></pre>
<p class=\" text-justify\">Uniquify renames buffers (but not the underlying files, if any) to sensible names instead of <code>foo&lt;1&gt;</code>, <code>foo&lt;2&gt;</code>, etc. It’s enabled by default, nowadays, but if you use the projects feature in Emacs, and if you frequently open the same file name in multiple projects, give this setting a try.</p>
<pre><code>New user option 'remote-file-name-inhibit-delete-by-moving-to-trash'.
When non-nil, this option suppresses moving remote files to the local
trash when deleting.  Default is nil.</code></pre>
<pre><code>New user option 'remote-file-name-inhibit-auto-save'.
If this user option is non-nil, 'auto-save-mode' will not auto-save
remote buffers.  The default is nil.</code></pre>
<pre><code>New user option 'remote-file-name-access-timeout'.
If a positive number, this option limits the call of 'access-file'
for remote files to that number of seconds.  Default is nil.</code></pre>
<p class=\" text-justify\">These are Tramp features, part of Emacs’s remote file editing system.</p>
<pre><code>New user option 'yes-or-no-prompt'.
This allows the user to customize the prompt that is appended by
'yes-or-no-p' when asking questions.  The default value is
\"(yes or no) \".</code></pre>
<pre><code>New user option 'menu-bar-close-window'.
When non-nil, selecting \"Close\" from the \"File\" menu or clicking
\"Close\" in the tool bar will result in the current window being
deleted, if possible.  The default is nil, and these gestures kill the
buffer shown in the current window, but don't delete the window.</code></pre>
<pre><code>New face 'display-time-date-and-time'.
This is used for displaying the time and date components of
'display-time-mode'.</code></pre>
<pre><code>New face 'appt-notification' for 'appt-display-mode-line'.
It can be used to customize the look of the appointment notification
displayed on the mode line when 'appt-display-mode-line' is non-nil.</code></pre>
<pre><code>New icon images for general use.
Several symbolic icons have been added to \"etc/images/symbols\",
including plus, minus, check-mark, star, etc.</code></pre>
<pre><code>Emacs now recognizes shebang lines that pass '-S'/'--split-string' to 'env'.
When visiting a script that invokes 'env -S INTERPRETER ARGS...' in
its shebang line, Emacs will now skip over 'env -S' and deduce the
major mode based on the interpreter after 'env -S'.</code></pre>
<p class=\" text-justify\">Emacs uses a wide range of tools to infer the major mode to use. Filename is not the only way: Emacs will scan the file to try and determine the major mode if there is no obvious choice that matches its filename. Looking at <code>/usr/bin/env</code> is one such method.</p>
<pre><code>'insert-directory-program' is now a user option.
On *BSD and macOS systems, this user option now defaults to the \"gls\"
executable, if it exists.  This should remove the need to change its
value when installing GNU coreutils using something like ports or
Homebrew.</code></pre>
<pre><code>'write-region-inhibit-fsync' now defaults to t in interactive mode.
This is the default in batch mode since Emacs 24.</code></pre>
<pre><code>The default value of 'read-process-output-max' was increased to 65536.</code></pre>
<p class=\" text-justify\">You can probably experiment with setting this even higher to batch up output from commands. Your mileage may vary, though. Mine is set to <code>1048576</code>.</p>
<pre><code>'url-gateway-broken-resolution' is now obsolete.
This option was intended for use on SunOS 4.x and Ultrix systems,
neither of which have been supported by Emacs since version 23.1.
The user option 'url-gateway-nslookup-program' and the command
'url-gateway-nslookup-host' are consequently also obsolete.

</code></pre>
<H2 id=\"editing-changes-in-emacs-30.1\">Editing Changes in Emacs 30.1</H2>
<pre><code>New minor mode 'visual-wrap-prefix-mode'.
When enabled, continuation lines displayed for a wrapped long line
will receive a 'wrap-prefix' automatically computed from the line's
surrounding context, such that continuation lines are indented on
display as if they were filled with 'M-q' or similar.  Unlike 'M-q',
the indentation only happens on display, and doesn't change the buffer
text in any way.  The global minor mode
'global-visual-wrap-prefix-mode' enables this minor mode in all
buffers.

(This minor mode is the 'adaptive-wrap' ELPA package renamed and
lightly edited for inclusion in Emacs.)</code></pre>
<pre><code>New global minor mode 'kill-ring-deindent-mode'.
When enabled, text being saved to the kill ring will be de-indented by
the column number at its start.  For example, saving the entire
function call within an indented block:

foo ()
{
  long_function_with_several_arguments (argument_1_compute (),
                                        argument_2_compute (),
                                        argument_3_compute ());
}

will save this to the kill ring:

long_function_with_several_arguments (argument_1_compute (),
                                      argument_2_compute (),
                                      argument_3_compute ())

This omits the two columns of extra indentation that would otherwise be
copied from the second and third lines and saved to the kill ring.</code></pre>
<p class=\" text-justify\">This is worth enabling if inconsistent kill-yank indentation annoys you. Doing this correctly, especially in whitespace sensitive languages, is really important in structured editing tools such as my package, <a href=\"/article/combobulate-structured-movement-editing-treesitter\" class=\" article-link\">Combobulate</a>.</p>
<pre><code>New command 'replace-regexp-as-diff'.
It reads a regexp to search for and a string to replace with, then
displays a buffer with replacements as diffs.  After reviewing the
changes in the output buffer you can apply the replacements as
a patch to the current file buffer.  There are also new commands
'multi-file-replace-regexp-as-diff' that shows as diffs replacements
in a list of specified files, and 'dired-do-replace-regexp-as-diff'
that shows as diffs replacements in the marked files in Dired.</code></pre>
<p class=\" text-justify\">This is a very welcome addition for bulk text replacing. It’s a nervewracking thing to accept/reject changes and hope you didn’t screw it up. Having a dedicated diff window that works across multiple files is a superb addition to Emacs.</p>
<pre><code>New mode of prompting for register names and showing preview.
The new user option 'register-use-preview' can be customized to the
value t or 'insist' to request a different user interface of prompting for
register names and previewing the registers: Emacs will require
confirmation for overwriting the value of a register, and will show
the preview of registers without delay.  You can also customize this
new option to disable the preview completely.

The default value of 'register-use-preview' ('traditional') preserves the
behavior of Emacs 29 and before.  See the Info node \"(emacs) Registers\"
for more details about the new UI and its variants.</code></pre>
<p class=\" text-justify\">I love registers, and I use them a lot. I use them because they require no forethought on my part to use: set and recall; it’s that simple. No fuss. If you want added distractions like confirmation prompts if you override a register? Go ahead and change the new option. If you like registers the way they are, then you don’t have to do anything.</p>
<pre><code>New advanced macro counter commands.
New commands have been added to implement advanced macro counter
functions.

The commands 'C-x C-k C-r l' and 'C-x C-k C-r s' load and save the
macro counter from and to a number register, respectively.

The commands 'C-x C-k C-r a =', 'C-x C-k C-r a &lt;', and 'C-x C-k C-r a &gt;'
compare the macro counter with the contents of a number register and
increment the counter by an optional prefix if the comparison succeeds.

The commands 'C-x C-k C-q =', 'C-x C-k C-q &lt;', and 'C-x C-k C-q &gt;'
compare the macro counter with an optional prefix and terminate the
macro if the comparison succeeds.</code></pre>
<p class=\" text-justify\">Advanced indeed. Registers are capable of incrementing and decrementing a number already, and kmacro (Emacs’s keyboard macro facility) has its own internal counter (see <a href=\"/article/keyboard-macros-are-misunderstood\" class=\" article-link\">Keyboard Macros are Misunderstood</a>) also. Now you can switch values between them and also do simple comparisons. Combine it with the ability to physically move up or down a line; increment and decrement; and conditional termination, and I’m pretty sure kmacro close to Turing-complete.</p>
<pre><code>New mode 'kmacro-menu-mode' and new command 'list-keyboard-macros'.
The new command 'list-keyboard-macros' is the keyboard-macro version
of commands like 'list-buffers' and 'list-processes', creating a listing
of the currently existing keyboards macros using the new mode
'kmacro-menu-mode'.  It allows rearranging the macros in the ring,
duplicating them, deleting them, and editing their counters, formats,
and keys.</code></pre>
<p class=\" text-justify\">Excellent. There’s already a kmacro ring for macros known to Emacs, but it’s a bit awkward. Now you can list the macros.</p>
<pre><code>On X, Emacs now supports input methods which perform \"string conversion\".
This means an input method can now ask Emacs to delete text
surrounding point and replace it with something else, as well as query
Emacs for surrounding text.  If your input method allows you to \"undo\"
mistaken compositions, this will now work as well.</code></pre>
<pre><code>New user option 'duplicate-region-final-position'.
It controls the placement of point and the region after duplicating a
region with 'duplicate-dwim'.</code></pre>
<pre><code>New user option 'mouse-prefer-closest-glyph'.
When enabled, clicking or dragging with the mouse will put the point
or start the drag in front of the buffer position corresponding to the
glyph with the closest X coordinate to the click or start of the drag.
In other words, if the mouse pointer is in the right half of a glyph,
point will be put after the buffer position corresponding to that glyph,
whereas if the mouse pointer is in the left half of a glyph, point
will be put in front the buffer position corresponding to that glyph.
By default this is disabled.</code></pre>
<pre><code>New pre-defined values for 'electric-quote-chars'.
The available customization options for 'electric-quote-chars' have been
updated with common pairs of quotation characters, including \"‘\", \"’\",
\"“\", \"”\", \"«\", \"»\", \"‹\", \"›\", \"‚\", \"„\", \"「\", \"」\", \"『\", and \"』\".
The default is unchanged.</code></pre>
<p class=\" text-justify\">This is for <code>M-x electric-pair-mode</code>, which automatically pairs an opening character with its constituent closing character.</p>
<pre><code>'M-TAB' now invokes 'completion-at-point' in Text mode.
By default, Text mode no longer binds 'M-TAB' to 'ispell-complete-word'.
Instead, this mode arranges for 'completion-at-point', globally bound to
'M-TAB', to perform word completion as well.  You can have Text mode
binding 'M-TAB' to 'ispell-complete-word' as it did in previous Emacs
versions, or disable Ispell word completion in Text mode altogether, by
customizing the new user option 'text-mode-ispell-word-completion'.</code></pre>
<p class=\" text-justify\"><code>M-&lt;TAB&gt;</code> is also Alt+Tab. The key binding <code>C-M-i</code> is functionally equivalent.</p>
<H2 id=\"internationalization\">Internationalization</H2>
<pre><code>Mode-line mnemonics for some coding-systems have changed.
The mode-line mnemonic for 'utf-7' is now the lowercase 'u', to be
consistent with the other encodings of this family.

The mode-line mnemonic for 'koi8-u' is now 'У', U+0423 CYRILLIC
CAPITAL LETTER U, to distinguish between this encoding and the
UTF-8/UTF-16 family.

If your terminal cannot display 'У', or if you want to get the old
behavior back for any other reason, you can do that using the
'coding-system-put' function.  For example, the following restores the
previous behavior of showing 'U' in the mode line for 'koi8-u':

    (coding-system-put 'koi8-u :mnemonic ?U)</code></pre>
<p class=\" text-justify\">The mode line adopts a different character for the coding system in the active buffer. You can find it in the bottom left.</p>
<pre><code>'vietnamese-tcvn' is now a coding system alias for 'vietnamese-vscii'.
VSCII-1 and TCVN-5712 are different names for the same character
encoding.  Therefore, the duplicate coding system definition has been
dropped in favor of an alias.

The mode-line mnemonic for 'vietnamese-vscii' and its aliases is the
lowercase letter \"v\".</code></pre>
<pre><code>Users in CJK locales can control width of some non-CJK characters.
Some characters are considered by Unicode as \"ambiguous\" with respect
to their display width: either \"full-width\" (i.e., taking 2 columns on
display) or \"narrow\" (taking 1 column).  The actual width depends on
the fonts used for these characters by Emacs or (for text-mode frames)
by the terminal emulator.  Traditionally, font sets in CJK locales
were set up so as to display these characters as full-width, and thus
Emacs modified the char-width table in those locales to follow suit.
Lately, the tendency is to display these characters as narrow.  The
new user option 'cjk-ambiguous-chars-are-wide' allows users to control
whether Emacs considers these characters as full-width (the default)
or narrow (if the variable is customized to the nil value).

This setting affects the results of 'string-width' and similar
functions in CJK locales.</code></pre>
<pre><code>New input methods for the Urdu, Pashto, and Sindhi languages.
These languages are spoken in Pakistan and Afghanistan.</code></pre>
<pre><code>New input method \"english-colemak\".
This input method supports the Colemak keyboard layout.</code></pre>
<p class=\" text-justify\">Input methods are really neat. You can switch to a ‘virtual keyboard’ that behaves like another language, letting you enter diacritics and complex unicode characters using your current keyboard’s layout. You are not limited to actual languages, either: there are input methods to help you enter LaTeX for example.</p>
<p class=\" text-justify\">You can toggle the input method with <code>C-\\</code> and with a prefix argument to set the input method type. I wrote about them in <a href=\"/article/diacritics-in-emacs\" class=\" article-link\">Olé! Diacritics in Emacs</a>. I even wrote my own input method for <a href=\"/article/inserting-emoji-input-methods\" class=\" article-link\">Inserting Emoji</a> just to highlight how powerful and simple the system is.</p>
<pre><code>Additional 'C-x 8' key translations for \"æ\" and \"Æ\".
These characters can now be input with 'C-x 8 a e' and 'C-x 8 A E',
respectively, in addition to the existing translations 'C-x 8 / e' and
'C-x 8 / E'.</code></pre>
<p class=\" text-justify\">Wonderful news for people who prefer the original spelling of encyclopedia, and Danes, I suppose.</p>
<pre><code>New 'C-x 8' key translations for \"low\" quotes \"„\", and \"‚\".
These can now be entered with 'C-x , \"' and 'C-x , ''.</code></pre>
<pre><code>New German language 'C-x 8' key translations for quotation marks.
The characters \"„\", \"“\", and \"”\" can now be entered with 'C-x 8 v',
'C-x 8 b' and 'C-x 8 n'.  The single versions \"‚\", \"‘\", and \"’\" can now
be entered with 'C-x 8 V', 'C-x 8 B' and 'C-x 8 N'.  These characters
are used for the official German quoting style.  Using them requires
activating German language support via 'iso-transl-set-language'.</code></pre>
<pre><code>\"latin-prefix\" and \"latin-postfix\" quotation marks additions.
These input methods can now produce single, double and \"low\" left and
right quotation marks:

    \"‘\", \"’\", \"“\", \"”\", \"„\", and \"‚\"

by using \"[\", \"]\", and \",\" for \"left\", \"right\", and \"low\" respectively
to modify \"'\" and \"\"\".</code></pre>
<pre><code>\"latin-prefix\" and \"latin-postfix\" guillemets support.
These input methods can now produce single guillemets \"‹\" and \"›\".  For
\"latin-prefix\" use \"~~&lt;\" and \"~~&gt;\", for \"latin-postfix\" use \"&lt;~\" and
\"&gt;~\".  Double guillemets (\"«\" and \"»\") were already supported.</code></pre>
<pre><code>New French language 'C-x 8' key translations for \"‹\" and \"›\".
These characters can now be entered using 'C-x 8 ~ &lt;' and 'C-x 8 ~ &gt;',
respectively, after activating French language support via
'iso-transl-set-language'.  Double guillemets were already supported via
'C-x 8 &lt;' and 'C-x 8 &gt;'</code></pre>
<pre><code>Additional 'C-x 8' key translation for Euro \"€\" currency symbol.
This can now be entered using 'C-x 8 E' in addition to the existing
'C-x 8 * E' translation.</code></pre>
<H2 id=\"changes-in-specialized-modes-and-packages-in-emacs-30.1\">Changes in Specialized Modes and Packages in Emacs 30.1</H2>
<H3 id=\"outline-mode\">Outline mode</H3>
<p class=\" text-justify\">Outline mode is a cut-down outliner for collapsing and expanding headings.</p>
<pre><code>New commands to show/hide outlines by regexp.
'C-c / h' ('outline-hide-by-heading-regexp') asks for a regexp and then
hides the body lines of all outlines whose heading lines match the
regexp.  'C-c / s' ('outline-show-by-heading-regexp') does the inverse:
it shows the bodies of outlines that matched a regexp.</code></pre>
<pre><code>'outline-minor-mode' is supported in tree-sitter major modes.
It can be used in all tree-sitter major modes that set either the
variable 'treesit-simple-imenu-settings' or 'treesit-outline-predicate'.</code></pre>
<p class=\" text-justify\">Excellent news, and likely to be far more robust as it uses tree-sitter’s nodes to determine what to hide and show.</p>
<H3 id=\"info\">Info</H3>
<p class=\" text-justify\">Info mode is Emacs’s implementation of the TexInfo hypertext viewer.</p>
<pre><code>New user option 'Info-url-alist'.
This user option associates manual names with URLs.  It affects the
'Info-goto-node-web' command.  By default, associations for all
Emacs-included manuals are set.  Further associations can be added for
arbitrary Info manuals.</code></pre>
<pre><code>Emacs can now display Info manuals compressed with 'lzip'.
This requires the 'lzip' program to be installed on your system.</code></pre>
<H3 id=\"gud-grand-unified-debugger\">GUD (Grand Unified Debugger)</H3>
<p class=\" text-justify\">GUD is a user interface for debuggers such as GDB.</p>
<pre><code>New user option 'gud-highlight-current-line'.
When enabled, GUD will visually emphasize the line being executed upon
pauses in the debuggee's execution, such as those occasioned by
breakpoints being hit.</code></pre>
<pre><code>New command 'lldb'.
Run the LLDB debugger, analogous to the 'gud-gdb' command.</code></pre>
<pre><code>Variable order and truncation can now be configured in 'gdb-many-windows'.
The new user option 'gdb-locals-table-row-config' allows users to
configure the order and max length of various properties in the local
variables buffer when using 'gdb-many-windows'.

By default, this user option is set to write the properties in the order:
'name', 'type' and 'value', where the 'name' and 'type' are truncated to 20
characters, and the 'value' is truncated according to the value of
'gdb-locals-value-limit'.

If you want to get back the old behavior, set the user option to the value

    (setopt gdb-locals-table-row-config
            `((type . 0) (name . 0) (value . ,gdb-locals-value-limit)))</code></pre>
<pre><code>New user option 'gdb-display-io-buffer'.
If this is nil, command 'gdb' will neither create nor display a separate
buffer for the I/O of the program being debugged, but will instead
redirect the program's interaction to the GDB execution buffer.  The
default is t, to preserve previous behavior.</code></pre>
<H3 id=\"grep\">Grep</H3>
<p class=\" text-justify\">Grep (or rather the interface for talking to and displaying the results from <code>grep</code>) is a powerful feature in Emacs with a wide range of commands.</p>
<pre><code>New user option 'grep-use-headings'.
When non-nil, the output of Grep is split into sections, one for each
file, instead of having file names prefixed to each line.  It is
equivalent to the '--heading' option of some tools such as 'git grep'
and 'rg'.  The headings are displayed using the new 'grep-heading' face.
The default is nil.</code></pre>
<p class=\" text-justify\">Good news if you prefer the heading system used by tools such as <code>rg</code>. I have not tried it yet, but I wonder how easy it is to bulk edit the output of a grep command when it is in header mode.</p>
<H3 id=\"compilation-mode\">Compilation mode</H3>
<p class=\" text-justify\">Compilation mode (via <code>M-x compile</code> usually) is Emacs’s interface for talking to not just compilers but any tool that emits structured output.</p>
<pre><code>The 'omake' matching rule is now disabled by default.
This is because it partly acts by modifying other rules which may
occasionally be surprising.  It can be re-enabled by adding 'omake' to
'compilation-error-regexp-alist'.</code></pre>
<pre><code>Lua errors and stack traces are now recognized.
Compilation mode now recognizes Lua language errors and stack traces.
Every Lua error is recognized as a compilation error, and every Lua
stack frame is recognized as a compilation info.</code></pre>
<p class=\" text-justify\">Emacs already has a huge range of compilation rules, so I’m surprised it didn’t have it for Lua, given how popular it is.</p>
<H3 id=\"project\">Project</H3>
<p class=\" text-justify\">Project is one of many, many file project solutions built into Emacs, and arguably the best one to use. See <code>C-x p C-h</code>.</p>
<pre><code>New user option 'project-mode-line'.
When non-nil, display the name of the current project on the mode
line.  Clicking 'mouse-1' on the project name pops up the project
menu.  The default value is nil.</code></pre>
<p class=\" text-justify\">If you’re not strapped for space, why not enable this?</p>
<pre><code>New user option 'project-file-history-behavior'.
Customizing it to 'relativize' makes commands like 'project-find-file'
and 'project-find-dir' display previous history entries relative to
the current project.</code></pre>
<pre><code>New user option 'project-key-prompt-style'.
The look of the key prompt in the project switcher has been changed
slightly.  To get the previous one, set this option to 'brackets'.</code></pre>
<pre><code>Function 'project-try-vc' tries harder to find the responsible VCS.
When 'project-vc-extra-root-markers' is non-nil, and causes a
subdirectory project to be detected which is not a VCS root, Project now
additionally traverses the parent directories until a VCS root is found
(if any), so that the ignore rules for that repository are used, and
the file listing's performance is still optimized.</code></pre>
<p class=\" text-justify\">Root markers are used to find the boundaries of a project (for example the <code>.git</code> directory, or maybe a file such as a Makefile), and that works well enough for simple use cases. You can tell Emacs to look for other things in addition to its builtin rules, and this is where the contract of a root marker breaks down a little, particularly if you have a repo and another non-repo marker inside of that.</p>
<pre><code>New commands 'project-any-command' and 'project-prefix-or-any-command'.
The former is now bound to 'C-x p o' by default.
The latter is designed primarily for use as a value of
'project-switch-commands'.  If instead of a short menu you prefer to
have access to all keys defined inside 'project-prefix-map', as well
as global bindings (to run other commands inside the project root),
you can add this to your init script:

    (setopt project-switch-commands #'project-prefix-or-any-command)</code></pre>
<p class=\" text-justify\">This is effectively a way of executing a key bindings from the root directory of the current buffer’s root project.</p>
<pre><code>New variable 'project-files-relative-names'.
If it is non-nil, 'project-files' can return file names relative to the
project root.  Project backends can use this to improve the performance
of their 'project-files' implementation.</code></pre>
<H3 id=\"vc\">VC</H3>
<p class=\" text-justify\">VC is Emacs’s excellent generic version control interface. If you do not use <a href=\"/article/introduction-magit-emacs-mode-git\" class=\" article-link\">Magit, an Emacs mode for Git</a>, or if you use a source control that is not git, then I highly recommend you sit down and learn how to use VC. It’s really excellent.</p>
<pre><code>Log-Edit buffers now display a tool bar.
This tool bar contains items for committing log entries and editing or
generating log entries, among other editing operations.</code></pre>
<p class=\" text-justify\">I’ve long advocated using the menu bar because telling beginners to turn it off is <a href=\"/article/bad-emacs-advice\" class=\" article-link\">Bad Emacs Advice</a>. The toolbar is harder to justify turning on as it is a little bit threadbare. Having said that, making it even more contextual is still a very positive thing indeed.</p>
<pre><code>New user option 'vc-git-shortlog-switches'.
This is a string or a list of strings that specifies the Git log
switches for shortlogs, such as the one produced by 'C-x v L'.
'vc-git-log-switches' is no longer used for shortlogs.</code></pre>
<pre><code>New value 'no-backend' for user option 'vc-display-status'.
With this value only the revision number is displayed on the mode-line.</code></pre>
<pre><code>Obsolete command 'vc-switch-backend' re-added as 'vc-change-backend'.
The command was previously obsoleted and unbound in Emacs 28.</code></pre>
<p class=\" text-justify\">It is rare indeed for a command to get obsoleted and the unobsoleted.</p>
<pre><code>Support for viewing VC change history across renames.
When a fileset's VC change history ends at a rename, 'C-x v l' now
prints the old name(s) and shows a button which jumps to the history of
the files under the old names.  This feature is supported for Git and
Hg.  Naturally, 'vc-git-print-log-follow' should be nil for this to work
(or '--follow' should not be in 'vc-hg-log-switches', in Hg's case).
Unlike when the '--follow' switch is used, commands to see the diff of
the old revision ('d'), to check out an old file version ('f') or to
annotate it ('a'), also work on revisions which precede renames.</code></pre>
<pre><code>'vc-annotate' now abbreviates the Git revision in the buffer name.
When using the Git backend, 'vc-annotate' will use an abbreviated
revision identifier in its buffer name.  To restore the previous
behavior, set user option 'vc-annotate-use-short-revision' to nil.</code></pre>
<pre><code>New user option 'vc-git-file-name-changes-switches'.
It allows tweaking the thresholds for rename and copy detection.</code></pre>
<pre><code>VC Directory buffers now display the upstream branch in Git repositories.
The \"upstream branch\" is the branch from which 'vc-pull' fetches changes
by default.  In Git terms, the upstream branch of branch B is determined
by configuration variables 'branch.B.remote' and 'branch.B.merge'.

When these configuration variables are set for the current branch, the
VC Directory buffer will show the corresponding upstream branch under
the \"Tracking\" header.</code></pre>
<H3 id=\"diff-mode\">Diff mode</H3>
<p class=\" text-justify\">Diff mode is one of several modes for interacting with and browsing <code>.diff</code> files.</p>
<pre><code>New user option 'diff-refine-nonmodified'.
When this is non-nil, 'diff-refine-hunk' will highlight lines that were
added or removed in their entirety (as opposed to modified lines, where
some parts of the line were modified), using the same faces as for
highlighting the words added and removed within modified lines.  The
default value is nil.</code></pre>
<pre><code>'diff-ignore-whitespace-hunk' can now be applied to all hunks.
When called with a non-nil prefix argument,
'diff-ignore-whitespace-hunk' now iterates over all the hunks in the
current diff, regenerating them without whitespace changes.</code></pre>
<p class=\" text-justify\">Very useful in Lisp, in my opinion, where a change of indentation can easily happen when you change something else. I have git set to ignore whitespace by default to avoid indentation changes gumming up the staging area.</p>
<pre><code>New user option 'diff-ignore-whitespace-switches'.
This allows changing which type of whitespace changes are ignored when
regenerating hunks with 'diff-ignore-whitespace-hunk'.  Defaults to
the previously hard-coded \"-b\".</code></pre>
<pre><code>New command 'diff-apply-buffer' bound to 'C-c RET a'.
It applies the diff in the entire diff buffer and
saves all modified file buffers.</code></pre>
<p class=\" text-justify\">Good all-round command and saves having to do multiple keystrokes to achieve the same effect.</p>
<H3 id=\"dired\">Dired</H3>
<p class=\" text-justify\">Dired is Emacs’s all-singing, all-dancing directory and file editor, bound to <code>C-x d</code> and <code>M-x dired</code>.</p>
<pre><code>New user option 'dired-movement-style'.
When non-nil, make 'dired-next-line', 'dired-previous-line',
'dired-next-dirline', 'dired-prev-dirline' skip empty lines.
It also controls how to move point when encountering a boundary
(e.g., if every line is visible, invoking 'dired-next-line' at
the last line will move to the first line).  The default is nil.</code></pre>
<p class=\" text-justify\">Oh, this is much-needed. Here’s how it works: you can insert the contents of a directory into an existing dired buffer (find a directory and tap <code>i</code>) and act on the files across the directory boundaries as though they were one directory – very powerful, and it means you can use <a href=\"/article/dired-shell-commands-find-xargs-replacement\" class=\" article-link\">dired to replace find &amp; xargs</a> – but the <code>p</code> and <code>n</code> commands to move between files does not jump between these virtual directories, and so you’re stuck having to move point between a bunch of dead space. Until now, that is. I recommend you set it to <code>bounded</code> or <code>cycle</code>.</p>
<pre><code>New user option 'dired-filename-display-length'.
It is an integer representing the maximum display length of file names.
The middle part of a file name whose length exceeds the restriction is
hidden and an ellipsis is displayed instead.  A value of 'window'
means using the right edge of window as the display restriction.  The
default is nil.</code></pre>
<p class=\" text-justify\">If you squeeze dired into a side bar window, you can now truncate filenames to make them fit to the size of the window, which is a good quality of life improvement.</p>
<pre><code>New user option 'shell-command-guess-functions'.
It defines how to populate a list of commands available
for 'M-!', 'M-&amp;', '!', '&amp;' and the context menu \"Open With\"
based on marked files in Dired.  Possible backends are
'dired-guess-default', MIME types, XDG configuration
and a universal command such as \"open\" or \"start\"
that delegates to the OS.</code></pre>
<p class=\" text-justify\">Emacs has several ways of guessing the right command to run on a filename, and they are annoyingly different and only available in some parts of Emacs and not others. This is a clear attempt to clean up this mess and offer a unified way of picking the right command to run.</p>
<pre><code>New command 'dired-do-open'.
This command is bound to 'E' (mnemonics \"External\").  Also it can be
used by clicking \"Open\" in the context menu; it \"opens\" the marked or
clicked on files according to the OS conventions.  For example, on
systems supporting XDG, this runs 'xdg-open' on the files.</code></pre>
<p class=\" text-justify\">Excellent addition. I used to do <code>!</code> to do this, but now it has its own key.</p>
<pre><code>New variable 'dired-guess-shell-alist-optional'.
It contains commands for external viewers and players for various media
formats, moved to this list from 'dired-guess-shell-alist-default'.</code></pre>
<p class=\" text-justify\">Worth a look if you want Emacs to open your media files in other tools than its defaults.</p>
<pre><code>The default value of 'dired-omit-size-limit' was increased.
After performance improvements to omitting in large directories, the new
default value is 300k, up from 100k.  This means 'dired-omit-mode' will
omit files in directories whose directory listing is up to 300 kilobytes
in size.</code></pre>
<p class=\" text-justify\">Omit mode hides useless files based on regexp filters. Great way to hide backup files, compiler detritus and more. You may have to <code>(require 'dired-x)</code> first.</p>
<pre><code>'dired-listing-switches' handles connection-local values if exist.
This allows you to customize different switches for different remote machines.</code></pre>
<p class=\" text-justify\">This relates to Tramp, Emacs’s remote file editing protocol. Because Tramp sends commands to the remote host, you can now customize how dired should query for files on the remote file system.</p>
<H3 id=\"ediff\">Ediff</H3>
<p class=\" text-justify\">Ediff is another diff tool in Emacs, albeit a far more advanced one. It has a wide range of entrypoints: <code>C-h a ediff</code>.</p>
<pre><code>New user option 'ediff-floating-control-frame'.
If non-nil, try making the control frame be floating rather than tiled.

Many X tiling window managers make the Ediff control frame a tiled
window equal in size to the main Emacs frame, which works poorly.
This option is useful to set if you use such a window manager.</code></pre>
<p class=\" text-justify\">Ediff’s achilles’ heel is its awkward frame that it uses as a control interface; but now it at least grants succor to people who use tiling window managers.</p>
<H3 id=\"buffer-selection\">Buffer Selection</H3>
<p class=\" text-justify\">Buffer selection, not to be confused with <code>C-x b</code>, is one of, ah, several buffer switching tools in Emacs. Try it with <code>M-x bs-show</code>.</p>
<pre><code>New user option 'bs-default-action-list'.
You can now configure how to display the \"*buffer-selection*\" buffer
using this new option.  (Or set 'display-buffer-alist' directly.)</code></pre>
<H3 id=\"eshell\">Eshell</H3>
<p class=\" text-justify\">Eshell is an Emacs shell written entirely in Emacs. It’s worth <a href=\"/article/complete-guide-mastering-eshell\" class=\" article-link\">Mastering Eshell</a> if you want an all-Emacs command line experience.</p>
<pre><code>You can now run Eshell scripts in batch mode.
By adding the following interpreter directive to an Eshell script, you
can make it executable like other shell scripts:

    #!/usr/bin/env -S emacs --batch -f eshell-batch-file</code></pre>
<p class=\" text-justify\">If you thought someone using korn or c shell wasn’t bad enough, now you can frustrate your coworkers by writing your shell scripts in Eshells’ own zsh-like language.</p>
<pre><code>New builtin Eshell command 'compile'.
This command runs another command, sending its output to a compilation
buffer when the command would output interactively.  This can be useful
when defining aliases so that they produce a compilation buffer when
appropriate, but still allow piping the output elsewhere if desired.
For more information, see the \"(eshell) Built-ins\" node in the Eshell
manual.</code></pre>
<p class=\" text-justify\">Eshell has a huge range of commands that it exposes to its shell, only to intercept them and pass the input and output to a dedicated Emacs function. See <code>C-u C-h a eshell/</code>.</p>
<pre><code>Eshell's 'env' command now supports running commands.
Like in many other shells, Eshell's 'env' command now lets you run a
command passed as arguments to 'env'.  If you pass any initial
arguments of the form 'VAR=VALUE', 'env' will first set 'VAR' to
'VALUE' before running the command.</code></pre>
<pre><code>Eshell's 'umask' command now supports setting the mask symbolically.
Now, you can pass an argument like \"u+w,o-r\" to Eshell's 'umask'
command, which will give write permission for owners of newly-created
files and deny read permission for users who are not members of the
file's group.  See the Info node \"(coreutils) File permissions\" for
more information on this notation.</code></pre>
<pre><code>Performance improvements for interactive output in Eshell.
Interactive output in Eshell should now be significantly faster,
especially for commands that can print large amounts of output
(e.g. \"cat\").  For external commands, Eshell saves time by only looking
for password prompts in the last 256 characters of each block of output.
To restore the previous behavior when checking for password prompts, set
'eshell-password-prompt-max-length' to 'most-positive-fixnum'.</code></pre>
<pre><code>Eshell built-in commands can now display progress.
Eshell built-in commands like \"cat\" and \"ls\" now update the display
periodically while running to show their progress.</code></pre>
<pre><code>New special reference type '#&lt;marker POSITION BUFFER&gt;'.
This special reference type returns a marker at 'POSITION' in
'BUFFER'.  You can insert it by typing or using the new interactive
command 'eshell-insert-marker'.  You can also insert special
references of any type using the new interactive command
'eshell-insert-special-reference'.  See the \"(eshell) Arguments\" node
in the Eshell manual for more details.</code></pre>
<pre><code>New splice operator for Eshell dollar expansions.
Dollar expansions in Eshell now let you splice the elements of the
expansion in-place using '$@expr'.  This makes it easier to fill lists
of arguments into a command, such as when defining aliases.  For more
information, see the \"(eshell) Dollars Expansion\" node in the Eshell
manual.</code></pre>
<p class=\" text-justify\">Eshell’s expansion system is inspired by zsh’s, though they’re not at all interchangeable, as Eshell effectively passes things to elisp functions internally, arguments and all, so being able to split, splice and otherwise manipulate how entries are fed to the underlying commands is very important.</p>
<pre><code>You can now splice Eshell globs in-place into argument lists.
By setting 'eshell-glob-splice-results' to a non-nil value, Eshell
will expand glob results in-place as if you had typed each matching
file name individually.  For more information, see the \"(eshell)
Globbing\" node in the Eshell manual.</code></pre>
<pre><code>Eshell now supports negative numbers and ranges for indices.
Now, you can retrieve the last element of a list with '$my-list[-1]'
or get a sublist of elements 2 through 4 with '$my-list[2..5]'.  For
more information, see the \"(eshell) Dollars Expansion\" node in the
Eshell manual.</code></pre>
<pre><code>Eshell commands can now be explicitly-remote (or local).
By prefixing a command name in Eshell with a remote identifier, like
\"/ssh:user@remote:whoami\", you can now run commands on a particular
host no matter your current directory.  Likewise, you can run a
command on your local system no matter your current directory via
\"/local:whoami\".  For more information, see the \"(eshell) Remote Access\"
node in the Eshell manual.</code></pre>
<pre><code>Eshell's '$UID' and '$GID' variables are now connection-aware.
Now, when expanding '$UID' or '$GID' in a remote directory, the value
is the user or group ID associated with the remote connection.</code></pre>
<p class=\" text-justify\">One cool feature of Eshell is that you can <code>cd</code> into a remote system using Tramp – for example <code>cd /ssh:homer@powerplant:/etc/</code> – and then operate on the remote machine through Eshell and Tramp as though it were ‘local’. Really powerful, but sometimes there are cracks in the machinery, such as the case of the user and group id environment variables not being correct.</p>
<pre><code>Eshell now uses 'field' properties in its output.
In particular, this means that pressing the '&lt;home&gt;' key moves the
point to the beginning of your input, not the beginning of the whole
line.  If you want to go back to the old behavior, add something like
this to your configuration:

    (keymap-set eshell-mode-map \"&lt;home&gt;\" #'eshell-bol-ignoring-prompt)

This also means you no longer need to adjust 'eshell-prompt-regexp'
when customizing your Eshell prompt.</code></pre>
<p class=\" text-justify\">I long ago abandoned using <code>C-a</code> and friends to move the beginning of line, preferring <code>M-m</code> instead (as it skips forward past whitespace after moving to the beginning of the line) but this command obviously does not respect the prompt. So if you use <code>M-m</code>, just rebind it to the same key as <code>C-a</code>.</p>
<pre><code>You can now properly unload Eshell.
Calling '(unload-feature 'eshell)' no longer signals an error, and now
correctly unloads Eshell and all of its modules.</code></pre>
<pre><code>'eshell-read-aliases-list' is now an interactive command.
After manually editing 'eshell-aliases-file', you can use this command
to load the edited aliases.</code></pre>
<p class=\" text-justify\">Aliases here referring to the same aliasing you can do in other shells.</p>
<pre><code>'rgrep' is now a builtin Eshell command.
Running 'rgrep' in Eshell now uses the Emacs grep facility instead of
calling external rgrep.</code></pre>
<p class=\" text-justify\"><code>M-x rgrep</code> is a command I use all the time when I want more specificity around searching than what a tool like <code>rg</code> gives me. <code>grep</code> already works great in Eshell, so it’s nice to see that <code>rgrep</code> does so too.</p>
<pre><code>If a command exits abnormally, the Eshell prompt now shows its exit code.</code></pre>
<p class=\" text-justify\">I added this to my bash prompt decades ago, as I find it invaluable when I want to compare exit codes in scripts.</p>
<pre><code>New user option 'eshell-history-append'.
If non-nil, each Eshell session will save history by appending new
entries of that session to the history file rather than overwriting
the file with the whole history of the session.  The default is nil.</code></pre>
<H3 id=\"pcomplete\">Pcomplete</H3>
<p class=\" text-justify\">Pcomplete is the completer tool originally built for Eshell, but now has uses elsewhere. It’s a pretty nifty little completion engine, as I demonstrate in <a href=\"/article/pcomplete-context-sensitive-completion-emacs\" class=\" article-link\">PComplete: Context-Sensitive Completion in Emacs</a></p>
<pre><code>New user option 'pcomplete-remote-file-ignore'.
When this option is non-nil, remote file names are not completed by
Pcomplete.  Packages, like 'shell-mode', could set this in order to
suppress remote file name completion at all.</code></pre>
<pre><code>Completion for the 'doas' command has been added.
Command completion for 'doas' in Eshell and Shell mode will now work.</code></pre>
<p class=\" text-justify\">The mooted successor to <code>sudo</code>.</p>
<H3 id=\"shell-mode\">Shell mode</H3>
<p class=\" text-justify\">This is the shell I actually use the most day to day. Delightfully dumb and it behaves exactly like a souped-up Emacs buffer. See <a href=\"/article/running-shells-in-emacs-overview\" class=\" article-link\">Running Shells and Terminal Emulators in Emacs</a> if you want to know what all the differences are.</p>
<pre><code>New user option 'shell-get-old-input-include-continuation-lines'.
When this user option is non-nil, 'shell-get-old-input' ('C-RET')
includes multiple shell \"\\\" continuation lines from command output.
Default is nil.</code></pre>
<pre><code>New user option 'shell-history-file-name'.
When this user option is set to t, 'shell-mode' does not read the shell
history file.  Setting this user option to a string specifies the name
of the shell history file to be read.  A nil value triggers reading the
environment variable 'HISTFILE'.

In a 'shell' buffer, this user option is connection-local.</code></pre>
<p class=\" text-justify\">This is a nice change as Emacs will of course keep its own history (see <a href=\"/article/shell-comint-secrets-history-commands\" class=\" article-link\">Shell &amp; Comint Secrets: History commands</a>) but that history does not persist under normal circumstances. If you’re using a non-default history file for your shell and you want Emacs to respect it, now you can.</p>
<pre><code>Performance improvements for interactive output.
Interactive output in Shell mode now scans more selectively for password
prompts by only examining the last 256 characters of each block of
output, reducing the time spent when printing large amounts of output.
To restore the old behavior, set 'comint-password-prompt-max-length' to
'most-positive-fixnum'.</code></pre>
<p class=\" text-justify\">Anything that speeds up comint is a good thing in my book.</p>
<H3 id=\"prog-mode\">Prog mode</H3>
<p class=\" text-justify\">Prog mode is a generic major mode that programming modes should try to inherit from. It is not intended for normal users.</p>
<pre><code>New command 'prog-fill-reindent-defun'.
This command either fills a single paragraph in a defun, such as a
docstring, or a comment, or (re)indents the surrounding defun if point
is not in a comment or a string.  By default, it is bound to 'M-q' in
'prog-mode' and all its descendants.</code></pre>
<H3 id=\"imenu\">Imenu</H3>
<p class=\" text-justify\">Imenu is a lookup feature for structured elements in the current buffer, such as function and class names in code, and headings and sub-headings in text.</p>
<pre><code>New user option 'imenu-flatten'.
It controls whether to flatten the list of sections in an imenu, and
how to display the sections in the flattened list.</code></pre>
<p class=\" text-justify\">If you use a completion mechanism that makes accessing nested elements hard in imenu, you can now request that it flattens the hierarchy.</p>
<pre><code>The sort order of Imenu completions can now be customized.
You can customize the user option 'completion-category-overrides'
and set 'display-sort-function' for the category 'imenu'.</code></pre>
<H3 id=\"which-function-mode\">Which Function mode</H3>
<p class=\" text-justify\">Which function shows the current function in the mode line by default. It works anywhere <code>M-x imenu</code> works.</p>
<pre><code>Which Function mode can now display function names on the header line.
The new user option 'which-func-display' allows choosing where the
function name is displayed.  The default is 'mode' to display in the
mode line.  'header' will display in the header line;
'mode-and-header' displays in both the header line and mode line.</code></pre>
<p class=\" text-justify\">The mode line is crowded and often truncated if you split your windows. Having another place to put this information is useful.</p>
<pre><code>New user option 'which-func-update-delay'.
This replaces the user option 'idle-update-delay', which was previously
used to control the delay before 'which-function-mode' updated its
display.  The user option 'idle-update-delay', which was only used by
Which Function mode, is now obsolete.</code></pre>
<H3 id=\"tramp\">Tramp</H3>
<p class=\" text-justify\">Tramp is Emacs’s remote file editing facility.</p>
<pre><code>Tramp methods can be optional.
An optional connection method is not enabled by default.  The user must
enable it explicitly by the 'tramp-enable-method' command.  The existing
methods \"fcp\", \"krlogin\", \" ksu\" and \"nc\" are optional now.</code></pre>
<pre><code>New optional connection method \"androidsu\".
This provides access to system files with elevated privileges granted by
the idiosyncratic 'su' implementations and system utilities customary on
Android.</code></pre>
<p class=\" text-justify\">Tramp supports a dizzying array of “connection” methods, including things that aren’t “connections” in the traditional sense, such as <code>sudo</code> and now <code>androidsu</code>.</p>
<pre><code>New optional connection method \"run0\".
This connection method is similar to \"sudo\", but it uses the 'systemd'
framework internally.</code></pre>
<pre><code>New connection methods \"dockercp\" and \"podmancp\".
These are the external methods counterparts of \"docker\" and \"podman\".</code></pre>
<p class=\" text-justify\">Tramp added native docker support a version or two ago, which is super handy for editing or viewing stuff inside a container from the comfort of your own Emacs.</p>
<pre><code>New optional connection methods for containers.
There are new optional connection methods \"toolbox\", \"distrobox\",
\"flatpak\", \"apptainer\" and \"nspawn\".  They allow accessing system
containers provided by Toolbox or Distrobox, sandboxes provided by
Flatpak, instances managed by Apptainer, or accessing systemd-based
light-weight containers..</code></pre>
<p class=\" text-justify\">Good to see more support for namespace-based container solutions other than docker.</p>
<pre><code>Connection method \"kubernetes\" supports now optional container name.
The host name for Kubernetes connections can be of kind [CONTAINER.]POD,
in order to specify a dedicated container.  If there is just the pod
name, the first container in the pod is taken.  The new user options
'tramp-kubernetes-context' and 'tramp-kubernetes-namespace' allow
accessing pods with different context or namespace but the default one.</code></pre>
<p class=\" text-justify\">Tramp can chain connections, so you can connect to a bastion host first before you connect to kubernetes pods.</p>
<pre><code>Rename 'tramp-use-ssh-controlmaster-options' to 'tramp-use-connection-share'.
The old name still exists as obsolete variable alias.  This user
option controls now connection sharing for both ssh-based and
plink-based methods.  It allows the values t, nil, and 'suppress'.
The latter suppresses also \"ControlMaster\" settings in the user's
\"~/.ssh/config\" file, or connection share configuration in PuTTY
sessions, respectively.</code></pre>
<p class=\" text-justify\">You absolutely must enable connection sharing (controlmaster) if you use ssh. It makes a huge difference in performance.</p>
<pre><code>New command 'tramp-cleanup-some-buffers'.
It kills only a subset of opened remote buffers, subject to the user
option 'tramp-cleanup-some-buffers-hook'.</code></pre>
<pre><code>New command 'inhibit-remote-files'.
This command disables the handling of file names with the special
remote file name syntax.  It should be applied only when remote files
won't be used in this Emacs instance.  It provides a slightly improved
performance of file name handling in Emacs.</code></pre>
<pre><code>New macro 'without-remote-files'.
This macro could wrap code which handles local files only.  Due to the
temporary deactivation of remote files, it results in a slightly
improved performance of file name handling in Emacs.</code></pre>
<pre><code>New user option 'tramp-completion-multi-hop-methods'.
It contains a list of connection methods for which completion should
be attempted at the end of a multi-hop chain.  This allows completion
candidates to include a list of, for example, containers running on a
remote docker host.</code></pre>
<p class=\" text-justify\">Oh, cool! One common criticism I had of multi-hop/chaining connections is that you really need to know what you’re looking for when you are writing out these multi-hop connections, as the completion support is non-existent. Good to see that Tramp will now attempt to complete via the multi-hop links you have already written. Neat!</p>
<pre><code>New command 'tramp-revert-buffer-with-sudo'.
It reverts the current buffer to visit with \"sudo\" permissions.  The
buffer must either visit a file, or it must run 'dired-mode'.  Another
method but \"sudo\" can be configured with user option
'tramp-file-name-with-method'.</code></pre>
<p class=\" text-justify\">I’ve had a snippet of code called <code>sudo</code> that does exactly this for what must be a decade plus now. Now it’s built in, albeit with a harder-to-remember name.</p>
<pre><code>Direct asynchronous processes are indicated by a connection-local variable.
If direct asynchronous processes shall be used, set the connection-local
variable 'tramp-direct-async-process' to a non-nil value.  In previous
Emacs versions this was indicated by the connection property
\"direct-async-process\".  That connection property (though not connection
properties and 'tramp-connection-properties' in general) is now
deprecated.  See the Tramp manual \"(tramp) Improving performance of
asynchronous remote processes\".</code></pre>
<p class=\" text-justify\">If you have performance issues with Tramp, you should try this out.</p>
<pre><code>Direct asynchronous processes use 'tramp-remote-path'.
When a direct asynchronous process is invoked, it uses 'tramp-remote-path'
for setting the remote 'PATH' environment variable.</code></pre>
<H3 id=\"shr\">SHR</H3>
<p class=\" text-justify\">SHR is Emacs’s HTML rendering engine that powers EWW, the Emacs Web Wowser.</p>
<pre><code>New user option 'shr-fill-text'.
When 'shr-fill-text' is non-nil (the default), SHR will fill text
according to the width of the window.  If you customize it to nil, SHR
will leave the text as-is; in that case, EWW will automatically enable
'visual-line-mode' when displaying a page so that long lines are
visually wrapped at word boundaries.</code></pre>
<H3 id=\"eww\">EWW</H3>
<p class=\" text-justify\"><code>M-x eww</code> is Emacs’s builtin web browser.</p>
<pre><code>New mouse bindings in EWW buffers.
Certain form elements that were displayed as buttons, yet could only be
activated by keyboard input, are now operable using 'mouse-2'.  With
\"Submit\" buttons, this triggers submission of the form, while clicks on
other classes of buttons either toggle their values or prompt for user
input, as the case may be.</code></pre>
<pre><code>EWW text input fields and areas are now fields.
In consequence, movement commands and OS input method features now
recognize and confine their activities to the text input field around
point.  See also the Info node \"(elisp) Fields\".</code></pre>
<p class=\" text-justify\">Fields here meaning the widget system that Emacs has built in.</p>
<pre><code>'eww-open-file' can now display the file in a new buffer.
By default, the command reuses the \"*eww*\" buffer, but if called with
the new argument NEW-BUFFER non-nil, it will use a new buffer instead.
Interactively, invoke 'eww-open-file' with a prefix argument to
activate this behavior.</code></pre>
<pre><code>'eww' URL or keyword prompt now has tab completion.
The interactive minibuffer prompt when invoking 'eww' now has support
for tab completion.</code></pre>
<pre><code>'eww' URL and keyword prompt now completes suggested URIs and bookmarks.
The interactive minibuffer prompt when invoking 'eww' now provides
completions from 'eww-suggest-uris'.  'eww-suggest-uris' now includes
bookmark URIs.</code></pre>
<pre><code>New command 'eww-copy-alternate-url'.
It copies an alternate link on the page currently visited in EWW into
the kill ring.  Alternate links are optional metadata that HTML pages
use for linking to their alternative representations, such as translated
versions or associated RSS feeds.  It is bound to 'A' by default.</code></pre>
<pre><code>'eww-open-in-new-buffer' supports the prefix argument.
When invoked with the prefix argument ('C-u'),
'eww-open-in-new-buffer' will not make the new buffer the current one.
This is useful for continuing reading the URL in the current buffer
when the new URL is fetched.</code></pre>
<pre><code>History navigation in EWW now behaves as in other browsers.
Previously, when navigating back and forward through page history, EWW
would add a duplicate entry to the end of the history list each time.
This made it impossible to navigate to the \"end\" of the history list.
Now, navigating through history in EWW simply changes your position in
the history list, allowing you to reach the end as expected.  In
addition, when browsing to a new page from a \"historical\" one (i.e., a
page loaded by navigating back through history), EWW deletes the history
entries newer than the current page.  To change the behavior when
browsing from \"historical\" pages, you can customize
'eww-before-browse-history-function'.</code></pre>
<pre><code>'eww-readable' now toggles display of the readable parts of a web page.
When called interactively, 'eww-readable' toggles whether to display
only the readable parts of a page or the full page.  With a positive
prefix argument, it always displays the readable parts, and with a zero
or negative prefix, it always displays the full page.</code></pre>
<p class=\" text-justify\">This feature has been around for ages, and it’s great if you want to remove all the chaff from a page. Note that the only real change here is that it toggles.</p>
<pre><code>New user option 'eww-readable-urls'.
This is a list of regular expressions matching the URLs where EWW should
display only the readable parts by default.  For more details, see
\"(eww) Basics\" in the EWW manual.</code></pre>
<p class=\" text-justify\">Great stuff if you regularly visit pages that require toggling on readable mode.</p>
<pre><code>New user option 'eww-readable-adds-to-history'.
When non-nil (the default), calling 'eww-readable' adds a new entry to
the EWW page history.</code></pre>
<H3 id=\"go-ts-mode\">Go-ts mode</H3>
<p class=\" text-justify\">This is the tree-sitter version for Go.</p>
<pre><code>New command 'go-ts-mode-docstring'.
This command adds a docstring comment to the current defun.  If a
comment already exists, point is only moved to the comment.  It is
bound to 'C-c C-d' in 'go-ts-mode'.</code></pre>
<H3 id=\"man-mode\">Man mode</H3>
<p class=\" text-justify\">Man referring here to the manual page tool <code>man</code>.</p>
<pre><code>New user option 'Man-prefer-synchronous-call'.
When this is non-nil, run the 'man' command synchronously rather than
asynchronously (which is the default behavior).</code></pre>
<pre><code>New user option 'Man-support-remote-systems'.
This option controls whether the man page is formatted on the remote
system when the current buffer's default-directory is remote.  You can
invoke the 'man' command with a prefix argument to countermand the
value of this option for the current invocation of 'man'.</code></pre>
<H3 id=\"docview\">DocView</H3>
<p class=\" text-justify\">DocView is a generic tool for converting complex documents into images for display in Emacs (pdf, docx, etc.)</p>
<pre><code>New user option 'doc-view-mpdf-use-svg'.
If non-nil, DocView uses SVG images to display PDF documents.  The
default is non-nil if your system supports display of SVG images.</code></pre>
<p class=\" text-justify\">Emacs’s SVG engine is quite good nowadays, and it’s definitely better than a raster image of a PDF.</p>
<pre><code>New face 'doc-view-svg-face'.
This replaces 'doc-view-svg-foreground' and 'doc-view-svg-background'.
By default, this face has black foreground on white background and
inherits from the default face.  When unsetting the foreground and
background values, the display in DocView is styled according to the
current theme.  However, this, or any non-standard values, can result in
poor contrast for documents which aren't simply black text on white
background.</code></pre>
<p class=\" text-justify\">If your theme clashes with the colors in SVG files, you can now change them to better suit your theme.</p>
<pre><code>DocView buffers now display a new tool bar.
This tool bar contains options for searching and navigating within the
document, replacing the incompatible items for incremental search and
editing within the default tool bar displayed in the past.</code></pre>
<H3 id=\"shortdoc\">Shortdoc</H3>
<p class=\" text-justify\">Shortdoc is <a href=\"/article/emacs-builtin-elisp-cheat-sheet\" class=\" article-link\">Emacs’s Builtin Elisp Cheat Sheet</a>.</p>
<pre><code>New function 'shortdoc-function-examples'.
This function returns examples of use of a given Emacs Lisp function
from the available shortdoc information.</code></pre>
<pre><code>New function 'shortdoc-help-fns-examples-function'.
This function inserts into the current buffer examples of use of a
given Emacs Lisp function, which it gleans from the shortdoc
information.  If you want 'describe-function' ('C-h f') to insert
examples of using the function into regular \"*Help*\" buffers, add the
following to your init file:

    (add-hook 'help-fns-describe-function-functions
              #'shortdoc-help-fns-examples-function)</code></pre>
<H3 id=\"package\">Package</H3>
<p class=\" text-justify\">Package is the package manager and installer in Emacs.</p>
<pre><code>New user option 'package-vc-register-as-project'.
When non-nil, 'package-vc-install' and 'package-vc-checkout' will
automatically register every package they install as a project, that you
can quickly select using 'project-switch-project' ('C-x p p').  Default
is t.</code></pre>
<p class=\" text-justify\">Oh that is very nice. I will definitely enable this now that <code>package</code> can install from source control using <code>vc</code>.</p>
<pre><code>New user option 'package-vc-allow-build-commands'.
Controls for which packages Emacs runs extra build commands when
installing directly from the package VCS repository.</code></pre>
<pre><code>New command 'package-vc-log-incoming'.
This commands displays incoming changes for a VC package without
modifying the current checkout.</code></pre>
<pre><code>New command to start an inferior Emacs loading only specific packages.
The new command 'package-isolate' will start a new Emacs process, as
a sub-process of Emacs where you invoke the command, in a way that
causes the new process to load only some of the installed packages.
The command prompts for the packages to activate in this
sub-process, and is intended for testing Emacs and/or the packages
in a clean environment.</code></pre>
<p class=\" text-justify\">That’s a really cool addition, and I look forward to using it with my own packages. I normally maintain a separate Emacs installation just for this purpose, but this approach might save me the hassle of having to maintain that.</p>
<H3 id=\"flymake\">Flymake</H3>
<p class=\" text-justify\">Flymake is Emacs’s linter/on-the-fly-compiler interface.</p>
<pre><code>New user option 'flymake-indicator-type'.
This controls which error indicator type Flymake should use in the
current buffer.  Depending on your preference, this can either use
fringes or margins for indicating errors, the default is 'margins'.</code></pre>
<pre><code>New user option 'flymake-margin-indicators-string'.
It controls, for each error type, the string and its face to display as
the margin indicator.</code></pre>
<pre><code>New user option 'flymake-autoresize-margins'.
If non-nil (the default), Flymake will resize the margins when
'flymake-mode' is turned on or off.
Only relevant if 'flymake-indicator-type' is set to 'margins'.</code></pre>
<pre><code>New user option 'flymake-margin-indicator-position'.
It controls whether to use margins for margin indicators, and which
margin (left or right) to use.  Default is to use the left margin.</code></pre>
<pre><code>New user option 'flymake-show-diagnostics-at-end-of-line'.
When non-nil, Flymake shows summarized descriptions of diagnostics at
the end of the line.  Depending on your preference, this can either be
distracting and easily confused with actual code, or a significant
early aid that relieves you from moving the buffer or reaching for the
mouse to consult an error message.  Default is nil.</code></pre>
<p class=\" text-justify\">Worth enabling to see if it is something that helps or hinders. You should consider setting it in a dir locals variable or mode hook so it only applies to some buffers.</p>
<H3 id=\"flyspell\">Flyspell</H3>
<p class=\" text-justify\">Emacs’s on the fly spell checker.</p>
<pre><code>New user option 'flyspell-check-changes'.
When non-nil, Flyspell mode spell-checks only words that you edited; it
does not check unedited words just because you move point across them.
Default is nil.</code></pre>
<H3 id=\"js-mode\">JS mode</H3>
<p class=\" text-justify\">One of a dozen modes that edit Javascript.</p>
<pre><code>The binding 'M-.' has been removed from the major mode keymaps in
'js-mode' and 'js-ts-mode', having it default to the global binding
which calls 'xref-find-definitions'.  If the previous one worked
better for you, use 'define-key' in your init script to bind
'js-find-symbol' to that combination again.</code></pre>
<p class=\" text-justify\">This is just standardizing on the xref interface and its default global keys.</p>
<p class=\" text-justify\">:</p>
<pre><code>'js-json-mode' does not derive from 'js-mode' any more so as not
to confuse tools like Eglot or YASnippet into thinking that those
buffers contain Javascript code.</code></pre>
<H3 id=\"python-mode\">Python mode</H3>
<p class=\" text-justify\">The major mode for editing Python.</p>
<pre><code>New user option 'python-indent-block-paren-deeper'.
If non-nil, increase the indentation of the lines inside parens in a
header of a block when they are indented to the same level as the body
of the block, producing:

    if (some_expression
            and another_expression):
        do_something()

instead of:

    if (some_expression
        and another_expression):
        do_something()

Default is nil.</code></pre>
<p class=\" text-justify\">I long ago stopped worrying about this stuff when code formatting tools became prevalent. Why get angry at your coworkers’ bad code formatting habits when you can direct your anger at a faceless code formatting tool instead?</p>
<pre><code>New user option 'python-interpreter-args'.
This allows the user to specify command line arguments to the non
interactive Python interpreter specified by 'python-interpreter'.</code></pre>
<pre><code>New function 'python-shell-send-block'.
It sends the python block delimited by 'python-nav-beginning-of-block'
and 'python-nav-end-of-block' to the inferior Python process.</code></pre>
<H3 id=\"inferior-python-mode\">Inferior Python mode</H3>
<p class=\" text-justify\">Inferior Python mode refers to the comint version that talks to the external python interpreter.</p>
<pre><code>Default value of 'python-shell-compilation-regexp-alist' is changed.
Support for Python's ExceptionGroup has been added, so in the Python
shell, the line indicating the source of an error in the error messages
from ExceptionGroup will be recognized as well.</code></pre>
<H3 id=\"eldoc\">Eldoc</H3>
<p class=\" text-justify\">Eldoc is a generic documentation popup system.</p>
<pre><code>'eldoc' no longer truncates to a single line by default.
Previously, the entire docstring was not available to eldoc, which made
'eldoc-echo-area-use-multiline-p' ineffective.  The old behavior may be
kept by customizing 'eldoc-echo-area-use-multiline-p'.</code></pre>
<H3 id=\"scheme-mode\">Scheme mode</H3>
<pre><code>Scheme mode now handles the regular expression literal '#/regexp/' that
 is available in some Scheme implementations.
 Also, it should now handle nested sexp-comments.</code></pre>
<H3 id=\"use-package\">Use package</H3>
<p class=\" text-justify\"><a href=\"/article/spotlight-use-package-a-declarative-configuration-tool\" class=\" article-link\">use-package is a declarative configuration tool</a>.</p>
<pre><code>New ':vc' keyword.
This keyword enables the user to install packages using package-vc.el.</code></pre>
<p class=\" text-justify\">This is a great addition and it rounds off the ability to manually install packages with VC that arrived in Emacs 29. You can replace a lot of the third-party package managers now if your needs are simple.</p>
<pre><code>New user option 'use-package-vc-prefer-newest'.
If non-nil, always install the newest commit of a package when using the
':vc' keyword rather than its stable release.  Default is nil.</code></pre>
<H3 id=\"gnus\">Gnus</H3>
<p class=\" text-justify\">Gnus is an expansive mail and news agent in Emacs.</p>
<pre><code>New backend 'nnfeed'.
This allows backend developers to easily create new backends for web
feeds, as inheriting backends of 'nnfeed'.</code></pre>
<pre><code>New backend 'nnatom'.
This allow users to add Atom Syndication Format feeds to Gnus as
servers.</code></pre>
<pre><code>The 'nnweb-type' option 'gmane' has been removed.
The gmane.org website is, sadly, down since a number of years with no
prospect of it coming back.  Therefore, it is no longer valid to set
the server variable 'nnweb-type' to 'gmane'.</code></pre>
<pre><code>New user option 'gnus-mode-line-logo'.
This allows the user to either disable the display of any logo or
specify which logo will be displayed as part of the
buffer-identification in the mode-line of Gnus buffers.</code></pre>
<pre><code>'gnus-summary-limit-to-age' now counts days since midnight.
\"Less than 1 day\" now means \"since last midnight\", rather than \"less
than 24 hours old\".</code></pre>
<H3 id=\"rmail\">Rmail</H3>
<p class=\" text-justify\">Rmail is one of many ways of sending and reading email in Emacs.</p>
<pre><code>New commands for reading mailing lists.
The new Rmail commands 'rmail-mailing-list-post',
'rmail-mailing-list-unsubscribe', 'rmail-mailing-list-help', and
'rmail-mailing-list-archive' allow, respectively, posting to,
unsubscribing from, requesting help about, and browsing the archives
of, the mailing list from which the current email message was
delivered.</code></pre>
<H3 id=\"dictionary\">Dictionary</H3>
<p class=\" text-justify\">Dictionary is a lookup system for <a href=\"/article/wordsmithing-in-emacs\" class=\" article-link\">wordsmiths</a>.</p>
<pre><code>New user option 'dictionary-search-interface'.
Controls how the 'dictionary-search' command prompts for and displays
dictionary definitions.  Customize this user option to 'help' to have
'dictionary-search' display definitions in a \"*Help*\" buffer and
provide dictionary-based minibuffer completion for word selection.
Default is nil, which means to use a \"*Dictionary*\" buffer.</code></pre>
<pre><code>New user option 'dictionary-read-word-prompt'.
This allows the user to customize the prompt that is used by
'dictionary-search' when asking for a word to search in the
dictionaries.</code></pre>
<pre><code>New user option 'dictionary-display-definition-function'.
This allows the user to customize the way in which 'dictionary-search'
displays word definitions.  If non-nil, this user option should be set
to a function that displays a word definition obtained from a
dictionary server.  The new function
'dictionary-display-definition-in-help-buffer' can be used to display
the definition in a \"*Help*\" buffer, instead of the default
\"*Dictionary*\" buffer.</code></pre>
<pre><code>New user option 'dictionary-read-word-function'.
This allows the user to customize the way in which 'dictionary-search'
prompts for a word to search in the dictionary.  This user option
should be set to a function that lets the user select a word and
returns it as a string.  The new function
'dictionary-completing-read-word' can be used to prompt with
completion based on dictionary matches.</code></pre>
<pre><code>New user option 'dictionary-read-dictionary-function'.
This allows the user to customize the way in which 'dictionary-search'
prompts for a dictionary to search in.  This user option should be set
to a function that lets the user select a dictionary and returns its
name as a string.  The new function
'dictionary-completing-read-dictionary' can be used to prompt with
completion based on dictionaries that the server supports.</code></pre>
<pre><code>The default value of 'dictionary-tooltip-dictionary' has changed.
The new default value is t, which means use the same dictionary as the
value of 'dictionary-default-dictionary'.  The previous default value
was nil, which effectively disabled 'dictionary-tooltip-mode', even if
the mode was turned on.</code></pre>
<H3 id=\"pp\">Pp</H3>
<p class=\" text-justify\">Pp is the pretty printing functionality for elisp.</p>
<pre><code>New 'pp-default-function' user option replaces 'pp-use-max-width'.
Its default value is 'pp-fill', a new default pretty-printing function,
which tries to obey 'fill-column'.</code></pre>
<pre><code>'pp-to-string' takes an additional PP-FUNCTION argument.
This argument specifies the prettifying algorithm to use.</code></pre>
<pre><code>'pp' and 'pp-to-string' now always include a terminating newline.
In the past they included a terminating newline in most cases but not all.</code></pre>
<H3 id=\"emacs-lisp-mode\">Emacs Lisp mode</H3>
<p class=\" text-justify\">The major mode used to edit elisp code.</p>
<pre><code>'elisp-flymake-byte-compile' is disabled for untrusted files.
For security reasons, this backend can be used only in those files
specified as trusted according to 'trusted-content' and emits an
\"untrusted content\" warning otherwise.
This fixes CVE-2024-53920.</code></pre>
<pre><code>',@' now has 'prefix' syntax.
Previously, the '@' character, which normally has 'symbol' syntax,
would combine with a following Lisp symbol and interfere with symbol
searching.</code></pre>
<pre><code>'emacs-lisp-docstring-fill-column' now defaults to 72.
It was previously 65.  The new default formats documentation strings to
fit on fewer lines without negatively impacting readability.</code></pre>
<H3 id=\"cperl-mode\">CPerl mode</H3>
<p class=\" text-justify\">One of two Perl modes in Emacs.</p>
<pre><code>Subroutine signatures are now supported.
CPerl mode fontifies subroutine signatures like variable declarations
which makes them visually distinct from subroutine prototypes.</code></pre>
<pre><code>Syntax of Perl up to version 5.40 is supported.
CPerl mode supports the new keywords for exception handling and the
object oriented syntax which were added in Perl 5.36, 5.38 and 5.40.</code></pre>
<pre><code>New user option 'cperl-fontify-trailer'.
This user option takes the values 'perl-code' or 'comment' and treats
text after an \"__END__\" or \"__DATA__\" token accordingly.  The default
value of 'perl-code' is useful for trailing POD and for AutoSplit
modules, the value 'comment' makes CPerl mode treat trailers as
comment, like Perl mode does.</code></pre>
<pre><code>New command 'cperl-file-style'.
This command sets the indentation style for the current buffer.  To
change the default style, either use the user option with the same name
or use the command 'cperl-set-style'.</code></pre>
<pre><code>New minor mode 'cperl-extra-paired-delimiters-mode'.
Perl 5.36 and newer allows using more than 200 non-ASCII paired
delimiters for quote-like constructs, e.g. \"q«text»\".  Use this minor
mode in buffers where this feature is activated.</code></pre>
<pre><code>Commands using the Perl Info manual are obsolete.
The Perl documentation in Info format is no longer distributed with
Perl or on CPAN since more than 10 years.  Perl documentation can be
read with 'cperl-perldoc' instead.</code></pre>
<pre><code>Highlighting trailing whitespace has been removed.
The user option 'cperl-invalid-face' is now obsolete, and does
nothing.  See the user option 'show-trailing-whitespace' instead.</code></pre>
<H3 id=\"emacs-sessions-desktop\">Emacs Sessions (Desktop)</H3>
<p class=\" text-justify\">Desktop saves and restores your Emacs buffers and files between sessions.</p>
<pre><code>Restoring buffers visiting remote files can now time out.
When a buffer is restored which visits a remote file, the restoration
of the session could hang if the remote host is off-line or slow to
respond.  Setting the user option 'remote-file-name-access-timeout' to
a positive number will abandon the attempt to restore such buffers
after a timeout of that many seconds, thus allowing the rest of
desktop restoration to continue.</code></pre>
<p class=\" text-justify\">I have absolutely been caught out by this before, so that is a welcome change indeed.</p>
<H3 id=\"recentf\">Recentf</H3>
<p class=\" text-justify\">Recentf remembers files you have visited and lets you re-visit them quickly.</p>
<pre><code>Checking recent remote files can now time out.
Similarly to buffer restoration by Desktop, 'recentf-mode' checking
of the accessibility of remote files can now time out if
'remote-file-name-access-timeout' is set to a positive number.</code></pre>
<H3 id=\"image-dired\">Image Dired</H3>
<p class=\" text-justify\">One of several ways of displaying images in Emacs.</p>
<pre><code>New user option 'image-dired-thumb-naming'.
You can now configure how thumbnails are named using this option.</code></pre>
<H3 id=\"ert\">ERT</H3>
<p class=\" text-justify\">This is a test runner framework for Emacs, and a rather useful one at that.</p>
<pre><code>New macro 'skip-when' to skip 'ert-deftest' tests.
This can help to avoid some awkward skip conditions.  For example
'(skip-unless (not noninteractive))' can be changed to the easier
to read '(skip-when noninteractive)'.</code></pre>
<pre><code>Syntax highlighting unit testing support.
An ERT extension ('ert-font-lock') now provides support for face
assignment unit testing.  For more information, see the \"(ert) Syntax
Highlighting Tests\" node in the ERT manual.</code></pre>
<H3 id=\"socks\">Socks</H3>
<p class=\" text-justify\">SOCKS is a proxy-like protocol that, quite frankly, I don’t think I’ve used in decades.</p>
<pre><code>Socks supports version 4a.
The 'socks-server' user option accepts '4a' as a value for its version
field.</code></pre>
<H3 id=\"edmacro\">Edmacro</H3>
<p class=\" text-justify\">This is the major mode for interactively editing keyboard macros.</p>
<pre><code>New command 'edmacro-set-macro-to-region-lines'.
Bound to 'C-c C-r', this command replaces the macro text with the
lines of the region.  If needed, the region is extended to include
whole lines.  If the region ends at the beginning of a line, that last
line is excluded.</code></pre>
<pre><code>New user option 'edmacro-reverse-macro-lines'.
When this is non-nil, the lines of key sequences are displayed with
the most recent line first.  This is can be useful when working with
macros with many lines, such as from 'kmacro-edit-lossage'.</code></pre>
<H3 id=\"calc\">Calc</H3>
<p class=\" text-justify\">This is Emacs’s advanced symbolic computer algebra system.</p>
<pre><code>Calc parses fractions written using U+2044 FRACTION SLASH.
Fractions of the form \"123⁄456\" are handled as if written \"123:456\".
Note in particular the difference in behavior from U+2215 DIVISION SLASH
and U+002F SOLIDUS, which result in division rather than a rational
fraction.  In addition, precomposed fraction characters, such as ½
(U+00BD VULGAR FRACTION ONE HALF), are also recognized as rational
fractions.  (They have been recognized since 2004, but it looks like it
was never mentioned in the NEWS, or even the Calc manual.)</code></pre>
<H3 id=\"ielm\">IELM</H3>
<p class=\" text-justify\">IELM is the interactive shell for <a href=\"/article/evaluating-elisp-emacs\" class=\" article-link\">Evaluating Elisp in Emacs</a>.</p>
<pre><code>IELM now remembers input history between sessions.
The new user option 'ielm-history-file-name' is the name of the file
where IELM input history will be saved.  Customize it to nil to revert
to the old behavior of not remembering input history between sessions.</code></pre>
<H3 id=\"easypg\">EasyPG</H3>
<p class=\" text-justify\">EasyPG is a wrapper for GnuPG and friends. See <a href=\"/article/keeping-secrets-in-emacs-gnupg-auth-sources\" class=\" article-link\">Keeping Secrets in Emacs with GnuPG and Auth Sources</a>.</p>
<pre><code>New user option 'epa-keys-select-method'.
This allows the user to customize the key selection method, which can be
either by using a pop-up buffer or from the minibuffer.  The pop-up
buffer method is the default, which preserves previous behavior.</code></pre>
<H3 id=\"widget\">Widget</H3>
<p class=\" text-justify\">This is the internal library used by Emacs for buttons, edit fields, etc. in places like the Customize interface.</p>
<pre><code>New face 'widget-unselected'.
Customize this face to a non-default value to visually distinguish the
labels of unselected active radio-button or checkbox widgets from the
labels of unselected inactive widgets (the default value inherits from
the 'widget-inactive' face).</code></pre>
<pre><code>New user option 'widget-skip-inactive'.
If non-nil, moving point forward or backward between widgets by typing
'TAB' or 'S-TAB' skips over inactive widgets.  The default value is nil.</code></pre>
<H3 id=\"ruby-mode\">Ruby mode</H3>
<p class=\" text-justify\">Programming mode for Ruby.</p>
<pre><code>New user option 'ruby-rubocop-use-bundler'.
By default it retains the previous behavior: read the contents of
Gemfile and act accordingly.  But you can also set it to t or nil to
skip checking the Gemfile.</code></pre>
<pre><code>New user option 'ruby-bracketed-args-indent'.
When it is set to nil, multiple consecutive open braces/brackets/parens
result in only one additional indentation level.  Default is t.</code></pre>
<H3 id=\"thingatpt\">Thingatpt</H3>
<p class=\" text-justify\">A framework for plucking the thing at point: words, functions, emails, urls, you name it. A useful thing to learn about and use, as it has a wide range of applications.</p>
<pre><code>New variables for providing custom thingatpt implementations.
The new variables 'bounds-of-thing-at-point-provider-alist' and
'forward-thing-provider-alist' now allow defining custom implementations
of 'bounds-of-thing-at-point' and 'forward-thing', respectively.</code></pre>
<pre><code>New helper functions for text property-based thingatpt providers.
The new helper functions 'thing-at-point-for-char-property',
'bounds-of-thing-at-point-for-char-property', and
'forward-thing-for-char-property' can help to implement custom thingatpt
providers for \"things\" that are defined by text properties.</code></pre>
<pre><code>'bug-reference-mode' now supports 'thing-at-point'.
Now, calling '(thing-at-point 'url)' when point is on a bug reference
will return the URL for that bug.</code></pre>
<p class=\" text-justify\">Bug reference mode is a small minor mode that makes ‘bug references’ (such as #2823) clickable.</p>
<H3 id=\"buffer-menu\">Buffer-menu</H3>
<p class=\" text-justify\">Yet another buffer selection and display system in Emacs.</p>
<pre><code>New user option 'Buffer-menu-group-by'.
It controls how buffers are divided into groups that are displayed with
headings using Outline minor mode.  Using commands that mark buffers
on the outline heading line will mark all buffers in the outline.  By
default, no grouping is performed.</code></pre>
<pre><code>New command 'Buffer-menu-toggle-internal'.
This command toggles the display of internal buffers in Buffer Menu mode;
that is, buffers not visiting a file and whose names start with a space.
Previously, such buffers were never shown.  This command is bound to 'I'
in Buffer Menu mode.</code></pre>
<H3 id=\"miscellaneous-1\">Miscellaneous</H3>
<pre><code>New user option 'rcirc-log-time-format'.
This allows for rcirc logs to use a custom timestamp format, which the
chat buffers use by default.</code></pre>
<p class=\" text-justify\">RCIRC is one of two IRC clients in Emacs, the other being ERC.</p>
<pre><code>'ffap-lax-url' now defaults to nil.
Previously, it was set to t, but this broke remote file name detection.</code></pre>
<p class=\" text-justify\">FFAP is Find File At Point is a system for plucking the file at point and opening it.</p>
<pre><code>More control on automatic update of Proced buffers.
The user option 'proced-auto-update-flag' can now be set to an
additional value 'visible', which controls automatic updates of Proced
buffers that are displayed in some window.</code></pre>
<p class=\" text-justify\">Proced’s basically Emacs’s answer to <code>top</code>. See <a href=\"/article/displaying-interacting-processes-proced\" class=\" article-link\">Displaying and Interacting with processes using Proced</a>.</p>
<pre><code>nXML Mode now comes with schemas for Mono/.NET development.
The following new XML schemas are now supported:
- MSBuild project files
- Dotnet package properties files
- Dotnet resource extension files
- Dotnet Application config files
- Nuget config file
- Nuget package specification file
- Nuget packages config file</code></pre>
<pre><code>color.el now supports the Oklab color representation.</code></pre>
<p class=\" text-justify\">The color file has a large range of advanced color conversion routines. Worth a look if that is something you interact with a lot.</p>
<pre><code>New user option 'xwidget-webkit-disable-javascript'.
This allows disabling JavaScript in xwidget Webkit sessions.</code></pre>
<p class=\" text-justify\">XWidget is a half-abandoned, half-working attempt at bringing the Webkit browser to Emacs.</p>
<pre><code>'ls-lisp--insert-directory' supports more long options of 'ls'.
'ls-lisp--insert-directory', the ls-lisp implementation of
'insert-directory', now supports the '--time=TIME' and '--sort=time'
options of GNU 'ls'.</code></pre>
<p class=\" text-justify\">How does dired work on platforms (such as MS-DOS or Windows) where there is no <code>ls</code> program? The answer is simple: Emacs has an elisp emulation layer that talks to the underlying system directly.</p>
<pre><code>'M-x ping' can now give additional flags to the 'ping' program.
Typing 'C-u M-x ping' prompts first for the host, and then for the flags
to give to the 'ping' command.</code></pre>
<p class=\" text-justify\">There is a host of network utility wrappers in Emacs. See <a href=\"/article/network-utilities-emacs\" class=\" article-link\">Using the commandline network utilities from Emacs</a>.</p>
<pre><code>Webjump now assumes URIs are HTTPS instead of HTTP.
For links in 'webjump-sites' without an explicit URI scheme, it was
previously assumed that they should be prefixed with \"http://\".  Such
URIs are now prefixed with \"https://\" instead.</code></pre>
<p class=\" text-justify\">Another obscure feature in Emacs. Here it’s a flat list of common URLs and a command to select and then open one of them. The fact that “Yahoo” is still in there says it all.</p>
<pre><code>Added prefixes in titdic-cnv library.
Most of the variables and functions in the file have been renamed to
make sure they all use a 'tit-' namespace prefix.</code></pre>
<p class=\" text-justify\">Obscure library for working with Quail, a format used in multilingual systems.</p>
<pre><code>'xref-revert-buffer' is now an alias of 'revert-buffer'.
The Xref buffer now sets up 'revert-buffer-function' such that
'revert-buffer' behaves like 'xref-revert-buffer' did in previous Emacs
versions, and the latter is now an alias of the former.</code></pre>
<p class=\" text-justify\">Xref is Emacs’s cross-referencing system, and all this change does is make it so <code>M-x revert-buffer</code> (which I have a version of that reverts the current buffer bound to <code>F6</code>) reverts properly in xref buffers also.</p>
<pre><code>The Makefile browser is now obsolete.
The command 'makefile-switch-to-browser' command is now obsolete,
together with related commands used in the \"*Macros and Targets*\"
buffer.  We recommend using an alternative like 'imenu' instead.</code></pre>
<pre><code>'jsonrpc-default-request-timeout' is now a defcustom.</code></pre>
<H2 id=\"new-modes-and-packages-in-emacs-30.1\">New Modes and Packages in Emacs 30.1</H2>
<H3 id=\"new-major-modes-based-on-the-tree-sitter-library\">New major modes based on the tree-sitter library</H3>
<pre><code>New major mode 'elixir-ts-mode'.
A major mode based on the tree-sitter library for editing Elixir files.</code></pre>
<pre><code>New major mode 'heex-ts-mode'.
A major mode based on the tree-sitter library for editing HEEx files.</code></pre>
<pre><code>New major mode 'html-ts-mode'.
An optional major mode based on the tree-sitter library for editing
HTML files.</code></pre>
<pre><code>New major mode 'lua-ts-mode'.
A major mode based on the tree-sitter library for editing Lua files.</code></pre>
<pre><code>New major mode 'php-ts-mode'.
A major mode based on the tree-sitter library for editing PHP files.</code></pre>
<p class=\" text-justify\">Good to see more tree-sitter major modes.</p>
<pre><code>New package EditorConfig.
This package provides support for the EditorConfig standard,
an editor-neutral way to provide directory local (project-wide) settings.
It is enabled via a new global minor mode 'editorconfig-mode'
which makes Emacs obey the '.editorconfig' files.
There is also a new major mode 'editorconfig-conf-mode'
to edit those configuration files.</code></pre>
<p class=\" text-justify\">Long overdue, even if I find the capabilities of editorconfig rather basic.</p>
<pre><code>New global minor mode 'etags-regen-mode'.
This minor mode generates the tags table automatically based on the
current project configuration, and later updates it as you edit the
files and save the changes.</code></pre>
<pre><code>New package 'which-key'.
The 'which-key' package from GNU ELPA is now included in Emacs.  It
implements the global minor mode 'which-key-mode' that displays a table
of key bindings upon entering a partial key chord and waiting for a
moment.  For example, after enabling the minor mode, if you enter 'C-x'
and wait for one second, the minibuffer will expand with all available
key bindings that follow 'C-x' (or as many as space allows).</code></pre>
<p class=\" text-justify\">This is a long-awaited inclusion for some people. Which-key pops up a list of key bindings if you partially type a key and a wait a little while.</p>
<pre><code>New minor mode 'completion-preview-mode'.
This minor mode shows you symbol completion suggestions as you type,
using an inline preview.  New user options in the 'completion-preview'
customization group control exactly when Emacs displays this preview.
'completion-preview-mode' is buffer-local, to enable it globally use
'global-completion-preview-mode'.</code></pre>
<p class=\" text-justify\">Buried in the foot of the NEWS file is one of the best new additions in Emacs. A window-based answer to Company / Corfu, with a host of really nice ergonomic features. I really, really recommend you disable your in-line completer (corfu, company, auto-complete, whatever) and give this one a try for a little while.</p>
<pre><code>New package Window-Tool-Bar.
This provides a new minor mode, 'window-tool-bar-mode'.  When this minor
mode is enabled, a tool bar is displayed at the top of a window.  To
conserve space, no tool bar is shown if 'tool-bar-map' is nil.  The
global minor mode 'global-window-tool-bar-mode' enables this minor mode
in all buffers.</code></pre>
<p class=\" text-justify\">A compromise for people who want the toolbar but only when it has something interesting to offer.</p>
<pre><code>New library Track-Changes.
This library is a layer of abstraction above 'before-change-functions'
and 'after-change-functions' which provides a superset of
the functionality of 'after-change-functions':
- It provides the actual previous text rather than only its length.
- It takes care of accumulating and bundling changes until a time when
  its client finds it convenient to react to them.
- It detects most cases where some changes were not properly
  reported (calls to 'before/after-change-functions' that are
  incorrectly paired, missing, etc...) and reports them adequately.</code></pre>
<p class=\" text-justify\">Building this sort of thing is surprisingly tricky, as the text above briefly alludes to. It does not seem to be used in many places yet, but I foresee that it will play an important role in tools that want to provide in-buffer tracking of changes without the tears of having to build all this infrastructure from scratch. I especially like the feature that it collects the changes until such a time that the client deems it needs them; very useful, and hard to do well with nothing more than a set of before/after change hooks.</p>
<pre><code>New global minor mode 'minibuffer-regexp-mode'.
This is a minor mode for editing regular expressions in the minibuffer,
for example in 'query-replace-regexp'.  It correctly highlights parens
via 'show-paren-mode' and 'blink-matching-paren' in a user-friendly way,
avoids reporting alleged paren mismatches and makes sexp navigation more
intuitive.  It is enabled by default, 'minibuffer-regexp-prompts' can be
used to tune when it takes effect.</code></pre>
<p class=\" text-justify\">Excellent feature that is enabled by default, so no need to do anything.</p>
<pre><code>The highly accessible Modus themes collection has eight items.
The 'modus-operandi' and 'modus-vivendi' are the main themes that have
been part of Emacs since version 28.  The former is light, the latter
dark.  In addition to these, we now have 'modus-operandi-tinted' and
'modus-vivendi-tinted' for easier legibility, as well as
'modus-operandi-deuteranopia', 'modus-vivendi-deuteranopia',
'modus-operandi-tritanopia', and 'modus-vivendi-tritanopia' to cover
the needs of users with red-green or blue-yellow color deficiency.
The Info manual \"(modus-themes) Top\" describes the details and
showcases all their user options.</code></pre>
<p class=\" text-justify\">A popular set of themes beloved by many.</p>
<H3 id=\"new-library-peg\">New library PEG</H3>
<pre><code>Emacs now includes a library for writing Parsing Expression
Grammars (PEG), an approach to text parsing that provides more structure
than regular expressions, but less complexity than context-free
grammars.  The Info manual \"(elisp) Parsing Expression Grammars\" has
documentation and examples.</code></pre>
<p class=\" text-justify\">Interesting inclusion and I am curious to see it in use. Emacs already has parsing tools already (Semantic Bovinator being one such example) so I guess this will find a home in Org mode as it has a range of custom query languages.</p>
<pre><code>New major mode 'shell-command-mode'.
This mode is used by default for the output of asynchronous 'shell-command'.
To revert to the previous behavior, set the (also new) variable
'async-shell-command-mode' to 'shell-mode'.  Any hooks or mode-specific
variables used should be adapted appropriately.</code></pre>
<pre><code>New package Compat.
Emacs now comes with a stub implementation of the
forwards-compatibility Compat package from GNU ELPA.  This allows
built-in packages to use the library more effectively, and helps
preventing the installation of Compat if unnecessary.</code></pre>
<p class=\" text-justify\">Compat provides backwards and forwards compatible changes for package authors so they can target older versions of Emacs, and keep older packages working in newer ones, too.</p>
<H3 id=\"incompatible-lisp-changes-in-emacs-30.1\">Incompatible Lisp Changes in Emacs 30.1</H3>
<pre><code>Evaluating a 'lambda' returns an object of type 'interpreted-function'.
Instead of representing interpreted functions as lists that start with
either 'lambda' or 'closure', Emacs now represents them as objects
of their own 'interpreted-function' type, which is very similar
to 'byte-code-function' objects (the argument list, docstring, and
interactive forms are placed in the same slots).
Lists that start with 'lambda' are now used only for non-evaluated
functions (in other words, for source code), but for backward compatibility
reasons, 'functionp' still recognizes them as functions and you can
still call them as before.
Thus code that attempts to \"dig\" into the internal structure of an
interpreted function's object with the likes of 'car' or 'cdr' will
no longer work and will need to use 'aref' instead to extract its
various subparts (when 'interactive-form', 'documentation', and
'help-function-arglist' aren't adequate).</code></pre>
<p class=\" text-justify\">The heart of this is that in Lisp, code and data are the same, and when Emacs emits a readable form of a lambda or closure you just created, it does so in a way that looks like a list. In older Emacsen, you could write <code>(car (lambda))</code> and it’d spit out <code>closure</code> (provided <code>lexical-binding</code> is enabled), and now you cannot do this; it’s not a list any more.</p>
<p class=\" text-justify\">It’s very unlikely this will affect you in any way.</p>
<pre><code>The escape sequence '\\x' not followed by hex digits is now an error.
Previously, '\\x' without at least one hex digit denoted character code
zero (NUL) but as this was neither intended nor documented or even
known by anyone, it is now treated as an error by the Lisp reader.</code></pre>
<pre><code>'subr-native-elisp-p' is renamed to 'native-comp-function-p'.
The previous name still exists but is marked as obsolete.</code></pre>
<pre><code>'define-globalized-minor-mode' requires that modes use 'run-mode-hooks'.
Minor modes defined with 'define-globalized-minor-mode', such as
'global-font-lock-mode', will not be enabled any more in those buffers
whose major modes fail to use 'run-mode-hooks'.  Major modes defined
with 'define-derived-mode' are not affected.  'run-mode-hooks' has been the
recommended way to run major mode hooks since Emacs 22.</code></pre>
<pre><code>'buffer-match-p' and 'match-buffers' take '&amp;rest ARGS'.
They used to take a single '&amp;optional ARG' and were documented to use
an unreliable hack to try and support condition predicates that
don't accept this optional ARG.
The new semantics makes no such accommodation, but the code still
supports it (with a warning) for backward compatibility.</code></pre>
<pre><code>'post-gc-hook' runs after updating 'gcs-done' and 'gc-elapsed'.</code></pre>
<pre><code>Connection-local variables are applied in buffers visiting remote files.
This overrides possible directory-local or file-local variables with
the same name.</code></pre>
<pre><code>'copy-tree' now copies records when its optional 2nd argument is non-nil.</code></pre>
<pre><code>Regexp zero-width assertions followed by operators are better defined.
Previously, regexps such as \"xy\\\\B*\" would have ill-defined behavior.
Now any operator following a zero-width assertion applies to that
assertion only (which is useless).  For historical compatibility, an
operator character following '^' or '\\`' becomes literal, but we
advise against relying on this.</code></pre>
<pre><code>Infinities and NaNs no longer act as symbols on non-IEEE platforms.
On old platforms like the VAX that do not support IEEE floating-point,
tokens like '0.0e+NaN' and '1.0e+INF' are no longer read as symbols.
Instead, the Lisp reader approximates an infinity with the nearest
finite value, and a NaN with some other non-numeric object that
provokes an error if used numerically.</code></pre>
<pre><code>Conversion of strings to and from byte-arrays works with multibyte strings.
The functions 'dbus-string-to-byte-array' and
'dbus-byte-array-to-string' now accept and return multibyte Lisp
strings, encoding to UTF-8 and decoding from UTF-8 internally.  This
means that the argument to 'dbus-byte-array-to-string' must be a valid
UTF-8 byte sequence, and the optional parameter MULTIBYTE of
'dbus-byte-array-to-string' is now obsolete and unused.  The argument of
'dbus-string-to-byte-array' should be a regular Lisp string, not a
unibyte string.</code></pre>
<pre><code>'minibuffer-allow-text-properties' now can be set buffer-local.
'read-from-minibuffer' and functions that use it can take the
buffer-local value from the minibuffer.</code></pre>
<pre><code>'minibuffer-allow-text-properties' now also affects completions.
When it has a non-nil value, then completion functions like
'completing-read' don't discard text properties from the returned
completion candidate.</code></pre>
<pre><code>X color support compatibility aliases are now obsolete.
The compatibility aliases 'x-defined-colors', 'x-color-defined-p',
'x-color-values', and 'x-display-color-p' are now obsolete.</code></pre>
<pre><code>'easy-mmode-define-{minor,global}-mode' aliases are now obsolete.
Use 'define-minor-mode' and 'define-globalized-minor-mode' instead.</code></pre>
<pre><code>The 'millisec' argument of 'sleep-for' is now obsolete.
Use a float value for the first argument instead.</code></pre>
<pre><code>User options 'eshell-NAME-unload-hook' are now obsolete.
These hooks were named incorrectly, and so they never actually ran
when unloading the corresponding feature.  Instead, you should use
hooks named after the feature name, like 'esh-mode-unload-hook'.</code></pre>
<pre><code>User options 'eshell-process-wait-{seconds,milliseconds}' are now obsolete.
Instead, use 'eshell-process-wait-time', which supports floating-point
values.</code></pre>
<pre><code>User option 'tramp-completion-reread-directory-timeout' has been removed.
This user option was obsoleted in Emacs 27, use
'remote-file-name-inhibit-cache' instead.</code></pre>
<pre><code>The obsolete calling convention of 'sit-for' has been removed.
That convention was: '(sit-for SECONDS MILLISEC &amp;optional NODISP)'.</code></pre>
<pre><code>'defadvice' is marked as obsolete.
See the \"(elisp) Porting Old Advice\" Info node for help converting
them to use 'advice-add' or 'define-advice' instead.</code></pre>
<p class=\" text-justify\">Emacs added a new advice system many versions ago; it’s better, and I should get around to removing the old advice forms…</p>
<pre><code>'cl-old-struct-compat-mode' is marked as obsolete.
You may need to recompile your code if it was compiled with Emacs &lt; 24.3.</code></pre>
<pre><code>Old derived.el functions removed.
The following functions have been deleted because they were only used
by code compiled with Emacs &lt; 21:
'derived-mode-init-mode-variables', 'derived-mode-merge-abbrev-tables',
'derived-mode-merge-keymaps', 'derived-mode-merge-syntax-tables',
'derived-mode-run-hooks', 'derived-mode-set-abbrev-table',
'derived-mode-set-keymap', 'derived-mode-set-syntax-table',
'derived-mode-setup-function-name'.

</code></pre>
<H3 id=\"lisp-changes-in-emacs-30.1\">Lisp Changes in Emacs 30.1</H3>
<pre><code>The 'wheel-up/down/left/right' events are now bound unconditionally.
The 'mouse-wheel-up/down/left/right-event' variables are thus used only
to specify the 'mouse-4/5/6/7' events that might still happen to be
generated by some old packages (or if 'mouse-wheel-buttons' has been set
to nil).</code></pre>
<pre><code>Xterm Mouse mode now emits 'wheel-up/down/right/left' events.
This is instead of 'mouse-4/5/6/7' events for the mouse wheel.  It uses
the new variable 'mouse-wheel-buttons' to decide which button maps to
which wheel event (if any).</code></pre>
<pre><code>In batch mode, tracing now sends the trace to stdout.</code></pre>
<pre><code>New hook 'hack-dir-local-get-variables-functions'.
This can be used to provide support for other directory-local settings
beside \".dir-locals.el\".</code></pre>
<pre><code>'auto-coding-functions' can know the name of the file.
The functions on this hook can now find the name of the file to
which the text belongs by consulting the variable 'auto-coding-file-name'.</code></pre>
<pre><code>New user option 'compilation-safety' to control safety of native code.
It is now possible to control how safe is the code generated by native
compilation, by customizing this user option.  It is also possible to
control this at function granularity by using the new 'safety' parameter
in the function's 'declare' form.</code></pre>
<pre><code>New types 'closure' and 'interpreted-function'.
'interpreted-function' is the new type used for interpreted functions,
and 'closure' is the common parent type of 'interpreted-function'
and 'byte-code-function'.

Those new types come with the associated new predicates 'closurep' and
'interpreted-function-p' as well as a new constructor
'make-interpreted-closure'.</code></pre>
<pre><code>New function 'help-fns-function-name'.
For named functions, it just returns the name and otherwise
it returns a short \"unique\" string that identifies the function.
In either case, the string is propertized so clicking on it gives
further details.</code></pre>
<pre><code>New function 'char-to-name'.
This is a convenience function to return the Unicode name of a char (if
it has one).</code></pre>
<pre><code>New function 'cl-type-of'.
This function is like 'type-of' except that it sometimes returns
a more precise type.  For example, for nil and t it returns 'null'
and 'boolean' respectively, instead of just 'symbol'.</code></pre>
<pre><code>New functions 'primitive-function-p' and 'cl-functionp'.
'primitive-function-p' is like 'subr-primitive-p' except that it returns
t only if the argument is a function rather than a special-form,
and 'cl-functionp' is like 'functionp' except it returns nil
for lists and symbols.</code></pre>
<pre><code>Built-in types now have corresponding classes.
At the Lisp level, this means that things like '(cl-find-class 'integer)'
will now return a class object, and at the UI level it means that
things like 'C-h o integer RET' will show some information about that type.</code></pre>
<pre><code>New variable 'major-mode-remap-defaults' and function 'major-mode-remap'.
The first is like Emacs-29's 'major-mode-remap-alist' but to be set by
packages (instead of users).  The second looks up those two variables.</code></pre>
<p class=\" text-justify\">Yet more complexity around how to remap major modes to accommodate tree-sitter major modes.</p>
<pre><code>Pcase's functions (in 'pred' and 'app') can specify the argument position.
For example, instead of '(pred (&lt; 5))' you can write '(pred (&gt; _ 5))'.</code></pre>
<p class=\" text-justify\">Ah good. I always found it odd that it would bind to the left-most argument, but now I can specify which one I want.</p>
<pre><code>'define-advice' now sets the new advice's 'name' property to NAME.
Named advices defined with 'define-advice' can now be removed with
'(advice-remove SYMBOL NAME)' in addition to '(advice-remove SYMBOL
SYMBOL@NAME)'.</code></pre>
<pre><code>New function 'require-with-check' to detect new versions shadowing.
This is like 'require', but it checks whether the argument 'feature'
is already loaded, in which case it either signals an error or
forcibly reloads the file that defines the feature.</code></pre>
<pre><code>New variable 'lisp-eval-depth-reserve'.
It puts a limit to the amount by which Emacs can temporarily increase
'max-lisp-eval-depth' when handling signals.</code></pre>
<pre><code>New special form 'handler-bind'.
It provides a functionality similar to 'condition-case' except it runs
the handler code without unwinding the stack, such that we can record
the backtrace and other dynamic state at the point of the error.  See
the Info node \"(elisp) Handling Errors\".</code></pre>
<pre><code>New text properties add tooltips on fringes.
It is now possible to provide tooltips on fringes by adding special text
properties 'left-fringe-help' and 'right-fringe-help'.  See the \"(elisp)
Special Properties\" Info node in the Emacs Lisp Reference Manual for
more details.</code></pre>
<pre><code>New 'display-buffer' action alist entry 'pop-up-frames'.
This has the same effect as the variable of the same name and takes
precedence over the variable when present.</code></pre>
<pre><code>New function 'merge-ordered-lists'.
Mostly used internally to do a kind of topological sort of
inheritance hierarchies.</code></pre>
<pre><code>'drop' is now an alias for the function 'nthcdr'.</code></pre>
<pre><code>New polymorphic comparison function 'value&lt;'.
This function returns non-nil if the first argument is less than the
second.  It works for any two values of the same type with reasonable
ordering for numbers, strings, symbols, bool-vectors, markers, buffers
and processes.  Conses, lists, vectors and records are ordered
lexicographically.
It is intended as a convenient ordering predicate for sorting, and is
likely to be faster than hand-written Lisp functions.</code></pre>
<p class=\" text-justify\">Ah that is very useful actually. Now to remember that it exists…</p>
<pre><code>New 'sort' arguments and features.
The 'sort' function can now be called using the signature

    (sort SEQ &amp;rest KEYWORD-ARGUMENTS)

where arguments after the first are keyword/value pairs, all optional:
':key' specifies a function that produces the sorting key from an element,
':lessp' specifies the ordering predicate, defaulting to 'value&lt;',
':reverse' is used to reverse the sorting order,
':in-place' is used for in-place sorting, as the default is now to
sort a copy of the input.

The new signature is less error-prone and reduces the need to write
ordering predicates by hand.  We recommend that you use the ':key'
argument instead of ':lessp' unless a suitable ordering predicate is
already available.  This can also be used for multi-key sorting:

    (sort seq :key (lambda (x) (list (age x) (size x) (cost x))))

sorts by the return value of 'age', then by 'size', then by 'cost'.

The old signature, '(sort SEQ PREDICATE)', can still be used and sorts
its input in-place as before.</code></pre>
<pre><code>New API for 'derived-mode-p' and control of the graph of major modes</code></pre>
<pre><code>'derived-mode-p' now takes the list of modes as a single argument.
The same holds for 'provided-mode-derived-p'.
The old calling convention where multiple modes are passed as
separate arguments is deprecated.</code></pre>
<pre><code>New functions to access the graph of major modes.
While 'define-derived-mode' still only supports single inheritance,
modes can declare additional parents (for tests like 'derived-mode-p')
with 'derived-mode-add-parents'.
Accessing the 'derived-mode-parent' property directly is now
deprecated in favor of the new functions 'derived-mode-set-parent'
and 'derived-mode-all-parents'.</code></pre>
<p class=\" text-justify\">This complexity is yet again borne out of tree-sitter’s introduction to Emacs. I do wonder if all this complexity (remember diamond pattern inheritance in OO?) will come back to bite us in a few years… I hope not.</p>
<pre><code>Drag-and-drop functions can now be called once for compound drops.
It is now possible for drag-and-drop handler functions to respond to
drops incorporating more than one URL.  Functions capable of this must
set their 'dnd-multiple-handler' symbol properties to a non-nil value.
See the Info node \"(elisp) Drag and Drop\".

The function 'dnd-handle-one-url' has been made obsolete, since it
cannot take these new handlers into account.</code></pre>
<pre><code>'notifications-notify' can use Icon Naming Specification for ':app-icon'.
You can use a symbol as the value for ':app-icon' to provide icon name
without specifying a file, like this:

    (notifications-notify
      :title \"I am playing music\" :app-icon 'multimedia-player)</code></pre>
<pre><code>New function 're-disassemble' to see the innards of a regexp.
If you built Emacs with '--enable-checking', you can use this to help
debug either your regexp performance problems or the regexp engine.</code></pre>
<pre><code>XLFDs are no longer restricted to 255 characters.
'font-xlfd-name' now returns an XLFD even if it is greater than 255
characters in length, provided that the LONG_XLFDs argument is true.
Other features in Emacs which employ XLFDs have been modified to
produce and understand XLFDs larger than 255 characters.</code></pre>
<pre><code>New macro 'static-if' for conditional evaluation of code.
This macro hides a form from the evaluator or byte-compiler based on a
compile-time condition.  This is handy for avoiding byte-compilation
warnings about code that will never actually run under some conditions.</code></pre>
<pre><code>Desktop notifications are now supported on the Haiku operating system.
The new function 'haiku-notifications-notify' provides a subset of the
capabilities of the 'notifications-notify' function in a manner
analogous to 'w32-notification-notify'.</code></pre>
<pre><code>New Haiku specific variable 'haiku-pass-control-tab-to-system'.
This sets whether Emacs should pass 'C-TAB' on to the system instead of
handling it, fixing a problem where window switching would not activate
if an Emacs frame had focus on the Haiku operating system.  Default
value is t.</code></pre>
<pre><code>New value 'if-regular' for the REPLACE argument to 'insert-file-contents'.
It results in 'insert-file-contents' erasing the buffer instead of
preserving markers if the file being inserted is not a regular file,
rather than signaling an error.</code></pre>
<pre><code>New variable 'current-key-remap-sequence'.
It is bound to the key sequence that caused a call to a function bound
within 'function-key-map' or 'input-decode-map' around those calls.</code></pre>
<pre><code>The function 'key-translate' can now remove translations.
If the second argument TO is nil, the existing key translation is
removed.</code></pre>
<pre><code>New variables describing the names of built in programs.
The new variables 'ctags-program-name', 'ebrowse-program-name',
'etags-program-name', 'hexl-program-name', 'emacsclient-program-name'
'movemail-program-name', and 'rcs2log-program-name' should be used
instead of \"ctags\", \"ebrowse\", \"etags\", \"hexl\", \"emacsclient\", and
\"rcs2log\", when starting one of these built in programs in a subprocess.</code></pre>
<pre><code>New variable 'case-symbols-as-words' affects case operations for symbols.
If non-nil, then case operations such as 'upcase-initials' or
'replace-match' (with nil FIXEDCASE) will treat the entire symbol name
as a single word.  This is useful for programming languages and styles
where only the first letter of a symbol's name is ever capitalized.
The default value of this variable is nil.</code></pre>
<pre><code>Bytecode is now always loaded eagerly.
Bytecode compiled with older Emacs versions for lazy loading using
'byte-compile-dynamic' is now loaded all at once.
As a consequence, 'fetch-bytecode' has no use, does nothing, and is
now obsolete.  The variable 'byte-compile-dynamic' has no effect any
more; compilation will always yield bytecode for eager loading.</code></pre>
<pre><code>Returned strings from functions and macros are never docstrings.
Functions and macros whose bodies consist of a single string literal now
only return that string, and will not use it as a docstring.  Example:

    (defun sing-a-song ()
      \"Sing a song.\")

The above function returns the string \"Sing a song.\" and has no
docstring.  Previously, that string was used as both the docstring and
return value, which was never what the programmer wanted.  If you want
the string to be a docstring, add an explicit return value.

This change applies to 'defun', 'defsubst', 'defmacro' and 'lambda'
forms; other defining forms such as 'cl-defun' already worked this way.</code></pre>
<H3 id=\"new-or-changed-byte-compilation-warnings\">New or changed byte-compilation warnings</H3>
<pre><code>Warn about missing 'lexical-binding' directive.
The compiler now warns if an Elisp file lacks the standard
'-*- lexical-binding: ... -*-' cookie on the first line.
This line typically looks something like

    ;;; My little pony mode  -*- lexical-binding: t -*-

It is needed to inform the compiler about which dialect of ELisp
your code is using: the modern dialect with lexical binding or
the old dialect with only dynamic binding.

Lexical binding avoids some name conflicts and allows the compiler to
detect more mistakes and generate more efficient code, so it is
recommended.  For how to adapt your code to lexical binding, see the
manual section \"(elisp) Converting to Lexical Binding\".

If your code cannot be converted to lexical binding, you can insert
the line

    ;;; -*- lexical-binding: nil -*-

first in the file to declare that it uses the old dialect.</code></pre>
<pre><code>Warn about empty bodies for more special forms and macros.
The compiler now warns about an empty body argument to 'when',
'unless', 'ignore-error' and 'with-suppressed-warnings' in addition to
the existing warnings for 'let' and 'let*'.  Example:

    (when (&gt; x 2))

This warning can be suppressed using 'with-suppressed-warnings' with
the warning name 'empty-body'.</code></pre>
<pre><code>Warn about quoted error names in 'condition-case' and 'ignore-error'.
The compiler now warns about quoted condition (error) names
in 'condition-case' and 'ignore-error'.  Example:

    (condition-case nil
        (/ x y)
      ('arith-error \"division by zero\"))

Quoting them adds the error name 'quote' to those handled or ignored
respectively, which was probably not intended.</code></pre>
<pre><code>Warn about comparison with literal constants without defined identity.
The compiler now warns about comparisons by identity with a literal
string, cons, vector, record, function, large integer or float as this
may not match any value at all.  Example:

    (eq x \"hello\")

Only literals for symbols and small integers (fixnums), including
characters, are guaranteed to have a consistent (unique) identity.
This warning applies to 'eq', 'eql', 'memq', 'memql', 'assq', 'rassq',
'remq' and 'delq'.

To compare by (structural) value, use 'equal', 'member', 'assoc',
'rassoc', 'remove' or 'delete' instead.  Floats and bignums can also
be compared using 'eql', '=' and 'memql'.  Function literals cannot be
compared reliably at all.

This warning can be suppressed using 'with-suppressed-warnings' with
the warning name 'suspicious'.</code></pre>
<pre><code>Warn about 'condition-case' without handlers.
The compiler now warns when the 'condition-case' form is used without
any actual handlers, as in

    (condition-case nil (read buffer))

because it has no effect other than the execution of the body form.
In particular, no errors are caught or suppressed.  If the intention
was to catch all errors, add an explicit handler for 'error', or use
'ignore-error' or 'ignore-errors'.

This warning can be suppressed using 'with-suppressed-warnings' with
the warning name 'suspicious'.</code></pre>
<pre><code>Warn about 'unwind-protect' without unwind forms.
The compiler now warns when the 'unwind-protect' form is used without
any unwind forms, as in

    (unwind-protect (read buffer))

because the behavior is identical to that of the argument; there is
no protection of any kind.  Perhaps the intended unwind forms have
been misplaced or forgotten, or the use of 'unwind-protect' could be
simplified away.

This warning can be suppressed using 'with-suppressed-warnings' with
the warning name 'suspicious'.</code></pre>
<pre><code>Warn about useless trailing 'cond' clauses.
The compiler now warns when a 'cond' form contains clauses following a
default (unconditional) clause.  Example:

    (cond ((= x 0) (say \"none\"))
          (t (say \"some\"))
          (say \"goodbye\"))

Such a clause will never be executed, and is likely to be a mistake,
perhaps due to misplaced parens.

This warning can be suppressed using 'with-suppressed-warnings' with
the warning name 'suspicious'.</code></pre>
<pre><code>Warn about mutation of constant values.
The compiler now warns about code that modifies program constants in
some obvious cases.  Examples:

    (setcar '(1 2) 7)
    (aset [3 4] 0 8)
    (aset \"abc\" 1 ?d)

Such code may have unpredictable behavior because the constants are part
of the program and are not data structures generated afresh during
execution; the compiler does not expect them to change.

To avoid the warning, operate on an object created by the program
(maybe a copy of the constant), or use a non-destructive operation
instead.

This warning can be suppressed using 'with-suppressed-warnings' with
the warning name 'mutate-constant'.</code></pre>
<pre><code>Warn about more ignored function return values.
The compiler now warns when the return value from certain functions is
implicitly ignored.  Example:

    (progn (nreverse my-list) my-list)

will elicit a warning because it is usually pointless to call
'nreverse' on a list without using the returned value.

To silence the warning, make use of the value in some way, such as
assigning it to a variable.  You can also wrap the function call in
'(ignore ...)', or use 'with-suppressed-warnings' with the warning
name 'ignored-return-value'.

The warning will only be issued for calls to functions declared
'important-return-value' or 'side-effect-free' (but not 'error-free').</code></pre>
<pre><code>Warn about docstrings that contain control characters.
The compiler now warns about docstrings with control characters other
than newline and tab.  This is often a result of improper escaping.
Example:

    (defun my-fun ()
      \"Uses c:\\remote\\dir\\files and the key \\C-x.\"
      ...)

where the docstring contains the four control characters 'CR', 'DEL',
'FF' and 'C-x'.

The warning name is 'docstrings-control-chars'.</code></pre>
<pre><code>The warning about wide docstrings can now be disabled separately.
Its warning name is 'docstrings-wide'.</code></pre>
<pre><code>'fset', 'defalias' and 'defvaralias' now signal an error for cyclic aliases.
Previously, 'fset', 'defalias' and 'defvaralias' could be made to
build circular function and variable indirection chains as in

    (defalias 'able 'baker)
    (defalias 'baker 'able)

but trying to use them would sometimes make Emacs hang.  Now, an attempt
to create such a loop results in an error.

Since circular alias chains now cannot occur, 'function-alias-p',
'indirect-function' and 'indirect-variable' will never signal an error.
Their 'noerror' arguments have no effect and are therefore obsolete.</code></pre>
<H3 id=\"touch-screen-support\">Touch Screen support</H3>
<pre><code>'x-popup-menu' now understands touch screen events.
When a 'touchscreen-begin' or 'touchscreen-end' event is passed as the
POSITION argument, it will behave as if that event was a mouse event.</code></pre>
<pre><code>New functions for handling touch screen events.
The new functions 'touch-screen-track-tap' and 'touch-screen-track-drag'
handle tracking common touch screen gestures from within a command.</code></pre>
<pre><code>New parameter to 'touchscreen-end' events.
CANCEL non-nil establishes that the touch sequence has been intercepted
by programs such as window managers and should be ignored with Emacs.</code></pre>
<pre><code>New variable 'inhibit-auto-fill' to temporarily prevent auto-fill.</code></pre>
<pre><code>New variable 'secondary-tool-bar-map'.
If non-nil, this variable contains a keymap of menu items that are
displayed along tool bar items defined by 'tool-bar-map'.  These items
are displayed below the tool bar if the value of 'tool-bar-position' is
'top', and above it if the value is 'bottom'.  This is used by
'modifier-bar-mode'.</code></pre>
<pre><code>New variable 'completion-lazy-hilit'.
Lisp programs that present completion candidates may bind this
variable non-nil around calls to functions such as
'completion-all-completions'.  This tells the underlying completion
styles to skip eager fontification of completion candidates, which
improves performance.  Such a Lisp program can then use the
'completion-lazy-hilit' function to fontify candidates just in time.</code></pre>
<pre><code>New primitive 'buffer-last-name'.
It returns the name of a buffer before the last time it was renamed or
killed.</code></pre>
<pre><code>New primitive 'marker-last-position'.
It returns the last position of a marker in its buffer even if that
buffer has been killed.  ('marker-position' would return nil in that
case.)</code></pre>
<H3 id=\"functions-and-variables-to-transpose-sexps\">Functions and variables to transpose sexps</H3>
<p class=\" text-justify\">Juri Linkov did an awful lot of work to try and salvage the rather broken tree-sitter “sexp” commands and I think he’s done a stellar job, considering how hard it is to do <a href=\"/article/combobulate-structured-movement-editing-treesitter\" class=\" article-link\">Structured Movement and Editing with Tree-Sitter</a> in a way that works the way users expect it work.</p>
<pre><code>New helper variable 'transpose-sexps-function'.
Lisp programs can now set this variable to customize the behavior of the
'transpose-sexps' command.</code></pre>
<pre><code>New function 'transpose-sexps-default-function'.
The previous implementation of 'transpose-sexps' was moved into its own
function, to be used in 'transpose-sexps-function'.</code></pre>
<pre><code>New function 'treesit-transpose-sexps'.
Tree-sitter now unconditionally sets 'transpose-sexps-function' for all
tree-sitter enabled modes to this function.</code></pre>
<H3 id=\"functions-and-variables-to-move-by-program-statements\">Functions and variables to move by program statements</H3>
<pre><code>New variable 'forward-sentence-function'.
Major modes can now set this variable to customize the behavior of the
'forward-sentence' command.</code></pre>
<pre><code>New function 'forward-sentence-default-function'.
The previous implementation of 'forward-sentence' is moved into its
own function, to be bound by 'forward-sentence-function'.</code></pre>
<pre><code>New function 'treesit-forward-sentence'.
All tree-sitter enabled modes that define 'sentence' in
'treesit-thing-settings' now set 'forward-sentence-function' to call
'treesit-forward-sentence'.</code></pre>
<H3 id=\"functions-and-variables-to-move-by-program-sexps\">Functions and variables to move by program sexps</H3>
<pre><code>New function 'treesit-forward-sexp'.
Tree-sitter conditionally sets 'forward-sexp-function' for major modes
that have defined 'sexp' in 'treesit-thing-settings' to enable
sexp-related motion commands.</code></pre>
<pre><code>New user option 'native-comp-async-warnings-errors-kind'.
It allows control of what kinds of warnings and errors from asynchronous
native compilation are reported to the parent Emacs process.  The
default is to report all errors and only important warnings.  If you
were used to customizing 'native-comp-async-report-warnings-errors' to
nil or 'silent', we suggest that you now leave it at its default value,
and see if you get only warnings that matter.</code></pre>
<pre><code>New 'ftype' function declaration.
The declaration '(ftype TYPE)' specifies the type of a function.
Example:

    (defun hello (x y)
      (declare (ftype (function (integer boolean) string)))
      ...)

specifies that the function takes two arguments, an integer and a
boolean, and returns a string.  If the compilation happens with
'compilation-safety' set to zero, this information can be used by the
native compiler to produce better code, but specifying an incorrect type
may lead to Emacs crashing.  See the Info node \"(elisp) Declare Form\"
for further information.</code></pre>
<p class=\" text-justify\">You can now declare the type of functions in Emacs, presumably to help the native compiler make informed choices about the input and return value. We are moving inexorably closer to Common Lisp…</p>
<pre><code>New 'important-return-value' function declaration and property.
The declaration '(important-return-value t)' sets the
'important-return-value' property which indicates that the function
return value should probably not be thrown away implicitly.</code></pre>
<pre><code>New functions 'file-user-uid' and 'file-group-gid'.
These functions are like 'user-uid' and 'group-gid', respectively, but
are aware of file name handlers, so they will return the remote UID or
GID for remote files (or -1 if the connection has no associated user).</code></pre>
<pre><code>'treesit-font-lock-rules' now accepts additional global keywords.
When supplied with ':default-language LANGUAGE', rules after it will
default to use 'LANGUAGE'.</code></pre>
<p class=\" text-justify\">A welcome bit of syntactic sugar.</p>
<pre><code>New optional argument to 'modify-dir-local-variable'.
An optional 5th argument FILE has been added to
'modify-dir-local-variable'.  It can be used to specify which file to
modify instead of the default \".dir-locals.el\".</code></pre>
<H3 id=\"connection-local-variables\">Connection local variables</H3>
<p class=\" text-justify\">Connection local variables are variables local to Tramp-specific connections.</p>
<pre><code>New macros 'connection-local-p' and 'connection-local-value'.
The former macro returns non-nil if a variable has a connection-local
binding.  The latter macro returns the connection-local value of a
variable if any, or its current value.</code></pre>
<H3 id=\"hash-tables\">Hash tables</H3>
<pre><code>':rehash-size' and ':rehash-threshold' args no longer have any effect.
These keyword arguments are now ignored by 'make-hash-table'.  Emacs
manages the memory for all hash table objects in the same way.
The functions 'hash-table-rehash-size' and 'hash-table-rehash-threshold'
remain for compatibility but now always return the old default values.</code></pre>
<pre><code>The printed representation has been shrunk and simplified.
The 'test' parameter is omitted if it is 'eql' (the default), as is
'data' if empty.  'rehash-size', 'rehash-threshold' and 'size' are
always omitted, and ignored if present when the object is read back in.</code></pre>
<H3 id=\"obarrays\">Obarrays</H3>
<pre><code>New obarray type.
Obarrays are now represented by an opaque type instead of using vectors.
They are created by 'obarray-make' and manage their internal storage
automatically, which means that the size parameter to 'obarray-make' can
safely be omitted.  That is, they do not become slower as they fill up.

The old vector representation is still accepted by functions operating
on obarrays, but 'obarrayp' only returns t for obarray objects.
'type-of' now returns 'obarray' for obarray objects.

Old code which (incorrectly) created \"obarrays\" as Lisp vectors filled
with something other than 0, as in '(make-vector N nil)', will no longer
work, and should be rewritten to use 'obarray-make'.  Alternatively, you
can fill the vector with 0.</code></pre>
<pre><code>New function 'obarray-clear' removes all symbols from an obarray.</code></pre>
<pre><code>'obarray-size' and 'obarray-default-size' are now obsolete.
They pertained to the internal storage size which is now irrelevant.</code></pre>
<pre><code>'treesit-install-language-grammar' can handle local directory instead of URL.
It is now possible to pass a directory of a local repository as URL
inside 'treesit-language-source-alist', so that calling
'treesit-install-language-grammar' will avoid cloning the repository.
It may be useful, for example, for the purposes of bisecting a
treesitter grammar.</code></pre>
<pre><code>New buffer-local variable 'tabulated-list-groups'.
It controls display and separate sorting of groups of entries.  By
default no grouping or sorting is done.</code></pre>
<pre><code>New variable 'revert-buffer-restore-functions'.
It helps to preserve various states after reverting the buffer.</code></pre>
<pre><code>New text property 'context-menu-functions'.
Like the variable with the same name, it adds menus from the list that
is the value of the property to context menus shown when clicking on the
text which as this property.</code></pre>
<pre><code>Detecting the end of an iteration of a keyboard macro.
'read-event', 'read-char', and 'read-char-exclusive' no longer return -1
when called at the end of an iteration of the execution of a keyboard
macro.  Instead, they will transparently continue reading available input
(e.g., from the keyboard).  If you need to detect the end of a macro
iteration, check the following condition before calling one of the
aforementioned functions:

    (and (arrayp executing-kbd-macro)
         (&gt;= executing-kbd-macro-index (length executing-kbd-macro)))</code></pre>
<pre><code>'vtable-update-object' updates an existing object with just two arguments.
It is now possible to update the representation of an object in a vtable
by calling 'vtable-update-object' with just the vtable and the object as
arguments.  (Previously, the OLD-OBJECT argument was required which, in
this case, would mean repeating the object in the argument list.)  When
replacing an object with a different one, passing both the new and old
objects is still necessary.</code></pre>
<pre><code>'vtable-insert-object' can insert \"before\" or at an index.
The signature of 'vtable-insert-object' has changed and is now:

    (vtable-insert-object TABLE OBJECT &amp;optional LOCATION BEFORE)

LOCATION corresponds to the old AFTER-OBJECT argument; if BEFORE is
non-nil, the new object is inserted before the LOCATION object, making
it possible to insert a new object at the top of the table.  (Before,
this was not possible.)  In addition, LOCATION can be an integer, a
(zero-based) index into the table at which the new object is inserted
(BEFORE is ignored in this case).</code></pre>
<pre><code>New function 'sqlite-execute-batch'.
This function lets the user execute multiple SQL statements in one go.
It is useful, for example, when a Lisp program needs to evaluate an
entire SQL file.</code></pre>
<H3 id=\"json\">JSON</H3>
<pre><code>'json-serialize' now always returns a unibyte string.
This is appropriate since it is an encoding operation.  In the unlikely
event that a multibyte string is needed, the result can be decoded using

    (decode-coding-string RESULT 'utf-8)</code></pre>
<pre><code>The parser keeps duplicated object keys in alist and plist output.
A JSON object such as '{\"a\":1,\"a\":2}' will now be translated into the
Lisp values '((a . 1) (a . 2))' or '(:a 1 :a 2)' if alist or plist
object types are requested.</code></pre>
<pre><code>The parser sometimes signals different types of errors.
It will now signal 'json-utf8-decode-error' for inputs that are not
correctly UTF-8 encoded.</code></pre>
<pre><code>The parser and encoder now accept arbitrarily large integers.
Previously, they were limited to the range of signed 64-bit integers.</code></pre>
<pre><code>New tree-sitter functions and variables for defining and using \"things\"</code></pre>
<pre><code>New variable 'treesit-thing-settings'.
It allows modes to define \"things\" like 'defun', 'text', 'sexp', and
'sentence' for navigation commands and tree-traversal functions.</code></pre>
<pre><code>New functions for navigating \"things\".
There are new navigation functions 'treesit-thing-prev',
'treesit-thing-next', 'treesit-navigate-thing',
'treesit-beginning-of-thing', and 'treesit-end-of-thing'.</code></pre>
<pre><code>New functions 'treesit-thing-at', 'treesit-thing-at-point'.</code></pre>
<p class=\" text-justify\">The tree-sitter-enabled equivalent of <code>thing-at-point</code>. This really should be merged into the existing thing at point system; if TS is available, then its settings should take precedence.</p>
<pre><code>Tree-traversing functions.
The functions 'treesit-search-subtree', 'treesit-search-forward',
'treesit-search-forward-goto', and 'treesit-induce-sparse-tree' now
accept more kinds of predicates.  Lisp programs can now use thing
symbols (defined in 'treesit-thing-settings') and any thing definitions
for the predicate argument.</code></pre>
<H3 id=\"other-tree-sitter-function-and-variable-changes\">Other tree-sitter function and variable changes</H3>
<pre><code>'treesit-parser-list' now takes additional optional arguments.
The additional arguments are LANGUAGE and TAG.  If LANGUAGE is given,
only return parsers for that language.  If TAG is given, only return
parsers with that tag.  Note that passing nil as tag doesn't mean return
all parsers, but rather \"all parsers with no tags\".</code></pre>
<pre><code>New variable 'treesit-primary-parser'.
This variable should be set by multi-langauge major modes before calling
'treesit-major-mode-setup', in order for tree-sitter integration
functionalities to operate correctly.</code></pre>
<p class=\" text-justify\">I’m not convinced having the notion of a primary parser is the right approach for multi-language support in a buffer. The notion of primacy is not going to resolve problems where multiple languages that do not know of each other have to coexist in the same buffer; those languages by definition do not have a primary language, and trying to coax Emacs and thus tree-sitter into thinking there is such a thing is flawed.</p>
<H3 id=\"changes-in-emacs-30.1-on-non-free-operating-systems\">Changes in Emacs 30.1 on Non-Free Operating Systems</H3>
<H3 id=\"ms-windows\">MS-Windows</H3>
<pre><code>You can now opt out of following MS-Windows' Dark mode.
By default, Emacs on MS-Windows follows the system's Dark mode for its
title bars' and scroll bars' appearance.  If the new user option
'w32-follow-system-dark-mode' is customized to the nil value, Emacs
will disregard the system's Dark mode and will always use the default
Light mode.</code></pre>
<pre><code>You can now use Image-Dired even if the 'convert' program is not installed.
If you don't have GraphicsMagick or ImageMagick installed, and thus the
'gm convert'/'convert' program is not available, Emacs on MS-Windows
will now use its own function 'w32image-create-thumbnail' to create
thumbnail images and show them in the thumbnail buffer.  Unlike with
using 'convert', this fallback method is synchronous, so Emacs will wait
until all the thumbnails are created and displayed, before showing them.</code></pre>
<pre><code>Emacs on MS-Windows now supports the ':stipple' face attribute.</code></pre>" "https://www.masteringemacs.org/article/whats-new-in-emacs-301?utm_source=newsletter&utm_medium=rss" (26556 11705) new 4 nil nil ((title nil "What's New in Emacs 30.1?") (link nil "https://www.masteringemacs.org/article/whats-new-in-emacs-301?utm_source=newsletter&utm_medium=rss") (description nil "What is new in Emacs 30.1? I go through every change in the NEWS file and talk about the most interesting and useful changes.") (encoded nil "
<p class=\" text-justify drop-cap\">Emacs 30.1 is upon us, and it’s time for another bumper release full of new features and improvements.</p>
<p class=\" text-justify\">As always, I have taken the time to go through most of the changes in Emacs 30.1 and annotated them to give perspective and clarity.</p>
<p class=\" text-justify\">Here is but a few of the highlights in 30.1:</p>
<ul>
<li><p class=\" text-justify\"><code>completion-preview-mode</code> is a tantalizing replacement for company mode and corfu as it combines the buffer and window system (the <code>*Completions*</code> window when you minibuffer complete with <code>TAB</code>) with an <em>excellent</em> user experience by adding a schnazzy predictive typing that the old auto complete package did. I think <code>*Completions*</code> system already in Emacs, combined with the preview option, makes it a useful alternative to Company / Corfu for some.</p>
<p class=\" text-justify\">You also get to leverage the full force of Emacs’s expansive set of minibuffer completion styles, orders and more, though preview mode does have a few limitations around the style you can use.</p>
<p class=\" text-justify\">This is my favorite feature in Emacs 30.1. The user experience is superb; someone really cared for this, and it shows.</p></li>
<li><p class=\" text-justify\">The Org URI protocol should now register automatically, meaning you can send data from a browser bookmarklet straight into org capture in your running Emacs instance.</p>
<p class=\" text-justify\">The org protocol feature’s not new to Emacs 30.1, but automatically configuring your Emacs on Linux so it works properly <em>is</em>.</p></li>
<li><p class=\" text-justify\">Which-key is now built in, which is good news for people who prefer that method of help (as opposed to typing <code>C-h</code> in a key chord).</p></li>
<li><p class=\" text-justify\"><code>libjansson</code> is dead; long live Emacs’s builtin JSON parser. The new parser is much faster.</p></li>
<li><p class=\" text-justify\">The tree-sitter-specific <code>*-sexp</code> commands (such as <code>forward-sexp</code>) now work well.</p></li>
<li><p class=\" text-justify\">Native compilation is on by default, provided your system has the required dependencies. A massive vote of confidence for a great feature.</p></li>
<li><p class=\" text-justify\">Full support for Emacs on Android, and a whole host of touch screen-related improvements to Emacs as a result.</p></li>
<li><p class=\" text-justify\">You can now request a diff of your multi-file replace regexp (see <code>C-h a replace diff</code>)</p></li>
<li><p class=\" text-justify\">More Tramp (Emacs’s remote file editing system) connections, including support for Kubernetes pods.</p></li>
</ul>
<p class=\" text-justify\">I will, as per usual, begin to update <a href=\"/book\" class=\" article-link\">my book, Mastering Emacs</a>, so it includes these latest changes.</p>
<p class=\" text-justify\">Until then, and for the next couple of days, you can enjoy a 30% discount on my book. Enjoy!</p>
<H2 id=\"installation-changes-in-emacs-30.1\">Installation Changes in Emacs 30.1</H2>
<pre><code>Native compilation is now enabled by default.
'configure' will enable the Emacs Lisp native compiler, so long as
libgccjit is present and functional on the system.  To disable native
compilation, configure Emacs with the option:

    ./configure --with-native-compilation=no</code></pre>
<p class=\" text-justify\">That is good news. I’m hoping by declaring that native compilation, a must-have feature that <a href=\"/article/speed-up-emacs-libjansson-native-elisp-compilation\" class=\" article-link\">compiles elisp into native code</a> and greatly speeds up your Emacs, it encourage more distros to adopt the setting, if they have not already. If you’re the type to compile your own Emacs, you may want to read my article as it does require a few mandatory components that most Linux distributions do not ship with.</p>
<pre><code>Emacs has been ported to the Android operating system.
This requires Emacs to be compiled on another computer.  The Android
NDK, SDK, and a suitable Java compiler must also be installed.

See the file \"java/INSTALL\" for more details.</code></pre>
<p class=\" text-justify\">I’ve been following this development for quite a while, and it’s wonderful to see that you can run a full-blown Emacs instance on Android <em>and</em> with the support of the Emacs developers behind it. How exciting. I’ll have to find the time to play around with it.</p>
<pre><code>Native JSON support is now always available; libjansson is no longer used.
No external library is required.  The '--with-json' configure option has
been removed.  'json-available-p' now always returns non-nil and is only
kept for compatibility.</code></pre>
<p class=\" text-justify\">JSON is a massive bottleneck when you’re using LSP servers, as LSPs are chatty and JSON is how they communicate. I wrote about the introduction of <a href=\"/article/speed-up-emacs-libjansson-native-elisp-compilation\" class=\" article-link\">libjansson</a> when it was first introduced as it made a noticeable difference in performance back when it made an optional dependency in Emacs. It turns out that libjansson is not that quick. One day, a new contributor, Géza Herman, showed up with a JSON parser that was not only faster than libjansson, but more complete in its implementation.</p>
<p class=\" text-justify\">As a result libjansson is not only deprecated but removed entirely. Excellent!</p>
<pre><code>Emacs now defaults to the ossaudio library for sound on NetBSD and OpenBSD.
Previously, configure used ALSA libraries if installed on the system
when configured '--with-sound=yes' (which is the default), with fallback
to libossaudio.  The libossaudio library included with the base system
is now used even if ALSA is found to avoid relying on external packages
and to resolve potential incompatibilities between GNU/Linux and *BSD
versions of ALSA.  Use '--with-sound=alsa' to build with ALSA on these
operating systems instead.</code></pre>
<pre><code>New configuration option '--disable-gc-mark-trace'.
This disables the GC mark trace buffer for about 5% better garbage
collection performance.  Doing so may make it more difficult for Emacs
developers to help finding GC-related bugs that you run into, which is
why the mark trace buffer is enabled by default.</code></pre>
<p class=\" text-justify\">If you’re the type of person to compile your own Emacs, you might as well give this one a whirl. GC bugs do happen, but I’d say they’re rare enough that you can turn it off and claim your 5% speed-up voucher.</p>
<H2 id=\"startup-changes-in-emacs-30.1\">Startup Changes in Emacs 30.1</H2>
<pre><code>On GNU/Linux, Emacs is now the default application for 'org-protocol'.
Org mode provides a way to quickly capture bookmarks, notes, and links
using 'emacsclient':

    emacsclient \"org-protocol://store-link?url=URL&amp;title=TITLE\"

Previously, users had to manually configure their GNU/Linux desktop
environment to open 'org-protocol' links in Emacs.  These links should
now open in Emacs automatically, as the \"emacsclient.desktop\" file now
arranges for Emacs to be the default application for the 'org-protocol'
URI scheme.  See the Org mode manual, Info node \"(org) Protocols\" for
more details.</code></pre>
<p class=\" text-justify\">OK, no lie, this is a really cool feature that just got easier to use.</p>
<p class=\" text-justify\">Org can register (on Windows, Linux, etc.) itself as a URI protocol controller. When you open a <code>https</code> hyperlink, your OS knows it has to use your preferred browser; ditto for e-mail. Here it’s called <code>org-protocol</code>, and with this new change (or the slightly more manual steps outlined <a href=\"https://orgmode.org/worg/org-contrib/org-protocol.html\" class=\" article-link\">in the org mode manual</a>) you can request that <code>org-protocol://....</code> contents are sent to your Emacs for processing.</p>
<p class=\" text-justify\">That means you can send information to Org from other tools — such as the commandline or, more tantalizingly, from your web browser or even e-mails, provided your e-mail client follows hyperlinks and supports custom protocols.</p>
<p class=\" text-justify\">Provided you’ve done the installation steps (I recommend you check out the <a href=\"https://orgmode.org/worg/org-contrib/org-protocol.html\" class=\" article-link\">the link</a> if the example below does not work) you can use a snippet like this in a Bookmarklet in your browser – or straight into the console for testing:</p>
<pre><code>javascript:location.href = 'org-protocol://capture?' +
    new URLSearchParams({
          template: \"m\",
          url: location.href,
          title: document.title,
          body: window.getSelection()})</code></pre>
<p class=\" text-justify\">Replacing <code>template: \"m\"</code> with the <code>M-x org-capture</code> template key of your choice. The document’s title, URL and text selection is then sent to your org capture.</p>
<p class=\" text-justify\">Pretty darn cool! If you’re an org mode user – I know you are! – you should get on top of this right away.</p>
<p class=\" text-justify\">You can even register your own protocols (<code>org-protocol-protocol-alist</code>) and build your own integrations, and it’s not like you have to feed it into org!</p>
<pre><code>New variable lets Lisp code read emacsclient arguments.
When '--eval' is passed to emacsclient and Emacs is evaluating each
argument, the new variable 'server-eval-args-left' is set to those
arguments not yet evaluated.  It can be used by Lisp code to 'pop'
arguments and process them by the function called in the '--eval'
expression, which is useful when those arguments contain arbitrary
characters that otherwise might require elaborate and error-prone
escaping (to protect them from the shell).</code></pre>
<p class=\" text-justify\">Do not sleep on Emacs’s client-server architecture, or the headless evaluation feature it has. My article on <a href=\"/article/fuzzy-finding-emacs-instead-of-fzf\" class=\" article-link\">Fuzzy Finding with Emacs Instead of fzf</a> is a great example of how two dozen lines of elisp and another baker’s dozen of bash can clone the keystone feature of <code>fzf</code>.</p>
<H2 id=\"incompatible-changes-in-emacs-30.1\">Incompatible Changes in Emacs 30.1</H2>
<pre><code>Tree-Sitter modes are now declared as submodes of the non-TS modes.
In order to help the use of those Tree-Sitter modes, they are now
declared to have the corresponding non-Tree-Sitter mode as an
additional parent.
This way, things like \".dir-locals.el\" settings, and YASnippet
collections of snippets automatically apply to the new Tree-Sitter modes.

Note that those modes still do not inherit from the non-TS mode, so
configuration settings installed via mode hooks are not affected.

Loading a Tree-Sitter mode (such as by using 'M-x load-library' or with
'M-x load-file') by default causes the corresponding non-Tree-Sitter
mode be remapped to the Tree-Sitter mode.  This remapping affects
visiting files for which 'auto-mode-alist' specifies a non-Tree-Sitter
mode, and also affects mode-specification cookies on the first line of a
file and mode specifications in file- and directory-local variables.  To
revert to using a non-Tree-Sitter mode, reload the corresponding mode
file anew.  To prevent file loading from turning on Tree-Sitter mode
when 'auto-mode-alist' or the file/directory-local variables specify a
non-Tree-Sitter mode, customize the user option 'major-mode-remap-alist'
to specify that a non-Tree-Sitter mode is \"remapped\" to itself.  For
example:

    (add-to-list 'major-mode-remap-alist '(c-mode))

specifies that C Mode should not be remapped to 'c-ts-mode' even if and
when 'c-ts-mode' is loaded.  Conversely,

    (add-to-list 'major-mode-remap-alist '(c-mode . c-ts-mode))

tells Emacs to always invoke 'c-ts-mode' whenever 'c-mode' is
requested, either by 'auto-mode-alist' or by file/directory-local
variables.

We recommend using 'major-mode-remap-alist' to express your preferences
for using Tree-Sitter or non-Tree-Sitter modes for files for which both
variants of major modes are available, because that variable overrides
the remapping Emacs might decide to perform as result of loading Lisp
files and features.</code></pre>
<p class=\" text-justify\">I mean, I’m glad they’re slowly making these changes, as the tree-sitter modes are threadbare. Aside from better (usually) syntax highlighting and indentation, they rarely offer much.</p>
<p class=\" text-justify\">But this is yet another thing to explain to people that, yes, now your dir-locals will pick up on the TS mode you’re using, but all the other features present in the old major modes probably don’t work.</p>
<p class=\" text-justify\">In my opinion, tree-sitter major modes should be deprecated and the syntax highlighting and indentation relegated to optional minor modes you can enable in the existing major modes (and obviously brand new ones, if no such major modes exist) and all other “tree-sitter-portable” custom commands are gated behind a feature flag that require the presence of TS and the right grammar file to work, with perhaps a fallback for things that can be implemented – or is already – with non-TS code.</p>
<pre><code>Mouse wheel events should now always be 'wheel-up/down/left/right'.
At those places where the old 'mouse-4/5/6/7' events could still occur
(i.e., X11 input in the absence of XInput2, and 'xterm-mouse-mode'),
we remap them to the corresponding 'wheel-up/down/left/right' event,
according to the new user option 'mouse-wheel-buttons'.
The old variables 'mouse-wheel-up-event', 'mouse-wheel-down-event',
'mouse-wheel-left-event', and 'mouse-wheel-right-event' are thereby
obsolete.</code></pre>
<p class=\" text-justify\">I’ve never in my life been able to remember what the numbers map to, so I this is a useful aid to me and, no doubt, anybody else looking to remap or just figure out what a mouse event is.</p>
<pre><code>'completion-auto-help' now affects 'icomplete-in-buffer'.
Previously, 'completion-auto-help' mostly affected only minibuffer
completion.  Now, if 'completion-auto-help' has the value 'lazy', then
Icomplete's in-buffer display of possible completions will only appear
after the 'completion-at-point' command has been invoked twice, and if
'completion-auto-help' is nil, then Icomplete's in-buffer display is
completely suppressed.  Thus, if you use 'icomplete-in-buffer', ensure
'completion-auto-help' is not customized to 'lazy' or nil.</code></pre>
<pre><code>The \"*Completions*\" buffer now always accompanies 'icomplete-in-buffer'.
Previously, it was not consistent whether the \"*Completions*\" buffer would
appear when using 'icomplete-in-buffer'.  Now the \"*Completions*\" buffer
and Icomplete's in-buffer display of possible completions always
appear together.  If you would prefer to see only Icomplete's
in-buffer display, and not the \"*Completions*\" buffer, you can add this
to your init file:

    (advice-add 'completion-at-point :after #'minibuffer-hide-completions)</code></pre>
<p class=\" text-justify\">This governs the <code>*Completions*</code> window that may (or may not, as the case may be) pop up to offer assistance if when you are completing. If you use the default completion mechanism in Emacs, you may want to consider looking into tweaking this, if you find the current <code>*Completions*</code> behavior is not to your liking.</p>
<pre><code>The default process filter was rewritten in native code.
The round-trip through the Lisp function
'internal-default-process-filter' is skipped when the process filter is
the default one.  It is reimplemented in native code, reducing GC churn.
To undo this change, set 'fast-read-process-output' to nil.</code></pre>
<p class=\" text-justify\">Anything that speeds up a known and serious IO bottleneck in Emacs is welcome news to me. The fact they named the variable <code>fast-read-process-output</code> says it all.</p>
<pre><code>Network Security Manager now warns about 3DES by default.
This cypher is no longer recommended owing to a major vulnerability
disclosed in 2016, and its small 112 bit key size.  Emacs now warns
about its use also when 'network-security-level' is set to 'medium'
(the default).  See 'network-security-protocol-checks'.</code></pre>
<pre><code>Network Security Manager now warns about &lt;2048 bits in DH key exchange.
Emacs used to warn for ephemeral Diffie-Hellman (DHE) key exchanges with
prime numbers smaller than 1024 bits.  Since more servers now support
it, this number has been bumped to 2048 bits.</code></pre>
<pre><code>URL now never sends user email addresses in HTTP requests.
Emacs never sent email addresses by default, but it used to be
possible to customize 'url-privacy-level' so that the user's email
address was sent along in HTTP requests.  This feature has now been
removed, as it was considered more dangerous than useful.  RFC 9110
(§ 10.1.2) also recommends against it.  The user option
'url-personal-mail-address' is now also obsolete.

To send an email address in the header of individual HTTP requests,
see the variable 'url-request-extra-headers'.</code></pre>
<p class=\" text-justify\">I am not sure why there was ever the option of sending email addressed alongside HTTP requests. I don’t recall that ever being a thing in the 90s either, but perhaps that is just my memory failing me.</p>
<pre><code>'pixel-scroll-precision-mode' sets 'make-cursor-line-fully-visible'.
'pixel-scroll-precision-mode' sets 'make-cursor-line-fully-visible' to a
nil value globally, since the usual requirement of the Emacs display to
make the cursor line fully visible contradicts the smooth scrolling
expectations.</code></pre>
<p class=\" text-justify\">I recommend you try <a href=\"https://github.com/jdtsmith/ultra-scroll\" class=\" article-link\">ultra-scroll</a> if you’re serious about wanting smooth scrolling in Emacs.</p>
<H2 id=\"changes-in-emacs-30.1\">Changes in Emacs 30.1</H2>
<pre><code>Fix shell injection vulnerability in man.el (CVE-2025-1244).
We urge all users to upgrade immediately.</code></pre>
<pre><code>New user option 'trusted-content' to allow potentially dangerous features.
This option lists those files and directories whose content Emacs should
consider as sufficiently trusted to run any part of the code contained
therein even without any explicit user request.

For example, Flymake's backend for Emacs Lisp consults this option
and disables itself with an \"untrusted content\" warning if the file
is not listed.

Emacs Lisp authors should note that a major or minor mode must never set
this option to the ':all' value.

This option is used to fix CVE-2024-53920.  See below for details.</code></pre>
<p class=\" text-justify\">It shouldn’t come as a surprise to anybody that Emacs, a dynamic computing environment, can be coaxed into running stuff it shouldn’t. Ideally that’d never happen, but given the nature of what Emacs does – and how integrated it is in our lives – it is no surprise that on occasion its power is turned against it. What surprises me is that these issues don’t happen more frequently.</p>
<pre><code>Emacs now supports Unicode Standard version 15.1.</code></pre>
<pre><code>Emacs now comes with Org v9.7.
See the file \"etc/ORG-NEWS\" for user-visible changes in Org.</code></pre>
<pre><code>Improved support for touchscreen devices.
On systems that understand them (at present X, Android, PGTK, and
MS-Windows), many touch screen gestures are now implemented and
translated into mouse or gesture events, and support for tapping tool
bar buttons and opening menus has been added.  Countless packages, such
as Dired and Custom, have been adjusted to better understand touch
screen input.</code></pre>
<p class=\" text-justify\">This obviously goes hand in hand with the Android changes. The myth that Emacs is a keyboard only system is obviously false, and it has been since Lucid/XEmacs improved mouse support in the 1990s. Now that touch screen support is improved, I’m curious to see if we’ll see the emergence of org packages/email clients on Android that lean into the new touch support.</p>
<pre><code>Support for styled underline face attributes.
These are implemented as new values of the 'style' attribute in a face
underline specification, 'double-line', 'dots', and 'dashes', and are
available on GUI systems.  If your terminal's termcap or terminfo
database entry defines the 'Su' or 'Smulx' capability, Emacs will also
emit the prescribed escape sequence to render faces with such styles on
TTY frames.</code></pre>
<pre><code>Support for underline colors on TTY frames.
Colors specified in the underline face will now also be displayed on TTY
frames on terminals that support the 'Su' or 'Smulx' capabilities.</code></pre>
<p class=\" text-justify\">This is addition to things like squiggly underlines that we’ve had for a long time now. I’m quite surprised that terminals can render anything other than a opaque line, though; that is news to me.</p>
<pre><code>Modeline elements can now be right-aligned.
Anything following the symbol 'mode-line-format-right-align' in
'mode-line-format' will be right-aligned.  Exactly where it is
right-aligned to is controlled by the new user option
'mode-line-right-align-edge'.</code></pre>
<p class=\" text-justify\">Can’t say I’ve ever had the desire to heavily mod my mode line, but I know that a lot of people care greatly about its aethestics. I’m sure this is of benefit to people who use right-to-left languages also; perhaps they are the primary users?</p>
<pre><code>X selection requests are now handled much faster and asynchronously.
This means it should be less necessary to disable the likes of
'select-active-regions' when Emacs is running over a slow network
connection.</code></pre>
<pre><code>Emacs now updates invisible frames that are made visible by a compositor.
If an invisible or an iconified frame is shown to the user by the
compositing manager, Emacs will now redisplay such a frame even though
'frame-visible-p' returns nil or 'icon' for it.  This can happen, for
example, as part of preview for iconified frames.</code></pre>
<p class=\" text-justify\">I guess this refers to the ‘window peek’ feature in Windows’ taskbar, and that it’s really more of a bugfix / tweak more than an actual feature.</p>
<pre><code>Most file notification backends detect unmounting of a watched filesystem.
The only exception is w32notify.</code></pre>
<p class=\" text-justify\">Emacs will watch file changes using a range of mechanisms depending on the platform of choice.</p>
<pre><code>The ':map' property of images is now recomputed when image is transformed.
Images with clickable maps now work as expected after you run commands
such as 'image-increase-size', 'image-decrease-size', 'image-rotate',
'image-flip-horizontally', and 'image-flip-vertically'.
Set the new user option 'image-recompute-map-p' to nil to prevent Emacs
from recomputing image maps.</code></pre>
<H2 id=\"minibuffer-and-completions\">Minibuffer and Completions</H2>
<pre><code>New commands 'previous-line-completion' and 'next-line-completion'.
Bound to '&lt;up&gt;' and '&lt;down&gt;' arrow keys, respectively, they navigate
the \"*Completions*\" buffer vertically by lines, wrapping at the
top/bottom when 'completion-auto-wrap' is non-nil.</code></pre>
<pre><code>New user option 'minibuffer-visible-completions'.
When customized to non-nil, you can use arrow keys in the minibuffer
to navigate the completions displayed in the \"*Completions*\" window.
Typing 'RET' selects the highlighted candidate.  'C-g' hides the
completions window.  When the completions window is not visible,
then all these keys have their usual meaning in the minibuffer.
This option is supported for in-buffer completion as well.</code></pre>
<pre><code>Selected completion candidates are deselected on typing.
When you type at the minibuffer prompt, the current completion
candidate will be un-highlighted, and point in the \"*Completions*\" window
will be moved off that candidate.  'minibuffer-choose-completion'
('M-RET') will still choose a previously-selected completion
candidate, but the new command 'minibuffer-choose-completion-or-exit'
(bound to 'RET' by 'minibuffer-visible-completions') will exit with
the minibuffer contents instead.  This deselection behavior can be
controlled with the new user option 'completion-auto-deselect', which
is t by default.</code></pre>
<p class=\" text-justify\">There’s a longer-running theme to try and make the <code>*Completions*</code> window useful in contexts outside the minibuffer’s completion mechanism. This mechanism is rather confusingly named <code>completion-in-region</code>, even though it’s not just about acting on a region. If you use popup completion tools like company and corfu, then you should consider experimenting with this improved completion system, as it’s a “native” buffer-and-window-based approach to the same.</p>
<pre><code>New value 'historical' for user option 'completions-sort'.
When 'completions-sort' is set to 'historical', completion candidates
will be first sorted alphabetically, and then re-sorted by their order
in the minibuffer history, with more recent candidates appearing first.</code></pre>
<p class=\" text-justify\">There are popular third-party packages that do much of this already, so it’s nice to see that a similar feature has made it into core. My article on <a href=\"/article/understanding-minibuffer-completion\" class=\" article-link\">Understanding Minibuffer Completion</a> goes into more detail on how to configure minibuffer completion in Emacs.</p>
<pre><code>'completion-category-overrides' supports more metadata.
The new supported completion properties are 'cycle-sort-function',
'display-sort-function', 'annotation-function', 'affixation-function',
and 'group-function'.  You can now customize them for any category in
'completion-category-overrides' that will override the properties
defined in completion metadata.</code></pre>
<pre><code>'completion-extra-properties' supports more metadata.
The new supported completion properties are 'category',
'group-function', 'display-sort-function', and 'cycle-sort-function'.</code></pre>
<p class=\" text-justify\">See <a href=\"/article/understanding-minibuffer-completion\" class=\" article-link\">my article</a> for more information on customizing Emacs’s minibuffer.</p>
<H2 id=\"windows\">Windows</H2>
<pre><code>New command 'toggle-window-dedicated'.
This makes it easy to interactively mark a specific window as
dedicated, so it won't be reused by 'display-buffer'.  This can be
useful for complicated window setups.  It is bound to 'C-x w d'
globally.</code></pre>
<pre><code>\"d\" in the mode line now indicates that the window is dedicated.
Windows have always been able to be dedicated to a specific buffer;
see 'window-dedicated-p'.  Now the mode line indicates the dedicated
status of a window, with \"d\" appearing in the mode line if a window is
dedicated and \"D\" if the window is strongly dedicated.  This indicator
appears before the buffer name, and after the buffer modification and
remote buffer indicators (usually \"---\" together).</code></pre>
<p class=\" text-justify\">Coaxing Emacs into putting your windows where you want them to go is a common source of frustrating. I wrote <a href=\"/article/demystifying-emacs-window-manager\" class=\" article-link\">Demystifying Emacs’s Window Manager</a> in part to help people wrangle the windows into place. Dedicated windows are a blunt (though useful) tool that tells Emacs not to use a window for anything other than what is in it already. This feature mirrors what you find in a lot of other IDEs and editors where most windows have a singular purpose, unlike Emacs’.</p>
<pre><code>New action alist entry 'some-window' for 'display-buffer'.
It specifies which window 'display-buffer-use-some-window' should prefer.
For example, when 'display-buffer-base-action' is customized to
'(nil . ((some-window . mru)))', then a buffer will be displayed
in the same most recently used window from consecutive calls of
'display-buffer' (in a configuration with more than two windows).</code></pre>
<p class=\" text-justify\">This is pretty advanced stuff, but if you’re unhappy with the default methods employed by Emacs (see <code>display-buffer-fallback-action</code>) you can now tell it to more aggressively reuse windows using the “most recently used” order of windows.</p>
<pre><code>New action alist entry 'category' for 'display-buffer'.
If the caller of 'display-buffer' passes '(category . symbol)'
in its 'action' argument, you can match the displayed buffer
by adding '(category . symbol)' to the condition part of
'display-buffer-alist' entries.</code></pre>
<p class=\" text-justify\">I do not think you’re likely to encounter code that does this just yet, but I suppose this is one way of disambiguating windows that may share the same buffer name or major mode, but differ in some crucial way that only a custom cons cell <code>category</code> can sort out.</p>
<p class=\" text-justify\">Pretty niche. You’re probably not going to use this <em>really</em> into <code>display-buffer-alist</code>.</p>
<pre><code>New action alist entry 'post-command-select-window' for 'display-buffer'.
It specifies whether the window of the displayed buffer should be
selected or deselected at the end of executing the current command.</code></pre>
<pre><code>New variable 'window-restore-killed-buffer-windows'.
It specifies how 'set-window-configuration' and 'window-state-put'
should proceed with windows whose buffer was killed after the
corresponding configuration or state was recorded.</code></pre>
<p class=\" text-justify\">Window configurations are, well, configurations of windows. They are snapshots of window layouts: <code>C-x r w</code> puts your current window configuration into a register, and that is one such use; the other is tab bars in <code>tab-bar-mode</code>. Both set and restore window configurations when you change tabs or explicitly change them with a register. This variable’s really quite complex, so if you have strong opinions on this (you probably do not) then you really should read the lengthy docstring for this variable.</p>
<pre><code>New variable 'window-point-context-set-function'.
It can be used to set a context for window point in all windows by
'window-point-context-set' before calling 'current-window-configuration'
and 'window-state-get'.  Then later another new variable
'window-point-context-use-function' can be used by
'window-point-context-use' after 'set-window-configuration' and
'window-state-put' to restore positions of window points
according to the context stored in a window parameter.</code></pre>
<p class=\" text-justify\">Emacs tracks the position of point by <em>window</em> and not by buffer, as you may think. Split your current buffer and then move the point in one window and switch to the other: observe that your point is remembered between each window. Very handy, that, and this (alongside the window configuration stuff I mentioned before) is what this is about. You… probably don’t care.</p>
<pre><code>New functions 'set-window-cursor-type' and 'window-cursor-type'.
'set-window-cursor-type' sets a per-window cursor type, and
'window-cursor-type' queries this setting for a given window.  Windows
are always created with a 'window-cursor-type' of t, which means to
consult the variable 'cursor-type' as before.</code></pre>
<p class=\" text-justify\">You can now change the cursor type for each window. Neat. The variable <code>cursor-type</code> used to just override it for the whole Emacs session.</p>
<pre><code>The user option 'display-comint-buffer-action' is now obsolete.
You can use a '(category . comint)' condition in 'display-buffer-alist'
to match buffers displayed by comint-related commands.  Another
user option 'display-tex-shell-buffer-action' is obsolete too
for which you can use '(category . tex-shell)'.</code></pre>
<p class=\" text-justify\">I suppose this is what the change above is really about: to remove bespoke code and generalize it into the new category system.</p>
<H2 id=\"tool-bars\">Tool bars</H2>
<pre><code>Tool bars can now be placed on the bottom on more systems.
The 'tool-bar-position' frame parameter can be set to 'bottom' on all
window systems other than macOS and GNUstep (Nextstep).</code></pre>
<pre><code>New global minor mode 'modifier-bar-mode'.
When this minor mode is enabled, the tool bar displays buttons
representing modifier keys.  Clicking on these buttons applies the
corresponding modifiers to the next input event.</code></pre>
<p class=\" text-justify\">Useful on portable devices (like Android) that may not have certain modifier keys on its native keyboard.</p>
<pre><code>New user option 'tool-bar-always-show-default'.
When non-nil, the tool bar at the top of a frame does not show buffer
local customization of the tool bar.  The default value is nil.</code></pre>
<H2 id=\"tab-bars-and-tab-lines\">Tab Bars and Tab Lines</H2>
<p class=\" text-justify\">Tab bars are window configurations; tab lines are basically tabs like they appear in your browser.</p>
<pre><code>New user option 'tab-bar-select-restore-context'.
It uses 'window-point-context-set' to save contexts where
window points were located before switching away from the tab,
and 'window-point-context-use' to restore positions of window
points after switching back to that tab.</code></pre>
<p class=\" text-justify\">If you have multiple tabs featuring the same buffer, you can now preserve the point location between tabs.</p>
<pre><code>New user option 'tab-bar-select-restore-windows'.
It defines what to do with windows whose buffer was killed since the tab
was last selected.  By default it displays a placeholder buffer
with the name \" *Old buffer &lt;name&gt;*\" that provides information about
the name of the killed buffer that was displayed in that window.</code></pre>
<pre><code>New user option 'tab-bar-tab-name-format-functions'.
It can be used to add, remove and reorder functions that change the
appearance of every tab on the tab bar.</code></pre>
<pre><code>New hook 'tab-bar-tab-post-select-functions'.</code></pre>
<pre><code>New keymap 'tab-bar-mode-map'.
By default it contains a keybinding 'C-TAB' to switch tabs, but only
when 'C-TAB' is not bound globally.  You can unbind it if it conflicts
with 'C-TAB' in other modes.</code></pre>
<pre><code>New keymap 'tab-line-mode-map'.
By default it contains keybindings for switching tabs: 'C-x &lt;left&gt;',
'C-x &lt;right&gt;', 'C-x C-&lt;left&gt;', 'C-x C-&lt;right&gt;'.  You can unbind them if
you want to use these keys for the commands 'previous-buffer' and
'next-buffer'.</code></pre>
<p class=\" text-justify\">A better way of configuring tab bar/line modes’ keys. You can opt for more complex keys, and even use keyboard repeat maps if you use <code>C-&lt;TAB&gt;</code> for other things.</p>
<pre><code>Default list of tab-line tabs is changed to support a fixed order.
This means that 'tab-line-tabs-fixed-window-buffers', the new default
tabs function, is like the previous 'tab-line-tabs-window-buffers' where
both of them show only buffers that were previously displayed in the
window.  But the difference is that the new function always keeps the
original order of buffers on the tab line, even after switching between
these buffers.  You can drag the tabs and release at a new position
to manually reorder the buffers on the tab line.</code></pre>
<pre><code>New user option 'tab-line-tabs-buffer-group-function'.
It provides two choices to group tab buffers by major mode and by
project name.</code></pre>
<pre><code>Buffers on tab-line group tabs are now sorted alphabetically.
This will keep the fixed order of tabs, even after switching between
them.</code></pre>
<H2 id=\"help\">Help</H2>
<pre><code>New command 'help-find-source'.
Switch to a buffer visiting the source of what is being described in
\"*Help*\".  It is bound to 'C-h 4 s' globally.</code></pre>
<p class=\" text-justify\">Other notable commands include <code>M-x find-variable</code>, <code>M-x find-function</code> and <code>M-x find-function-on-key</code> to jump to their source definitions. I use ’em all the time.</p>
<pre><code>New user option 'describe-bindings-outline-rules'.
This user option controls outline visibility in the output buffer of
'describe-bindings' when 'describe-bindings-outline' is non-nil.</code></pre>
<p class=\" text-justify\">All this does is determine whether <code>outline-minor-mode</code> is enabled and configured to make headings collapsible.</p>
<pre><code>'describe-function' shows the function's inferred type when available.
For native compiled Lisp functions, 'describe-function' prints (after
the signature) the automatically inferred function type as well.  If the
function's type was explicitly declared (via the 'declare' form's
'ftype' property), 'describe-function' shows the declared type.  This is
controlled by the new user option 'help-display-function-type', which is
by default t; customize to nil to disable function type display.</code></pre>
<p class=\" text-justify\">This is really only likely to be of interest and use to elisp hackers who know their way around Emacs’s internals. The declared type for <code>+</code> is <code>Declared type: (function (&amp;rest (or number marker)) number)</code> for example.</p>
<pre><code>'describe-function' now shows the type of the function object.
The text used to say things like \"car is a built-in function\" whereas it
now says \"car is a primitive-function\" where \"primitive-function\" is the
name of the symbol returned by 'cl-type-of'.  You can click on those
words to get information about that type.</code></pre>
<p class=\" text-justify\">It’s been a long-running saga to get some sort of type taxonomy into Emacs, and it’s slowly happening now. I am unsure how useful this is to your average elisp hacker; this is more likely to be of use for byte and native compilation. See also the entry further down on declaratively specifying the arguments and return type of a function.</p>
<pre><code>'C-h m' ('describe-mode') uses outlining by default.
Set 'describe-mode-outline' to nil to get back the old behavior.</code></pre>
<p class=\" text-justify\">See above.</p>
<pre><code>'C-h k' ('describe-key') shows Unicode name.
For keybindings which produce single characters via translation or input
methods, 'C-h k' now shows the Unicode name of the produced character in
addition to the character itself, e.g.

'C-h k C-x 8 E' =&gt;

    € 'EURO SIGN' (translated from C-x 8 E)</code></pre>
<p class=\" text-justify\">A useful change, even though I doubt I’ll remember that I can do this. For inputtable characters I normally type them then use <code>C-u C-x =</code> to see its unicode name along with a host of other useful information.</p>
<pre><code>'C-h b' ('describe-bindings') shows Unicode names.
For keybindings which produce single characters via translation (such as
those using the 'C-x 8' or 'A-' prefix, or 'dead-acute', 'dead-grave',
etc), the Unicode names will now be shown in addition to the character
itself, i.e.

    A-!         ¡   INVERTED EXCLAMATION MARK
    A-$         ¤   CURRENCY SIGN

and so on.</code></pre>
<p class=\" text-justify\">This I am more likely to find a use for. <code>C-h b</code> is a must-know command, and now it shows the unicode name for self-inserted characters.</p>
<pre><code>Multi-character key echo now ends with a suggestion to use Help.
Customize 'echo-keystrokes-help' to nil to prevent that.</code></pre>
<H2 id=\"customize\">Customize</H2>
<pre><code>New command 'customize-dirlocals'.
This command pops up a buffer to edit the settings in \".dir-locals.el\".</code></pre>
<p class=\" text-justify\">Wow. This change is great. Directory-local variables are elisp variables declared in one of several files (such as <code>.dir-locals.el</code>) that you can use to effect directory-specific changes to Emacs buffers. I really love dirlocals; however, they’re a pain to add and edit. <code>M-x add-dir-local-variable</code> is a newbie trap, and it’s easy to type the wrong thing and cause all sorts of issues (or worse: that nothing at all happens.)</p>
<p class=\" text-justify\">A nice customize UI will go a long way towards encouraging more people to use it.</p>
<pre><code>New command 'customize-toggle-option'.
This command can toggle boolean options for the duration of a session.</code></pre>
<p class=\" text-justify\">One cool aspect of Customize is that you can set settings for the duration only, and then later on return to finalize them and save them to a file. All this does is add that functionality to booleans.</p>
<pre><code>New prefix argument for modifying directory-local variables.
The commands 'add-dir-local-variable', 'delete-dir-local-variable' and
'copy-file-locals-to-dir-locals' now take an optional prefix argument,
to enter the file name where you want to modify directory-local
variables.</code></pre>
<pre><code>New user option 'safe-local-variable-directories'.
This user option names directories in which Emacs will treat all
directory-local variables as safe.</code></pre>
<p class=\" text-justify\">Very useful. Emacs is squeamish about dirlocals as it maintains a list of safe variables and anything else is considered unsafe, and you’re asked to approve every setting. Whitelisting certain directories is a great compromise for people who are OK with the risks that follow from such a feature.</p>
<H2 id=\"cl-print\">CL Print</H2>
<p class=\" text-justify\">This is for elisp programmers only, and governs how Elisp forms are printed on the screen for human consumption.</p>
<pre><code>There is a new chapter in the CL manual documenting cl-print.el.
See the Info node \"(cl) Printing\".</code></pre>
<pre><code>You can expand the \"...\" truncation everywhere.
The code that allowed \"...\" to be expanded in the \"*Backtrace*\" buffer
should now work anywhere the data is generated by 'cl-print'.</code></pre>
<pre><code>The 'backtrace-ellipsis' button is replaced by 'cl-print-ellipsis'.</code></pre>
<pre><code>hash-tables' contents can be expanded via the ellipsis.</code></pre>
<pre><code>Modes can control the expansion via 'cl-print-expand-ellipsis-function'.</code></pre>
<pre><code>New setting 'raw' for 'cl-print-compiled'.
This setting causes byte-compiled functions to be printed in full by
'prin1'.  A button on this output can be activated to disassemble the
function.</code></pre>
<H2 id=\"miscellaneous\">Miscellaneous</H2>
<pre><code>New command 'kill-matching-buffers-no-ask'.
This works like 'kill-matching-buffers', but without asking for
confirmation.</code></pre>
<p class=\" text-justify\"><code>M-x kill-matching-buffers</code> kills buffers by regexp; and now you can have it do so without asking your permission.</p>
<pre><code>'recover-file' can show diffs between auto save file and current file.
When answering the prompt with \"diff\" or \"=\", it now shows the diffs
between the auto save file and the current file.</code></pre>
<p class=\" text-justify\">Ah, very handy. You can already diff files you want to save with <code>C-x s</code> and then <code>d</code>.</p>
<pre><code>'read-passwd' can toggle the visibility of passwords.
Use 'TAB' in the minibuffer to show or hide the password.
Alternatively, click the new show-password icon on the mode-line with
'mouse-1' to toggle the visibility of the password.</code></pre>
<p class=\" text-justify\">TAB, eh? I’m most assuredly going to accidentally reveal a password that way. You can edit <code>read-passwd-map</code> to remove the TAB if you want, though.</p>
<pre><code>'advice-remove' is now an interactive command.
When called interactively, 'advice-remove' now prompts for an advised
function to the advice to remove.</code></pre>
<p class=\" text-justify\">Good. You can do this with <code>M-x remove-hook</code> also. Useful if you foolishly cram lambdas into hooks or advice… and are now struggling to remove them. But you’d never make that mistake, right? :)</p>
<pre><code>New user option 'uniquify-dirname-transform'.
This can be used to customize how buffer names are uniquified, by
making arbitrary transforms on the buffer's directory name (whose
components are used to uniquify buffer names when they clash).  You
can use this to distinguish between buffers visiting files with the
same base name that belong to different projects by using the provided
transform function 'project-uniquify-dirname-transform'.</code></pre>
<p class=\" text-justify\">Uniquify renames buffers (but not the underlying files, if any) to sensible names instead of <code>foo&lt;1&gt;</code>, <code>foo&lt;2&gt;</code>, etc. It’s enabled by default, nowadays, but if you use the projects feature in Emacs, and if you frequently open the same file name in multiple projects, give this setting a try.</p>
<pre><code>New user option 'remote-file-name-inhibit-delete-by-moving-to-trash'.
When non-nil, this option suppresses moving remote files to the local
trash when deleting.  Default is nil.</code></pre>
<pre><code>New user option 'remote-file-name-inhibit-auto-save'.
If this user option is non-nil, 'auto-save-mode' will not auto-save
remote buffers.  The default is nil.</code></pre>
<pre><code>New user option 'remote-file-name-access-timeout'.
If a positive number, this option limits the call of 'access-file'
for remote files to that number of seconds.  Default is nil.</code></pre>
<p class=\" text-justify\">These are Tramp features, part of Emacs’s remote file editing system.</p>
<pre><code>New user option 'yes-or-no-prompt'.
This allows the user to customize the prompt that is appended by
'yes-or-no-p' when asking questions.  The default value is
\"(yes or no) \".</code></pre>
<pre><code>New user option 'menu-bar-close-window'.
When non-nil, selecting \"Close\" from the \"File\" menu or clicking
\"Close\" in the tool bar will result in the current window being
deleted, if possible.  The default is nil, and these gestures kill the
buffer shown in the current window, but don't delete the window.</code></pre>
<pre><code>New face 'display-time-date-and-time'.
This is used for displaying the time and date components of
'display-time-mode'.</code></pre>
<pre><code>New face 'appt-notification' for 'appt-display-mode-line'.
It can be used to customize the look of the appointment notification
displayed on the mode line when 'appt-display-mode-line' is non-nil.</code></pre>
<pre><code>New icon images for general use.
Several symbolic icons have been added to \"etc/images/symbols\",
including plus, minus, check-mark, star, etc.</code></pre>
<pre><code>Emacs now recognizes shebang lines that pass '-S'/'--split-string' to 'env'.
When visiting a script that invokes 'env -S INTERPRETER ARGS...' in
its shebang line, Emacs will now skip over 'env -S' and deduce the
major mode based on the interpreter after 'env -S'.</code></pre>
<p class=\" text-justify\">Emacs uses a wide range of tools to infer the major mode to use. Filename is not the only way: Emacs will scan the file to try and determine the major mode if there is no obvious choice that matches its filename. Looking at <code>/usr/bin/env</code> is one such method.</p>
<pre><code>'insert-directory-program' is now a user option.
On *BSD and macOS systems, this user option now defaults to the \"gls\"
executable, if it exists.  This should remove the need to change its
value when installing GNU coreutils using something like ports or
Homebrew.</code></pre>
<pre><code>'write-region-inhibit-fsync' now defaults to t in interactive mode.
This is the default in batch mode since Emacs 24.</code></pre>
<pre><code>The default value of 'read-process-output-max' was increased to 65536.</code></pre>
<p class=\" text-justify\">You can probably experiment with setting this even higher to batch up output from commands. Your mileage may vary, though. Mine is set to <code>1048576</code>.</p>
<pre><code>'url-gateway-broken-resolution' is now obsolete.
This option was intended for use on SunOS 4.x and Ultrix systems,
neither of which have been supported by Emacs since version 23.1.
The user option 'url-gateway-nslookup-program' and the command
'url-gateway-nslookup-host' are consequently also obsolete.

</code></pre>
<H2 id=\"editing-changes-in-emacs-30.1\">Editing Changes in Emacs 30.1</H2>
<pre><code>New minor mode 'visual-wrap-prefix-mode'.
When enabled, continuation lines displayed for a wrapped long line
will receive a 'wrap-prefix' automatically computed from the line's
surrounding context, such that continuation lines are indented on
display as if they were filled with 'M-q' or similar.  Unlike 'M-q',
the indentation only happens on display, and doesn't change the buffer
text in any way.  The global minor mode
'global-visual-wrap-prefix-mode' enables this minor mode in all
buffers.

(This minor mode is the 'adaptive-wrap' ELPA package renamed and
lightly edited for inclusion in Emacs.)</code></pre>
<pre><code>New global minor mode 'kill-ring-deindent-mode'.
When enabled, text being saved to the kill ring will be de-indented by
the column number at its start.  For example, saving the entire
function call within an indented block:

foo ()
{
  long_function_with_several_arguments (argument_1_compute (),
                                        argument_2_compute (),
                                        argument_3_compute ());
}

will save this to the kill ring:

long_function_with_several_arguments (argument_1_compute (),
                                      argument_2_compute (),
                                      argument_3_compute ())

This omits the two columns of extra indentation that would otherwise be
copied from the second and third lines and saved to the kill ring.</code></pre>
<p class=\" text-justify\">This is worth enabling if inconsistent kill-yank indentation annoys you. Doing this correctly, especially in whitespace sensitive languages, is really important in structured editing tools such as my package, <a href=\"/article/combobulate-structured-movement-editing-treesitter\" class=\" article-link\">Combobulate</a>.</p>
<pre><code>New command 'replace-regexp-as-diff'.
It reads a regexp to search for and a string to replace with, then
displays a buffer with replacements as diffs.  After reviewing the
changes in the output buffer you can apply the replacements as
a patch to the current file buffer.  There are also new commands
'multi-file-replace-regexp-as-diff' that shows as diffs replacements
in a list of specified files, and 'dired-do-replace-regexp-as-diff'
that shows as diffs replacements in the marked files in Dired.</code></pre>
<p class=\" text-justify\">This is a very welcome addition for bulk text replacing. It’s a nervewracking thing to accept/reject changes and hope you didn’t screw it up. Having a dedicated diff window that works across multiple files is a superb addition to Emacs.</p>
<pre><code>New mode of prompting for register names and showing preview.
The new user option 'register-use-preview' can be customized to the
value t or 'insist' to request a different user interface of prompting for
register names and previewing the registers: Emacs will require
confirmation for overwriting the value of a register, and will show
the preview of registers without delay.  You can also customize this
new option to disable the preview completely.

The default value of 'register-use-preview' ('traditional') preserves the
behavior of Emacs 29 and before.  See the Info node \"(emacs) Registers\"
for more details about the new UI and its variants.</code></pre>
<p class=\" text-justify\">I love registers, and I use them a lot. I use them because they require no forethought on my part to use: set and recall; it’s that simple. No fuss. If you want added distractions like confirmation prompts if you override a register? Go ahead and change the new option. If you like registers the way they are, then you don’t have to do anything.</p>
<pre><code>New advanced macro counter commands.
New commands have been added to implement advanced macro counter
functions.

The commands 'C-x C-k C-r l' and 'C-x C-k C-r s' load and save the
macro counter from and to a number register, respectively.

The commands 'C-x C-k C-r a =', 'C-x C-k C-r a &lt;', and 'C-x C-k C-r a &gt;'
compare the macro counter with the contents of a number register and
increment the counter by an optional prefix if the comparison succeeds.

The commands 'C-x C-k C-q =', 'C-x C-k C-q &lt;', and 'C-x C-k C-q &gt;'
compare the macro counter with an optional prefix and terminate the
macro if the comparison succeeds.</code></pre>
<p class=\" text-justify\">Advanced indeed. Registers are capable of incrementing and decrementing a number already, and kmacro (Emacs’s keyboard macro facility) has its own internal counter (see <a href=\"/article/keyboard-macros-are-misunderstood\" class=\" article-link\">Keyboard Macros are Misunderstood</a>) also. Now you can switch values between them and also do simple comparisons. Combine it with the ability to physically move up or down a line; increment and decrement; and conditional termination, and I’m pretty sure kmacro close to Turing-complete.</p>
<pre><code>New mode 'kmacro-menu-mode' and new command 'list-keyboard-macros'.
The new command 'list-keyboard-macros' is the keyboard-macro version
of commands like 'list-buffers' and 'list-processes', creating a listing
of the currently existing keyboards macros using the new mode
'kmacro-menu-mode'.  It allows rearranging the macros in the ring,
duplicating them, deleting them, and editing their counters, formats,
and keys.</code></pre>
<p class=\" text-justify\">Excellent. There’s already a kmacro ring for macros known to Emacs, but it’s a bit awkward. Now you can list the macros.</p>
<pre><code>On X, Emacs now supports input methods which perform \"string conversion\".
This means an input method can now ask Emacs to delete text
surrounding point and replace it with something else, as well as query
Emacs for surrounding text.  If your input method allows you to \"undo\"
mistaken compositions, this will now work as well.</code></pre>
<pre><code>New user option 'duplicate-region-final-position'.
It controls the placement of point and the region after duplicating a
region with 'duplicate-dwim'.</code></pre>
<pre><code>New user option 'mouse-prefer-closest-glyph'.
When enabled, clicking or dragging with the mouse will put the point
or start the drag in front of the buffer position corresponding to the
glyph with the closest X coordinate to the click or start of the drag.
In other words, if the mouse pointer is in the right half of a glyph,
point will be put after the buffer position corresponding to that glyph,
whereas if the mouse pointer is in the left half of a glyph, point
will be put in front the buffer position corresponding to that glyph.
By default this is disabled.</code></pre>
<pre><code>New pre-defined values for 'electric-quote-chars'.
The available customization options for 'electric-quote-chars' have been
updated with common pairs of quotation characters, including \"‘\", \"’\",
\"“\", \"”\", \"«\", \"»\", \"‹\", \"›\", \"‚\", \"„\", \"「\", \"」\", \"『\", and \"』\".
The default is unchanged.</code></pre>
<p class=\" text-justify\">This is for <code>M-x electric-pair-mode</code>, which automatically pairs an opening character with its constituent closing character.</p>
<pre><code>'M-TAB' now invokes 'completion-at-point' in Text mode.
By default, Text mode no longer binds 'M-TAB' to 'ispell-complete-word'.
Instead, this mode arranges for 'completion-at-point', globally bound to
'M-TAB', to perform word completion as well.  You can have Text mode
binding 'M-TAB' to 'ispell-complete-word' as it did in previous Emacs
versions, or disable Ispell word completion in Text mode altogether, by
customizing the new user option 'text-mode-ispell-word-completion'.</code></pre>
<p class=\" text-justify\"><code>M-&lt;TAB&gt;</code> is also Alt+Tab. The key binding <code>C-M-i</code> is functionally equivalent.</p>
<H2 id=\"internationalization\">Internationalization</H2>
<pre><code>Mode-line mnemonics for some coding-systems have changed.
The mode-line mnemonic for 'utf-7' is now the lowercase 'u', to be
consistent with the other encodings of this family.

The mode-line mnemonic for 'koi8-u' is now 'У', U+0423 CYRILLIC
CAPITAL LETTER U, to distinguish between this encoding and the
UTF-8/UTF-16 family.

If your terminal cannot display 'У', or if you want to get the old
behavior back for any other reason, you can do that using the
'coding-system-put' function.  For example, the following restores the
previous behavior of showing 'U' in the mode line for 'koi8-u':

    (coding-system-put 'koi8-u :mnemonic ?U)</code></pre>
<p class=\" text-justify\">The mode line adopts a different character for the coding system in the active buffer. You can find it in the bottom left.</p>
<pre><code>'vietnamese-tcvn' is now a coding system alias for 'vietnamese-vscii'.
VSCII-1 and TCVN-5712 are different names for the same character
encoding.  Therefore, the duplicate coding system definition has been
dropped in favor of an alias.

The mode-line mnemonic for 'vietnamese-vscii' and its aliases is the
lowercase letter \"v\".</code></pre>
<pre><code>Users in CJK locales can control width of some non-CJK characters.
Some characters are considered by Unicode as \"ambiguous\" with respect
to their display width: either \"full-width\" (i.e., taking 2 columns on
display) or \"narrow\" (taking 1 column).  The actual width depends on
the fonts used for these characters by Emacs or (for text-mode frames)
by the terminal emulator.  Traditionally, font sets in CJK locales
were set up so as to display these characters as full-width, and thus
Emacs modified the char-width table in those locales to follow suit.
Lately, the tendency is to display these characters as narrow.  The
new user option 'cjk-ambiguous-chars-are-wide' allows users to control
whether Emacs considers these characters as full-width (the default)
or narrow (if the variable is customized to the nil value).

This setting affects the results of 'string-width' and similar
functions in CJK locales.</code></pre>
<pre><code>New input methods for the Urdu, Pashto, and Sindhi languages.
These languages are spoken in Pakistan and Afghanistan.</code></pre>
<pre><code>New input method \"english-colemak\".
This input method supports the Colemak keyboard layout.</code></pre>
<p class=\" text-justify\">Input methods are really neat. You can switch to a ‘virtual keyboard’ that behaves like another language, letting you enter diacritics and complex unicode characters using your current keyboard’s layout. You are not limited to actual languages, either: there are input methods to help you enter LaTeX for example.</p>
<p class=\" text-justify\">You can toggle the input method with <code>C-\\</code> and with a prefix argument to set the input method type. I wrote about them in <a href=\"/article/diacritics-in-emacs\" class=\" article-link\">Olé! Diacritics in Emacs</a>. I even wrote my own input method for <a href=\"/article/inserting-emoji-input-methods\" class=\" article-link\">Inserting Emoji</a> just to highlight how powerful and simple the system is.</p>
<pre><code>Additional 'C-x 8' key translations for \"æ\" and \"Æ\".
These characters can now be input with 'C-x 8 a e' and 'C-x 8 A E',
respectively, in addition to the existing translations 'C-x 8 / e' and
'C-x 8 / E'.</code></pre>
<p class=\" text-justify\">Wonderful news for people who prefer the original spelling of encyclopedia, and Danes, I suppose.</p>
<pre><code>New 'C-x 8' key translations for \"low\" quotes \"„\", and \"‚\".
These can now be entered with 'C-x , \"' and 'C-x , ''.</code></pre>
<pre><code>New German language 'C-x 8' key translations for quotation marks.
The characters \"„\", \"“\", and \"”\" can now be entered with 'C-x 8 v',
'C-x 8 b' and 'C-x 8 n'.  The single versions \"‚\", \"‘\", and \"’\" can now
be entered with 'C-x 8 V', 'C-x 8 B' and 'C-x 8 N'.  These characters
are used for the official German quoting style.  Using them requires
activating German language support via 'iso-transl-set-language'.</code></pre>
<pre><code>\"latin-prefix\" and \"latin-postfix\" quotation marks additions.
These input methods can now produce single, double and \"low\" left and
right quotation marks:

    \"‘\", \"’\", \"“\", \"”\", \"„\", and \"‚\"

by using \"[\", \"]\", and \",\" for \"left\", \"right\", and \"low\" respectively
to modify \"'\" and \"\"\".</code></pre>
<pre><code>\"latin-prefix\" and \"latin-postfix\" guillemets support.
These input methods can now produce single guillemets \"‹\" and \"›\".  For
\"latin-prefix\" use \"~~&lt;\" and \"~~&gt;\", for \"latin-postfix\" use \"&lt;~\" and
\"&gt;~\".  Double guillemets (\"«\" and \"»\") were already supported.</code></pre>
<pre><code>New French language 'C-x 8' key translations for \"‹\" and \"›\".
These characters can now be entered using 'C-x 8 ~ &lt;' and 'C-x 8 ~ &gt;',
respectively, after activating French language support via
'iso-transl-set-language'.  Double guillemets were already supported via
'C-x 8 &lt;' and 'C-x 8 &gt;'</code></pre>
<pre><code>Additional 'C-x 8' key translation for Euro \"€\" currency symbol.
This can now be entered using 'C-x 8 E' in addition to the existing
'C-x 8 * E' translation.</code></pre>
<H2 id=\"changes-in-specialized-modes-and-packages-in-emacs-30.1\">Changes in Specialized Modes and Packages in Emacs 30.1</H2>
<H3 id=\"outline-mode\">Outline mode</H3>
<p class=\" text-justify\">Outline mode is a cut-down outliner for collapsing and expanding headings.</p>
<pre><code>New commands to show/hide outlines by regexp.
'C-c / h' ('outline-hide-by-heading-regexp') asks for a regexp and then
hides the body lines of all outlines whose heading lines match the
regexp.  'C-c / s' ('outline-show-by-heading-regexp') does the inverse:
it shows the bodies of outlines that matched a regexp.</code></pre>
<pre><code>'outline-minor-mode' is supported in tree-sitter major modes.
It can be used in all tree-sitter major modes that set either the
variable 'treesit-simple-imenu-settings' or 'treesit-outline-predicate'.</code></pre>
<p class=\" text-justify\">Excellent news, and likely to be far more robust as it uses tree-sitter’s nodes to determine what to hide and show.</p>
<H3 id=\"info\">Info</H3>
<p class=\" text-justify\">Info mode is Emacs’s implementation of the TexInfo hypertext viewer.</p>
<pre><code>New user option 'Info-url-alist'.
This user option associates manual names with URLs.  It affects the
'Info-goto-node-web' command.  By default, associations for all
Emacs-included manuals are set.  Further associations can be added for
arbitrary Info manuals.</code></pre>
<pre><code>Emacs can now display Info manuals compressed with 'lzip'.
This requires the 'lzip' program to be installed on your system.</code></pre>
<H3 id=\"gud-grand-unified-debugger\">GUD (Grand Unified Debugger)</H3>
<p class=\" text-justify\">GUD is a user interface for debuggers such as GDB.</p>
<pre><code>New user option 'gud-highlight-current-line'.
When enabled, GUD will visually emphasize the line being executed upon
pauses in the debuggee's execution, such as those occasioned by
breakpoints being hit.</code></pre>
<pre><code>New command 'lldb'.
Run the LLDB debugger, analogous to the 'gud-gdb' command.</code></pre>
<pre><code>Variable order and truncation can now be configured in 'gdb-many-windows'.
The new user option 'gdb-locals-table-row-config' allows users to
configure the order and max length of various properties in the local
variables buffer when using 'gdb-many-windows'.

By default, this user option is set to write the properties in the order:
'name', 'type' and 'value', where the 'name' and 'type' are truncated to 20
characters, and the 'value' is truncated according to the value of
'gdb-locals-value-limit'.

If you want to get back the old behavior, set the user option to the value

    (setopt gdb-locals-table-row-config
            `((type . 0) (name . 0) (value . ,gdb-locals-value-limit)))</code></pre>
<pre><code>New user option 'gdb-display-io-buffer'.
If this is nil, command 'gdb' will neither create nor display a separate
buffer for the I/O of the program being debugged, but will instead
redirect the program's interaction to the GDB execution buffer.  The
default is t, to preserve previous behavior.</code></pre>
<H3 id=\"grep\">Grep</H3>
<p class=\" text-justify\">Grep (or rather the interface for talking to and displaying the results from <code>grep</code>) is a powerful feature in Emacs with a wide range of commands.</p>
<pre><code>New user option 'grep-use-headings'.
When non-nil, the output of Grep is split into sections, one for each
file, instead of having file names prefixed to each line.  It is
equivalent to the '--heading' option of some tools such as 'git grep'
and 'rg'.  The headings are displayed using the new 'grep-heading' face.
The default is nil.</code></pre>
<p class=\" text-justify\">Good news if you prefer the heading system used by tools such as <code>rg</code>. I have not tried it yet, but I wonder how easy it is to bulk edit the output of a grep command when it is in header mode.</p>
<H3 id=\"compilation-mode\">Compilation mode</H3>
<p class=\" text-justify\">Compilation mode (via <code>M-x compile</code> usually) is Emacs’s interface for talking to not just compilers but any tool that emits structured output.</p>
<pre><code>The 'omake' matching rule is now disabled by default.
This is because it partly acts by modifying other rules which may
occasionally be surprising.  It can be re-enabled by adding 'omake' to
'compilation-error-regexp-alist'.</code></pre>
<pre><code>Lua errors and stack traces are now recognized.
Compilation mode now recognizes Lua language errors and stack traces.
Every Lua error is recognized as a compilation error, and every Lua
stack frame is recognized as a compilation info.</code></pre>
<p class=\" text-justify\">Emacs already has a huge range of compilation rules, so I’m surprised it didn’t have it for Lua, given how popular it is.</p>
<H3 id=\"project\">Project</H3>
<p class=\" text-justify\">Project is one of many, many file project solutions built into Emacs, and arguably the best one to use. See <code>C-x p C-h</code>.</p>
<pre><code>New user option 'project-mode-line'.
When non-nil, display the name of the current project on the mode
line.  Clicking 'mouse-1' on the project name pops up the project
menu.  The default value is nil.</code></pre>
<p class=\" text-justify\">If you’re not strapped for space, why not enable this?</p>
<pre><code>New user option 'project-file-history-behavior'.
Customizing it to 'relativize' makes commands like 'project-find-file'
and 'project-find-dir' display previous history entries relative to
the current project.</code></pre>
<pre><code>New user option 'project-key-prompt-style'.
The look of the key prompt in the project switcher has been changed
slightly.  To get the previous one, set this option to 'brackets'.</code></pre>
<pre><code>Function 'project-try-vc' tries harder to find the responsible VCS.
When 'project-vc-extra-root-markers' is non-nil, and causes a
subdirectory project to be detected which is not a VCS root, Project now
additionally traverses the parent directories until a VCS root is found
(if any), so that the ignore rules for that repository are used, and
the file listing's performance is still optimized.</code></pre>
<p class=\" text-justify\">Root markers are used to find the boundaries of a project (for example the <code>.git</code> directory, or maybe a file such as a Makefile), and that works well enough for simple use cases. You can tell Emacs to look for other things in addition to its builtin rules, and this is where the contract of a root marker breaks down a little, particularly if you have a repo and another non-repo marker inside of that.</p>
<pre><code>New commands 'project-any-command' and 'project-prefix-or-any-command'.
The former is now bound to 'C-x p o' by default.
The latter is designed primarily for use as a value of
'project-switch-commands'.  If instead of a short menu you prefer to
have access to all keys defined inside 'project-prefix-map', as well
as global bindings (to run other commands inside the project root),
you can add this to your init script:

    (setopt project-switch-commands #'project-prefix-or-any-command)</code></pre>
<p class=\" text-justify\">This is effectively a way of executing a key bindings from the root directory of the current buffer’s root project.</p>
<pre><code>New variable 'project-files-relative-names'.
If it is non-nil, 'project-files' can return file names relative to the
project root.  Project backends can use this to improve the performance
of their 'project-files' implementation.</code></pre>
<H3 id=\"vc\">VC</H3>
<p class=\" text-justify\">VC is Emacs’s excellent generic version control interface. If you do not use <a href=\"/article/introduction-magit-emacs-mode-git\" class=\" article-link\">Magit, an Emacs mode for Git</a>, or if you use a source control that is not git, then I highly recommend you sit down and learn how to use VC. It’s really excellent.</p>
<pre><code>Log-Edit buffers now display a tool bar.
This tool bar contains items for committing log entries and editing or
generating log entries, among other editing operations.</code></pre>
<p class=\" text-justify\">I’ve long advocated using the menu bar because telling beginners to turn it off is <a href=\"/article/bad-emacs-advice\" class=\" article-link\">Bad Emacs Advice</a>. The toolbar is harder to justify turning on as it is a little bit threadbare. Having said that, making it even more contextual is still a very positive thing indeed.</p>
<pre><code>New user option 'vc-git-shortlog-switches'.
This is a string or a list of strings that specifies the Git log
switches for shortlogs, such as the one produced by 'C-x v L'.
'vc-git-log-switches' is no longer used for shortlogs.</code></pre>
<pre><code>New value 'no-backend' for user option 'vc-display-status'.
With this value only the revision number is displayed on the mode-line.</code></pre>
<pre><code>Obsolete command 'vc-switch-backend' re-added as 'vc-change-backend'.
The command was previously obsoleted and unbound in Emacs 28.</code></pre>
<p class=\" text-justify\">It is rare indeed for a command to get obsoleted and the unobsoleted.</p>
<pre><code>Support for viewing VC change history across renames.
When a fileset's VC change history ends at a rename, 'C-x v l' now
prints the old name(s) and shows a button which jumps to the history of
the files under the old names.  This feature is supported for Git and
Hg.  Naturally, 'vc-git-print-log-follow' should be nil for this to work
(or '--follow' should not be in 'vc-hg-log-switches', in Hg's case).
Unlike when the '--follow' switch is used, commands to see the diff of
the old revision ('d'), to check out an old file version ('f') or to
annotate it ('a'), also work on revisions which precede renames.</code></pre>
<pre><code>'vc-annotate' now abbreviates the Git revision in the buffer name.
When using the Git backend, 'vc-annotate' will use an abbreviated
revision identifier in its buffer name.  To restore the previous
behavior, set user option 'vc-annotate-use-short-revision' to nil.</code></pre>
<pre><code>New user option 'vc-git-file-name-changes-switches'.
It allows tweaking the thresholds for rename and copy detection.</code></pre>
<pre><code>VC Directory buffers now display the upstream branch in Git repositories.
The \"upstream branch\" is the branch from which 'vc-pull' fetches changes
by default.  In Git terms, the upstream branch of branch B is determined
by configuration variables 'branch.B.remote' and 'branch.B.merge'.

When these configuration variables are set for the current branch, the
VC Directory buffer will show the corresponding upstream branch under
the \"Tracking\" header.</code></pre>
<H3 id=\"diff-mode\">Diff mode</H3>
<p class=\" text-justify\">Diff mode is one of several modes for interacting with and browsing <code>.diff</code> files.</p>
<pre><code>New user option 'diff-refine-nonmodified'.
When this is non-nil, 'diff-refine-hunk' will highlight lines that were
added or removed in their entirety (as opposed to modified lines, where
some parts of the line were modified), using the same faces as for
highlighting the words added and removed within modified lines.  The
default value is nil.</code></pre>
<pre><code>'diff-ignore-whitespace-hunk' can now be applied to all hunks.
When called with a non-nil prefix argument,
'diff-ignore-whitespace-hunk' now iterates over all the hunks in the
current diff, regenerating them without whitespace changes.</code></pre>
<p class=\" text-justify\">Very useful in Lisp, in my opinion, where a change of indentation can easily happen when you change something else. I have git set to ignore whitespace by default to avoid indentation changes gumming up the staging area.</p>
<pre><code>New user option 'diff-ignore-whitespace-switches'.
This allows changing which type of whitespace changes are ignored when
regenerating hunks with 'diff-ignore-whitespace-hunk'.  Defaults to
the previously hard-coded \"-b\".</code></pre>
<pre><code>New command 'diff-apply-buffer' bound to 'C-c RET a'.
It applies the diff in the entire diff buffer and
saves all modified file buffers.</code></pre>
<p class=\" text-justify\">Good all-round command and saves having to do multiple keystrokes to achieve the same effect.</p>
<H3 id=\"dired\">Dired</H3>
<p class=\" text-justify\">Dired is Emacs’s all-singing, all-dancing directory and file editor, bound to <code>C-x d</code> and <code>M-x dired</code>.</p>
<pre><code>New user option 'dired-movement-style'.
When non-nil, make 'dired-next-line', 'dired-previous-line',
'dired-next-dirline', 'dired-prev-dirline' skip empty lines.
It also controls how to move point when encountering a boundary
(e.g., if every line is visible, invoking 'dired-next-line' at
the last line will move to the first line).  The default is nil.</code></pre>
<p class=\" text-justify\">Oh, this is much-needed. Here’s how it works: you can insert the contents of a directory into an existing dired buffer (find a directory and tap <code>i</code>) and act on the files across the directory boundaries as though they were one directory – very powerful, and it means you can use <a href=\"/article/dired-shell-commands-find-xargs-replacement\" class=\" article-link\">dired to replace find &amp; xargs</a> – but the <code>p</code> and <code>n</code> commands to move between files does not jump between these virtual directories, and so you’re stuck having to move point between a bunch of dead space. Until now, that is. I recommend you set it to <code>bounded</code> or <code>cycle</code>.</p>
<pre><code>New user option 'dired-filename-display-length'.
It is an integer representing the maximum display length of file names.
The middle part of a file name whose length exceeds the restriction is
hidden and an ellipsis is displayed instead.  A value of 'window'
means using the right edge of window as the display restriction.  The
default is nil.</code></pre>
<p class=\" text-justify\">If you squeeze dired into a side bar window, you can now truncate filenames to make them fit to the size of the window, which is a good quality of life improvement.</p>
<pre><code>New user option 'shell-command-guess-functions'.
It defines how to populate a list of commands available
for 'M-!', 'M-&amp;', '!', '&amp;' and the context menu \"Open With\"
based on marked files in Dired.  Possible backends are
'dired-guess-default', MIME types, XDG configuration
and a universal command such as \"open\" or \"start\"
that delegates to the OS.</code></pre>
<p class=\" text-justify\">Emacs has several ways of guessing the right command to run on a filename, and they are annoyingly different and only available in some parts of Emacs and not others. This is a clear attempt to clean up this mess and offer a unified way of picking the right command to run.</p>
<pre><code>New command 'dired-do-open'.
This command is bound to 'E' (mnemonics \"External\").  Also it can be
used by clicking \"Open\" in the context menu; it \"opens\" the marked or
clicked on files according to the OS conventions.  For example, on
systems supporting XDG, this runs 'xdg-open' on the files.</code></pre>
<p class=\" text-justify\">Excellent addition. I used to do <code>!</code> to do this, but now it has its own key.</p>
<pre><code>New variable 'dired-guess-shell-alist-optional'.
It contains commands for external viewers and players for various media
formats, moved to this list from 'dired-guess-shell-alist-default'.</code></pre>
<p class=\" text-justify\">Worth a look if you want Emacs to open your media files in other tools than its defaults.</p>
<pre><code>The default value of 'dired-omit-size-limit' was increased.
After performance improvements to omitting in large directories, the new
default value is 300k, up from 100k.  This means 'dired-omit-mode' will
omit files in directories whose directory listing is up to 300 kilobytes
in size.</code></pre>
<p class=\" text-justify\">Omit mode hides useless files based on regexp filters. Great way to hide backup files, compiler detritus and more. You may have to <code>(require 'dired-x)</code> first.</p>
<pre><code>'dired-listing-switches' handles connection-local values if exist.
This allows you to customize different switches for different remote machines.</code></pre>
<p class=\" text-justify\">This relates to Tramp, Emacs’s remote file editing protocol. Because Tramp sends commands to the remote host, you can now customize how dired should query for files on the remote file system.</p>
<H3 id=\"ediff\">Ediff</H3>
<p class=\" text-justify\">Ediff is another diff tool in Emacs, albeit a far more advanced one. It has a wide range of entrypoints: <code>C-h a ediff</code>.</p>
<pre><code>New user option 'ediff-floating-control-frame'.
If non-nil, try making the control frame be floating rather than tiled.

Many X tiling window managers make the Ediff control frame a tiled
window equal in size to the main Emacs frame, which works poorly.
This option is useful to set if you use such a window manager.</code></pre>
<p class=\" text-justify\">Ediff’s achilles’ heel is its awkward frame that it uses as a control interface; but now it at least grants succor to people who use tiling window managers.</p>
<H3 id=\"buffer-selection\">Buffer Selection</H3>
<p class=\" text-justify\">Buffer selection, not to be confused with <code>C-x b</code>, is one of, ah, several buffer switching tools in Emacs. Try it with <code>M-x bs-show</code>.</p>
<pre><code>New user option 'bs-default-action-list'.
You can now configure how to display the \"*buffer-selection*\" buffer
using this new option.  (Or set 'display-buffer-alist' directly.)</code></pre>
<H3 id=\"eshell\">Eshell</H3>
<p class=\" text-justify\">Eshell is an Emacs shell written entirely in Emacs. It’s worth <a href=\"/article/complete-guide-mastering-eshell\" class=\" article-link\">Mastering Eshell</a> if you want an all-Emacs command line experience.</p>
<pre><code>You can now run Eshell scripts in batch mode.
By adding the following interpreter directive to an Eshell script, you
can make it executable like other shell scripts:

    #!/usr/bin/env -S emacs --batch -f eshell-batch-file</code></pre>
<p class=\" text-justify\">If you thought someone using korn or c shell wasn’t bad enough, now you can frustrate your coworkers by writing your shell scripts in Eshells’ own zsh-like language.</p>
<pre><code>New builtin Eshell command 'compile'.
This command runs another command, sending its output to a compilation
buffer when the command would output interactively.  This can be useful
when defining aliases so that they produce a compilation buffer when
appropriate, but still allow piping the output elsewhere if desired.
For more information, see the \"(eshell) Built-ins\" node in the Eshell
manual.</code></pre>
<p class=\" text-justify\">Eshell has a huge range of commands that it exposes to its shell, only to intercept them and pass the input and output to a dedicated Emacs function. See <code>C-u C-h a eshell/</code>.</p>
<pre><code>Eshell's 'env' command now supports running commands.
Like in many other shells, Eshell's 'env' command now lets you run a
command passed as arguments to 'env'.  If you pass any initial
arguments of the form 'VAR=VALUE', 'env' will first set 'VAR' to
'VALUE' before running the command.</code></pre>
<pre><code>Eshell's 'umask' command now supports setting the mask symbolically.
Now, you can pass an argument like \"u+w,o-r\" to Eshell's 'umask'
command, which will give write permission for owners of newly-created
files and deny read permission for users who are not members of the
file's group.  See the Info node \"(coreutils) File permissions\" for
more information on this notation.</code></pre>
<pre><code>Performance improvements for interactive output in Eshell.
Interactive output in Eshell should now be significantly faster,
especially for commands that can print large amounts of output
(e.g. \"cat\").  For external commands, Eshell saves time by only looking
for password prompts in the last 256 characters of each block of output.
To restore the previous behavior when checking for password prompts, set
'eshell-password-prompt-max-length' to 'most-positive-fixnum'.</code></pre>
<pre><code>Eshell built-in commands can now display progress.
Eshell built-in commands like \"cat\" and \"ls\" now update the display
periodically while running to show their progress.</code></pre>
<pre><code>New special reference type '#&lt;marker POSITION BUFFER&gt;'.
This special reference type returns a marker at 'POSITION' in
'BUFFER'.  You can insert it by typing or using the new interactive
command 'eshell-insert-marker'.  You can also insert special
references of any type using the new interactive command
'eshell-insert-special-reference'.  See the \"(eshell) Arguments\" node
in the Eshell manual for more details.</code></pre>
<pre><code>New splice operator for Eshell dollar expansions.
Dollar expansions in Eshell now let you splice the elements of the
expansion in-place using '$@expr'.  This makes it easier to fill lists
of arguments into a command, such as when defining aliases.  For more
information, see the \"(eshell) Dollars Expansion\" node in the Eshell
manual.</code></pre>
<p class=\" text-justify\">Eshell’s expansion system is inspired by zsh’s, though they’re not at all interchangeable, as Eshell effectively passes things to elisp functions internally, arguments and all, so being able to split, splice and otherwise manipulate how entries are fed to the underlying commands is very important.</p>
<pre><code>You can now splice Eshell globs in-place into argument lists.
By setting 'eshell-glob-splice-results' to a non-nil value, Eshell
will expand glob results in-place as if you had typed each matching
file name individually.  For more information, see the \"(eshell)
Globbing\" node in the Eshell manual.</code></pre>
<pre><code>Eshell now supports negative numbers and ranges for indices.
Now, you can retrieve the last element of a list with '$my-list[-1]'
or get a sublist of elements 2 through 4 with '$my-list[2..5]'.  For
more information, see the \"(eshell) Dollars Expansion\" node in the
Eshell manual.</code></pre>
<pre><code>Eshell commands can now be explicitly-remote (or local).
By prefixing a command name in Eshell with a remote identifier, like
\"/ssh:user@remote:whoami\", you can now run commands on a particular
host no matter your current directory.  Likewise, you can run a
command on your local system no matter your current directory via
\"/local:whoami\".  For more information, see the \"(eshell) Remote Access\"
node in the Eshell manual.</code></pre>
<pre><code>Eshell's '$UID' and '$GID' variables are now connection-aware.
Now, when expanding '$UID' or '$GID' in a remote directory, the value
is the user or group ID associated with the remote connection.</code></pre>
<p class=\" text-justify\">One cool feature of Eshell is that you can <code>cd</code> into a remote system using Tramp – for example <code>cd /ssh:homer@powerplant:/etc/</code> – and then operate on the remote machine through Eshell and Tramp as though it were ‘local’. Really powerful, but sometimes there are cracks in the machinery, such as the case of the user and group id environment variables not being correct.</p>
<pre><code>Eshell now uses 'field' properties in its output.
In particular, this means that pressing the '&lt;home&gt;' key moves the
point to the beginning of your input, not the beginning of the whole
line.  If you want to go back to the old behavior, add something like
this to your configuration:

    (keymap-set eshell-mode-map \"&lt;home&gt;\" #'eshell-bol-ignoring-prompt)

This also means you no longer need to adjust 'eshell-prompt-regexp'
when customizing your Eshell prompt.</code></pre>
<p class=\" text-justify\">I long ago abandoned using <code>C-a</code> and friends to move the beginning of line, preferring <code>M-m</code> instead (as it skips forward past whitespace after moving to the beginning of the line) but this command obviously does not respect the prompt. So if you use <code>M-m</code>, just rebind it to the same key as <code>C-a</code>.</p>
<pre><code>You can now properly unload Eshell.
Calling '(unload-feature 'eshell)' no longer signals an error, and now
correctly unloads Eshell and all of its modules.</code></pre>
<pre><code>'eshell-read-aliases-list' is now an interactive command.
After manually editing 'eshell-aliases-file', you can use this command
to load the edited aliases.</code></pre>
<p class=\" text-justify\">Aliases here referring to the same aliasing you can do in other shells.</p>
<pre><code>'rgrep' is now a builtin Eshell command.
Running 'rgrep' in Eshell now uses the Emacs grep facility instead of
calling external rgrep.</code></pre>
<p class=\" text-justify\"><code>M-x rgrep</code> is a command I use all the time when I want more specificity around searching than what a tool like <code>rg</code> gives me. <code>grep</code> already works great in Eshell, so it’s nice to see that <code>rgrep</code> does so too.</p>
<pre><code>If a command exits abnormally, the Eshell prompt now shows its exit code.</code></pre>
<p class=\" text-justify\">I added this to my bash prompt decades ago, as I find it invaluable when I want to compare exit codes in scripts.</p>
<pre><code>New user option 'eshell-history-append'.
If non-nil, each Eshell session will save history by appending new
entries of that session to the history file rather than overwriting
the file with the whole history of the session.  The default is nil.</code></pre>
<H3 id=\"pcomplete\">Pcomplete</H3>
<p class=\" text-justify\">Pcomplete is the completer tool originally built for Eshell, but now has uses elsewhere. It’s a pretty nifty little completion engine, as I demonstrate in <a href=\"/article/pcomplete-context-sensitive-completion-emacs\" class=\" article-link\">PComplete: Context-Sensitive Completion in Emacs</a></p>
<pre><code>New user option 'pcomplete-remote-file-ignore'.
When this option is non-nil, remote file names are not completed by
Pcomplete.  Packages, like 'shell-mode', could set this in order to
suppress remote file name completion at all.</code></pre>
<pre><code>Completion for the 'doas' command has been added.
Command completion for 'doas' in Eshell and Shell mode will now work.</code></pre>
<p class=\" text-justify\">The mooted successor to <code>sudo</code>.</p>
<H3 id=\"shell-mode\">Shell mode</H3>
<p class=\" text-justify\">This is the shell I actually use the most day to day. Delightfully dumb and it behaves exactly like a souped-up Emacs buffer. See <a href=\"/article/running-shells-in-emacs-overview\" class=\" article-link\">Running Shells and Terminal Emulators in Emacs</a> if you want to know what all the differences are.</p>
<pre><code>New user option 'shell-get-old-input-include-continuation-lines'.
When this user option is non-nil, 'shell-get-old-input' ('C-RET')
includes multiple shell \"\\\" continuation lines from command output.
Default is nil.</code></pre>
<pre><code>New user option 'shell-history-file-name'.
When this user option is set to t, 'shell-mode' does not read the shell
history file.  Setting this user option to a string specifies the name
of the shell history file to be read.  A nil value triggers reading the
environment variable 'HISTFILE'.

In a 'shell' buffer, this user option is connection-local.</code></pre>
<p class=\" text-justify\">This is a nice change as Emacs will of course keep its own history (see <a href=\"/article/shell-comint-secrets-history-commands\" class=\" article-link\">Shell &amp; Comint Secrets: History commands</a>) but that history does not persist under normal circumstances. If you’re using a non-default history file for your shell and you want Emacs to respect it, now you can.</p>
<pre><code>Performance improvements for interactive output.
Interactive output in Shell mode now scans more selectively for password
prompts by only examining the last 256 characters of each block of
output, reducing the time spent when printing large amounts of output.
To restore the old behavior, set 'comint-password-prompt-max-length' to
'most-positive-fixnum'.</code></pre>
<p class=\" text-justify\">Anything that speeds up comint is a good thing in my book.</p>
<H3 id=\"prog-mode\">Prog mode</H3>
<p class=\" text-justify\">Prog mode is a generic major mode that programming modes should try to inherit from. It is not intended for normal users.</p>
<pre><code>New command 'prog-fill-reindent-defun'.
This command either fills a single paragraph in a defun, such as a
docstring, or a comment, or (re)indents the surrounding defun if point
is not in a comment or a string.  By default, it is bound to 'M-q' in
'prog-mode' and all its descendants.</code></pre>
<H3 id=\"imenu\">Imenu</H3>
<p class=\" text-justify\">Imenu is a lookup feature for structured elements in the current buffer, such as function and class names in code, and headings and sub-headings in text.</p>
<pre><code>New user option 'imenu-flatten'.
It controls whether to flatten the list of sections in an imenu, and
how to display the sections in the flattened list.</code></pre>
<p class=\" text-justify\">If you use a completion mechanism that makes accessing nested elements hard in imenu, you can now request that it flattens the hierarchy.</p>
<pre><code>The sort order of Imenu completions can now be customized.
You can customize the user option 'completion-category-overrides'
and set 'display-sort-function' for the category 'imenu'.</code></pre>
<H3 id=\"which-function-mode\">Which Function mode</H3>
<p class=\" text-justify\">Which function shows the current function in the mode line by default. It works anywhere <code>M-x imenu</code> works.</p>
<pre><code>Which Function mode can now display function names on the header line.
The new user option 'which-func-display' allows choosing where the
function name is displayed.  The default is 'mode' to display in the
mode line.  'header' will display in the header line;
'mode-and-header' displays in both the header line and mode line.</code></pre>
<p class=\" text-justify\">The mode line is crowded and often truncated if you split your windows. Having another place to put this information is useful.</p>
<pre><code>New user option 'which-func-update-delay'.
This replaces the user option 'idle-update-delay', which was previously
used to control the delay before 'which-function-mode' updated its
display.  The user option 'idle-update-delay', which was only used by
Which Function mode, is now obsolete.</code></pre>
<H3 id=\"tramp\">Tramp</H3>
<p class=\" text-justify\">Tramp is Emacs’s remote file editing facility.</p>
<pre><code>Tramp methods can be optional.
An optional connection method is not enabled by default.  The user must
enable it explicitly by the 'tramp-enable-method' command.  The existing
methods \"fcp\", \"krlogin\", \" ksu\" and \"nc\" are optional now.</code></pre>
<pre><code>New optional connection method \"androidsu\".
This provides access to system files with elevated privileges granted by
the idiosyncratic 'su' implementations and system utilities customary on
Android.</code></pre>
<p class=\" text-justify\">Tramp supports a dizzying array of “connection” methods, including things that aren’t “connections” in the traditional sense, such as <code>sudo</code> and now <code>androidsu</code>.</p>
<pre><code>New optional connection method \"run0\".
This connection method is similar to \"sudo\", but it uses the 'systemd'
framework internally.</code></pre>
<pre><code>New connection methods \"dockercp\" and \"podmancp\".
These are the external methods counterparts of \"docker\" and \"podman\".</code></pre>
<p class=\" text-justify\">Tramp added native docker support a version or two ago, which is super handy for editing or viewing stuff inside a container from the comfort of your own Emacs.</p>
<pre><code>New optional connection methods for containers.
There are new optional connection methods \"toolbox\", \"distrobox\",
\"flatpak\", \"apptainer\" and \"nspawn\".  They allow accessing system
containers provided by Toolbox or Distrobox, sandboxes provided by
Flatpak, instances managed by Apptainer, or accessing systemd-based
light-weight containers..</code></pre>
<p class=\" text-justify\">Good to see more support for namespace-based container solutions other than docker.</p>
<pre><code>Connection method \"kubernetes\" supports now optional container name.
The host name for Kubernetes connections can be of kind [CONTAINER.]POD,
in order to specify a dedicated container.  If there is just the pod
name, the first container in the pod is taken.  The new user options
'tramp-kubernetes-context' and 'tramp-kubernetes-namespace' allow
accessing pods with different context or namespace but the default one.</code></pre>
<p class=\" text-justify\">Tramp can chain connections, so you can connect to a bastion host first before you connect to kubernetes pods.</p>
<pre><code>Rename 'tramp-use-ssh-controlmaster-options' to 'tramp-use-connection-share'.
The old name still exists as obsolete variable alias.  This user
option controls now connection sharing for both ssh-based and
plink-based methods.  It allows the values t, nil, and 'suppress'.
The latter suppresses also \"ControlMaster\" settings in the user's
\"~/.ssh/config\" file, or connection share configuration in PuTTY
sessions, respectively.</code></pre>
<p class=\" text-justify\">You absolutely must enable connection sharing (controlmaster) if you use ssh. It makes a huge difference in performance.</p>
<pre><code>New command 'tramp-cleanup-some-buffers'.
It kills only a subset of opened remote buffers, subject to the user
option 'tramp-cleanup-some-buffers-hook'.</code></pre>
<pre><code>New command 'inhibit-remote-files'.
This command disables the handling of file names with the special
remote file name syntax.  It should be applied only when remote files
won't be used in this Emacs instance.  It provides a slightly improved
performance of file name handling in Emacs.</code></pre>
<pre><code>New macro 'without-remote-files'.
This macro could wrap code which handles local files only.  Due to the
temporary deactivation of remote files, it results in a slightly
improved performance of file name handling in Emacs.</code></pre>
<pre><code>New user option 'tramp-completion-multi-hop-methods'.
It contains a list of connection methods for which completion should
be attempted at the end of a multi-hop chain.  This allows completion
candidates to include a list of, for example, containers running on a
remote docker host.</code></pre>
<p class=\" text-justify\">Oh, cool! One common criticism I had of multi-hop/chaining connections is that you really need to know what you’re looking for when you are writing out these multi-hop connections, as the completion support is non-existent. Good to see that Tramp will now attempt to complete via the multi-hop links you have already written. Neat!</p>
<pre><code>New command 'tramp-revert-buffer-with-sudo'.
It reverts the current buffer to visit with \"sudo\" permissions.  The
buffer must either visit a file, or it must run 'dired-mode'.  Another
method but \"sudo\" can be configured with user option
'tramp-file-name-with-method'.</code></pre>
<p class=\" text-justify\">I’ve had a snippet of code called <code>sudo</code> that does exactly this for what must be a decade plus now. Now it’s built in, albeit with a harder-to-remember name.</p>
<pre><code>Direct asynchronous processes are indicated by a connection-local variable.
If direct asynchronous processes shall be used, set the connection-local
variable 'tramp-direct-async-process' to a non-nil value.  In previous
Emacs versions this was indicated by the connection property
\"direct-async-process\".  That connection property (though not connection
properties and 'tramp-connection-properties' in general) is now
deprecated.  See the Tramp manual \"(tramp) Improving performance of
asynchronous remote processes\".</code></pre>
<p class=\" text-justify\">If you have performance issues with Tramp, you should try this out.</p>
<pre><code>Direct asynchronous processes use 'tramp-remote-path'.
When a direct asynchronous process is invoked, it uses 'tramp-remote-path'
for setting the remote 'PATH' environment variable.</code></pre>
<H3 id=\"shr\">SHR</H3>
<p class=\" text-justify\">SHR is Emacs’s HTML rendering engine that powers EWW, the Emacs Web Wowser.</p>
<pre><code>New user option 'shr-fill-text'.
When 'shr-fill-text' is non-nil (the default), SHR will fill text
according to the width of the window.  If you customize it to nil, SHR
will leave the text as-is; in that case, EWW will automatically enable
'visual-line-mode' when displaying a page so that long lines are
visually wrapped at word boundaries.</code></pre>
<H3 id=\"eww\">EWW</H3>
<p class=\" text-justify\"><code>M-x eww</code> is Emacs’s builtin web browser.</p>
<pre><code>New mouse bindings in EWW buffers.
Certain form elements that were displayed as buttons, yet could only be
activated by keyboard input, are now operable using 'mouse-2'.  With
\"Submit\" buttons, this triggers submission of the form, while clicks on
other classes of buttons either toggle their values or prompt for user
input, as the case may be.</code></pre>
<pre><code>EWW text input fields and areas are now fields.
In consequence, movement commands and OS input method features now
recognize and confine their activities to the text input field around
point.  See also the Info node \"(elisp) Fields\".</code></pre>
<p class=\" text-justify\">Fields here meaning the widget system that Emacs has built in.</p>
<pre><code>'eww-open-file' can now display the file in a new buffer.
By default, the command reuses the \"*eww*\" buffer, but if called with
the new argument NEW-BUFFER non-nil, it will use a new buffer instead.
Interactively, invoke 'eww-open-file' with a prefix argument to
activate this behavior.</code></pre>
<pre><code>'eww' URL or keyword prompt now has tab completion.
The interactive minibuffer prompt when invoking 'eww' now has support
for tab completion.</code></pre>
<pre><code>'eww' URL and keyword prompt now completes suggested URIs and bookmarks.
The interactive minibuffer prompt when invoking 'eww' now provides
completions from 'eww-suggest-uris'.  'eww-suggest-uris' now includes
bookmark URIs.</code></pre>
<pre><code>New command 'eww-copy-alternate-url'.
It copies an alternate link on the page currently visited in EWW into
the kill ring.  Alternate links are optional metadata that HTML pages
use for linking to their alternative representations, such as translated
versions or associated RSS feeds.  It is bound to 'A' by default.</code></pre>
<pre><code>'eww-open-in-new-buffer' supports the prefix argument.
When invoked with the prefix argument ('C-u'),
'eww-open-in-new-buffer' will not make the new buffer the current one.
This is useful for continuing reading the URL in the current buffer
when the new URL is fetched.</code></pre>
<pre><code>History navigation in EWW now behaves as in other browsers.
Previously, when navigating back and forward through page history, EWW
would add a duplicate entry to the end of the history list each time.
This made it impossible to navigate to the \"end\" of the history list.
Now, navigating through history in EWW simply changes your position in
the history list, allowing you to reach the end as expected.  In
addition, when browsing to a new page from a \"historical\" one (i.e., a
page loaded by navigating back through history), EWW deletes the history
entries newer than the current page.  To change the behavior when
browsing from \"historical\" pages, you can customize
'eww-before-browse-history-function'.</code></pre>
<pre><code>'eww-readable' now toggles display of the readable parts of a web page.
When called interactively, 'eww-readable' toggles whether to display
only the readable parts of a page or the full page.  With a positive
prefix argument, it always displays the readable parts, and with a zero
or negative prefix, it always displays the full page.</code></pre>
<p class=\" text-justify\">This feature has been around for ages, and it’s great if you want to remove all the chaff from a page. Note that the only real change here is that it toggles.</p>
<pre><code>New user option 'eww-readable-urls'.
This is a list of regular expressions matching the URLs where EWW should
display only the readable parts by default.  For more details, see
\"(eww) Basics\" in the EWW manual.</code></pre>
<p class=\" text-justify\">Great stuff if you regularly visit pages that require toggling on readable mode.</p>
<pre><code>New user option 'eww-readable-adds-to-history'.
When non-nil (the default), calling 'eww-readable' adds a new entry to
the EWW page history.</code></pre>
<H3 id=\"go-ts-mode\">Go-ts mode</H3>
<p class=\" text-justify\">This is the tree-sitter version for Go.</p>
<pre><code>New command 'go-ts-mode-docstring'.
This command adds a docstring comment to the current defun.  If a
comment already exists, point is only moved to the comment.  It is
bound to 'C-c C-d' in 'go-ts-mode'.</code></pre>
<H3 id=\"man-mode\">Man mode</H3>
<p class=\" text-justify\">Man referring here to the manual page tool <code>man</code>.</p>
<pre><code>New user option 'Man-prefer-synchronous-call'.
When this is non-nil, run the 'man' command synchronously rather than
asynchronously (which is the default behavior).</code></pre>
<pre><code>New user option 'Man-support-remote-systems'.
This option controls whether the man page is formatted on the remote
system when the current buffer's default-directory is remote.  You can
invoke the 'man' command with a prefix argument to countermand the
value of this option for the current invocation of 'man'.</code></pre>
<H3 id=\"docview\">DocView</H3>
<p class=\" text-justify\">DocView is a generic tool for converting complex documents into images for display in Emacs (pdf, docx, etc.)</p>
<pre><code>New user option 'doc-view-mpdf-use-svg'.
If non-nil, DocView uses SVG images to display PDF documents.  The
default is non-nil if your system supports display of SVG images.</code></pre>
<p class=\" text-justify\">Emacs’s SVG engine is quite good nowadays, and it’s definitely better than a raster image of a PDF.</p>
<pre><code>New face 'doc-view-svg-face'.
This replaces 'doc-view-svg-foreground' and 'doc-view-svg-background'.
By default, this face has black foreground on white background and
inherits from the default face.  When unsetting the foreground and
background values, the display in DocView is styled according to the
current theme.  However, this, or any non-standard values, can result in
poor contrast for documents which aren't simply black text on white
background.</code></pre>
<p class=\" text-justify\">If your theme clashes with the colors in SVG files, you can now change them to better suit your theme.</p>
<pre><code>DocView buffers now display a new tool bar.
This tool bar contains options for searching and navigating within the
document, replacing the incompatible items for incremental search and
editing within the default tool bar displayed in the past.</code></pre>
<H3 id=\"shortdoc\">Shortdoc</H3>
<p class=\" text-justify\">Shortdoc is <a href=\"/article/emacs-builtin-elisp-cheat-sheet\" class=\" article-link\">Emacs’s Builtin Elisp Cheat Sheet</a>.</p>
<pre><code>New function 'shortdoc-function-examples'.
This function returns examples of use of a given Emacs Lisp function
from the available shortdoc information.</code></pre>
<pre><code>New function 'shortdoc-help-fns-examples-function'.
This function inserts into the current buffer examples of use of a
given Emacs Lisp function, which it gleans from the shortdoc
information.  If you want 'describe-function' ('C-h f') to insert
examples of using the function into regular \"*Help*\" buffers, add the
following to your init file:

    (add-hook 'help-fns-describe-function-functions
              #'shortdoc-help-fns-examples-function)</code></pre>
<H3 id=\"package\">Package</H3>
<p class=\" text-justify\">Package is the package manager and installer in Emacs.</p>
<pre><code>New user option 'package-vc-register-as-project'.
When non-nil, 'package-vc-install' and 'package-vc-checkout' will
automatically register every package they install as a project, that you
can quickly select using 'project-switch-project' ('C-x p p').  Default
is t.</code></pre>
<p class=\" text-justify\">Oh that is very nice. I will definitely enable this now that <code>package</code> can install from source control using <code>vc</code>.</p>
<pre><code>New user option 'package-vc-allow-build-commands'.
Controls for which packages Emacs runs extra build commands when
installing directly from the package VCS repository.</code></pre>
<pre><code>New command 'package-vc-log-incoming'.
This commands displays incoming changes for a VC package without
modifying the current checkout.</code></pre>
<pre><code>New command to start an inferior Emacs loading only specific packages.
The new command 'package-isolate' will start a new Emacs process, as
a sub-process of Emacs where you invoke the command, in a way that
causes the new process to load only some of the installed packages.
The command prompts for the packages to activate in this
sub-process, and is intended for testing Emacs and/or the packages
in a clean environment.</code></pre>
<p class=\" text-justify\">That’s a really cool addition, and I look forward to using it with my own packages. I normally maintain a separate Emacs installation just for this purpose, but this approach might save me the hassle of having to maintain that.</p>
<H3 id=\"flymake\">Flymake</H3>
<p class=\" text-justify\">Flymake is Emacs’s linter/on-the-fly-compiler interface.</p>
<pre><code>New user option 'flymake-indicator-type'.
This controls which error indicator type Flymake should use in the
current buffer.  Depending on your preference, this can either use
fringes or margins for indicating errors, the default is 'margins'.</code></pre>
<pre><code>New user option 'flymake-margin-indicators-string'.
It controls, for each error type, the string and its face to display as
the margin indicator.</code></pre>
<pre><code>New user option 'flymake-autoresize-margins'.
If non-nil (the default), Flymake will resize the margins when
'flymake-mode' is turned on or off.
Only relevant if 'flymake-indicator-type' is set to 'margins'.</code></pre>
<pre><code>New user option 'flymake-margin-indicator-position'.
It controls whether to use margins for margin indicators, and which
margin (left or right) to use.  Default is to use the left margin.</code></pre>
<pre><code>New user option 'flymake-show-diagnostics-at-end-of-line'.
When non-nil, Flymake shows summarized descriptions of diagnostics at
the end of the line.  Depending on your preference, this can either be
distracting and easily confused with actual code, or a significant
early aid that relieves you from moving the buffer or reaching for the
mouse to consult an error message.  Default is nil.</code></pre>
<p class=\" text-justify\">Worth enabling to see if it is something that helps or hinders. You should consider setting it in a dir locals variable or mode hook so it only applies to some buffers.</p>
<H3 id=\"flyspell\">Flyspell</H3>
<p class=\" text-justify\">Emacs’s on the fly spell checker.</p>
<pre><code>New user option 'flyspell-check-changes'.
When non-nil, Flyspell mode spell-checks only words that you edited; it
does not check unedited words just because you move point across them.
Default is nil.</code></pre>
<H3 id=\"js-mode\">JS mode</H3>
<p class=\" text-justify\">One of a dozen modes that edit Javascript.</p>
<pre><code>The binding 'M-.' has been removed from the major mode keymaps in
'js-mode' and 'js-ts-mode', having it default to the global binding
which calls 'xref-find-definitions'.  If the previous one worked
better for you, use 'define-key' in your init script to bind
'js-find-symbol' to that combination again.</code></pre>
<p class=\" text-justify\">This is just standardizing on the xref interface and its default global keys.</p>
<p class=\" text-justify\">:</p>
<pre><code>'js-json-mode' does not derive from 'js-mode' any more so as not
to confuse tools like Eglot or YASnippet into thinking that those
buffers contain Javascript code.</code></pre>
<H3 id=\"python-mode\">Python mode</H3>
<p class=\" text-justify\">The major mode for editing Python.</p>
<pre><code>New user option 'python-indent-block-paren-deeper'.
If non-nil, increase the indentation of the lines inside parens in a
header of a block when they are indented to the same level as the body
of the block, producing:

    if (some_expression
            and another_expression):
        do_something()

instead of:

    if (some_expression
        and another_expression):
        do_something()

Default is nil.</code></pre>
<p class=\" text-justify\">I long ago stopped worrying about this stuff when code formatting tools became prevalent. Why get angry at your coworkers’ bad code formatting habits when you can direct your anger at a faceless code formatting tool instead?</p>
<pre><code>New user option 'python-interpreter-args'.
This allows the user to specify command line arguments to the non
interactive Python interpreter specified by 'python-interpreter'.</code></pre>
<pre><code>New function 'python-shell-send-block'.
It sends the python block delimited by 'python-nav-beginning-of-block'
and 'python-nav-end-of-block' to the inferior Python process.</code></pre>
<H3 id=\"inferior-python-mode\">Inferior Python mode</H3>
<p class=\" text-justify\">Inferior Python mode refers to the comint version that talks to the external python interpreter.</p>
<pre><code>Default value of 'python-shell-compilation-regexp-alist' is changed.
Support for Python's ExceptionGroup has been added, so in the Python
shell, the line indicating the source of an error in the error messages
from ExceptionGroup will be recognized as well.</code></pre>
<H3 id=\"eldoc\">Eldoc</H3>
<p class=\" text-justify\">Eldoc is a generic documentation popup system.</p>
<pre><code>'eldoc' no longer truncates to a single line by default.
Previously, the entire docstring was not available to eldoc, which made
'eldoc-echo-area-use-multiline-p' ineffective.  The old behavior may be
kept by customizing 'eldoc-echo-area-use-multiline-p'.</code></pre>
<H3 id=\"scheme-mode\">Scheme mode</H3>
<pre><code>Scheme mode now handles the regular expression literal '#/regexp/' that
 is available in some Scheme implementations.
 Also, it should now handle nested sexp-comments.</code></pre>
<H3 id=\"use-package\">Use package</H3>
<p class=\" text-justify\"><a href=\"/article/spotlight-use-package-a-declarative-configuration-tool\" class=\" article-link\">use-package is a declarative configuration tool</a>.</p>
<pre><code>New ':vc' keyword.
This keyword enables the user to install packages using package-vc.el.</code></pre>
<p class=\" text-justify\">This is a great addition and it rounds off the ability to manually install packages with VC that arrived in Emacs 29. You can replace a lot of the third-party package managers now if your needs are simple.</p>
<pre><code>New user option 'use-package-vc-prefer-newest'.
If non-nil, always install the newest commit of a package when using the
':vc' keyword rather than its stable release.  Default is nil.</code></pre>
<H3 id=\"gnus\">Gnus</H3>
<p class=\" text-justify\">Gnus is an expansive mail and news agent in Emacs.</p>
<pre><code>New backend 'nnfeed'.
This allows backend developers to easily create new backends for web
feeds, as inheriting backends of 'nnfeed'.</code></pre>
<pre><code>New backend 'nnatom'.
This allow users to add Atom Syndication Format feeds to Gnus as
servers.</code></pre>
<pre><code>The 'nnweb-type' option 'gmane' has been removed.
The gmane.org website is, sadly, down since a number of years with no
prospect of it coming back.  Therefore, it is no longer valid to set
the server variable 'nnweb-type' to 'gmane'.</code></pre>
<pre><code>New user option 'gnus-mode-line-logo'.
This allows the user to either disable the display of any logo or
specify which logo will be displayed as part of the
buffer-identification in the mode-line of Gnus buffers.</code></pre>
<pre><code>'gnus-summary-limit-to-age' now counts days since midnight.
\"Less than 1 day\" now means \"since last midnight\", rather than \"less
than 24 hours old\".</code></pre>
<H3 id=\"rmail\">Rmail</H3>
<p class=\" text-justify\">Rmail is one of many ways of sending and reading email in Emacs.</p>
<pre><code>New commands for reading mailing lists.
The new Rmail commands 'rmail-mailing-list-post',
'rmail-mailing-list-unsubscribe', 'rmail-mailing-list-help', and
'rmail-mailing-list-archive' allow, respectively, posting to,
unsubscribing from, requesting help about, and browsing the archives
of, the mailing list from which the current email message was
delivered.</code></pre>
<H3 id=\"dictionary\">Dictionary</H3>
<p class=\" text-justify\">Dictionary is a lookup system for <a href=\"/article/wordsmithing-in-emacs\" class=\" article-link\">wordsmiths</a>.</p>
<pre><code>New user option 'dictionary-search-interface'.
Controls how the 'dictionary-search' command prompts for and displays
dictionary definitions.  Customize this user option to 'help' to have
'dictionary-search' display definitions in a \"*Help*\" buffer and
provide dictionary-based minibuffer completion for word selection.
Default is nil, which means to use a \"*Dictionary*\" buffer.</code></pre>
<pre><code>New user option 'dictionary-read-word-prompt'.
This allows the user to customize the prompt that is used by
'dictionary-search' when asking for a word to search in the
dictionaries.</code></pre>
<pre><code>New user option 'dictionary-display-definition-function'.
This allows the user to customize the way in which 'dictionary-search'
displays word definitions.  If non-nil, this user option should be set
to a function that displays a word definition obtained from a
dictionary server.  The new function
'dictionary-display-definition-in-help-buffer' can be used to display
the definition in a \"*Help*\" buffer, instead of the default
\"*Dictionary*\" buffer.</code></pre>
<pre><code>New user option 'dictionary-read-word-function'.
This allows the user to customize the way in which 'dictionary-search'
prompts for a word to search in the dictionary.  This user option
should be set to a function that lets the user select a word and
returns it as a string.  The new function
'dictionary-completing-read-word' can be used to prompt with
completion based on dictionary matches.</code></pre>
<pre><code>New user option 'dictionary-read-dictionary-function'.
This allows the user to customize the way in which 'dictionary-search'
prompts for a dictionary to search in.  This user option should be set
to a function that lets the user select a dictionary and returns its
name as a string.  The new function
'dictionary-completing-read-dictionary' can be used to prompt with
completion based on dictionaries that the server supports.</code></pre>
<pre><code>The default value of 'dictionary-tooltip-dictionary' has changed.
The new default value is t, which means use the same dictionary as the
value of 'dictionary-default-dictionary'.  The previous default value
was nil, which effectively disabled 'dictionary-tooltip-mode', even if
the mode was turned on.</code></pre>
<H3 id=\"pp\">Pp</H3>
<p class=\" text-justify\">Pp is the pretty printing functionality for elisp.</p>
<pre><code>New 'pp-default-function' user option replaces 'pp-use-max-width'.
Its default value is 'pp-fill', a new default pretty-printing function,
which tries to obey 'fill-column'.</code></pre>
<pre><code>'pp-to-string' takes an additional PP-FUNCTION argument.
This argument specifies the prettifying algorithm to use.</code></pre>
<pre><code>'pp' and 'pp-to-string' now always include a terminating newline.
In the past they included a terminating newline in most cases but not all.</code></pre>
<H3 id=\"emacs-lisp-mode\">Emacs Lisp mode</H3>
<p class=\" text-justify\">The major mode used to edit elisp code.</p>
<pre><code>'elisp-flymake-byte-compile' is disabled for untrusted files.
For security reasons, this backend can be used only in those files
specified as trusted according to 'trusted-content' and emits an
\"untrusted content\" warning otherwise.
This fixes CVE-2024-53920.</code></pre>
<pre><code>',@' now has 'prefix' syntax.
Previously, the '@' character, which normally has 'symbol' syntax,
would combine with a following Lisp symbol and interfere with symbol
searching.</code></pre>
<pre><code>'emacs-lisp-docstring-fill-column' now defaults to 72.
It was previously 65.  The new default formats documentation strings to
fit on fewer lines without negatively impacting readability.</code></pre>
<H3 id=\"cperl-mode\">CPerl mode</H3>
<p class=\" text-justify\">One of two Perl modes in Emacs.</p>
<pre><code>Subroutine signatures are now supported.
CPerl mode fontifies subroutine signatures like variable declarations
which makes them visually distinct from subroutine prototypes.</code></pre>
<pre><code>Syntax of Perl up to version 5.40 is supported.
CPerl mode supports the new keywords for exception handling and the
object oriented syntax which were added in Perl 5.36, 5.38 and 5.40.</code></pre>
<pre><code>New user option 'cperl-fontify-trailer'.
This user option takes the values 'perl-code' or 'comment' and treats
text after an \"__END__\" or \"__DATA__\" token accordingly.  The default
value of 'perl-code' is useful for trailing POD and for AutoSplit
modules, the value 'comment' makes CPerl mode treat trailers as
comment, like Perl mode does.</code></pre>
<pre><code>New command 'cperl-file-style'.
This command sets the indentation style for the current buffer.  To
change the default style, either use the user option with the same name
or use the command 'cperl-set-style'.</code></pre>
<pre><code>New minor mode 'cperl-extra-paired-delimiters-mode'.
Perl 5.36 and newer allows using more than 200 non-ASCII paired
delimiters for quote-like constructs, e.g. \"q«text»\".  Use this minor
mode in buffers where this feature is activated.</code></pre>
<pre><code>Commands using the Perl Info manual are obsolete.
The Perl documentation in Info format is no longer distributed with
Perl or on CPAN since more than 10 years.  Perl documentation can be
read with 'cperl-perldoc' instead.</code></pre>
<pre><code>Highlighting trailing whitespace has been removed.
The user option 'cperl-invalid-face' is now obsolete, and does
nothing.  See the user option 'show-trailing-whitespace' instead.</code></pre>
<H3 id=\"emacs-sessions-desktop\">Emacs Sessions (Desktop)</H3>
<p class=\" text-justify\">Desktop saves and restores your Emacs buffers and files between sessions.</p>
<pre><code>Restoring buffers visiting remote files can now time out.
When a buffer is restored which visits a remote file, the restoration
of the session could hang if the remote host is off-line or slow to
respond.  Setting the user option 'remote-file-name-access-timeout' to
a positive number will abandon the attempt to restore such buffers
after a timeout of that many seconds, thus allowing the rest of
desktop restoration to continue.</code></pre>
<p class=\" text-justify\">I have absolutely been caught out by this before, so that is a welcome change indeed.</p>
<H3 id=\"recentf\">Recentf</H3>
<p class=\" text-justify\">Recentf remembers files you have visited and lets you re-visit them quickly.</p>
<pre><code>Checking recent remote files can now time out.
Similarly to buffer restoration by Desktop, 'recentf-mode' checking
of the accessibility of remote files can now time out if
'remote-file-name-access-timeout' is set to a positive number.</code></pre>
<H3 id=\"image-dired\">Image Dired</H3>
<p class=\" text-justify\">One of several ways of displaying images in Emacs.</p>
<pre><code>New user option 'image-dired-thumb-naming'.
You can now configure how thumbnails are named using this option.</code></pre>
<H3 id=\"ert\">ERT</H3>
<p class=\" text-justify\">This is a test runner framework for Emacs, and a rather useful one at that.</p>
<pre><code>New macro 'skip-when' to skip 'ert-deftest' tests.
This can help to avoid some awkward skip conditions.  For example
'(skip-unless (not noninteractive))' can be changed to the easier
to read '(skip-when noninteractive)'.</code></pre>
<pre><code>Syntax highlighting unit testing support.
An ERT extension ('ert-font-lock') now provides support for face
assignment unit testing.  For more information, see the \"(ert) Syntax
Highlighting Tests\" node in the ERT manual.</code></pre>
<H3 id=\"socks\">Socks</H3>
<p class=\" text-justify\">SOCKS is a proxy-like protocol that, quite frankly, I don’t think I’ve used in decades.</p>
<pre><code>Socks supports version 4a.
The 'socks-server' user option accepts '4a' as a value for its version
field.</code></pre>
<H3 id=\"edmacro\">Edmacro</H3>
<p class=\" text-justify\">This is the major mode for interactively editing keyboard macros.</p>
<pre><code>New command 'edmacro-set-macro-to-region-lines'.
Bound to 'C-c C-r', this command replaces the macro text with the
lines of the region.  If needed, the region is extended to include
whole lines.  If the region ends at the beginning of a line, that last
line is excluded.</code></pre>
<pre><code>New user option 'edmacro-reverse-macro-lines'.
When this is non-nil, the lines of key sequences are displayed with
the most recent line first.  This is can be useful when working with
macros with many lines, such as from 'kmacro-edit-lossage'.</code></pre>
<H3 id=\"calc\">Calc</H3>
<p class=\" text-justify\">This is Emacs’s advanced symbolic computer algebra system.</p>
<pre><code>Calc parses fractions written using U+2044 FRACTION SLASH.
Fractions of the form \"123⁄456\" are handled as if written \"123:456\".
Note in particular the difference in behavior from U+2215 DIVISION SLASH
and U+002F SOLIDUS, which result in division rather than a rational
fraction.  In addition, precomposed fraction characters, such as ½
(U+00BD VULGAR FRACTION ONE HALF), are also recognized as rational
fractions.  (They have been recognized since 2004, but it looks like it
was never mentioned in the NEWS, or even the Calc manual.)</code></pre>
<H3 id=\"ielm\">IELM</H3>
<p class=\" text-justify\">IELM is the interactive shell for <a href=\"/article/evaluating-elisp-emacs\" class=\" article-link\">Evaluating Elisp in Emacs</a>.</p>
<pre><code>IELM now remembers input history between sessions.
The new user option 'ielm-history-file-name' is the name of the file
where IELM input history will be saved.  Customize it to nil to revert
to the old behavior of not remembering input history between sessions.</code></pre>
<H3 id=\"easypg\">EasyPG</H3>
<p class=\" text-justify\">EasyPG is a wrapper for GnuPG and friends. See <a href=\"/article/keeping-secrets-in-emacs-gnupg-auth-sources\" class=\" article-link\">Keeping Secrets in Emacs with GnuPG and Auth Sources</a>.</p>
<pre><code>New user option 'epa-keys-select-method'.
This allows the user to customize the key selection method, which can be
either by using a pop-up buffer or from the minibuffer.  The pop-up
buffer method is the default, which preserves previous behavior.</code></pre>
<H3 id=\"widget\">Widget</H3>
<p class=\" text-justify\">This is the internal library used by Emacs for buttons, edit fields, etc. in places like the Customize interface.</p>
<pre><code>New face 'widget-unselected'.
Customize this face to a non-default value to visually distinguish the
labels of unselected active radio-button or checkbox widgets from the
labels of unselected inactive widgets (the default value inherits from
the 'widget-inactive' face).</code></pre>
<pre><code>New user option 'widget-skip-inactive'.
If non-nil, moving point forward or backward between widgets by typing
'TAB' or 'S-TAB' skips over inactive widgets.  The default value is nil.</code></pre>
<H3 id=\"ruby-mode\">Ruby mode</H3>
<p class=\" text-justify\">Programming mode for Ruby.</p>
<pre><code>New user option 'ruby-rubocop-use-bundler'.
By default it retains the previous behavior: read the contents of
Gemfile and act accordingly.  But you can also set it to t or nil to
skip checking the Gemfile.</code></pre>
<pre><code>New user option 'ruby-bracketed-args-indent'.
When it is set to nil, multiple consecutive open braces/brackets/parens
result in only one additional indentation level.  Default is t.</code></pre>
<H3 id=\"thingatpt\">Thingatpt</H3>
<p class=\" text-justify\">A framework for plucking the thing at point: words, functions, emails, urls, you name it. A useful thing to learn about and use, as it has a wide range of applications.</p>
<pre><code>New variables for providing custom thingatpt implementations.
The new variables 'bounds-of-thing-at-point-provider-alist' and
'forward-thing-provider-alist' now allow defining custom implementations
of 'bounds-of-thing-at-point' and 'forward-thing', respectively.</code></pre>
<pre><code>New helper functions for text property-based thingatpt providers.
The new helper functions 'thing-at-point-for-char-property',
'bounds-of-thing-at-point-for-char-property', and
'forward-thing-for-char-property' can help to implement custom thingatpt
providers for \"things\" that are defined by text properties.</code></pre>
<pre><code>'bug-reference-mode' now supports 'thing-at-point'.
Now, calling '(thing-at-point 'url)' when point is on a bug reference
will return the URL for that bug.</code></pre>
<p class=\" text-justify\">Bug reference mode is a small minor mode that makes ‘bug references’ (such as #2823) clickable.</p>
<H3 id=\"buffer-menu\">Buffer-menu</H3>
<p class=\" text-justify\">Yet another buffer selection and display system in Emacs.</p>
<pre><code>New user option 'Buffer-menu-group-by'.
It controls how buffers are divided into groups that are displayed with
headings using Outline minor mode.  Using commands that mark buffers
on the outline heading line will mark all buffers in the outline.  By
default, no grouping is performed.</code></pre>
<pre><code>New command 'Buffer-menu-toggle-internal'.
This command toggles the display of internal buffers in Buffer Menu mode;
that is, buffers not visiting a file and whose names start with a space.
Previously, such buffers were never shown.  This command is bound to 'I'
in Buffer Menu mode.</code></pre>
<H3 id=\"miscellaneous-1\">Miscellaneous</H3>
<pre><code>New user option 'rcirc-log-time-format'.
This allows for rcirc logs to use a custom timestamp format, which the
chat buffers use by default.</code></pre>
<p class=\" text-justify\">RCIRC is one of two IRC clients in Emacs, the other being ERC.</p>
<pre><code>'ffap-lax-url' now defaults to nil.
Previously, it was set to t, but this broke remote file name detection.</code></pre>
<p class=\" text-justify\">FFAP is Find File At Point is a system for plucking the file at point and opening it.</p>
<pre><code>More control on automatic update of Proced buffers.
The user option 'proced-auto-update-flag' can now be set to an
additional value 'visible', which controls automatic updates of Proced
buffers that are displayed in some window.</code></pre>
<p class=\" text-justify\">Proced’s basically Emacs’s answer to <code>top</code>. See <a href=\"/article/displaying-interacting-processes-proced\" class=\" article-link\">Displaying and Interacting with processes using Proced</a>.</p>
<pre><code>nXML Mode now comes with schemas for Mono/.NET development.
The following new XML schemas are now supported:
- MSBuild project files
- Dotnet package properties files
- Dotnet resource extension files
- Dotnet Application config files
- Nuget config file
- Nuget package specification file
- Nuget packages config file</code></pre>
<pre><code>color.el now supports the Oklab color representation.</code></pre>
<p class=\" text-justify\">The color file has a large range of advanced color conversion routines. Worth a look if that is something you interact with a lot.</p>
<pre><code>New user option 'xwidget-webkit-disable-javascript'.
This allows disabling JavaScript in xwidget Webkit sessions.</code></pre>
<p class=\" text-justify\">XWidget is a half-abandoned, half-working attempt at bringing the Webkit browser to Emacs.</p>
<pre><code>'ls-lisp--insert-directory' supports more long options of 'ls'.
'ls-lisp--insert-directory', the ls-lisp implementation of
'insert-directory', now supports the '--time=TIME' and '--sort=time'
options of GNU 'ls'.</code></pre>
<p class=\" text-justify\">How does dired work on platforms (such as MS-DOS or Windows) where there is no <code>ls</code> program? The answer is simple: Emacs has an elisp emulation layer that talks to the underlying system directly.</p>
<pre><code>'M-x ping' can now give additional flags to the 'ping' program.
Typing 'C-u M-x ping' prompts first for the host, and then for the flags
to give to the 'ping' command.</code></pre>
<p class=\" text-justify\">There is a host of network utility wrappers in Emacs. See <a href=\"/article/network-utilities-emacs\" class=\" article-link\">Using the commandline network utilities from Emacs</a>.</p>
<pre><code>Webjump now assumes URIs are HTTPS instead of HTTP.
For links in 'webjump-sites' without an explicit URI scheme, it was
previously assumed that they should be prefixed with \"http://\".  Such
URIs are now prefixed with \"https://\" instead.</code></pre>
<p class=\" text-justify\">Another obscure feature in Emacs. Here it’s a flat list of common URLs and a command to select and then open one of them. The fact that “Yahoo” is still in there says it all.</p>
<pre><code>Added prefixes in titdic-cnv library.
Most of the variables and functions in the file have been renamed to
make sure they all use a 'tit-' namespace prefix.</code></pre>
<p class=\" text-justify\">Obscure library for working with Quail, a format used in multilingual systems.</p>
<pre><code>'xref-revert-buffer' is now an alias of 'revert-buffer'.
The Xref buffer now sets up 'revert-buffer-function' such that
'revert-buffer' behaves like 'xref-revert-buffer' did in previous Emacs
versions, and the latter is now an alias of the former.</code></pre>
<p class=\" text-justify\">Xref is Emacs’s cross-referencing system, and all this change does is make it so <code>M-x revert-buffer</code> (which I have a version of that reverts the current buffer bound to <code>F6</code>) reverts properly in xref buffers also.</p>
<pre><code>The Makefile browser is now obsolete.
The command 'makefile-switch-to-browser' command is now obsolete,
together with related commands used in the \"*Macros and Targets*\"
buffer.  We recommend using an alternative like 'imenu' instead.</code></pre>
<pre><code>'jsonrpc-default-request-timeout' is now a defcustom.</code></pre>
<H2 id=\"new-modes-and-packages-in-emacs-30.1\">New Modes and Packages in Emacs 30.1</H2>
<H3 id=\"new-major-modes-based-on-the-tree-sitter-library\">New major modes based on the tree-sitter library</H3>
<pre><code>New major mode 'elixir-ts-mode'.
A major mode based on the tree-sitter library for editing Elixir files.</code></pre>
<pre><code>New major mode 'heex-ts-mode'.
A major mode based on the tree-sitter library for editing HEEx files.</code></pre>
<pre><code>New major mode 'html-ts-mode'.
An optional major mode based on the tree-sitter library for editing
HTML files.</code></pre>
<pre><code>New major mode 'lua-ts-mode'.
A major mode based on the tree-sitter library for editing Lua files.</code></pre>
<pre><code>New major mode 'php-ts-mode'.
A major mode based on the tree-sitter library for editing PHP files.</code></pre>
<p class=\" text-justify\">Good to see more tree-sitter major modes.</p>
<pre><code>New package EditorConfig.
This package provides support for the EditorConfig standard,
an editor-neutral way to provide directory local (project-wide) settings.
It is enabled via a new global minor mode 'editorconfig-mode'
which makes Emacs obey the '.editorconfig' files.
There is also a new major mode 'editorconfig-conf-mode'
to edit those configuration files.</code></pre>
<p class=\" text-justify\">Long overdue, even if I find the capabilities of editorconfig rather basic.</p>
<pre><code>New global minor mode 'etags-regen-mode'.
This minor mode generates the tags table automatically based on the
current project configuration, and later updates it as you edit the
files and save the changes.</code></pre>
<pre><code>New package 'which-key'.
The 'which-key' package from GNU ELPA is now included in Emacs.  It
implements the global minor mode 'which-key-mode' that displays a table
of key bindings upon entering a partial key chord and waiting for a
moment.  For example, after enabling the minor mode, if you enter 'C-x'
and wait for one second, the minibuffer will expand with all available
key bindings that follow 'C-x' (or as many as space allows).</code></pre>
<p class=\" text-justify\">This is a long-awaited inclusion for some people. Which-key pops up a list of key bindings if you partially type a key and a wait a little while.</p>
<pre><code>New minor mode 'completion-preview-mode'.
This minor mode shows you symbol completion suggestions as you type,
using an inline preview.  New user options in the 'completion-preview'
customization group control exactly when Emacs displays this preview.
'completion-preview-mode' is buffer-local, to enable it globally use
'global-completion-preview-mode'.</code></pre>
<p class=\" text-justify\">Buried in the foot of the NEWS file is one of the best new additions in Emacs. A window-based answer to Company / Corfu, with a host of really nice ergonomic features. I really, really recommend you disable your in-line completer (corfu, company, auto-complete, whatever) and give this one a try for a little while.</p>
<pre><code>New package Window-Tool-Bar.
This provides a new minor mode, 'window-tool-bar-mode'.  When this minor
mode is enabled, a tool bar is displayed at the top of a window.  To
conserve space, no tool bar is shown if 'tool-bar-map' is nil.  The
global minor mode 'global-window-tool-bar-mode' enables this minor mode
in all buffers.</code></pre>
<p class=\" text-justify\">A compromise for people who want the toolbar but only when it has something interesting to offer.</p>
<pre><code>New library Track-Changes.
This library is a layer of abstraction above 'before-change-functions'
and 'after-change-functions' which provides a superset of
the functionality of 'after-change-functions':
- It provides the actual previous text rather than only its length.
- It takes care of accumulating and bundling changes until a time when
  its client finds it convenient to react to them.
- It detects most cases where some changes were not properly
  reported (calls to 'before/after-change-functions' that are
  incorrectly paired, missing, etc...) and reports them adequately.</code></pre>
<p class=\" text-justify\">Building this sort of thing is surprisingly tricky, as the text above briefly alludes to. It does not seem to be used in many places yet, but I foresee that it will play an important role in tools that want to provide in-buffer tracking of changes without the tears of having to build all this infrastructure from scratch. I especially like the feature that it collects the changes until such a time that the client deems it needs them; very useful, and hard to do well with nothing more than a set of before/after change hooks.</p>
<pre><code>New global minor mode 'minibuffer-regexp-mode'.
This is a minor mode for editing regular expressions in the minibuffer,
for example in 'query-replace-regexp'.  It correctly highlights parens
via 'show-paren-mode' and 'blink-matching-paren' in a user-friendly way,
avoids reporting alleged paren mismatches and makes sexp navigation more
intuitive.  It is enabled by default, 'minibuffer-regexp-prompts' can be
used to tune when it takes effect.</code></pre>
<p class=\" text-justify\">Excellent feature that is enabled by default, so no need to do anything.</p>
<pre><code>The highly accessible Modus themes collection has eight items.
The 'modus-operandi' and 'modus-vivendi' are the main themes that have
been part of Emacs since version 28.  The former is light, the latter
dark.  In addition to these, we now have 'modus-operandi-tinted' and
'modus-vivendi-tinted' for easier legibility, as well as
'modus-operandi-deuteranopia', 'modus-vivendi-deuteranopia',
'modus-operandi-tritanopia', and 'modus-vivendi-tritanopia' to cover
the needs of users with red-green or blue-yellow color deficiency.
The Info manual \"(modus-themes) Top\" describes the details and
showcases all their user options.</code></pre>
<p class=\" text-justify\">A popular set of themes beloved by many.</p>
<H3 id=\"new-library-peg\">New library PEG</H3>
<pre><code>Emacs now includes a library for writing Parsing Expression
Grammars (PEG), an approach to text parsing that provides more structure
than regular expressions, but less complexity than context-free
grammars.  The Info manual \"(elisp) Parsing Expression Grammars\" has
documentation and examples.</code></pre>
<p class=\" text-justify\">Interesting inclusion and I am curious to see it in use. Emacs already has parsing tools already (Semantic Bovinator being one such example) so I guess this will find a home in Org mode as it has a range of custom query languages.</p>
<pre><code>New major mode 'shell-command-mode'.
This mode is used by default for the output of asynchronous 'shell-command'.
To revert to the previous behavior, set the (also new) variable
'async-shell-command-mode' to 'shell-mode'.  Any hooks or mode-specific
variables used should be adapted appropriately.</code></pre>
<pre><code>New package Compat.
Emacs now comes with a stub implementation of the
forwards-compatibility Compat package from GNU ELPA.  This allows
built-in packages to use the library more effectively, and helps
preventing the installation of Compat if unnecessary.</code></pre>
<p class=\" text-justify\">Compat provides backwards and forwards compatible changes for package authors so they can target older versions of Emacs, and keep older packages working in newer ones, too.</p>
<H3 id=\"incompatible-lisp-changes-in-emacs-30.1\">Incompatible Lisp Changes in Emacs 30.1</H3>
<pre><code>Evaluating a 'lambda' returns an object of type 'interpreted-function'.
Instead of representing interpreted functions as lists that start with
either 'lambda' or 'closure', Emacs now represents them as objects
of their own 'interpreted-function' type, which is very similar
to 'byte-code-function' objects (the argument list, docstring, and
interactive forms are placed in the same slots).
Lists that start with 'lambda' are now used only for non-evaluated
functions (in other words, for source code), but for backward compatibility
reasons, 'functionp' still recognizes them as functions and you can
still call them as before.
Thus code that attempts to \"dig\" into the internal structure of an
interpreted function's object with the likes of 'car' or 'cdr' will
no longer work and will need to use 'aref' instead to extract its
various subparts (when 'interactive-form', 'documentation', and
'help-function-arglist' aren't adequate).</code></pre>
<p class=\" text-justify\">The heart of this is that in Lisp, code and data are the same, and when Emacs emits a readable form of a lambda or closure you just created, it does so in a way that looks like a list. In older Emacsen, you could write <code>(car (lambda))</code> and it’d spit out <code>closure</code> (provided <code>lexical-binding</code> is enabled), and now you cannot do this; it’s not a list any more.</p>
<p class=\" text-justify\">It’s very unlikely this will affect you in any way.</p>
<pre><code>The escape sequence '\\x' not followed by hex digits is now an error.
Previously, '\\x' without at least one hex digit denoted character code
zero (NUL) but as this was neither intended nor documented or even
known by anyone, it is now treated as an error by the Lisp reader.</code></pre>
<pre><code>'subr-native-elisp-p' is renamed to 'native-comp-function-p'.
The previous name still exists but is marked as obsolete.</code></pre>
<pre><code>'define-globalized-minor-mode' requires that modes use 'run-mode-hooks'.
Minor modes defined with 'define-globalized-minor-mode', such as
'global-font-lock-mode', will not be enabled any more in those buffers
whose major modes fail to use 'run-mode-hooks'.  Major modes defined
with 'define-derived-mode' are not affected.  'run-mode-hooks' has been the
recommended way to run major mode hooks since Emacs 22.</code></pre>
<pre><code>'buffer-match-p' and 'match-buffers' take '&amp;rest ARGS'.
They used to take a single '&amp;optional ARG' and were documented to use
an unreliable hack to try and support condition predicates that
don't accept this optional ARG.
The new semantics makes no such accommodation, but the code still
supports it (with a warning) for backward compatibility.</code></pre>
<pre><code>'post-gc-hook' runs after updating 'gcs-done' and 'gc-elapsed'.</code></pre>
<pre><code>Connection-local variables are applied in buffers visiting remote files.
This overrides possible directory-local or file-local variables with
the same name.</code></pre>
<pre><code>'copy-tree' now copies records when its optional 2nd argument is non-nil.</code></pre>
<pre><code>Regexp zero-width assertions followed by operators are better defined.
Previously, regexps such as \"xy\\\\B*\" would have ill-defined behavior.
Now any operator following a zero-width assertion applies to that
assertion only (which is useless).  For historical compatibility, an
operator character following '^' or '\\`' becomes literal, but we
advise against relying on this.</code></pre>
<pre><code>Infinities and NaNs no longer act as symbols on non-IEEE platforms.
On old platforms like the VAX that do not support IEEE floating-point,
tokens like '0.0e+NaN' and '1.0e+INF' are no longer read as symbols.
Instead, the Lisp reader approximates an infinity with the nearest
finite value, and a NaN with some other non-numeric object that
provokes an error if used numerically.</code></pre>
<pre><code>Conversion of strings to and from byte-arrays works with multibyte strings.
The functions 'dbus-string-to-byte-array' and
'dbus-byte-array-to-string' now accept and return multibyte Lisp
strings, encoding to UTF-8 and decoding from UTF-8 internally.  This
means that the argument to 'dbus-byte-array-to-string' must be a valid
UTF-8 byte sequence, and the optional parameter MULTIBYTE of
'dbus-byte-array-to-string' is now obsolete and unused.  The argument of
'dbus-string-to-byte-array' should be a regular Lisp string, not a
unibyte string.</code></pre>
<pre><code>'minibuffer-allow-text-properties' now can be set buffer-local.
'read-from-minibuffer' and functions that use it can take the
buffer-local value from the minibuffer.</code></pre>
<pre><code>'minibuffer-allow-text-properties' now also affects completions.
When it has a non-nil value, then completion functions like
'completing-read' don't discard text properties from the returned
completion candidate.</code></pre>
<pre><code>X color support compatibility aliases are now obsolete.
The compatibility aliases 'x-defined-colors', 'x-color-defined-p',
'x-color-values', and 'x-display-color-p' are now obsolete.</code></pre>
<pre><code>'easy-mmode-define-{minor,global}-mode' aliases are now obsolete.
Use 'define-minor-mode' and 'define-globalized-minor-mode' instead.</code></pre>
<pre><code>The 'millisec' argument of 'sleep-for' is now obsolete.
Use a float value for the first argument instead.</code></pre>
<pre><code>User options 'eshell-NAME-unload-hook' are now obsolete.
These hooks were named incorrectly, and so they never actually ran
when unloading the corresponding feature.  Instead, you should use
hooks named after the feature name, like 'esh-mode-unload-hook'.</code></pre>
<pre><code>User options 'eshell-process-wait-{seconds,milliseconds}' are now obsolete.
Instead, use 'eshell-process-wait-time', which supports floating-point
values.</code></pre>
<pre><code>User option 'tramp-completion-reread-directory-timeout' has been removed.
This user option was obsoleted in Emacs 27, use
'remote-file-name-inhibit-cache' instead.</code></pre>
<pre><code>The obsolete calling convention of 'sit-for' has been removed.
That convention was: '(sit-for SECONDS MILLISEC &amp;optional NODISP)'.</code></pre>
<pre><code>'defadvice' is marked as obsolete.
See the \"(elisp) Porting Old Advice\" Info node for help converting
them to use 'advice-add' or 'define-advice' instead.</code></pre>
<p class=\" text-justify\">Emacs added a new advice system many versions ago; it’s better, and I should get around to removing the old advice forms…</p>
<pre><code>'cl-old-struct-compat-mode' is marked as obsolete.
You may need to recompile your code if it was compiled with Emacs &lt; 24.3.</code></pre>
<pre><code>Old derived.el functions removed.
The following functions have been deleted because they were only used
by code compiled with Emacs &lt; 21:
'derived-mode-init-mode-variables', 'derived-mode-merge-abbrev-tables',
'derived-mode-merge-keymaps', 'derived-mode-merge-syntax-tables',
'derived-mode-run-hooks', 'derived-mode-set-abbrev-table',
'derived-mode-set-keymap', 'derived-mode-set-syntax-table',
'derived-mode-setup-function-name'.

</code></pre>
<H3 id=\"lisp-changes-in-emacs-30.1\">Lisp Changes in Emacs 30.1</H3>
<pre><code>The 'wheel-up/down/left/right' events are now bound unconditionally.
The 'mouse-wheel-up/down/left/right-event' variables are thus used only
to specify the 'mouse-4/5/6/7' events that might still happen to be
generated by some old packages (or if 'mouse-wheel-buttons' has been set
to nil).</code></pre>
<pre><code>Xterm Mouse mode now emits 'wheel-up/down/right/left' events.
This is instead of 'mouse-4/5/6/7' events for the mouse wheel.  It uses
the new variable 'mouse-wheel-buttons' to decide which button maps to
which wheel event (if any).</code></pre>
<pre><code>In batch mode, tracing now sends the trace to stdout.</code></pre>
<pre><code>New hook 'hack-dir-local-get-variables-functions'.
This can be used to provide support for other directory-local settings
beside \".dir-locals.el\".</code></pre>
<pre><code>'auto-coding-functions' can know the name of the file.
The functions on this hook can now find the name of the file to
which the text belongs by consulting the variable 'auto-coding-file-name'.</code></pre>
<pre><code>New user option 'compilation-safety' to control safety of native code.
It is now possible to control how safe is the code generated by native
compilation, by customizing this user option.  It is also possible to
control this at function granularity by using the new 'safety' parameter
in the function's 'declare' form.</code></pre>
<pre><code>New types 'closure' and 'interpreted-function'.
'interpreted-function' is the new type used for interpreted functions,
and 'closure' is the common parent type of 'interpreted-function'
and 'byte-code-function'.

Those new types come with the associated new predicates 'closurep' and
'interpreted-function-p' as well as a new constructor
'make-interpreted-closure'.</code></pre>
<pre><code>New function 'help-fns-function-name'.
For named functions, it just returns the name and otherwise
it returns a short \"unique\" string that identifies the function.
In either case, the string is propertized so clicking on it gives
further details.</code></pre>
<pre><code>New function 'char-to-name'.
This is a convenience function to return the Unicode name of a char (if
it has one).</code></pre>
<pre><code>New function 'cl-type-of'.
This function is like 'type-of' except that it sometimes returns
a more precise type.  For example, for nil and t it returns 'null'
and 'boolean' respectively, instead of just 'symbol'.</code></pre>
<pre><code>New functions 'primitive-function-p' and 'cl-functionp'.
'primitive-function-p' is like 'subr-primitive-p' except that it returns
t only if the argument is a function rather than a special-form,
and 'cl-functionp' is like 'functionp' except it returns nil
for lists and symbols.</code></pre>
<pre><code>Built-in types now have corresponding classes.
At the Lisp level, this means that things like '(cl-find-class 'integer)'
will now return a class object, and at the UI level it means that
things like 'C-h o integer RET' will show some information about that type.</code></pre>
<pre><code>New variable 'major-mode-remap-defaults' and function 'major-mode-remap'.
The first is like Emacs-29's 'major-mode-remap-alist' but to be set by
packages (instead of users).  The second looks up those two variables.</code></pre>
<p class=\" text-justify\">Yet more complexity around how to remap major modes to accommodate tree-sitter major modes.</p>
<pre><code>Pcase's functions (in 'pred' and 'app') can specify the argument position.
For example, instead of '(pred (&lt; 5))' you can write '(pred (&gt; _ 5))'.</code></pre>
<p class=\" text-justify\">Ah good. I always found it odd that it would bind to the left-most argument, but now I can specify which one I want.</p>
<pre><code>'define-advice' now sets the new advice's 'name' property to NAME.
Named advices defined with 'define-advice' can now be removed with
'(advice-remove SYMBOL NAME)' in addition to '(advice-remove SYMBOL
SYMBOL@NAME)'.</code></pre>
<pre><code>New function 'require-with-check' to detect new versions shadowing.
This is like 'require', but it checks whether the argument 'feature'
is already loaded, in which case it either signals an error or
forcibly reloads the file that defines the feature.</code></pre>
<pre><code>New variable 'lisp-eval-depth-reserve'.
It puts a limit to the amount by which Emacs can temporarily increase
'max-lisp-eval-depth' when handling signals.</code></pre>
<pre><code>New special form 'handler-bind'.
It provides a functionality similar to 'condition-case' except it runs
the handler code without unwinding the stack, such that we can record
the backtrace and other dynamic state at the point of the error.  See
the Info node \"(elisp) Handling Errors\".</code></pre>
<pre><code>New text properties add tooltips on fringes.
It is now possible to provide tooltips on fringes by adding special text
properties 'left-fringe-help' and 'right-fringe-help'.  See the \"(elisp)
Special Properties\" Info node in the Emacs Lisp Reference Manual for
more details.</code></pre>
<pre><code>New 'display-buffer' action alist entry 'pop-up-frames'.
This has the same effect as the variable of the same name and takes
precedence over the variable when present.</code></pre>
<pre><code>New function 'merge-ordered-lists'.
Mostly used internally to do a kind of topological sort of
inheritance hierarchies.</code></pre>
<pre><code>'drop' is now an alias for the function 'nthcdr'.</code></pre>
<pre><code>New polymorphic comparison function 'value&lt;'.
This function returns non-nil if the first argument is less than the
second.  It works for any two values of the same type with reasonable
ordering for numbers, strings, symbols, bool-vectors, markers, buffers
and processes.  Conses, lists, vectors and records are ordered
lexicographically.
It is intended as a convenient ordering predicate for sorting, and is
likely to be faster than hand-written Lisp functions.</code></pre>
<p class=\" text-justify\">Ah that is very useful actually. Now to remember that it exists…</p>
<pre><code>New 'sort' arguments and features.
The 'sort' function can now be called using the signature

    (sort SEQ &amp;rest KEYWORD-ARGUMENTS)

where arguments after the first are keyword/value pairs, all optional:
':key' specifies a function that produces the sorting key from an element,
':lessp' specifies the ordering predicate, defaulting to 'value&lt;',
':reverse' is used to reverse the sorting order,
':in-place' is used for in-place sorting, as the default is now to
sort a copy of the input.

The new signature is less error-prone and reduces the need to write
ordering predicates by hand.  We recommend that you use the ':key'
argument instead of ':lessp' unless a suitable ordering predicate is
already available.  This can also be used for multi-key sorting:

    (sort seq :key (lambda (x) (list (age x) (size x) (cost x))))

sorts by the return value of 'age', then by 'size', then by 'cost'.

The old signature, '(sort SEQ PREDICATE)', can still be used and sorts
its input in-place as before.</code></pre>
<pre><code>New API for 'derived-mode-p' and control of the graph of major modes</code></pre>
<pre><code>'derived-mode-p' now takes the list of modes as a single argument.
The same holds for 'provided-mode-derived-p'.
The old calling convention where multiple modes are passed as
separate arguments is deprecated.</code></pre>
<pre><code>New functions to access the graph of major modes.
While 'define-derived-mode' still only supports single inheritance,
modes can declare additional parents (for tests like 'derived-mode-p')
with 'derived-mode-add-parents'.
Accessing the 'derived-mode-parent' property directly is now
deprecated in favor of the new functions 'derived-mode-set-parent'
and 'derived-mode-all-parents'.</code></pre>
<p class=\" text-justify\">This complexity is yet again borne out of tree-sitter’s introduction to Emacs. I do wonder if all this complexity (remember diamond pattern inheritance in OO?) will come back to bite us in a few years… I hope not.</p>
<pre><code>Drag-and-drop functions can now be called once for compound drops.
It is now possible for drag-and-drop handler functions to respond to
drops incorporating more than one URL.  Functions capable of this must
set their 'dnd-multiple-handler' symbol properties to a non-nil value.
See the Info node \"(elisp) Drag and Drop\".

The function 'dnd-handle-one-url' has been made obsolete, since it
cannot take these new handlers into account.</code></pre>
<pre><code>'notifications-notify' can use Icon Naming Specification for ':app-icon'.
You can use a symbol as the value for ':app-icon' to provide icon name
without specifying a file, like this:

    (notifications-notify
      :title \"I am playing music\" :app-icon 'multimedia-player)</code></pre>
<pre><code>New function 're-disassemble' to see the innards of a regexp.
If you built Emacs with '--enable-checking', you can use this to help
debug either your regexp performance problems or the regexp engine.</code></pre>
<pre><code>XLFDs are no longer restricted to 255 characters.
'font-xlfd-name' now returns an XLFD even if it is greater than 255
characters in length, provided that the LONG_XLFDs argument is true.
Other features in Emacs which employ XLFDs have been modified to
produce and understand XLFDs larger than 255 characters.</code></pre>
<pre><code>New macro 'static-if' for conditional evaluation of code.
This macro hides a form from the evaluator or byte-compiler based on a
compile-time condition.  This is handy for avoiding byte-compilation
warnings about code that will never actually run under some conditions.</code></pre>
<pre><code>Desktop notifications are now supported on the Haiku operating system.
The new function 'haiku-notifications-notify' provides a subset of the
capabilities of the 'notifications-notify' function in a manner
analogous to 'w32-notification-notify'.</code></pre>
<pre><code>New Haiku specific variable 'haiku-pass-control-tab-to-system'.
This sets whether Emacs should pass 'C-TAB' on to the system instead of
handling it, fixing a problem where window switching would not activate
if an Emacs frame had focus on the Haiku operating system.  Default
value is t.</code></pre>
<pre><code>New value 'if-regular' for the REPLACE argument to 'insert-file-contents'.
It results in 'insert-file-contents' erasing the buffer instead of
preserving markers if the file being inserted is not a regular file,
rather than signaling an error.</code></pre>
<pre><code>New variable 'current-key-remap-sequence'.
It is bound to the key sequence that caused a call to a function bound
within 'function-key-map' or 'input-decode-map' around those calls.</code></pre>
<pre><code>The function 'key-translate' can now remove translations.
If the second argument TO is nil, the existing key translation is
removed.</code></pre>
<pre><code>New variables describing the names of built in programs.
The new variables 'ctags-program-name', 'ebrowse-program-name',
'etags-program-name', 'hexl-program-name', 'emacsclient-program-name'
'movemail-program-name', and 'rcs2log-program-name' should be used
instead of \"ctags\", \"ebrowse\", \"etags\", \"hexl\", \"emacsclient\", and
\"rcs2log\", when starting one of these built in programs in a subprocess.</code></pre>
<pre><code>New variable 'case-symbols-as-words' affects case operations for symbols.
If non-nil, then case operations such as 'upcase-initials' or
'replace-match' (with nil FIXEDCASE) will treat the entire symbol name
as a single word.  This is useful for programming languages and styles
where only the first letter of a symbol's name is ever capitalized.
The default value of this variable is nil.</code></pre>
<pre><code>Bytecode is now always loaded eagerly.
Bytecode compiled with older Emacs versions for lazy loading using
'byte-compile-dynamic' is now loaded all at once.
As a consequence, 'fetch-bytecode' has no use, does nothing, and is
now obsolete.  The variable 'byte-compile-dynamic' has no effect any
more; compilation will always yield bytecode for eager loading.</code></pre>
<pre><code>Returned strings from functions and macros are never docstrings.
Functions and macros whose bodies consist of a single string literal now
only return that string, and will not use it as a docstring.  Example:

    (defun sing-a-song ()
      \"Sing a song.\")

The above function returns the string \"Sing a song.\" and has no
docstring.  Previously, that string was used as both the docstring and
return value, which was never what the programmer wanted.  If you want
the string to be a docstring, add an explicit return value.

This change applies to 'defun', 'defsubst', 'defmacro' and 'lambda'
forms; other defining forms such as 'cl-defun' already worked this way.</code></pre>
<H3 id=\"new-or-changed-byte-compilation-warnings\">New or changed byte-compilation warnings</H3>
<pre><code>Warn about missing 'lexical-binding' directive.
The compiler now warns if an Elisp file lacks the standard
'-*- lexical-binding: ... -*-' cookie on the first line.
This line typically looks something like

    ;;; My little pony mode  -*- lexical-binding: t -*-

It is needed to inform the compiler about which dialect of ELisp
your code is using: the modern dialect with lexical binding or
the old dialect with only dynamic binding.

Lexical binding avoids some name conflicts and allows the compiler to
detect more mistakes and generate more efficient code, so it is
recommended.  For how to adapt your code to lexical binding, see the
manual section \"(elisp) Converting to Lexical Binding\".

If your code cannot be converted to lexical binding, you can insert
the line

    ;;; -*- lexical-binding: nil -*-

first in the file to declare that it uses the old dialect.</code></pre>
<pre><code>Warn about empty bodies for more special forms and macros.
The compiler now warns about an empty body argument to 'when',
'unless', 'ignore-error' and 'with-suppressed-warnings' in addition to
the existing warnings for 'let' and 'let*'.  Example:

    (when (&gt; x 2))

This warning can be suppressed using 'with-suppressed-warnings' with
the warning name 'empty-body'.</code></pre>
<pre><code>Warn about quoted error names in 'condition-case' and 'ignore-error'.
The compiler now warns about quoted condition (error) names
in 'condition-case' and 'ignore-error'.  Example:

    (condition-case nil
        (/ x y)
      ('arith-error \"division by zero\"))

Quoting them adds the error name 'quote' to those handled or ignored
respectively, which was probably not intended.</code></pre>
<pre><code>Warn about comparison with literal constants without defined identity.
The compiler now warns about comparisons by identity with a literal
string, cons, vector, record, function, large integer or float as this
may not match any value at all.  Example:

    (eq x \"hello\")

Only literals for symbols and small integers (fixnums), including
characters, are guaranteed to have a consistent (unique) identity.
This warning applies to 'eq', 'eql', 'memq', 'memql', 'assq', 'rassq',
'remq' and 'delq'.

To compare by (structural) value, use 'equal', 'member', 'assoc',
'rassoc', 'remove' or 'delete' instead.  Floats and bignums can also
be compared using 'eql', '=' and 'memql'.  Function literals cannot be
compared reliably at all.

This warning can be suppressed using 'with-suppressed-warnings' with
the warning name 'suspicious'.</code></pre>
<pre><code>Warn about 'condition-case' without handlers.
The compiler now warns when the 'condition-case' form is used without
any actual handlers, as in

    (condition-case nil (read buffer))

because it has no effect other than the execution of the body form.
In particular, no errors are caught or suppressed.  If the intention
was to catch all errors, add an explicit handler for 'error', or use
'ignore-error' or 'ignore-errors'.

This warning can be suppressed using 'with-suppressed-warnings' with
the warning name 'suspicious'.</code></pre>
<pre><code>Warn about 'unwind-protect' without unwind forms.
The compiler now warns when the 'unwind-protect' form is used without
any unwind forms, as in

    (unwind-protect (read buffer))

because the behavior is identical to that of the argument; there is
no protection of any kind.  Perhaps the intended unwind forms have
been misplaced or forgotten, or the use of 'unwind-protect' could be
simplified away.

This warning can be suppressed using 'with-suppressed-warnings' with
the warning name 'suspicious'.</code></pre>
<pre><code>Warn about useless trailing 'cond' clauses.
The compiler now warns when a 'cond' form contains clauses following a
default (unconditional) clause.  Example:

    (cond ((= x 0) (say \"none\"))
          (t (say \"some\"))
          (say \"goodbye\"))

Such a clause will never be executed, and is likely to be a mistake,
perhaps due to misplaced parens.

This warning can be suppressed using 'with-suppressed-warnings' with
the warning name 'suspicious'.</code></pre>
<pre><code>Warn about mutation of constant values.
The compiler now warns about code that modifies program constants in
some obvious cases.  Examples:

    (setcar '(1 2) 7)
    (aset [3 4] 0 8)
    (aset \"abc\" 1 ?d)

Such code may have unpredictable behavior because the constants are part
of the program and are not data structures generated afresh during
execution; the compiler does not expect them to change.

To avoid the warning, operate on an object created by the program
(maybe a copy of the constant), or use a non-destructive operation
instead.

This warning can be suppressed using 'with-suppressed-warnings' with
the warning name 'mutate-constant'.</code></pre>
<pre><code>Warn about more ignored function return values.
The compiler now warns when the return value from certain functions is
implicitly ignored.  Example:

    (progn (nreverse my-list) my-list)

will elicit a warning because it is usually pointless to call
'nreverse' on a list without using the returned value.

To silence the warning, make use of the value in some way, such as
assigning it to a variable.  You can also wrap the function call in
'(ignore ...)', or use 'with-suppressed-warnings' with the warning
name 'ignored-return-value'.

The warning will only be issued for calls to functions declared
'important-return-value' or 'side-effect-free' (but not 'error-free').</code></pre>
<pre><code>Warn about docstrings that contain control characters.
The compiler now warns about docstrings with control characters other
than newline and tab.  This is often a result of improper escaping.
Example:

    (defun my-fun ()
      \"Uses c:\\remote\\dir\\files and the key \\C-x.\"
      ...)

where the docstring contains the four control characters 'CR', 'DEL',
'FF' and 'C-x'.

The warning name is 'docstrings-control-chars'.</code></pre>
<pre><code>The warning about wide docstrings can now be disabled separately.
Its warning name is 'docstrings-wide'.</code></pre>
<pre><code>'fset', 'defalias' and 'defvaralias' now signal an error for cyclic aliases.
Previously, 'fset', 'defalias' and 'defvaralias' could be made to
build circular function and variable indirection chains as in

    (defalias 'able 'baker)
    (defalias 'baker 'able)

but trying to use them would sometimes make Emacs hang.  Now, an attempt
to create such a loop results in an error.

Since circular alias chains now cannot occur, 'function-alias-p',
'indirect-function' and 'indirect-variable' will never signal an error.
Their 'noerror' arguments have no effect and are therefore obsolete.</code></pre>
<H3 id=\"touch-screen-support\">Touch Screen support</H3>
<pre><code>'x-popup-menu' now understands touch screen events.
When a 'touchscreen-begin' or 'touchscreen-end' event is passed as the
POSITION argument, it will behave as if that event was a mouse event.</code></pre>
<pre><code>New functions for handling touch screen events.
The new functions 'touch-screen-track-tap' and 'touch-screen-track-drag'
handle tracking common touch screen gestures from within a command.</code></pre>
<pre><code>New parameter to 'touchscreen-end' events.
CANCEL non-nil establishes that the touch sequence has been intercepted
by programs such as window managers and should be ignored with Emacs.</code></pre>
<pre><code>New variable 'inhibit-auto-fill' to temporarily prevent auto-fill.</code></pre>
<pre><code>New variable 'secondary-tool-bar-map'.
If non-nil, this variable contains a keymap of menu items that are
displayed along tool bar items defined by 'tool-bar-map'.  These items
are displayed below the tool bar if the value of 'tool-bar-position' is
'top', and above it if the value is 'bottom'.  This is used by
'modifier-bar-mode'.</code></pre>
<pre><code>New variable 'completion-lazy-hilit'.
Lisp programs that present completion candidates may bind this
variable non-nil around calls to functions such as
'completion-all-completions'.  This tells the underlying completion
styles to skip eager fontification of completion candidates, which
improves performance.  Such a Lisp program can then use the
'completion-lazy-hilit' function to fontify candidates just in time.</code></pre>
<pre><code>New primitive 'buffer-last-name'.
It returns the name of a buffer before the last time it was renamed or
killed.</code></pre>
<pre><code>New primitive 'marker-last-position'.
It returns the last position of a marker in its buffer even if that
buffer has been killed.  ('marker-position' would return nil in that
case.)</code></pre>
<H3 id=\"functions-and-variables-to-transpose-sexps\">Functions and variables to transpose sexps</H3>
<p class=\" text-justify\">Juri Linkov did an awful lot of work to try and salvage the rather broken tree-sitter “sexp” commands and I think he’s done a stellar job, considering how hard it is to do <a href=\"/article/combobulate-structured-movement-editing-treesitter\" class=\" article-link\">Structured Movement and Editing with Tree-Sitter</a> in a way that works the way users expect it work.</p>
<pre><code>New helper variable 'transpose-sexps-function'.
Lisp programs can now set this variable to customize the behavior of the
'transpose-sexps' command.</code></pre>
<pre><code>New function 'transpose-sexps-default-function'.
The previous implementation of 'transpose-sexps' was moved into its own
function, to be used in 'transpose-sexps-function'.</code></pre>
<pre><code>New function 'treesit-transpose-sexps'.
Tree-sitter now unconditionally sets 'transpose-sexps-function' for all
tree-sitter enabled modes to this function.</code></pre>
<H3 id=\"functions-and-variables-to-move-by-program-statements\">Functions and variables to move by program statements</H3>
<pre><code>New variable 'forward-sentence-function'.
Major modes can now set this variable to customize the behavior of the
'forward-sentence' command.</code></pre>
<pre><code>New function 'forward-sentence-default-function'.
The previous implementation of 'forward-sentence' is moved into its
own function, to be bound by 'forward-sentence-function'.</code></pre>
<pre><code>New function 'treesit-forward-sentence'.
All tree-sitter enabled modes that define 'sentence' in
'treesit-thing-settings' now set 'forward-sentence-function' to call
'treesit-forward-sentence'.</code></pre>
<H3 id=\"functions-and-variables-to-move-by-program-sexps\">Functions and variables to move by program sexps</H3>
<pre><code>New function 'treesit-forward-sexp'.
Tree-sitter conditionally sets 'forward-sexp-function' for major modes
that have defined 'sexp' in 'treesit-thing-settings' to enable
sexp-related motion commands.</code></pre>
<pre><code>New user option 'native-comp-async-warnings-errors-kind'.
It allows control of what kinds of warnings and errors from asynchronous
native compilation are reported to the parent Emacs process.  The
default is to report all errors and only important warnings.  If you
were used to customizing 'native-comp-async-report-warnings-errors' to
nil or 'silent', we suggest that you now leave it at its default value,
and see if you get only warnings that matter.</code></pre>
<pre><code>New 'ftype' function declaration.
The declaration '(ftype TYPE)' specifies the type of a function.
Example:

    (defun hello (x y)
      (declare (ftype (function (integer boolean) string)))
      ...)

specifies that the function takes two arguments, an integer and a
boolean, and returns a string.  If the compilation happens with
'compilation-safety' set to zero, this information can be used by the
native compiler to produce better code, but specifying an incorrect type
may lead to Emacs crashing.  See the Info node \"(elisp) Declare Form\"
for further information.</code></pre>
<p class=\" text-justify\">You can now declare the type of functions in Emacs, presumably to help the native compiler make informed choices about the input and return value. We are moving inexorably closer to Common Lisp…</p>
<pre><code>New 'important-return-value' function declaration and property.
The declaration '(important-return-value t)' sets the
'important-return-value' property which indicates that the function
return value should probably not be thrown away implicitly.</code></pre>
<pre><code>New functions 'file-user-uid' and 'file-group-gid'.
These functions are like 'user-uid' and 'group-gid', respectively, but
are aware of file name handlers, so they will return the remote UID or
GID for remote files (or -1 if the connection has no associated user).</code></pre>
<pre><code>'treesit-font-lock-rules' now accepts additional global keywords.
When supplied with ':default-language LANGUAGE', rules after it will
default to use 'LANGUAGE'.</code></pre>
<p class=\" text-justify\">A welcome bit of syntactic sugar.</p>
<pre><code>New optional argument to 'modify-dir-local-variable'.
An optional 5th argument FILE has been added to
'modify-dir-local-variable'.  It can be used to specify which file to
modify instead of the default \".dir-locals.el\".</code></pre>
<H3 id=\"connection-local-variables\">Connection local variables</H3>
<p class=\" text-justify\">Connection local variables are variables local to Tramp-specific connections.</p>
<pre><code>New macros 'connection-local-p' and 'connection-local-value'.
The former macro returns non-nil if a variable has a connection-local
binding.  The latter macro returns the connection-local value of a
variable if any, or its current value.</code></pre>
<H3 id=\"hash-tables\">Hash tables</H3>
<pre><code>':rehash-size' and ':rehash-threshold' args no longer have any effect.
These keyword arguments are now ignored by 'make-hash-table'.  Emacs
manages the memory for all hash table objects in the same way.
The functions 'hash-table-rehash-size' and 'hash-table-rehash-threshold'
remain for compatibility but now always return the old default values.</code></pre>
<pre><code>The printed representation has been shrunk and simplified.
The 'test' parameter is omitted if it is 'eql' (the default), as is
'data' if empty.  'rehash-size', 'rehash-threshold' and 'size' are
always omitted, and ignored if present when the object is read back in.</code></pre>
<H3 id=\"obarrays\">Obarrays</H3>
<pre><code>New obarray type.
Obarrays are now represented by an opaque type instead of using vectors.
They are created by 'obarray-make' and manage their internal storage
automatically, which means that the size parameter to 'obarray-make' can
safely be omitted.  That is, they do not become slower as they fill up.

The old vector representation is still accepted by functions operating
on obarrays, but 'obarrayp' only returns t for obarray objects.
'type-of' now returns 'obarray' for obarray objects.

Old code which (incorrectly) created \"obarrays\" as Lisp vectors filled
with something other than 0, as in '(make-vector N nil)', will no longer
work, and should be rewritten to use 'obarray-make'.  Alternatively, you
can fill the vector with 0.</code></pre>
<pre><code>New function 'obarray-clear' removes all symbols from an obarray.</code></pre>
<pre><code>'obarray-size' and 'obarray-default-size' are now obsolete.
They pertained to the internal storage size which is now irrelevant.</code></pre>
<pre><code>'treesit-install-language-grammar' can handle local directory instead of URL.
It is now possible to pass a directory of a local repository as URL
inside 'treesit-language-source-alist', so that calling
'treesit-install-language-grammar' will avoid cloning the repository.
It may be useful, for example, for the purposes of bisecting a
treesitter grammar.</code></pre>
<pre><code>New buffer-local variable 'tabulated-list-groups'.
It controls display and separate sorting of groups of entries.  By
default no grouping or sorting is done.</code></pre>
<pre><code>New variable 'revert-buffer-restore-functions'.
It helps to preserve various states after reverting the buffer.</code></pre>
<pre><code>New text property 'context-menu-functions'.
Like the variable with the same name, it adds menus from the list that
is the value of the property to context menus shown when clicking on the
text which as this property.</code></pre>
<pre><code>Detecting the end of an iteration of a keyboard macro.
'read-event', 'read-char', and 'read-char-exclusive' no longer return -1
when called at the end of an iteration of the execution of a keyboard
macro.  Instead, they will transparently continue reading available input
(e.g., from the keyboard).  If you need to detect the end of a macro
iteration, check the following condition before calling one of the
aforementioned functions:

    (and (arrayp executing-kbd-macro)
         (&gt;= executing-kbd-macro-index (length executing-kbd-macro)))</code></pre>
<pre><code>'vtable-update-object' updates an existing object with just two arguments.
It is now possible to update the representation of an object in a vtable
by calling 'vtable-update-object' with just the vtable and the object as
arguments.  (Previously, the OLD-OBJECT argument was required which, in
this case, would mean repeating the object in the argument list.)  When
replacing an object with a different one, passing both the new and old
objects is still necessary.</code></pre>
<pre><code>'vtable-insert-object' can insert \"before\" or at an index.
The signature of 'vtable-insert-object' has changed and is now:

    (vtable-insert-object TABLE OBJECT &amp;optional LOCATION BEFORE)

LOCATION corresponds to the old AFTER-OBJECT argument; if BEFORE is
non-nil, the new object is inserted before the LOCATION object, making
it possible to insert a new object at the top of the table.  (Before,
this was not possible.)  In addition, LOCATION can be an integer, a
(zero-based) index into the table at which the new object is inserted
(BEFORE is ignored in this case).</code></pre>
<pre><code>New function 'sqlite-execute-batch'.
This function lets the user execute multiple SQL statements in one go.
It is useful, for example, when a Lisp program needs to evaluate an
entire SQL file.</code></pre>
<H3 id=\"json\">JSON</H3>
<pre><code>'json-serialize' now always returns a unibyte string.
This is appropriate since it is an encoding operation.  In the unlikely
event that a multibyte string is needed, the result can be decoded using

    (decode-coding-string RESULT 'utf-8)</code></pre>
<pre><code>The parser keeps duplicated object keys in alist and plist output.
A JSON object such as '{\"a\":1,\"a\":2}' will now be translated into the
Lisp values '((a . 1) (a . 2))' or '(:a 1 :a 2)' if alist or plist
object types are requested.</code></pre>
<pre><code>The parser sometimes signals different types of errors.
It will now signal 'json-utf8-decode-error' for inputs that are not
correctly UTF-8 encoded.</code></pre>
<pre><code>The parser and encoder now accept arbitrarily large integers.
Previously, they were limited to the range of signed 64-bit integers.</code></pre>
<pre><code>New tree-sitter functions and variables for defining and using \"things\"</code></pre>
<pre><code>New variable 'treesit-thing-settings'.
It allows modes to define \"things\" like 'defun', 'text', 'sexp', and
'sentence' for navigation commands and tree-traversal functions.</code></pre>
<pre><code>New functions for navigating \"things\".
There are new navigation functions 'treesit-thing-prev',
'treesit-thing-next', 'treesit-navigate-thing',
'treesit-beginning-of-thing', and 'treesit-end-of-thing'.</code></pre>
<pre><code>New functions 'treesit-thing-at', 'treesit-thing-at-point'.</code></pre>
<p class=\" text-justify\">The tree-sitter-enabled equivalent of <code>thing-at-point</code>. This really should be merged into the existing thing at point system; if TS is available, then its settings should take precedence.</p>
<pre><code>Tree-traversing functions.
The functions 'treesit-search-subtree', 'treesit-search-forward',
'treesit-search-forward-goto', and 'treesit-induce-sparse-tree' now
accept more kinds of predicates.  Lisp programs can now use thing
symbols (defined in 'treesit-thing-settings') and any thing definitions
for the predicate argument.</code></pre>
<H3 id=\"other-tree-sitter-function-and-variable-changes\">Other tree-sitter function and variable changes</H3>
<pre><code>'treesit-parser-list' now takes additional optional arguments.
The additional arguments are LANGUAGE and TAG.  If LANGUAGE is given,
only return parsers for that language.  If TAG is given, only return
parsers with that tag.  Note that passing nil as tag doesn't mean return
all parsers, but rather \"all parsers with no tags\".</code></pre>
<pre><code>New variable 'treesit-primary-parser'.
This variable should be set by multi-langauge major modes before calling
'treesit-major-mode-setup', in order for tree-sitter integration
functionalities to operate correctly.</code></pre>
<p class=\" text-justify\">I’m not convinced having the notion of a primary parser is the right approach for multi-language support in a buffer. The notion of primacy is not going to resolve problems where multiple languages that do not know of each other have to coexist in the same buffer; those languages by definition do not have a primary language, and trying to coax Emacs and thus tree-sitter into thinking there is such a thing is flawed.</p>
<H3 id=\"changes-in-emacs-30.1-on-non-free-operating-systems\">Changes in Emacs 30.1 on Non-Free Operating Systems</H3>
<H3 id=\"ms-windows\">MS-Windows</H3>
<pre><code>You can now opt out of following MS-Windows' Dark mode.
By default, Emacs on MS-Windows follows the system's Dark mode for its
title bars' and scroll bars' appearance.  If the new user option
'w32-follow-system-dark-mode' is customized to the nil value, Emacs
will disregard the system's Dark mode and will always use the default
Light mode.</code></pre>
<pre><code>You can now use Image-Dired even if the 'convert' program is not installed.
If you don't have GraphicsMagick or ImageMagick installed, and thus the
'gm convert'/'convert' program is not available, Emacs on MS-Windows
will now use its own function 'w32image-create-thumbnail' to create
thumbnail images and show them in the thumbnail buffer.  Unlike with
using 'convert', this fallback method is synchronous, so Emacs will wait
until all the thumbnails are created and displayed, before showing them.</code></pre>
<pre><code>Emacs on MS-Windows now supports the ':stipple' face attribute.</code></pre>
") (guid ((isPermaLink . "false")) "/article/whats-new-in-emacs-301") (pubDate nil "Mon, 24 Feb 2025 08:28:41 +0000"))) ("Replacing tmux and GNU screen with Emacs" "<p class=\" text-justify drop-cap\">If you’re a command line hacker – and I know you are – then I am sure you are familiar with, and possibly use, GNU <code>screen</code> or its contemporary replacement, <code>tmux</code>. If you are in the process of <a href=\"/article/switching-from-vim-to-emacs\" class=\" article-link\">switching from Vim to Emacs</a>, then <code>tmux</code> is no doubt a large part of your workflow.</p>
<p class=\" text-justify\">But here’s the thing: you do not need a terminal multiplexer if you are already using Emacs. Emacs can accomplish nearly everything your terminal multiplexer can do. If you’re not a serious user of <code>screen</code> or <code>tmux</code>, but you’re still addicted to the command line, then I’m sure this article will convince you of the merits of multiplexers, and how Emacs can slot right in. If you’re still unconvinced after having read this article, then my parting advice is to read about the <a href=\"/article/keyboard-shortcuts-every-command-line-hacker-should-know-about-gnu-readline\" class=\" article-link\">keyboard shortcuts in GNU readline</a> as that’ll at least bring more of Emacs to your command line life.</p>
<p class=\" text-justify\">Before I get into the weeds of why, let me just quickly state that, sure, <code>tmux</code> and friends will always have their uses: on remote servers for people who insist on running their daemons inside a <code>screen</code> session like it’s 1997 (bonus points if it’s an IRC client); and of course for actual terminal use on machines where Emacs is not available, or where you have to work with others who may not know Emacs.</p>
<p class=\" text-justify\">Caveats aside, let me share why I think you should consider using Emacs for some or all of your multiplexing needs, as it can do everything from detaching and re-attaching sessions; to windowing; to terminal emulation and running shells; and even the odd bit of text editing…</p>
<H2 id=\"the-perils-of-terminal-programs\">The Perils of Terminal Programs</H2>
<p class=\" text-justify\">Naturally, terminal multiplexers are meant for terminals, and as such, I’ll talk exclusively about running Emacs in a terminal from now on, although nearly all the advice I write applies equally to GUI Emacs. My thoughts on terminal Emacs are well known if you’re a frequent reader, but I will restate them again by saying that running GUI Emacs is a far better proposition than running Emacs in a terminal (multiplexer or not) for the following simple reasons:</p>
<dl>
<dt>Key Bindings often clash with your terminal</dt>
<dd>
<p class=\" text-justify\">It’s such a common problem for beginners: they fire up Emacs in a terminal, and wonder why some keys don’t work at all. The answer is usually the terminal tool itself. You’ll have to disable their invasive overreach of your key bindings so they pass through to the terminal, but now you lose said key bindings as you may want to use them elsewhere.</p>
</dd>
<dt>Not all key bindings work in a terminal</dt>
<dd>
<p class=\" text-justify\">Despite a lot of bolted-on protocols, additions and extensions made over the years, the fact of the matter is that some keys are simply not possible to represent and transmit to a terminal and the underlying program. This is another common newbie trap.</p>
</dd>
<dt>Lack of fidelity</dt>
<dd>
<p class=\" text-justify\">You cannot view PDFs, use images, or rice your Emacs with fancy SVG icons; some terminal emulators have limited color bit depth. The value of this is debatable, but I find the ability to view PDFs and images useful.</p>
</dd>
<dt>Flow Control Chaos</dt>
<dd>
<p class=\" text-justify\">And the ultimate trap of them all: the ossified flow control feature that some terminals still enable by default. Type <code>Control+s</code> in some terminal setups, and your terminal freezes, so as to give you enough time to read the text before it can scroll by. <code>Control+q</code> thaws your terminal. A fantastic feature when you’re downloading Dr. Who fan scripts from a dusty newsgroup back in the 1980s. Today… not so much. You can permanently disable flow control with <code>stty -ixon</code>, but it’s just one more thing to think about.</p>
</dd>
</dl>
<p class=\" text-justify\">There’s one more reason not to run terminal Emacs inside a <em>terminal multiplexer</em> and that is… well, everything, actually. The multiplexer gets first dips on the ANSI escape codes terminals use to move the cursor and draw stuff to the screen, and it’s oh-so-easy to break or gum things up. Mismatched colors; loss of color bit-depth; keys not getting translated properly; keys intercepted and repurposed by the multiplexer; weird scrollback and buffering issues; the list goes on and on.</p>
<p class=\" text-justify\">Terminal multiplexers are awesome, but they’re also faced with a tricky problem: they <em>must</em> work with nearly everything in a way that is sensible and consistent and often across a wide range of terminal capabilities and platforms. Sure, you can tweak this stuff: do you really want to, though?</p>
<p class=\" text-justify\">So those are the downsides of terminal Emacs with or without the lather of a multiplexer messing with your escape codes. But as annoying as these issues are, terminal Emacs is a full-fledged Emacs experience otherwise.</p>
<p class=\" text-justify\">Now let’s replicate the multiplexing experience inside Emacs.</p>
<H2 id=\"emacss-client-server-architecture\">Emacs’s Client-Server Architecture</H2>
<p class=\" text-justify\">Of course Emacs has a client-server architecture. It’s a <em>text editor!</em></p>
<p class=\" text-justify\">Run <code>M-x server-start</code> in an active Emacs instance and your current Emacs becomes the server host. Note that there are multiple ways of running Emacs in server mode. If you use <code>emacs --daemon</code> to start the daemon, you’ll get a persistent daemon that does not spawn a frame; you must then type <code>emacsclient -c</code> to connect to your Emacs. A third way is <code>systemctl --user enable emacs</code> and you can let systemd run Emacs as a daemon.</p>
<p class=\" text-justify\">Either way, from that moment on, if you call <code>emacsclient</code>, Emacs will talk to your Emacs server. This is how experienced hackers prefer to use Emacs, but you do not have to, of course. If you run <code>emacs</code> it will launch a standalone instance. You can even mix and match.</p>
<p class=\" text-justify\">Now you can set <code>emacsclient</code> to your <code>$EDITOR</code> and everything Just Works.</p>
<blockquote>
<p class=\" text-justify\"><em>NOTE</em>: Emacs’s client-server architecture is not intended to straddle multiple computers; both should be run on the same machine, lest you run into weird, hard-to-debug problems. If you want to use Emacs ‘remotely’, you can use <a href=\"https://www.gnu.org/software/tramp/\" class=\" article-link\">Tramp</a> or <code>ssh</code> to your target machine and run Emacs as a client-server architecture there.</p>
</blockquote>
<H2 id=\"running-programs-from-emacs\">Running Programs from Emacs</H2>
<p class=\" text-justify\">Obviously this is the main purpose of a multiplexer, and Emacs is more than capable of doing this. Running instances of your favorite shell is the most common, so let’s start with that.</p>
<H3 id=\"shells-and-terminal-emulators\">Shells and Terminal Emulators</H3>
<table class=\" table\">
<colgroup>
<col style=\"width: 50%\">
<col style=\"width: 50%\">
</colgroup>
<tbody>
<tr class=\"odd\">
<td><strong>Command</strong></td>
<td><strong>Description</strong></td>
</tr>
<tr class=\"even\">
<td><code>M-x shell</code></td>
<td><p class=\" text-justify\">Runs your preferred shell via a pseudo-terminal or pipe. Uses Emacs keys, Emacs for scrollback, its own history, better search and a plain Emacs buffer.</p>
<p class=\" text-justify\">Limited emulation; cannot handle curses apps without third-party packages like <code>xterm-color</code>.</p></td>
</tr>
<tr class=\"odd\">
<td><code>M-x term</code></td>
<td>Emacs’s builtin terminal emulator. Can switch between traditional terminal mode and a mode that makes it temporarily behave like an Emacs buffer. Can be quite slow.</td>
</tr>
<tr class=\"even\">
<td><code>M-x vterm</code></td>
<td><p class=\" text-justify\">Uses <code>libvterm</code> to provide a modern, fast and compliant terminal emulator.</p>
<p class=\" text-justify\"><strong>NOTE</strong>: Requires a third-party package.</p></td>
</tr>
<tr class=\"odd\">
<td><code>M-x eat</code></td>
<td><p class=\" text-justify\">EAT is another terminal emulator that plugs into Eshell and also has its own terminal mode. Very fast.</p>
<p class=\" text-justify\"><strong>NOTE</strong>: Requires a third-party package.</p></td>
</tr>
<tr class=\"even\">
<td><code>M-x eshell</code></td>
<td><p class=\" text-justify\">Not a terminal emulator, but instead a replacement for your preferred shell. It’s loosely inspired by <code>zsh</code> and friends, and is written entirely in Emacs Lisp.</p>
<p class=\" text-justify\"><strong>NOTE</strong>: Eshell is a pathway to many abilities some consider to be unnatural.</p></td>
</tr>
</tbody>
</table>
<p class=\" text-justify\">My article on <a href=\"/article/running-shells-in-emacs-overview\" class=\" article-link\">Running Shells and Terminal Emulators in Emacs</a> is a more in-depth look at these options. If you want a near-terminal-like experience, then <code>vterm</code> is a great package. If you want to lean into the Emacs way of doing things, then <code>M-x shell</code> is a good choice, and that is what I mostly use, unless I absolutely have to run a curses app (then I use <code>M-x vterm</code>.) If you are unsure, then I recommend you install <code>vterm</code> and start with that.</p>
<p class=\" text-justify\">Another way – the more Emacsy way – is to instead consider that most things may not require a shell (and a terminal) at all for common tasks. If you just want to compile stuff (or run your development server, test harness, etc. etc.), then <a href=\"/article/compiling-running-scripts-emacs\" class=\" article-link\">compiling and running scripts in Emacs</a> is the way to go. You gain the added benefit of error highlighting (with hyperlinks to the erroneous file) that works with darn near every structured error output you can throw at it.</p>
<p class=\" text-justify\">But wait, there’s more: you can run a range of <a href=\"/article/network-utilities-emacs\" class=\" article-link\">command line network utilities</a>; <a href=\"/article/displaying-interacting-processes-proced\" class=\" article-link\">use M-x proced, Emacs’s replacement for top</a>; and use dired, Emacs’s <a href=\"/article/dired-shell-commands-find-xargs-replacement\" class=\" article-link\">directory editor</a> to do all sorts of cool stuff.</p>
<p class=\" text-justify\">For simple things? You can <a href=\"/article/executing-shell-commands-emacs\" class=\" article-link\">execute shell commands</a> directly, or even feed buffer text to the standard input of a command line program and get the output piped back. That solves a whole swathe of problems also.</p>
<H4 id=\"interacting-with-fzf\">Interacting with <code>fzf</code></H4>
<p class=\" text-justify\">Not really multiplexer related per se, so I’m going to point out that you can use <a href=\"/article/fuzzy-finding-emacs-instead-of-fzf\" class=\" article-link\">Emacs for fuzzy finding</a> instead of <code>fzf</code> using a fistful of shell script code. Kinda cool.</p>
<H3 id=\"starting-programs-from-outside-or-inside-emacs\">Starting programs from outside or inside Emacs</H3>
<p class=\" text-justify\">Another common thing to do with a multiplexer is to quickly open a program inside a running tmux instance; perhaps from a shell pane <em>inside</em> your <code>tmux</code> instance, or perhaps outside it.</p>
<p class=\" text-justify\">You can do this with Emacs also (with <code>M-x vterm</code> if it’s installed, otherwise <code>M-x term</code>) with the provided bash script. Let’s call it <code>emux.sh</code>:</p>
<div class=\"sourceCode\" id=\"cb1\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><span id=\"cb1-1\"><a href=\"#cb1-1\" aria-hidden=\"true\" tabindex=\"-1\" class=\" article-link\"></a><span class=\"co\">#!/usr/bin/env bash</span></span>
<span id=\"cb1-2\"><a href=\"#cb1-2\" aria-hidden=\"true\" tabindex=\"-1\" class=\" article-link\"></a><span class=\"bu\">set</span> <span class=\"at\">-o</span> nounset <span class=\"at\">-o</span> errexit <span class=\"at\">-o</span> pipefail</span>
<span id=\"cb1-3\"><a href=\"#cb1-3\" aria-hidden=\"true\" tabindex=\"-1\" class=\" article-link\"></a><span class=\"va\">argcmd</span><span class=\"op\">=</span><span class=\"st\">\"</span><span class=\"va\">$@</span><span class=\"st\">\"</span></span>
<span id=\"cb1-4\"><a href=\"#cb1-4\" aria-hidden=\"true\" tabindex=\"-1\" class=\" article-link\"></a><span class=\"va\">cmd</span><span class=\"op\">=</span><span class=\"st\">\"</span><span class=\"va\">${argcmd</span><span class=\"op\">:=</span><span class=\"va\">$SHELL}</span><span class=\"st\">\"</span></span>
<span id=\"cb1-5\"><a href=\"#cb1-5\" aria-hidden=\"true\" tabindex=\"-1\" class=\" article-link\"></a><span class=\"bu\">exec</span> emacsclient <span class=\"at\">-e</span> <span class=\"op\">&lt;&lt;EOF</span></span>
<span id=\"cb1-6\"><a href=\"#cb1-6\" aria-hidden=\"true\" tabindex=\"-1\" class=\" article-link\"></a><span class=\"st\">(let ((vterm-shell \"</span><span class=\"va\">${cmd}</span><span class=\"st\">\")) (if (fboundp 'vterm) (vterm t) (term vterm-shell)))</span></span>
<span id=\"cb1-7\"><a href=\"#cb1-7\" aria-hidden=\"true\" tabindex=\"-1\" class=\" article-link\"></a><span class=\"op\">EOF</span></span></code></pre></div>
<p class=\" text-justify\">Here I temporarily bind the Emacs variable <code>vterm-shell</code> to the command to run (it defaults to your shell). Then I invoke <code>vterm</code> (if it’s installed, otherwise I use <code>term</code>) and start a new instance.</p>
<p class=\" text-justify\">To use it is simple:</p>
<ul>
<li><code>./emux.sh top</code> runs <code>top</code> inside your active Emacs instance.</li>
<li><code>./emus.sh watch free -hg</code> calls <code>watch</code> and tells it to run <code>free -hg</code>.</li>
<li><code>./emux.sh</code> on its own will call your <code>$SHELL</code> instead.</li>
</ul>
<p class=\" text-justify\">All from the comfort of your Emacs. You don’t have to run this from inside an Emacs instance, either. Provided you’ve got the client-server feature enabled, it’ll work anywhere.</p>
<H3 id=\"detaching-and-attaching-long-running-programs\">Detaching and Attaching &amp; Long-running programs</H3>
<p class=\" text-justify\">By running programs in an Emacs server instance, you can leave them running even if you hang up your remote connection (such as when you disconnect from <code>ssh</code>) but that does depend a bit on the method you used to start your server. I recommend you daemonize it with <code>emacs --daemon</code>, or run it through systemd, to ensure this works.</p>
<p class=\" text-justify\">Your Emacs server remembers everything: processes, sockets, buffers — you name it. You can even have multiple daemons if you really, really want to.</p>
<p class=\" text-justify\">So if your workflow depends heavily on the ability to engage and disengage from a ‘running’ session of work, then Emacs can definitely do this.</p>
<p class=\" text-justify\">If you regularly work on remote servers, a lot of your work could be done from your local Emacs by talking to the remote server directly with Emacs’s <a href=\"https://www.gnu.org/software/tramp/\" class=\" article-link\">Tramp</a>.</p>
<H2 id=\"panes-windows-buffers-frames\">Panes, Windows, Buffers, Frames</H2>
<p class=\" text-justify\">Emacs’s windowing technology is so far ahead of every other terminal or GUI application that I’d struggle to even begin to cover all the things you can do with it. Emacs is a tiling window manager onto itself (and some do indeed use it as their tiling window manager!), with hundreds of commands and variables that govern how it works. It also has <em>frames</em> (Emacs’s name for what most people call <em>windows</em>), if you prefer a non-tiling approach.</p>
<p class=\" text-justify\">I’ve made a handy table of the window-related nomenclature used in <code>screen</code> and <code>tmux</code> and of course Emacs. They do differ, so let’s just quickly cover that.</p>
<table style=\"width:99%;\" class=\" table\">
<colgroup>
<col style=\"width: 24%\">
<col style=\"width: 24%\">
<col style=\"width: 24%\">
<col style=\"width: 24%\">
</colgroup>
<tbody>
<tr class=\"odd\">
<td><strong>Term</strong></td>
<td><strong>Emacs</strong></td>
<td><strong>tmux</strong></td>
<td><strong>GNU Screen</strong></td>
</tr>
<tr class=\"even\">
<td><strong>Frame</strong></td>
<td>The entire Emacs instance visible on screen, can contain multiple windows</td>
<td>The entire terminal instance running tmux, equivalent to the terminal window</td>
<td>The entire terminal instance running Screen, equivalent to the terminal window</td>
</tr>
<tr class=\"odd\">
<td><strong>Window</strong></td>
<td>A subdivision within a frame that displays one buffer</td>
<td>A full-screen view within a session that can be divided into panes (similar to tabs)</td>
<td>A full-screen virtual terminal identified by a number or name</td>
</tr>
<tr class=\"even\">
<td><strong>Buffer</strong></td>
<td>Container for text being edited, displayed within windows</td>
<td>No direct equivalent (closest is the content displayed in a pane)</td>
<td>No direct equivalent (closest is the content displayed in a window)</td>
</tr>
<tr class=\"odd\">
<td><strong>Pane</strong></td>
<td>No direct equivalent (similar to windows)</td>
<td>Subdivision of a window that contains a separate terminal instance</td>
<td>Called “regions” — subdivisions of the display when split screen is used</td>
</tr>
<tr class=\"even\">
<td><strong>Session</strong></td>
<td>Another term for an Emacs server instance</td>
<td>A collection of windows under a single server instance that can be detached/reattached</td>
<td>A detachable collection of windows running as a single process</td>
</tr>
</tbody>
</table>
<p class=\" text-justify\">Of note is that in Emacs, a <em>frame</em> is of course what most people would call a <em>window</em>, but there’s another dimension to it: frames behave differently in a terminal Emacs session.</p>
<p class=\" text-justify\">In terminal Emacs, a frame is really more like <em>window</em> in <code>tmux</code> or <code>screen</code>. Only one is ever visible at a time; in GUI Emacs, you can have many visible at the same time, subject to the whims of your window manager (tiling vs stacking for example) and Emacs has another set of complex commands for interacting with frames specifically. Emacs does its level best to provide parity between the GUI and terminal versions, but this is one area where there is some difference in appearance and behavior.</p>
<p class=\" text-justify\">Now let’s talk about – let’s call it “windowing features” for want of a better phrase – across the multiplexers and Emacs. There’s an awful lot of asterisks attached to some of these, but more on that below.</p>
<table style=\"width:99%;\" class=\" table\">
<colgroup>
<col style=\"width: 24%\">
<col style=\"width: 24%\">
<col style=\"width: 24%\">
<col style=\"width: 24%\">
</colgroup>
<tbody>
<tr class=\"odd\">
<td><strong>tmux Feature</strong></td>
<td><strong>screen Key Binding</strong></td>
<td><strong>tmux Key Binding</strong></td>
<td><strong>Emacs Key Binding</strong></td>
</tr>
<tr class=\"even\">
<td>Create new window</td>
<td><code>C-a c</code></td>
<td><code>C-b c</code></td>
<td><code>C-x 2</code>, <code>C-x 3</code> (splits instead)</td>
</tr>
<tr class=\"odd\">
<td>Close current window</td>
<td><code>C-a K</code></td>
<td><code>C-b &amp;</code></td>
<td><code>C-x 0</code> (close window), <code>C-x k</code> (kill buffer)</td>
</tr>
<tr class=\"even\">
<td>Rename current window</td>
<td><code>C-a A</code></td>
<td><code>C-b ,</code></td>
<td><code>M-x rename-buffer</code> or <code>C-x x r</code></td>
</tr>
<tr class=\"odd\">
<td>List all windows</td>
<td><code>C-a \"</code></td>
<td><code>C-b w</code></td>
<td><code>C-x b</code> (switch to) or <code>C-x C-b</code></td>
</tr>
<tr class=\"even\">
<td>Next window</td>
<td><code>C-a n</code></td>
<td><code>C-b n</code></td>
<td><code>C-x o</code> (other window)</td>
</tr>
<tr class=\"odd\">
<td>Previous window</td>
<td><code>C-a p</code></td>
<td><code>C-b p</code></td>
<td>N/A but you can fiddle with numeric arguments to <code>C-x o</code> to simulate it, or use windmove.</td>
</tr>
<tr class=\"even\">
<td>Go to window by number</td>
<td><code>C-a [0-9]</code></td>
<td><code>C-b [0-9]</code></td>
<td>Registers can sort of stand in for this, but there is no simple equivalent.</td>
</tr>
<tr class=\"odd\">
<td>Go to last active window</td>
<td><code>C-a C-a</code></td>
<td><code>C-b l</code></td>
<td>Maybe <code>M-x mode-line-other-buffer</code></td>
</tr>
<tr class=\"even\">
<td>Split window horizontally</td>
<td><code>C-a S</code> (added later)</td>
<td><code>C-b \"</code></td>
<td><code>C-x 2</code></td>
</tr>
<tr class=\"odd\">
<td>Split window vertically</td>
<td><code>C-a |</code> (added later)</td>
<td><code>C-b %</code></td>
<td><code>C-x 3</code></td>
</tr>
<tr class=\"even\">
<td>Move to next pane</td>
<td><code>C-a tab</code></td>
<td><code>C-b o</code></td>
<td><code>C-x o</code></td>
</tr>
<tr class=\"odd\">
<td>Convert pane to window</td>
<td>N/A</td>
<td><code>C-b !</code></td>
<td>N/A</td>
</tr>
<tr class=\"even\">
<td>Show pane numbers</td>
<td>N/A</td>
<td><code>C-b q</code></td>
<td>N/A</td>
</tr>
<tr class=\"odd\">
<td>Toggle between pane layouts</td>
<td>N/A</td>
<td><code>C-b space</code></td>
<td>Window Configurations; <code>M-x tab-bar-mode</code></td>
</tr>
<tr class=\"even\">
<td>Resize pane</td>
<td>N/A (not as intuitive)</td>
<td><code>C-b C-[arrow keys]</code></td>
<td><code>C-x {</code> / <code>C-x }</code></td>
</tr>
<tr class=\"odd\">
<td>Break pane into window</td>
<td>N/A</td>
<td><code>C-b !</code></td>
<td>N/A</td>
</tr>
<tr class=\"even\">
<td>Join pane from window</td>
<td>N/A</td>
<td><code>C-b :join-pane -s [window]</code></td>
<td>N/A</td>
</tr>
<tr class=\"odd\">
<td>Enter copy mode</td>
<td><code>C-a [</code></td>
<td><code>C-b [</code></td>
<td>N/A</td>
</tr>
<tr class=\"even\">
<td>Search in copy mode</td>
<td><code>/</code> (forward), <code>?</code> (backward)</td>
<td><code>/</code> (forward), <code>?</code> (backward)</td>
<td><code>C-s</code> (forward), <code>C-r</code> (backward)</td>
</tr>
<tr class=\"odd\">
<td>Swap window positions</td>
<td><code>C-a :number [n]</code></td>
<td><code>C-b .</code> (prompt for new number)</td>
<td>Use Windmove</td>
</tr>
<tr class=\"even\">
<td>Detach from session</td>
<td><code>C-a d</code></td>
<td><code>C-b d</code></td>
<td><code>C-x #</code> (if in an emacs client)</td>
</tr>
<tr class=\"odd\">
<td>Choose a session</td>
<td>N/A (via command line)</td>
<td><code>C-b s</code></td>
<td>Technically a thing, but multiple daemons is a rarely used feature.</td>
</tr>
<tr class=\"even\">
<td>Zoom pane (toggle full-screen)</td>
<td>N/A</td>
<td><code>C-b z</code></td>
<td><code>C-x 1</code></td>
</tr>
<tr class=\"odd\">
<td>Rotate panes</td>
<td>N/A</td>
<td><code>C-b C-o</code></td>
<td>N/A</td>
</tr>
<tr class=\"even\">
<td>Display clock</td>
<td><code>C-a t</code></td>
<td><code>C-b t</code></td>
<td><code>M-x display-time</code></td>
</tr>
<tr class=\"odd\">
<td>Command prompt</td>
<td><code>C-a :</code></td>
<td><code>C-b :</code></td>
<td><code>M-x</code></td>
</tr>
</tbody>
</table>
<p class=\" text-justify\"><code>tmux</code> and <code>screen</code> are not trying to be Emacs, and Emacs did not set out to replace either of these tools — it’s just that it is so advanced that it can step into the role of multiplexer with relative ease.</p>
<p class=\" text-justify\">Windows in Emacs are <em>transient</em> and considered disposable, and the commands are sort of built around that idea. That is a stark difference to other IDEs and editors, but consider that this is a complex topic with a lot of opinions. Luckily, Emacs can accommodate most of people’s complex windowing requirements, if you’re willing to <a href=\"/article/demystifying-emacs-window-manager\" class=\" article-link\">learn how Emacs’s Window Manager works</a>. As such swapping windows or referencing them by number is not really an Emacsy thing to do, though you can with a little bit of code (or using a third-party package like <code>avy</code>), or perhaps by bending registers to your will.</p>
<p class=\" text-justify\">In Emacs you have to contend with buffers first and foremost, as that is the <a href=\"/article/why-emacs-has-buffers\" class=\" article-link\">currency of Emacs</a>. Buffers, though, have no real equivalents in the multiplexers, as you can preserve the window layout in Emacs but change their buffers to show something else (though you technically <em>can</em> do this in <code>tmux</code>, it’s clearly not a well-trodden path) so in Emacs I’ve crammed both buffer and window switching commands into the mix. I would be remiss if I did not also mention both <code>M-x global-tab-line-mode</code>, for browser-style tabs; and <code>M-x tab-bar-mode</code> to set up and switch between window configurations (“pane layouts” in <code>tmux</code>), but more on that below.</p>
<p class=\" text-justify\">The builtin package <em>windmove</em> adds ortographic movement from the current active window (for example, <code>C-x &lt;up&gt;</code> to pick the window above the current one) as opposed to layout-driven keys like <code>C-x o</code> that cycle through the windows on your screen. It’s a useful package, and one a lot of people use to make movement between windows more intuitive and faster.</p>
<p class=\" text-justify\">Detaching / attaching to a session is best done by explicitly launching a server daemon (as I mentioned before) with <code>emacs --daemon</code> and then connecting and disconnecting (<code>C-x #</code>) at will with <code>emacsclient</code>.</p>
<p class=\" text-justify\">Because GUI frames and terminal frames behave differently, I have opted to use a mix of buffer and window commands to represent the pane/window commands as that is ultimately what you are going to use in Emacs. But that’s obviously not the only way of looking at this: if you want to mirror the behavior of <code>screen</code> or <code>tmux</code> you can use Emacs’s frames for some of this:</p>
<table style=\"width:99%;\" class=\" table\">
<colgroup>
<col style=\"width: 25%\">
<col style=\"width: 24%\">
<col style=\"width: 24%\">
<col style=\"width: 24%\">
</colgroup>
<tbody>
<tr class=\"odd\">
<td><strong>Operation</strong></td>
<td><strong>Terminal Emacs Frame</strong></td>
<td><strong>tmux</strong></td>
<td><strong>GNU Screen</strong></td>
</tr>
<tr class=\"even\">
<td>Create new frame</td>
<td><code>C-x 5 2</code></td>
<td><code>C-b c</code> (new window)</td>
<td><code>C-a c</code> (new window)</td>
</tr>
<tr class=\"odd\">
<td>Switch to next frame</td>
<td><code>C-x 5 o</code></td>
<td><code>C-b n</code> (next window)</td>
<td><code>C-a n</code> (next window)</td>
</tr>
<tr class=\"even\">
<td>Previous frame</td>
<td>N/A</td>
<td><code>C-b p</code> (previous window)</td>
<td><code>C-a p</code> (previous window)</td>
</tr>
<tr class=\"odd\">
<td>Close current frame</td>
<td><code>C-x 5 0</code></td>
<td><code>C-b &amp;</code> (kill window)</td>
<td><code>C-a K</code> (kill window)</td>
</tr>
<tr class=\"even\">
<td>Open file in new frame</td>
<td><code>C-x 5 f</code></td>
<td><code>C-b c</code></td>
<td><code>C-a c</code></td>
</tr>
<tr class=\"odd\">
<td>Open buffer in new frame</td>
<td><code>C-x 5 b</code></td>
<td><code>C-b c</code></td>
<td><code>C-a c</code></td>
</tr>
<tr class=\"even\">
<td>List all frames</td>
<td><code>M-x select-frame-by-name</code></td>
<td><code>C-b w</code> (list windows)</td>
<td><code>C-a \"</code> (list windows)</td>
</tr>
<tr class=\"odd\">
<td>Rename current frame</td>
<td><code>M-x set-frame-name</code></td>
<td><code>C-b ,</code> (rename window)</td>
<td><code>C-a A</code> (rename window)</td>
</tr>
</tbody>
</table>
<p class=\" text-justify\">Personally, I think the frame approach is an average facsimile, and that it’s better to just embrace Emacs’s way of doing things, instead of shoehorning frames into the multiplexers’ notion of “windows”.</p>
<p class=\" text-justify\">For that, I recommend you just use <code>M-x tab-bar-mode</code>. Each tab is its own window configuration, and you can interact with tabs in many ways. Note again that tab <em>bars</em> are not like tab <em>lines</em>, the latter being more like a browser’s open tabs.</p>
<table class=\" table\">
<colgroup>
<col style=\"width: 51%\">
<col style=\"width: 48%\">
</colgroup>
<tbody>
<tr class=\"odd\">
<td><strong>Operation</strong></td>
<td><strong>Emacs tab-bar-mode Key Binding</strong></td>
</tr>
<tr class=\"even\">
<td>Enable tab-bar-mode</td>
<td><code>M-x tab-bar-mode</code></td>
</tr>
<tr class=\"odd\">
<td>Create new tab</td>
<td><code>C-x t 2</code> or <code>C-x t n</code></td>
</tr>
<tr class=\"even\">
<td>Close current tab</td>
<td><code>C-x t 0</code> or <code>C-x t k</code></td>
</tr>
<tr class=\"odd\">
<td>Rename current tab</td>
<td><code>C-x t r</code></td>
</tr>
<tr class=\"even\">
<td>Switch to next tab</td>
<td><code>C-x t o</code> or <code>C-TAB</code></td>
</tr>
<tr class=\"odd\">
<td>Switch to previous tab</td>
<td><code>C-S-TAB</code></td>
</tr>
<tr class=\"even\">
<td>Switch to tab by name</td>
<td><code>C-x t RET</code></td>
</tr>
<tr class=\"odd\">
<td>Duplicate current tab</td>
<td><code>C-x t n</code></td>
</tr>
<tr class=\"even\">
<td>List all tabs</td>
<td><code>M-x tab-switcher</code> or <code>M-x tab-list</code></td>
</tr>
<tr class=\"odd\">
<td>Open file in new tab</td>
<td><code>C-x t f</code></td>
</tr>
</tbody>
</table>
<p class=\" text-justify\">So that’s yet another way to do it. This is my preferred approach: it’s consistent across GUI and terminal Emacs, and it’s a more ergonomic way of interacting with window setups in Emacs. It is also a close approximation of how your terminal multiplexer treats distinct “windows”.</p>
<H2 id=\"prefix-keys\">Prefix Keys</H2>
<p class=\" text-justify\">The problem with <code>screen</code> and <code>tmux</code> is that their default prefix keys override two rather useful Emacs key bindings that <a href=\"/article/keyboard-shortcuts-every-command-line-hacker-should-know-about-gnu-readline\" class=\" article-link\">also work everywhere GNU Readline</a> is used: <code>C-a</code>, to move to the beginning of a line; and <code>C-b</code> to move backward a character.</p>
<p class=\" text-justify\">In Emacs, that obviously isn’t a problem, as the key bindings you’ll need are scattered across a range of keys, and in any event, you’ll have full control over the keys available to you inside Emacs and which ones are sent to the underlying process, should you choose to use Emacs as your terminal emulator.</p>
<H2 id=\"scrollback-copying-and-searching\">Scrollback, Copying and Searching</H2>
<p class=\" text-justify\">Emacs is a full-fledged text editor, and it has scrollback everywhere, so there’s not much more to say about that. Selecting (marking) and copying is available everywhere, and Emacs’s terminal emulators can switch from “terminal mode” to “cooked” (meaning it behaves like a regular Emacs buffer with freeform navigation) so you can copy and search as you please. Now is the time mention occur mode, one of many ways of sifting through text. It lets you <a href=\"/article/searching-buffers-occur-mode\" class=\" article-link\">regexp search in Buffers</a> with a handy popup window of the matches. Terminal multiplexers can’t do that without plugins.</p>
<H2 id=\"my-workflow\">My Workflow</H2>
<p class=\" text-justify\">Workflow are personal things, but I’ll quickly talk about how I use Emacs in lieu of a multiplexer.</p>
<ol type=\"1\">
<li><p class=\" text-justify\">I prefer to do everything local to my machine, where feasible.</p>
<p class=\" text-justify\">For remote sessions, I will use <code>ssh</code> in a <code>M-x shell</code> instance (unless I have to interface with curses apps, then I use <code>M-x vterm</code>) and combine it with <a href=\"https://www.gnu.org/software/tramp/\" class=\" article-link\">Tramp</a> for file editing.</p></li>
<li><p class=\" text-justify\">I avoid running Emacs on a remote machine directly because I will always opt for local, as I mentioned in #1. But when I <em>have</em> to, I will run emacs in a client-server architecture. Having said that, it is very rare that I cannot do 90% of my work from my local machine.</p>
<p class=\" text-justify\">For things like docker containers or even talking to kubernetes pods, I can do this with Tramp also. I can also ssh to a bastion host and then onwards to root with <code>sudo</code> and then perhaps into a container with <code>docker</code>. I can bookmark these things in Emacs so I can return to them with the snap of a finger.</p></li>
<li><p class=\" text-justify\">Emacs’s Tramp can execute command line programs remotely for you. If you’re editing a remote file in a buffer, then <code>M-x dired</code> (<code>C-x d</code>) and tools like <code>M-x compile</code>, <code>M-x grep</code>, etc. automatically call out to their remote counterpart and return the results back to your local Emacs instance. Very powerful.</p></li>
<li><p class=\" text-justify\"><code>M-x shell</code> is the right tool for me. It’s a ‘dumb terminal’ in the sense that everything is fed into an Emacs buffer which is then enriched with features such as history, prompt detection, and more. Works great, except when it does not. However, I can live with the tradeoffs. I prefer a free-flowing buffer with all the advantages and disadvantages that brings. For example, I can type <code>M-s h p</code> (<code>M-x highlight-phrase</code>) and highlight stuff in the buffer by regexp. Emacs will highlight current and future instances.</p>
<p class=\" text-justify\">I’m sure you’re thinking of all the many, many instances in your career where you wished you could do such a simple, simple thing like highlight stuff.</p></li>
<li><p class=\" text-justify\">Watching logs and other changing files. Again with Tramp: open the file then <code>M-x auto-revert-mode</code> or <code>M-x auto-revert-tail-mode</code> and Emacs will revert the file when it changes. Simple.</p></li>
</ol>
<p class=\" text-justify\">And that’s just <em>some</em> of the things I do. The main thing to take away from my workflow – and this article – is that things orbit around Emacs, because I am proficient at using Emacs, and it is capable of a great many things.</p>
<p class=\" text-justify\">Honestly? Thrashing around on the command line – no matter your shell, even with nice ones like fish – feels like an enormous step back in productivity compared to using Emacs and regular old bash.</p>
<p class=\" text-justify\">But that’s me. You’ll build your own workflow that meets your needs.</p>
<H2 id=\"conclusion\">Conclusion</H2>
<p class=\" text-justify\">If you’re familiar with Emacs then most of my advice should not come as a surprise to you. If you’re new or still learning, then I hope this will give you some food for thought.</p>
<p class=\" text-justify\">You can pare back your use of your if it makes sense to do so: but most of the day-to-day grind I see <code>tmux</code> users do can easily be done from within Emacs, but with a real gain to your productivity. Switching to Emacs <em>just</em> to replace your terminal multiplexer is perhaps a harder sell, but if you can learn and memorize your multiplexer’s commands, then you’ll do just fine learning Emacs also.</p>
<p class=\" text-justify\">Let me know in the comments if ditching a multiplexer helps (or hinders!) your workflow!</p>" "https://www.masteringemacs.org/article/replacing-tmux-gnu-screen-emacs?utm_source=newsletter&utm_medium=rss" (26569 30826) new 5 nil nil ((title nil "Replacing tmux and GNU screen with Emacs") (link nil "https://www.masteringemacs.org/article/replacing-tmux-gnu-screen-emacs?utm_source=newsletter&utm_medium=rss") (description nil "If you live and breathe the terminal, then you are no doubt using a terminal multiplexer like GNU screen or tmux. But why not replace it with 100% all-natural Emacs? It can do everything your favorite multiplexer can do --- it can even edit text.") (encoded nil "
<p class=\" text-justify drop-cap\">If you’re a command line hacker – and I know you are – then I am sure you are familiar with, and possibly use, GNU <code>screen</code> or its contemporary replacement, <code>tmux</code>. If you are in the process of <a href=\"/article/switching-from-vim-to-emacs\" class=\" article-link\">switching from Vim to Emacs</a>, then <code>tmux</code> is no doubt a large part of your workflow.</p>
<p class=\" text-justify\">But here’s the thing: you do not need a terminal multiplexer if you are already using Emacs. Emacs can accomplish nearly everything your terminal multiplexer can do. If you’re not a serious user of <code>screen</code> or <code>tmux</code>, but you’re still addicted to the command line, then I’m sure this article will convince you of the merits of multiplexers, and how Emacs can slot right in. If you’re still unconvinced after having read this article, then my parting advice is to read about the <a href=\"/article/keyboard-shortcuts-every-command-line-hacker-should-know-about-gnu-readline\" class=\" article-link\">keyboard shortcuts in GNU readline</a> as that’ll at least bring more of Emacs to your command line life.</p>
<p class=\" text-justify\">Before I get into the weeds of why, let me just quickly state that, sure, <code>tmux</code> and friends will always have their uses: on remote servers for people who insist on running their daemons inside a <code>screen</code> session like it’s 1997 (bonus points if it’s an IRC client); and of course for actual terminal use on machines where Emacs is not available, or where you have to work with others who may not know Emacs.</p>
<p class=\" text-justify\">Caveats aside, let me share why I think you should consider using Emacs for some or all of your multiplexing needs, as it can do everything from detaching and re-attaching sessions; to windowing; to terminal emulation and running shells; and even the odd bit of text editing…</p>
<H2 id=\"the-perils-of-terminal-programs\">The Perils of Terminal Programs</H2>
<p class=\" text-justify\">Naturally, terminal multiplexers are meant for terminals, and as such, I’ll talk exclusively about running Emacs in a terminal from now on, although nearly all the advice I write applies equally to GUI Emacs. My thoughts on terminal Emacs are well known if you’re a frequent reader, but I will restate them again by saying that running GUI Emacs is a far better proposition than running Emacs in a terminal (multiplexer or not) for the following simple reasons:</p>
<dl>
<dt>Key Bindings often clash with your terminal</dt>
<dd>
<p class=\" text-justify\">It’s such a common problem for beginners: they fire up Emacs in a terminal, and wonder why some keys don’t work at all. The answer is usually the terminal tool itself. You’ll have to disable their invasive overreach of your key bindings so they pass through to the terminal, but now you lose said key bindings as you may want to use them elsewhere.</p>
</dd>
<dt>Not all key bindings work in a terminal</dt>
<dd>
<p class=\" text-justify\">Despite a lot of bolted-on protocols, additions and extensions made over the years, the fact of the matter is that some keys are simply not possible to represent and transmit to a terminal and the underlying program. This is another common newbie trap.</p>
</dd>
<dt>Lack of fidelity</dt>
<dd>
<p class=\" text-justify\">You cannot view PDFs, use images, or rice your Emacs with fancy SVG icons; some terminal emulators have limited color bit depth. The value of this is debatable, but I find the ability to view PDFs and images useful.</p>
</dd>
<dt>Flow Control Chaos</dt>
<dd>
<p class=\" text-justify\">And the ultimate trap of them all: the ossified flow control feature that some terminals still enable by default. Type <code>Control+s</code> in some terminal setups, and your terminal freezes, so as to give you enough time to read the text before it can scroll by. <code>Control+q</code> thaws your terminal. A fantastic feature when you’re downloading Dr. Who fan scripts from a dusty newsgroup back in the 1980s. Today… not so much. You can permanently disable flow control with <code>stty -ixon</code>, but it’s just one more thing to think about.</p>
</dd>
</dl>
<p class=\" text-justify\">There’s one more reason not to run terminal Emacs inside a <em>terminal multiplexer</em> and that is… well, everything, actually. The multiplexer gets first dips on the ANSI escape codes terminals use to move the cursor and draw stuff to the screen, and it’s oh-so-easy to break or gum things up. Mismatched colors; loss of color bit-depth; keys not getting translated properly; keys intercepted and repurposed by the multiplexer; weird scrollback and buffering issues; the list goes on and on.</p>
<p class=\" text-justify\">Terminal multiplexers are awesome, but they’re also faced with a tricky problem: they <em>must</em> work with nearly everything in a way that is sensible and consistent and often across a wide range of terminal capabilities and platforms. Sure, you can tweak this stuff: do you really want to, though?</p>
<p class=\" text-justify\">So those are the downsides of terminal Emacs with or without the lather of a multiplexer messing with your escape codes. But as annoying as these issues are, terminal Emacs is a full-fledged Emacs experience otherwise.</p>
<p class=\" text-justify\">Now let’s replicate the multiplexing experience inside Emacs.</p>
<H2 id=\"emacss-client-server-architecture\">Emacs’s Client-Server Architecture</H2>
<p class=\" text-justify\">Of course Emacs has a client-server architecture. It’s a <em>text editor!</em></p>
<p class=\" text-justify\">Run <code>M-x server-start</code> in an active Emacs instance and your current Emacs becomes the server host. Note that there are multiple ways of running Emacs in server mode. If you use <code>emacs --daemon</code> to start the daemon, you’ll get a persistent daemon that does not spawn a frame; you must then type <code>emacsclient -c</code> to connect to your Emacs. A third way is <code>systemctl --user enable emacs</code> and you can let systemd run Emacs as a daemon.</p>
<p class=\" text-justify\">Either way, from that moment on, if you call <code>emacsclient</code>, Emacs will talk to your Emacs server. This is how experienced hackers prefer to use Emacs, but you do not have to, of course. If you run <code>emacs</code> it will launch a standalone instance. You can even mix and match.</p>
<p class=\" text-justify\">Now you can set <code>emacsclient</code> to your <code>$EDITOR</code> and everything Just Works.</p>
<blockquote>
<p class=\" text-justify\"><em>NOTE</em>: Emacs’s client-server architecture is not intended to straddle multiple computers; both should be run on the same machine, lest you run into weird, hard-to-debug problems. If you want to use Emacs ‘remotely’, you can use <a href=\"https://www.gnu.org/software/tramp/\" class=\" article-link\">Tramp</a> or <code>ssh</code> to your target machine and run Emacs as a client-server architecture there.</p>
</blockquote>
<H2 id=\"running-programs-from-emacs\">Running Programs from Emacs</H2>
<p class=\" text-justify\">Obviously this is the main purpose of a multiplexer, and Emacs is more than capable of doing this. Running instances of your favorite shell is the most common, so let’s start with that.</p>
<H3 id=\"shells-and-terminal-emulators\">Shells and Terminal Emulators</H3>
<table class=\" table\">
<colgroup>
<col style=\"width: 50%\">
<col style=\"width: 50%\">
</colgroup>
<tbody>
<tr class=\"odd\">
<td><strong>Command</strong></td>
<td><strong>Description</strong></td>
</tr>
<tr class=\"even\">
<td><code>M-x shell</code></td>
<td><p class=\" text-justify\">Runs your preferred shell via a pseudo-terminal or pipe. Uses Emacs keys, Emacs for scrollback, its own history, better search and a plain Emacs buffer.</p>
<p class=\" text-justify\">Limited emulation; cannot handle curses apps without third-party packages like <code>xterm-color</code>.</p></td>
</tr>
<tr class=\"odd\">
<td><code>M-x term</code></td>
<td>Emacs’s builtin terminal emulator. Can switch between traditional terminal mode and a mode that makes it temporarily behave like an Emacs buffer. Can be quite slow.</td>
</tr>
<tr class=\"even\">
<td><code>M-x vterm</code></td>
<td><p class=\" text-justify\">Uses <code>libvterm</code> to provide a modern, fast and compliant terminal emulator.</p>
<p class=\" text-justify\"><strong>NOTE</strong>: Requires a third-party package.</p></td>
</tr>
<tr class=\"odd\">
<td><code>M-x eat</code></td>
<td><p class=\" text-justify\">EAT is another terminal emulator that plugs into Eshell and also has its own terminal mode. Very fast.</p>
<p class=\" text-justify\"><strong>NOTE</strong>: Requires a third-party package.</p></td>
</tr>
<tr class=\"even\">
<td><code>M-x eshell</code></td>
<td><p class=\" text-justify\">Not a terminal emulator, but instead a replacement for your preferred shell. It’s loosely inspired by <code>zsh</code> and friends, and is written entirely in Emacs Lisp.</p>
<p class=\" text-justify\"><strong>NOTE</strong>: Eshell is a pathway to many abilities some consider to be unnatural.</p></td>
</tr>
</tbody>
</table>
<p class=\" text-justify\">My article on <a href=\"/article/running-shells-in-emacs-overview\" class=\" article-link\">Running Shells and Terminal Emulators in Emacs</a> is a more in-depth look at these options. If you want a near-terminal-like experience, then <code>vterm</code> is a great package. If you want to lean into the Emacs way of doing things, then <code>M-x shell</code> is a good choice, and that is what I mostly use, unless I absolutely have to run a curses app (then I use <code>M-x vterm</code>.) If you are unsure, then I recommend you install <code>vterm</code> and start with that.</p>
<p class=\" text-justify\">Another way – the more Emacsy way – is to instead consider that most things may not require a shell (and a terminal) at all for common tasks. If you just want to compile stuff (or run your development server, test harness, etc. etc.), then <a href=\"/article/compiling-running-scripts-emacs\" class=\" article-link\">compiling and running scripts in Emacs</a> is the way to go. You gain the added benefit of error highlighting (with hyperlinks to the erroneous file) that works with darn near every structured error output you can throw at it.</p>
<p class=\" text-justify\">But wait, there’s more: you can run a range of <a href=\"/article/network-utilities-emacs\" class=\" article-link\">command line network utilities</a>; <a href=\"/article/displaying-interacting-processes-proced\" class=\" article-link\">use M-x proced, Emacs’s replacement for top</a>; and use dired, Emacs’s <a href=\"/article/dired-shell-commands-find-xargs-replacement\" class=\" article-link\">directory editor</a> to do all sorts of cool stuff.</p>
<p class=\" text-justify\">For simple things? You can <a href=\"/article/executing-shell-commands-emacs\" class=\" article-link\">execute shell commands</a> directly, or even feed buffer text to the standard input of a command line program and get the output piped back. That solves a whole swathe of problems also.</p>
<H4 id=\"interacting-with-fzf\">Interacting with <code>fzf</code></H4>
<p class=\" text-justify\">Not really multiplexer related per se, so I’m going to point out that you can use <a href=\"/article/fuzzy-finding-emacs-instead-of-fzf\" class=\" article-link\">Emacs for fuzzy finding</a> instead of <code>fzf</code> using a fistful of shell script code. Kinda cool.</p>
<H3 id=\"starting-programs-from-outside-or-inside-emacs\">Starting programs from outside or inside Emacs</H3>
<p class=\" text-justify\">Another common thing to do with a multiplexer is to quickly open a program inside a running tmux instance; perhaps from a shell pane <em>inside</em> your <code>tmux</code> instance, or perhaps outside it.</p>
<p class=\" text-justify\">You can do this with Emacs also (with <code>M-x vterm</code> if it’s installed, otherwise <code>M-x term</code>) with the provided bash script. Let’s call it <code>emux.sh</code>:</p>
<div class=\"sourceCode\" id=\"cb1\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><span id=\"cb1-1\"><a href=\"#cb1-1\" aria-hidden=\"true\" tabindex=\"-1\" class=\" article-link\"></a><span class=\"co\">#!/usr/bin/env bash</span></span>
<span id=\"cb1-2\"><a href=\"#cb1-2\" aria-hidden=\"true\" tabindex=\"-1\" class=\" article-link\"></a><span class=\"bu\">set</span> <span class=\"at\">-o</span> nounset <span class=\"at\">-o</span> errexit <span class=\"at\">-o</span> pipefail</span>
<span id=\"cb1-3\"><a href=\"#cb1-3\" aria-hidden=\"true\" tabindex=\"-1\" class=\" article-link\"></a><span class=\"va\">argcmd</span><span class=\"op\">=</span><span class=\"st\">\"</span><span class=\"va\">$@</span><span class=\"st\">\"</span></span>
<span id=\"cb1-4\"><a href=\"#cb1-4\" aria-hidden=\"true\" tabindex=\"-1\" class=\" article-link\"></a><span class=\"va\">cmd</span><span class=\"op\">=</span><span class=\"st\">\"</span><span class=\"va\">${argcmd</span><span class=\"op\">:=</span><span class=\"va\">$SHELL}</span><span class=\"st\">\"</span></span>
<span id=\"cb1-5\"><a href=\"#cb1-5\" aria-hidden=\"true\" tabindex=\"-1\" class=\" article-link\"></a><span class=\"bu\">exec</span> emacsclient <span class=\"at\">-e</span> <span class=\"op\">&lt;&lt;EOF</span></span>
<span id=\"cb1-6\"><a href=\"#cb1-6\" aria-hidden=\"true\" tabindex=\"-1\" class=\" article-link\"></a><span class=\"st\">(let ((vterm-shell \"</span><span class=\"va\">${cmd}</span><span class=\"st\">\")) (if (fboundp 'vterm) (vterm t) (term vterm-shell)))</span></span>
<span id=\"cb1-7\"><a href=\"#cb1-7\" aria-hidden=\"true\" tabindex=\"-1\" class=\" article-link\"></a><span class=\"op\">EOF</span></span></code></pre></div>
<p class=\" text-justify\">Here I temporarily bind the Emacs variable <code>vterm-shell</code> to the command to run (it defaults to your shell). Then I invoke <code>vterm</code> (if it’s installed, otherwise I use <code>term</code>) and start a new instance.</p>
<p class=\" text-justify\">To use it is simple:</p>
<ul>
<li><code>./emux.sh top</code> runs <code>top</code> inside your active Emacs instance.</li>
<li><code>./emus.sh watch free -hg</code> calls <code>watch</code> and tells it to run <code>free -hg</code>.</li>
<li><code>./emux.sh</code> on its own will call your <code>$SHELL</code> instead.</li>
</ul>
<p class=\" text-justify\">All from the comfort of your Emacs. You don’t have to run this from inside an Emacs instance, either. Provided you’ve got the client-server feature enabled, it’ll work anywhere.</p>
<H3 id=\"detaching-and-attaching-long-running-programs\">Detaching and Attaching &amp; Long-running programs</H3>
<p class=\" text-justify\">By running programs in an Emacs server instance, you can leave them running even if you hang up your remote connection (such as when you disconnect from <code>ssh</code>) but that does depend a bit on the method you used to start your server. I recommend you daemonize it with <code>emacs --daemon</code>, or run it through systemd, to ensure this works.</p>
<p class=\" text-justify\">Your Emacs server remembers everything: processes, sockets, buffers — you name it. You can even have multiple daemons if you really, really want to.</p>
<p class=\" text-justify\">So if your workflow depends heavily on the ability to engage and disengage from a ‘running’ session of work, then Emacs can definitely do this.</p>
<p class=\" text-justify\">If you regularly work on remote servers, a lot of your work could be done from your local Emacs by talking to the remote server directly with Emacs’s <a href=\"https://www.gnu.org/software/tramp/\" class=\" article-link\">Tramp</a>.</p>
<H2 id=\"panes-windows-buffers-frames\">Panes, Windows, Buffers, Frames</H2>
<p class=\" text-justify\">Emacs’s windowing technology is so far ahead of every other terminal or GUI application that I’d struggle to even begin to cover all the things you can do with it. Emacs is a tiling window manager onto itself (and some do indeed use it as their tiling window manager!), with hundreds of commands and variables that govern how it works. It also has <em>frames</em> (Emacs’s name for what most people call <em>windows</em>), if you prefer a non-tiling approach.</p>
<p class=\" text-justify\">I’ve made a handy table of the window-related nomenclature used in <code>screen</code> and <code>tmux</code> and of course Emacs. They do differ, so let’s just quickly cover that.</p>
<table style=\"width:99%;\" class=\" table\">
<colgroup>
<col style=\"width: 24%\">
<col style=\"width: 24%\">
<col style=\"width: 24%\">
<col style=\"width: 24%\">
</colgroup>
<tbody>
<tr class=\"odd\">
<td><strong>Term</strong></td>
<td><strong>Emacs</strong></td>
<td><strong>tmux</strong></td>
<td><strong>GNU Screen</strong></td>
</tr>
<tr class=\"even\">
<td><strong>Frame</strong></td>
<td>The entire Emacs instance visible on screen, can contain multiple windows</td>
<td>The entire terminal instance running tmux, equivalent to the terminal window</td>
<td>The entire terminal instance running Screen, equivalent to the terminal window</td>
</tr>
<tr class=\"odd\">
<td><strong>Window</strong></td>
<td>A subdivision within a frame that displays one buffer</td>
<td>A full-screen view within a session that can be divided into panes (similar to tabs)</td>
<td>A full-screen virtual terminal identified by a number or name</td>
</tr>
<tr class=\"even\">
<td><strong>Buffer</strong></td>
<td>Container for text being edited, displayed within windows</td>
<td>No direct equivalent (closest is the content displayed in a pane)</td>
<td>No direct equivalent (closest is the content displayed in a window)</td>
</tr>
<tr class=\"odd\">
<td><strong>Pane</strong></td>
<td>No direct equivalent (similar to windows)</td>
<td>Subdivision of a window that contains a separate terminal instance</td>
<td>Called “regions” — subdivisions of the display when split screen is used</td>
</tr>
<tr class=\"even\">
<td><strong>Session</strong></td>
<td>Another term for an Emacs server instance</td>
<td>A collection of windows under a single server instance that can be detached/reattached</td>
<td>A detachable collection of windows running as a single process</td>
</tr>
</tbody>
</table>
<p class=\" text-justify\">Of note is that in Emacs, a <em>frame</em> is of course what most people would call a <em>window</em>, but there’s another dimension to it: frames behave differently in a terminal Emacs session.</p>
<p class=\" text-justify\">In terminal Emacs, a frame is really more like <em>window</em> in <code>tmux</code> or <code>screen</code>. Only one is ever visible at a time; in GUI Emacs, you can have many visible at the same time, subject to the whims of your window manager (tiling vs stacking for example) and Emacs has another set of complex commands for interacting with frames specifically. Emacs does its level best to provide parity between the GUI and terminal versions, but this is one area where there is some difference in appearance and behavior.</p>
<p class=\" text-justify\">Now let’s talk about – let’s call it “windowing features” for want of a better phrase – across the multiplexers and Emacs. There’s an awful lot of asterisks attached to some of these, but more on that below.</p>
<table style=\"width:99%;\" class=\" table\">
<colgroup>
<col style=\"width: 24%\">
<col style=\"width: 24%\">
<col style=\"width: 24%\">
<col style=\"width: 24%\">
</colgroup>
<tbody>
<tr class=\"odd\">
<td><strong>tmux Feature</strong></td>
<td><strong>screen Key Binding</strong></td>
<td><strong>tmux Key Binding</strong></td>
<td><strong>Emacs Key Binding</strong></td>
</tr>
<tr class=\"even\">
<td>Create new window</td>
<td><code>C-a c</code></td>
<td><code>C-b c</code></td>
<td><code>C-x 2</code>, <code>C-x 3</code> (splits instead)</td>
</tr>
<tr class=\"odd\">
<td>Close current window</td>
<td><code>C-a K</code></td>
<td><code>C-b &amp;</code></td>
<td><code>C-x 0</code> (close window), <code>C-x k</code> (kill buffer)</td>
</tr>
<tr class=\"even\">
<td>Rename current window</td>
<td><code>C-a A</code></td>
<td><code>C-b ,</code></td>
<td><code>M-x rename-buffer</code> or <code>C-x x r</code></td>
</tr>
<tr class=\"odd\">
<td>List all windows</td>
<td><code>C-a \"</code></td>
<td><code>C-b w</code></td>
<td><code>C-x b</code> (switch to) or <code>C-x C-b</code></td>
</tr>
<tr class=\"even\">
<td>Next window</td>
<td><code>C-a n</code></td>
<td><code>C-b n</code></td>
<td><code>C-x o</code> (other window)</td>
</tr>
<tr class=\"odd\">
<td>Previous window</td>
<td><code>C-a p</code></td>
<td><code>C-b p</code></td>
<td>N/A but you can fiddle with numeric arguments to <code>C-x o</code> to simulate it, or use windmove.</td>
</tr>
<tr class=\"even\">
<td>Go to window by number</td>
<td><code>C-a [0-9]</code></td>
<td><code>C-b [0-9]</code></td>
<td>Registers can sort of stand in for this, but there is no simple equivalent.</td>
</tr>
<tr class=\"odd\">
<td>Go to last active window</td>
<td><code>C-a C-a</code></td>
<td><code>C-b l</code></td>
<td>Maybe <code>M-x mode-line-other-buffer</code></td>
</tr>
<tr class=\"even\">
<td>Split window horizontally</td>
<td><code>C-a S</code> (added later)</td>
<td><code>C-b \"</code></td>
<td><code>C-x 2</code></td>
</tr>
<tr class=\"odd\">
<td>Split window vertically</td>
<td><code>C-a |</code> (added later)</td>
<td><code>C-b %</code></td>
<td><code>C-x 3</code></td>
</tr>
<tr class=\"even\">
<td>Move to next pane</td>
<td><code>C-a tab</code></td>
<td><code>C-b o</code></td>
<td><code>C-x o</code></td>
</tr>
<tr class=\"odd\">
<td>Convert pane to window</td>
<td>N/A</td>
<td><code>C-b !</code></td>
<td>N/A</td>
</tr>
<tr class=\"even\">
<td>Show pane numbers</td>
<td>N/A</td>
<td><code>C-b q</code></td>
<td>N/A</td>
</tr>
<tr class=\"odd\">
<td>Toggle between pane layouts</td>
<td>N/A</td>
<td><code>C-b space</code></td>
<td>Window Configurations; <code>M-x tab-bar-mode</code></td>
</tr>
<tr class=\"even\">
<td>Resize pane</td>
<td>N/A (not as intuitive)</td>
<td><code>C-b C-[arrow keys]</code></td>
<td><code>C-x {</code> / <code>C-x }</code></td>
</tr>
<tr class=\"odd\">
<td>Break pane into window</td>
<td>N/A</td>
<td><code>C-b !</code></td>
<td>N/A</td>
</tr>
<tr class=\"even\">
<td>Join pane from window</td>
<td>N/A</td>
<td><code>C-b :join-pane -s [window]</code></td>
<td>N/A</td>
</tr>
<tr class=\"odd\">
<td>Enter copy mode</td>
<td><code>C-a [</code></td>
<td><code>C-b [</code></td>
<td>N/A</td>
</tr>
<tr class=\"even\">
<td>Search in copy mode</td>
<td><code>/</code> (forward), <code>?</code> (backward)</td>
<td><code>/</code> (forward), <code>?</code> (backward)</td>
<td><code>C-s</code> (forward), <code>C-r</code> (backward)</td>
</tr>
<tr class=\"odd\">
<td>Swap window positions</td>
<td><code>C-a :number [n]</code></td>
<td><code>C-b .</code> (prompt for new number)</td>
<td>Use Windmove</td>
</tr>
<tr class=\"even\">
<td>Detach from session</td>
<td><code>C-a d</code></td>
<td><code>C-b d</code></td>
<td><code>C-x #</code> (if in an emacs client)</td>
</tr>
<tr class=\"odd\">
<td>Choose a session</td>
<td>N/A (via command line)</td>
<td><code>C-b s</code></td>
<td>Technically a thing, but multiple daemons is a rarely used feature.</td>
</tr>
<tr class=\"even\">
<td>Zoom pane (toggle full-screen)</td>
<td>N/A</td>
<td><code>C-b z</code></td>
<td><code>C-x 1</code></td>
</tr>
<tr class=\"odd\">
<td>Rotate panes</td>
<td>N/A</td>
<td><code>C-b C-o</code></td>
<td>N/A</td>
</tr>
<tr class=\"even\">
<td>Display clock</td>
<td><code>C-a t</code></td>
<td><code>C-b t</code></td>
<td><code>M-x display-time</code></td>
</tr>
<tr class=\"odd\">
<td>Command prompt</td>
<td><code>C-a :</code></td>
<td><code>C-b :</code></td>
<td><code>M-x</code></td>
</tr>
</tbody>
</table>
<p class=\" text-justify\"><code>tmux</code> and <code>screen</code> are not trying to be Emacs, and Emacs did not set out to replace either of these tools — it’s just that it is so advanced that it can step into the role of multiplexer with relative ease.</p>
<p class=\" text-justify\">Windows in Emacs are <em>transient</em> and considered disposable, and the commands are sort of built around that idea. That is a stark difference to other IDEs and editors, but consider that this is a complex topic with a lot of opinions. Luckily, Emacs can accommodate most of people’s complex windowing requirements, if you’re willing to <a href=\"/article/demystifying-emacs-window-manager\" class=\" article-link\">learn how Emacs’s Window Manager works</a>. As such swapping windows or referencing them by number is not really an Emacsy thing to do, though you can with a little bit of code (or using a third-party package like <code>avy</code>), or perhaps by bending registers to your will.</p>
<p class=\" text-justify\">In Emacs you have to contend with buffers first and foremost, as that is the <a href=\"/article/why-emacs-has-buffers\" class=\" article-link\">currency of Emacs</a>. Buffers, though, have no real equivalents in the multiplexers, as you can preserve the window layout in Emacs but change their buffers to show something else (though you technically <em>can</em> do this in <code>tmux</code>, it’s clearly not a well-trodden path) so in Emacs I’ve crammed both buffer and window switching commands into the mix. I would be remiss if I did not also mention both <code>M-x global-tab-line-mode</code>, for browser-style tabs; and <code>M-x tab-bar-mode</code> to set up and switch between window configurations (“pane layouts” in <code>tmux</code>), but more on that below.</p>
<p class=\" text-justify\">The builtin package <em>windmove</em> adds ortographic movement from the current active window (for example, <code>C-x &lt;up&gt;</code> to pick the window above the current one) as opposed to layout-driven keys like <code>C-x o</code> that cycle through the windows on your screen. It’s a useful package, and one a lot of people use to make movement between windows more intuitive and faster.</p>
<p class=\" text-justify\">Detaching / attaching to a session is best done by explicitly launching a server daemon (as I mentioned before) with <code>emacs --daemon</code> and then connecting and disconnecting (<code>C-x #</code>) at will with <code>emacsclient</code>.</p>
<p class=\" text-justify\">Because GUI frames and terminal frames behave differently, I have opted to use a mix of buffer and window commands to represent the pane/window commands as that is ultimately what you are going to use in Emacs. But that’s obviously not the only way of looking at this: if you want to mirror the behavior of <code>screen</code> or <code>tmux</code> you can use Emacs’s frames for some of this:</p>
<table style=\"width:99%;\" class=\" table\">
<colgroup>
<col style=\"width: 25%\">
<col style=\"width: 24%\">
<col style=\"width: 24%\">
<col style=\"width: 24%\">
</colgroup>
<tbody>
<tr class=\"odd\">
<td><strong>Operation</strong></td>
<td><strong>Terminal Emacs Frame</strong></td>
<td><strong>tmux</strong></td>
<td><strong>GNU Screen</strong></td>
</tr>
<tr class=\"even\">
<td>Create new frame</td>
<td><code>C-x 5 2</code></td>
<td><code>C-b c</code> (new window)</td>
<td><code>C-a c</code> (new window)</td>
</tr>
<tr class=\"odd\">
<td>Switch to next frame</td>
<td><code>C-x 5 o</code></td>
<td><code>C-b n</code> (next window)</td>
<td><code>C-a n</code> (next window)</td>
</tr>
<tr class=\"even\">
<td>Previous frame</td>
<td>N/A</td>
<td><code>C-b p</code> (previous window)</td>
<td><code>C-a p</code> (previous window)</td>
</tr>
<tr class=\"odd\">
<td>Close current frame</td>
<td><code>C-x 5 0</code></td>
<td><code>C-b &amp;</code> (kill window)</td>
<td><code>C-a K</code> (kill window)</td>
</tr>
<tr class=\"even\">
<td>Open file in new frame</td>
<td><code>C-x 5 f</code></td>
<td><code>C-b c</code></td>
<td><code>C-a c</code></td>
</tr>
<tr class=\"odd\">
<td>Open buffer in new frame</td>
<td><code>C-x 5 b</code></td>
<td><code>C-b c</code></td>
<td><code>C-a c</code></td>
</tr>
<tr class=\"even\">
<td>List all frames</td>
<td><code>M-x select-frame-by-name</code></td>
<td><code>C-b w</code> (list windows)</td>
<td><code>C-a \"</code> (list windows)</td>
</tr>
<tr class=\"odd\">
<td>Rename current frame</td>
<td><code>M-x set-frame-name</code></td>
<td><code>C-b ,</code> (rename window)</td>
<td><code>C-a A</code> (rename window)</td>
</tr>
</tbody>
</table>
<p class=\" text-justify\">Personally, I think the frame approach is an average facsimile, and that it’s better to just embrace Emacs’s way of doing things, instead of shoehorning frames into the multiplexers’ notion of “windows”.</p>
<p class=\" text-justify\">For that, I recommend you just use <code>M-x tab-bar-mode</code>. Each tab is its own window configuration, and you can interact with tabs in many ways. Note again that tab <em>bars</em> are not like tab <em>lines</em>, the latter being more like a browser’s open tabs.</p>
<table class=\" table\">
<colgroup>
<col style=\"width: 51%\">
<col style=\"width: 48%\">
</colgroup>
<tbody>
<tr class=\"odd\">
<td><strong>Operation</strong></td>
<td><strong>Emacs tab-bar-mode Key Binding</strong></td>
</tr>
<tr class=\"even\">
<td>Enable tab-bar-mode</td>
<td><code>M-x tab-bar-mode</code></td>
</tr>
<tr class=\"odd\">
<td>Create new tab</td>
<td><code>C-x t 2</code> or <code>C-x t n</code></td>
</tr>
<tr class=\"even\">
<td>Close current tab</td>
<td><code>C-x t 0</code> or <code>C-x t k</code></td>
</tr>
<tr class=\"odd\">
<td>Rename current tab</td>
<td><code>C-x t r</code></td>
</tr>
<tr class=\"even\">
<td>Switch to next tab</td>
<td><code>C-x t o</code> or <code>C-TAB</code></td>
</tr>
<tr class=\"odd\">
<td>Switch to previous tab</td>
<td><code>C-S-TAB</code></td>
</tr>
<tr class=\"even\">
<td>Switch to tab by name</td>
<td><code>C-x t RET</code></td>
</tr>
<tr class=\"odd\">
<td>Duplicate current tab</td>
<td><code>C-x t n</code></td>
</tr>
<tr class=\"even\">
<td>List all tabs</td>
<td><code>M-x tab-switcher</code> or <code>M-x tab-list</code></td>
</tr>
<tr class=\"odd\">
<td>Open file in new tab</td>
<td><code>C-x t f</code></td>
</tr>
</tbody>
</table>
<p class=\" text-justify\">So that’s yet another way to do it. This is my preferred approach: it’s consistent across GUI and terminal Emacs, and it’s a more ergonomic way of interacting with window setups in Emacs. It is also a close approximation of how your terminal multiplexer treats distinct “windows”.</p>
<H2 id=\"prefix-keys\">Prefix Keys</H2>
<p class=\" text-justify\">The problem with <code>screen</code> and <code>tmux</code> is that their default prefix keys override two rather useful Emacs key bindings that <a href=\"/article/keyboard-shortcuts-every-command-line-hacker-should-know-about-gnu-readline\" class=\" article-link\">also work everywhere GNU Readline</a> is used: <code>C-a</code>, to move to the beginning of a line; and <code>C-b</code> to move backward a character.</p>
<p class=\" text-justify\">In Emacs, that obviously isn’t a problem, as the key bindings you’ll need are scattered across a range of keys, and in any event, you’ll have full control over the keys available to you inside Emacs and which ones are sent to the underlying process, should you choose to use Emacs as your terminal emulator.</p>
<H2 id=\"scrollback-copying-and-searching\">Scrollback, Copying and Searching</H2>
<p class=\" text-justify\">Emacs is a full-fledged text editor, and it has scrollback everywhere, so there’s not much more to say about that. Selecting (marking) and copying is available everywhere, and Emacs’s terminal emulators can switch from “terminal mode” to “cooked” (meaning it behaves like a regular Emacs buffer with freeform navigation) so you can copy and search as you please. Now is the time mention occur mode, one of many ways of sifting through text. It lets you <a href=\"/article/searching-buffers-occur-mode\" class=\" article-link\">regexp search in Buffers</a> with a handy popup window of the matches. Terminal multiplexers can’t do that without plugins.</p>
<H2 id=\"my-workflow\">My Workflow</H2>
<p class=\" text-justify\">Workflow are personal things, but I’ll quickly talk about how I use Emacs in lieu of a multiplexer.</p>
<ol type=\"1\">
<li><p class=\" text-justify\">I prefer to do everything local to my machine, where feasible.</p>
<p class=\" text-justify\">For remote sessions, I will use <code>ssh</code> in a <code>M-x shell</code> instance (unless I have to interface with curses apps, then I use <code>M-x vterm</code>) and combine it with <a href=\"https://www.gnu.org/software/tramp/\" class=\" article-link\">Tramp</a> for file editing.</p></li>
<li><p class=\" text-justify\">I avoid running Emacs on a remote machine directly because I will always opt for local, as I mentioned in #1. But when I <em>have</em> to, I will run emacs in a client-server architecture. Having said that, it is very rare that I cannot do 90% of my work from my local machine.</p>
<p class=\" text-justify\">For things like docker containers or even talking to kubernetes pods, I can do this with Tramp also. I can also ssh to a bastion host and then onwards to root with <code>sudo</code> and then perhaps into a container with <code>docker</code>. I can bookmark these things in Emacs so I can return to them with the snap of a finger.</p></li>
<li><p class=\" text-justify\">Emacs’s Tramp can execute command line programs remotely for you. If you’re editing a remote file in a buffer, then <code>M-x dired</code> (<code>C-x d</code>) and tools like <code>M-x compile</code>, <code>M-x grep</code>, etc. automatically call out to their remote counterpart and return the results back to your local Emacs instance. Very powerful.</p></li>
<li><p class=\" text-justify\"><code>M-x shell</code> is the right tool for me. It’s a ‘dumb terminal’ in the sense that everything is fed into an Emacs buffer which is then enriched with features such as history, prompt detection, and more. Works great, except when it does not. However, I can live with the tradeoffs. I prefer a free-flowing buffer with all the advantages and disadvantages that brings. For example, I can type <code>M-s h p</code> (<code>M-x highlight-phrase</code>) and highlight stuff in the buffer by regexp. Emacs will highlight current and future instances.</p>
<p class=\" text-justify\">I’m sure you’re thinking of all the many, many instances in your career where you wished you could do such a simple, simple thing like highlight stuff.</p></li>
<li><p class=\" text-justify\">Watching logs and other changing files. Again with Tramp: open the file then <code>M-x auto-revert-mode</code> or <code>M-x auto-revert-tail-mode</code> and Emacs will revert the file when it changes. Simple.</p></li>
</ol>
<p class=\" text-justify\">And that’s just <em>some</em> of the things I do. The main thing to take away from my workflow – and this article – is that things orbit around Emacs, because I am proficient at using Emacs, and it is capable of a great many things.</p>
<p class=\" text-justify\">Honestly? Thrashing around on the command line – no matter your shell, even with nice ones like fish – feels like an enormous step back in productivity compared to using Emacs and regular old bash.</p>
<p class=\" text-justify\">But that’s me. You’ll build your own workflow that meets your needs.</p>
<H2 id=\"conclusion\">Conclusion</H2>
<p class=\" text-justify\">If you’re familiar with Emacs then most of my advice should not come as a surprise to you. If you’re new or still learning, then I hope this will give you some food for thought.</p>
<p class=\" text-justify\">You can pare back your use of your if it makes sense to do so: but most of the day-to-day grind I see <code>tmux</code> users do can easily be done from within Emacs, but with a real gain to your productivity. Switching to Emacs <em>just</em> to replace your terminal multiplexer is perhaps a harder sell, but if you can learn and memorize your multiplexer’s commands, then you’ll do just fine learning Emacs also.</p>
<p class=\" text-justify\">Let me know in the comments if ditching a multiplexer helps (or hinders!) your workflow!</p>
") (guid ((isPermaLink . "false")) "/article/replacing-tmux-gnu-screen-emacs") (pubDate nil "Thu, 06 Mar 2025 10:26:50 +0000"))))